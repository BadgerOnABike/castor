---
title: "A Statistical Model of Caribou Habtiat in British Columbia"
author: "Tyler Muhly"
date: "January 17, 2019"
output: pdf_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## Introduction
The conservation and recovery of caribou popualtiosn across British Columbia (BC) has become an urgent prioirty for the provincal government and the government of Canada. The provincal governemtn recently supported a five year, $50 million program to corrdinate adn facilitate recovery actiosn across teh province. Integral to this program are decision support tools to help decision makers underatnd the implcaiitosn or alternative recovery actions. 

Decision support tools are infraomtion and models that represent factors of interest to decision makers. Specifically, these tools are being developed as a caribou and land use simulator (CLUS). The CLUS directly supports decision makers by providing spatial information (i.e., data and maps) on the current condition of the landscape (specifically, caribou habitat and populations and natural resource development), but more importantly, information on how future land use and climate change influences landscape condition. It will be used to help quantify, visualize and provide bounds to how alternate caribou recovery actions applied to an area (e.g., a group of caribou herds) could influence the future status of caribou and economic development in that area. The compoents of the CLUS are  transparent (i.e., available to the public), mathematical models (i.e., a documented, scientifically supported representation of reality using numbers and equations). These models reprsetn our undersadtning of ecology adn natural reorce development in a simplistic but useful way for supproting decision making. The CLUS model will allow decision makers to try out different management options (e.g., forest practices policies and habitat protection) before putting them into practice and identify those that achieve the desired balance between caribou recovery and economic costs and benefits. It helps improve the decision maker’s confidence in their decision by helping them understand the implications of alternative decisions, and the public’s confidence that the decision was based on a rational consideration of alternatives. 

Here I develop the cariobu habitat model component of the CLUS. The habitat model was developed using a resource selection function (RSF) and model selection process approach.  RSFs were calculated for three seasons (early winter, late winter and summer), and across four caribou designatable units (DUs), i.e., ecological designations, of caribou. Caribou DU's  in British Columbia include DU 6 (boreal), DU7 (northern mountain), DU8 (central mountain) and DU9 (sourthern mountain) [see COSEWIC 2011](https://www.canada.ca/content/dam/eccc/migration/cosewic-cosepac/4e5136bf-f3ef-4b7a-9a79-6d70ba15440f/cosewic_caribou_du_report_23dec2011.pdf). I had data that estimated measures of caribou habitat features (covaraites) at approximately 500,000 caribou telemetry locations collected across Brtisish Columbia, and approximately two million randomly sampled locations within caribou home ranges (i.e., 'available' locations). Cariobu selection of these habtait features was tested by formulating RSF models consisting of different combinatiosn of habtait covariates. Each RSF model reprsents a differetn hypothesis of habtiat features that influence cariobu. These hypotheses are coamrped in a model selection appraoch using Akaike's Infomation Criterion (AIC), and soem consdieation of their ability to predict cariobu occurence. 

The hyptohesis consisted of the follwong models:
- terrain adn water (soil parent amterail, lakes, watercoruses, eleavtion, aspect adn slope); cariobu are infleunced by 'enduring' features of teh ladnscape and/or these features represent or are proxies for a wide range of habtait featrues imprtoant to cariobu (food, predation risk, etc.)   
- forestry disturabnce (distance to cubtlocks of variaous age and different road types); well documented that cariobu distirbution and survical are inlfuenced by forestry activity, either as disturabnce or likely through predation meachnisms
- agricultural distruabnce (distance to agricultrual areas and different road types); likely contributes to predation mechanism; ag lands highly provudctive for ungualtes
- mine disturbance (distance to mines and different road types); highly modifed/disturbed ladnscape; cariobu shoudl avoid
- energy disturabnce; (distance to pipeliens and wells, sesimic lines and different road types); highly modifed/disturbed ladnscape; improtant preation mechanism, partiucalrly in boreal
- all human distruabnce (all huan distruabce covarties listed above); test whether all covaraites togetehr improve model fit
- 'natural' distruabce (burns adn beetles); natural distruabcen affects forest succesiion, early seral, which impacts food for ungulate sand predators; cariobu may avoid
- annual cliamte (temp, ppt, etc.); measures of climate taken over an annual period; long-term dirvers of habtiat
- seasonal climate; with lags?; measure sof climate over teh saeson that the cariobu occurred at those locations; shorter term dirvers of habtiat
- landcover (wetland (boreal only), bec, vri.....); broad classes of habitat; likely represent imprtoatn asptects fo food and predation
- forest stand (.....)


- combos of the above

- build a 'table' of these by DU/season; combos may vary by DU




## Methods
RSF models are a form of binomial logistic regression models that are used to statistically estimate habitat selection by animals (Boyce et al. 1999; Manly et al. 2007).


AIC is a model selction method, where models are ranked based on their fit to the data (log-likelihood) and the numebr of covaraites in teh model (Bunrham adn Anderson 2002). Models are penalzied for having more covaraites (i.e., are more complex).  


### GIS data
- CE data
  - roads: paved adn 'resoruce road' types


### Data Exploration
Did series of data visualtizatiosn to explore data for anamolies, potential issues with aplying regression mdoel and also better undersatdn potantil realtionships between covariates (Zuur et al. 2010)
 
First, looked for outliers using a bxolpot
 
```{r, boxplot data exploration, eval = F, echo = T}
ggplot (rsf.data.terrain.water.du6.ew, aes (x = pttype, y = elevation)) +
        geom_boxplot (outlier.colour = "red") +
        labs (title = "Boxplot DU6, Early Winter Elevation at Available (0) and Used (1) Locations",
              x = "Available (0) and Used (1) Locations",
              y = "Elevation")
```
 

Then looked at distbituion of data using hisotograms
```{r, histogram data exploration, eval = F, echo = T}
ggplot (rsf.data.terrain.water.du6.ew, aes (x = elevation, fill = pttype)) + 
        geom_histogram (position = "dodge", binwidth = 25) +
        labs (title = "Histogram DU6, Early Winter Elevation at Available (0) and Used (1) Locations",
              x = "Elevation",
              y = "Count") +
        scale_fill_discrete (name = "Location Type")
```

Then looked for corraltion using spearman correaltion analysis and plots 

I then tested for correlation between these covariates using a Spearman-rank ($\rho$) correlation and by calculating variance inflation factors (VIFs) from GLMs. If covariates had a $\rho$ > 0.7 or VIF > 10 (Montgomery and Peck 1992; Manly et al. 2007; DeCesare et al. 2012), then a covariate was removed from analysis. VIFs were calculated using the vif() function from the 'car' package in R. 


```{r, correlation plot, eval = F, echo = T}
corr.terrain.water.du6.ew <- rsf.data.terrain.water.du6.ew [c (10:15)]
corr.terrain.water.du6.ew <- round (cor (corr.terrain.water.du6.ew, method = "spearman"), 3)
ggcorrplot (corr.terrain.water.du6.ew, type = "lower", lab = TRUE, tl.cex = 10,  lab_size = 3,
            title = "Terrain and Water Resource Selection Function Model
            Covariate Correlations for DU6, Early Winter")
```


and coreatlions  variance inflation factors (VIFs) from 'car' package based on a simple glm
```{r, glm and vifs, eval = F, echo = T}
glm.terrain.du6.ew <- glm (pttype ~ elevation + easting + northing + slope + distance_to_lake +
                                     distance_to_watercourse + soil_parent_material_name, 
                            data = rsf.data.terrain.water.du6.ew,
                            family = binomial (link = 'logit'))
car::vif (glm.terrain.du6.ew)
```



### Fitting Models

- first, reviewed recent literature, herd plans, talked to regioanl biolgoists to get an undrstading of cariobu ecology in a DU

- used this to subset soem fo teh potential GIS covaiatres based on DU ecology

#### DU6
- select wetlands, avoid uplands; swamps, treed bogs and fens (Mumma and Gillinham 2017; http://www.bcogris.ca/sites/default/files/bcip-2015-09-final-report-may17.pdf)
- new (0-15) and old (16-40) cutblocks and burns, elevation, slope, disatcne to water, veg richness and raod density and sesimic density w (Mumma et al. 2018; https://reader.elsevier.com/reader/sd/pii/S0006320718307225?token=10CAC422DF6B2AE064234F05EE679D6B3C6D1FDC138746FA05D2E85C1D260B16F8B4392DBE5B0426F99BAFE911924D31)
- land cover, ndvi, slope, lakes, rivers, fires adn disturabnce (Demars 2018)
-  black spruce (Picea mariana) and tamarack (Larix laricina) (boreal herd plans)
- crandom efefct for idnvidual cariobu/year (Mumma et al. 2018; Demars 2018)

- endurign features tested:
  -  slope, disatcne to lake, distane to river, soil parnet maetiral 

- human features
  - raods, wells, piepline, seismic, agriculture, mine adn forestry
  

- covaraites tdandardized ((x-mean) / sd) to help with model convergence and simplify interepretation of relative effects of covariates


- compared models using AIC

- fit models with random efefcts (inercept for each unique indivudal and year, adn fixed efefcts for continouts and categoriacla covaraites, random efefcts account for indivdual anaimal variability and a random sampel of the popautlion; fixed efefcts are the popautliomn efefct, estiametd with random invidail varaition in sample accounted for in the model

- first fit terrain models, fit single covaraites, then combined, identified top model to combine with others

- for human disturabnce covariates, fit set of single covaraites models with and without itneraction terms for avauilable habtia in hoem range (Matthipolois)


## Results

### DU 6
#### Early Winter
##### Data Exploration
###### Enduring Features
- boxplots
- genrally didn;t appear to be signfiant outliers
- removed one location at 86 degree slope as outlier, unlikely to ever be eslected by cariobu even if in home range; very well coudl be a data error

![](plots/boxplot_terrain_water_du6_ew_slope.png)

![](plots/boxplot_terrain_water_du6_ew_dist_lake.png)

![](plots/boxplot_terrain_water_du6_ew_dist_watercourse.png)

- hisotragms
![](plots/hist_terrain_water_du6_ew_slope.png)
![](plots/hist_terrain_water_du6_ew_dist_lake.png)
![](plots/hist_terrain_water_du6_ew_dist_watercourse.png)

- correaltions
- not correalted, strongest was 0.07 between disatnce to lake and slope

![](plots/corr_terrain_water.png)

- highest vif value was 1.13

  - Endurign features top-ranked model included slope, disatnce to lake, and soil type and had an AIC weight (AIC*~w~*) of 0.511. The second ranked model included all covariates (elevation, slope, disatnce to lake, disatnce to watercourse, soil type) and had an AIC weight (AIC*~w~*) of 0.489 ; thus all covariates borught into next model. coefficent values of covairaets  for these two models were nearly ideantical, tehrefore ratehr than take average of each model, kept model with all covaraites for next 
  
  
###### Human Disturbance
- boxplots
- generally didn't appear to be signfiant outliers

![](plots/boxplot_terrain_water_du6_ew_distcut1to4.png)

![](plots/boxplot_terrain_water_du6_ew_distcut5to9.png)

![](plots/boxplot_terrain_water_du6_ew_distcut_over10.png)

![](plots/boxplot_terrain_water_du6_ew_dist_pvd_rd.png)

![](plots/boxplot_terrain_water_du6_ew_dist_resource_rd.png)

![](plots/boxplot_terrain_water_du6_ew_dist_ag.png)

![](plots/boxplot_terrain_water_du6_ew_dist_mine.png)

![](plots/boxplot_terrain_water_du6_ew_dist_pipe.png)

![](plots/boxplot_terrain_water_du6_ew_dist_well.png)

- hisotragms

![](plots/hist_terrain_water_du6_ew_dist_cut_1to4.png)
![](plots/hist_terrain_water_du6_ew_dist_cut_5to9.png)
![](plots/hist_terrain_water_du6_ew_dist_cut_over10.png)

![](plots/hist_terrain_water_du6_ew_dist_pvd_rd.png)

![](plots/hist_terrain_water_du6_ew_dist_res_rd.png)

![](plots/hist_terrain_water_du6_ew_dist_ag.png)

![](plots/hist_terrain_water_du6_ew_dist_mine.png)

![](plots/hist_terrain_water_du6_ew_dist_pipe.png)


![](plots/hist_terrain_water_du6_ew_dist_well.png)

- correlations
  - disatcne to agriculure highly correalted with disatnce to paved raoads ($\rho$ = 0.70) and some       cutblock ages ($\rho$ > 0.73), thus dropped that covariate
  - disatnce to pipeline adn distance to well highly correlated ($\rho$ = 0.74); dropped well because     mecahims of predation is via linear features; likely larger imapct than wells on cariobu 

![](plots/corr_human_dist.png)

- highest vif value was 3.56
 
  - Human disturbance features top-ranked model (AIC*~w~* 0.684) included the distance to cutblock covaraites, distance to road covariates distance to mine and distance to piepline and included an itneraction term  for distacne to pipeline. The second ranked model included the same covariates, and a covariate for sesimic lines,  and had an AIC*~w~* = 0.279.  Coefficent values of covairaets  for these two models were nearly ideantical, tehrefore ratehr than take average of each model, I used the model that included the seismic line covaraite rather tahn average models



  
###### Natural Disturbance
  
  - correlations
  - nor correalted

![](plots/corr_natrual_disturb_du6_ew.png)

-  vif values were less than 1.01

- the top model include burn age  (burns 1 to 5 years old, 6 to 25 years old and over 25 years old) adn beetle kill age (stands 1 to 5 years old and 6 to 9 years old) covaraites adn had an AIC*~w~* = 0.966; none of the models with functional responses converged

###### Annual Climate

- boxplots
- generally didn't appear to be signfiant outliers

![](plots/boxplot_annual_climate_du6_ew_frost_free_start.png)

![](plots/boxplot_annual_climate_du6_ew_grow_deg_day.png)

![](plots/boxplot_annual_climate_du6_ew_frost_free_end.png)

![](plots/boxplot_annual_climate_du6_ew_frost_free_period.png)

![](plots/boxplot_annual_climate_du6_ew_mean_annual_ppt.png)

![](plots/boxplot_annual_climate_du6_ew_mean_annual_temp.png)

![](plots/boxplot_annual_climate_du6_ew_mean_cold_mth_temp.png)

![](plots/boxplot_annual_climate_du6_ew_mean_warm_mth_temp.png)

![](plots/boxplot_annual_climate_du6_ew_mean_annual_pas.png)

- histograms

![](plots/hist_annual_climate_du6_ew_frost_free_start.png)

![](plots/hist_annual_climate_du6_ew_grow_deg_days.png)

![](plots/hist_annual_climate_du6_ew_frost_free_end.png)

![](plots/hist_annual_climate_du6_ew_frost_free_period.png)

![](plots/hist_annual_climate_du6_ew_mean_annual_ppt.png)

![](plots/hist_annual_climate_du6_ew_mean_annual_ppt.png)

![](plots/hist_annual_climate_du6_ew_mean_annual_temp.png)

![](plots/hist_annual_climate_du6_ew_mean_annual_cold_mth_temp.png)

![](plots/hist_annual_climate_du6_ew_mean_annual_warm_mth_temp.png)

![](plots/hist_annual_climate_du6_ew_mean_frost_free_days.png)

![](plots/hist_annual_climate_du6_ew_mean_pas.png)



 - correlations
    - frost free end day correalted with growing dregree days ($\rho$ = 0.79)
    - frost free period highly correlated with frost free start day ($\rho$ = -0.93), growing degree      days ($\rho$ = 0.75), frost free end day ($\rho$ = 0.70), and number of frost free days ($\rho$ =     0.85)
    - mean warmest month temperature highly correlated with growing degree days ($\rho$ = 0.87) and         mean coldest month temperature ($\rho$ = -0.73) 
    - number of frost free days highly correlated with frost free start day ($\rho$ = -0.76), growing       degree days ($\rho$ = 0.74), frost free end day ($\rho$ = 0.74), frost free period ($\rho$ =          0.85), and mean annual temperature ($\rho$ = 0.76)
    - precipitation as snow correlated with mean annual precipitation ($\rho$ = 0.81)

    - ended up using preceiptiation as snow, growing degree days and mean annual temprature
      - snow, indicator of winter conditions, mean annual temp indicator of larger climate                    conditions adn growing degree days indicator of foage production potential

![](plots/corr_annual_climate_du6_ew.png)

-  vif values were less than 2.47

- the top model include burn age  (burns 1 to 5 years old, 6 to 25 years old and over 25 years old) adn beetle kill age (stands 1 to 5 years old and 6 to 9 years old) covaraites adn had an AIC*~w~* = 0.966; none of the models with functional responses convereged


