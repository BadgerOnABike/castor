---
title: "Caribou Forest Cutblock Resoruce Selection Function Report"
output: word_document
---

```{r setup, include = FALSE}
knitr::opts_chunk$set (echo = TRUE)
require (dplyr)
require (ggplot2)
require (ggcorrplot)
require (gridExtra)
```

## Introduction
Here I summarize the data visualization and exploration done to identify which forestry cutblokc covariates to include in cairobu reserocue selction fucntion (RSF) models. This was doen across three seasons (early witner, ater winter adn summer) adn across four designatable units (DUs). I had data that estiametd the disatnce of each cariobu telemerty and each sampled available location to the nearest cutblock, by year, from one year old cuts up to greater than 50 year old cuts. I can't have 51 disatnce to cutblock covariaets int eh model, so here I look at whether distande to cublcok acorss eyars are correalted with each other. I also fit signle covairate genelaized lieanr models to look at changes in slection of ctublocks acorss years. I use this information to group years that are correalted in a meaningful way that will help simplify the model. 

I then also fit distance to cutblcok models usign  fucntional responses adn egeralized addtive models (GAMs) to look for non-lienar fits to the data. In the former case, I am testing whetehr slection of cublcoks is a fucntion of available disatnce to cutblocks within the caribou home range For the latter I am lookign for non-linear realtionhsips between cariobu selction and distance to cutblock.  

## Methods

### Correlation of Distance to Cutblock across Years
Here I tested whether distance to cutblock at locations in caribou home ranges tended to be correlated across years. The hypothesis was that distance to cutblock would be more correlated in proximate years (e.g., within 5 years) than years further apart. If distance to cutblock was highly correlated across proximate years, then it would be possible (and indeed necessary) to reduce the number of distance to cutblock covaraites in an RSF by grouping years together.   

I used a Spearman ($\rho$) correlation and correlated distance to cutblock between years in 10 years increments. Data were divided by designatable unit (DU) to comapre correaltions within similar types of caribou. Caribou DU's  in British Columbia include DU 6 (boreal), DU7 (northern mountain), DU8 (central mountain) and DU9 (sourthern mountain) [see COSEWIC 2011](https://www.canada.ca/content/dam/eccc/migration/cosewic-cosepac/4e5136bf-f3ef-4b7a-9a79-6d70ba15440f/cosewic_caribou_du_report_23dec2011.pdf). 

The following is an example of the code used to calculate and display the correaltion plots:
```{r, correlation plot code, eval = F, echo = T}
# data
rsf.data.cut.age <- read.csv ("C:\\Work\\caribou\\clus_data\\caribou_habitat_model\\rsf_data_cutblock_age.csv")

# Correlations
# Example code for first 10 years
dist.cut.1.10.corr <- rsf.data.cut.age [c (10:19)] # sub-sample 10 year periods
corr.1.10 <- round (cor (dist.cut.1.10.corr, method = "spearman"), 3)
p.mat.1.10 <- round (cor_pmat (dist.cut.1.10.corr), 2)
ggcorrplot (corr.1.10, type = "lower", lab = TRUE, tl.cex = 10,  lab_size = 3,
            title = "All Data Distance to Cutblock Correlation Years 1 to 10")
```

### Generalized Linear Models (GLMs) of Distance to Cutblock across Years
Here I test whether cariobu selection of distance to cutblock changes across years. The intent was to identify if there are temporal patterns in how cariobu slect cublocks, depending on teh age of the cutblock. This would also help with temporally grouping distance to cutblock, by identifying groups of years when caribou consistently selected or avodied cutblocks.  

I compared how caribou selected distance to cutblock across years by fitting seperate resource selection functions (RSFs), where each RSF had a single covariate for distance to cublock for each year since cut. For example, a RSF was fit with a single covariate for distance to one year old cutblock. RSFs were fit using binomial generalized linear models (GLMs) with a logit link (i.e., comparing used to available caribou locations). RSFs were fit for each season and DU to test whether patterns in distance to cutblock selection varied by each. 


The following is an example of the code used to calculate RSFs:
```{r, single covariate RSF model code, eval = F, echo = T}
dist.cut.data.du.6.ew <- dist.cut.data %>%
  dplyr::filter (du == "du6") %>% 
  dplyr::filter (season == "EarlyWinter")
glm.du.6.ew.1yo <- glm (pttype ~ distance_to_cut_1yo, 
                        data = dist.cut.data.du.6.ew,
                        family = binomial (link = 'logit'))
glm.du.6.ew.2yo <- glm (pttype ~ distance_to_cut_2yo, 
                        data = dist.cut.data.du.6.ew,
                        family = binomial (link = 'logit'))
....
....
....
glm.du.6.ew.51yo <- glm (pttype ~ distance_to_cut_pre50yo, 
                         data = dist.cut.data.du.6.ew,
                         family = binomial (link = 'logit'))
```

The beta coefficients of the distance to cutblock covariate were outputted from each model and plotted against the year age of the cutblock to illustrate how selection changed depending on the age of the cutblock. 

### Correlation of Distance to Cutblock Categories
Based on the results of the analysis described above, I grouped disatnce to cutblock into four temporal categories: one to four years old, five to nine years old, 10 to 29 years old and over 29 years old (see Results and Conclusion, below, for rational).

## Results
### Correlation Plots of Distance to Cutblock by Year for Designatable Unit (DU) 6
In the first 10 years (i.e., correlations between distance to cutblocks 1 to 10 years old), distance to cublock at locations in caribou home ranges were generally highly correlated. Correlations were particularly strong within two to three years ($\rho$ > 0.45). Correlations generally became weaker ($\rho$ < 0.4) after three to four years. Correlation between distance to cutblock 11 to 20, 21 to 30 and 31 to 40 years old were highly correlated across all 10 years ($\rho$ > 0.45). However, correlation between distance to cutblock in years 41 to 50 were gnerally not as strong, but also highly variable ($\rho$ = -0.07 to 0.86). 

![](R/caribou_habitat/plots/plot_dist_cut_corr_1_10_du6.png)

![](plots/plot_dist_cut_corr_1_10_du6.png)

![](plots/plot_dist_cut_corr_11_20_du6.png)

![](plots/plot_dist_cut_corr_21_30_du6.png)

![](plots/plot_dist_cut_corr_31_40_du6.png)

![](plots/plot_dist_cut_corr_41_50_du6.png)

### Correlation Plots of Distance to Cutblock by Year for Designatable Unit (DU) 7
Distance to cutblock was highly correlated across years within all the 10 years periods (\rho > 0.5). 

![](plots/plot_dist_cut_corr_1_10_du7.png)

![](plots/plot_dist_cut_corr_11_20_du7.png)

![](plots/plot_dist_cut_corr_21_30_du7.png)

![](plots/plot_dist_cut_corr_31_40_du7.png)

![](plots/plot_dist_cut_corr_41_50_du7.png)

### Correlation Plots of Distance to Cutblock by Year for Designatable Unit (DU) 8
In the first 10 years, distance to cublock at locations in caribou home ranges were generally highly correlated. Correlations were typically stronger within two to three years ($\rho$ > 0.35) and weaker after three to four years. In years 11 to 20, 21 to 30 and 31 to 40, distance to cutblock was highly correlated within one year ($\rho$ > 0.41), but less correlated when greater than one year apart. In years 41 to greater than 50 years, correlations were generally weak between years

![](plots/plot_dist_cut_corr_1_10_du8.png)

![](plots/plot_dist_cut_corr_11_20_du8.png)

![](plots/plot_dist_cut_corr_21_30_du8.png)

![](plots/plot_dist_cut_corr_31_40_du8.png)

![](plots/plot_dist_cut_corr_41_50_du8.png)

### Correlation Plots of Distance to Cutblock by Year for Designatable Unit (DU) 9
In the first 10 years, distance to cublock at locations in caribou home ranges were generally highly correlated within one year ($\rho$ > 0.44), and generally weaker thereafter. Correlation between distance to cutblock 11 to 20, 21 to 30, 31 to 40 adn 41 to greater than 50 years old were generally highly correlated across all 10 years, with few exceptions.

![](plots/plot_dist_cut_corr_1_10_du9.png)

![](plots/plot_dist_cut_corr_11_20_du9.png)

![](plots/plot_dist_cut_corr_21_30_du9.png)

![](plots/plot_dist_cut_corr_31_40_du9.png)

![](plots/plot_dist_cut_corr_41_50_du9.png)

### Resource Selection Function (RSF) Distance to Cutblock Beta Coefficients by Year, Season and Designatable Unit (DU)
In DU6, distance to cutblock generally had a weak effect on caribou resource selection across years. There was not a clear pattern in selection of cutblocks across years, and this lack of  pattern was consistent across seasons. In general, it appears that caribou in DU6, across all seasons, appear to avoid cutblocks less than three years old, select cutblocks four to ten years old and then avoid cutblocks over seven to ten years old.  
```{r, DU6 single covariate RSF model output, echo = F, fig.width = 7, fig.height = 5}
table.glm.summary <- read.csv ("data/table_glm_summary_forestry.csv")
table.glm.summary$DU <- as.factor (table.glm.summary$DU )
table.glm.summary.du6 <- table.glm.summary %>%
  filter (DU == 6)
print (ggplot (data = table.glm.summary.du6, 
        aes (years, coefficent.km)) +
  geom_line (aes (colour = Season)) +
  ggtitle ("Beta coefficient values of distance to cutblock by \n year and season for caribou designatable unit (DU) 6.") +
  xlab ("Years since harvest") + 
  ylab ("Beta coefficient") +
  geom_line (aes (x = years, y = 0), 
             size = 0.5, linetype = "solid", colour = "black") +
  theme (plot.title = element_text (hjust = 0.5),
         axis.text = element_text (size = 10),
         axis.title = element_text (size = 12),
         axis.line.x = element_line (size = 1),
         axis.line.y = element_line (size = 1),
         panel.grid.minor = element_blank (),
         panel.border = element_blank (),
         panel.background = element_blank ()) +
  scale_x_continuous (limits = c (0, 51), breaks = seq (0, 51, by = 5)) +
  scale_y_continuous (limits = c (-0.005, 0.005), breaks = seq (-0.005, 0.005, by = 0.001)))

```

In DU7, there was a more distinct pattern in caribou selection of cutblocks, and this pattern was different among the winter adn summer seasons. The early witner and late winter seasons were generally consistent. The  efefct of disatcne to cutblcoks was realtively weak across years, but the effect shifted from little or no selection of more recent cutlbocks (cutblocks less than 25 years old), to greater avoidance of older cutblocks (greater than 25 years old). In the summer, cutblocks less than four years old appeared to have little effect on caribou. However, there was realtively stong slection fo cutblcoks five to 30 years old adn then general avoidance of cutblocks older than 30 to 35 years old. 
```{r, DU7 single covariate RSF model output, echo = F,  fig.width = 7, fig.height = 5}
table.glm.summary <- read.csv ("data/table_glm_summary_forestry.csv")
table.glm.summary$DU <- as.factor (table.glm.summary$DU )
table.glm.summary.du7 <- table.glm.summary %>%
  filter (DU == 7)
ggplot (data = table.glm.summary.du7, 
        aes (years, coefficent.km)) +
  geom_line (aes (colour = Season)) +
  ggtitle ("Beta coefficient values of distance to cutblock by \n year and season for caribou designatable unit (DU) 7.") +
  xlab ("Years since harvest") + 
  ylab ("Beta coefficient") +
  geom_line (aes (x = years, y = 0), 
             size = 0.5, linetype = "solid", colour = "black") +
  theme (plot.title = element_text (hjust = 0.5),
         axis.text = element_text (size = 10),
         axis.title = element_text (size = 12),
         axis.line.x = element_line (size = 1),
         axis.line.y = element_line (size = 1),
         panel.grid.minor = element_blank (),
         panel.border = element_blank (),
         panel.background = element_blank ()) +
  scale_x_continuous (limits = c (0, 51), breaks = seq (0, 51, by = 5)) +
  scale_y_continuous (limits = c (-0.012, 0.012), breaks = seq (-0.012, 0.012, by = 0.003))
```

In DU8, selection of cutblocks was realtively strong and consistent across all saeosns, btu the apptern of selction was highly variable. However, in general, caribou selected younger cutblocks (approximately one to 20 years old) and avoided older cutblocks(greater than 20 years old). 
```{r, DU8 single covariate RSF model output, echo = F, fig.width = 7, fig.height = 5}
table.glm.summary <- read.csv ("data/table_glm_summary_forestry.csv")
table.glm.summary$DU <- as.factor (table.glm.summary$DU )
table.glm.summary.du8 <- table.glm.summary %>%
  filter (DU == 8)
ggplot (data = table.glm.summary.du8, 
        aes (years, coefficent.km)) +
  geom_line (aes (colour = Season)) +
  ggtitle ("Beta coefficient values of distance to cutblock by \n year and season for caribou designatable unit (DU) 8.") +
  xlab ("Years since harvest") + 
  ylab ("Beta coefficient") +
  geom_line (aes (x = years, y = 0), 
             size = 0.5, linetype = "solid", colour = "black") +
  theme (plot.title = element_text (hjust = 0.5),
         axis.text = element_text (size = 10),
         axis.title = element_text (size = 12),
         axis.line.x = element_line (size = 1),
         axis.line.y = element_line (size = 1),
         panel.grid.minor = element_blank (),
         panel.border = element_blank (),
         panel.background = element_blank ()) +
  scale_x_continuous (limits = c (0, 51), breaks = seq (0, 51, by = 5)) +
  scale_y_continuous (limits = c (-0.025, 0.025), breaks = seq (-0.025, 0.025, by = 0.005))
```
  
In DU9, teh efefct of cutblocks was realtively strong and consistent acorss saesons. In egenral, cariobu qavoidd cutblocks, although avoidacne of younger (less than 10 year old) cutblocks was weaker than older (greater htan 10 years old) cutlbocks. 
```{r, DU9 single covariate RSF model output, echo = F, fig.width = 7, fig.height = 5}
table.glm.summary <- read.csv ("data/table_glm_summary_forestry.csv")
table.glm.summary$DU <- as.factor (table.glm.summary$DU )
table.glm.summary.du9 <- table.glm.summary %>%
  filter (DU == 9)
ggplot (data = table.glm.summary.du9, 
        aes (years, coefficent.km)) +
  geom_line (aes (colour = Season)) +
  ggtitle ("Beta coefficient values of distance to cutblock by \n year and season for caribou designatable unit (DU) 9.") +
  xlab ("Years since harvest") + 
  ylab ("Beta coefficient") +
  geom_line (aes (x = years, y = 0), 
             size = 0.5, linetype = "solid", colour = "black") +
  theme (plot.title = element_text(hjust = 0.5),
         axis.text = element_text (size = 10),
         axis.title = element_text (size = 12),
         axis.line.x = element_line (size = 1),
         axis.line.y = element_line (size = 1),
         panel.grid.minor = element_blank (),
         panel.border = element_blank (),
         panel.background = element_blank ()) +
  scale_x_continuous (limits = c (0, 51), breaks = seq (0, 51, by = 5)) +
  scale_y_continuous (limits = c (-0.025, 0.055), breaks = seq (-0.025, 0.055, by = 0.01))
```


## Conclusions
Based on the high correaltion of annual distacne to cutblock measures across years, there is a need to group into few categories to avoid correlation of covaraites in the RSF model. At a minimum it appears that disatnce to cutblock measures are correalted 2-5 years apart. Patterns in cariobu selciton of cutlbocks suggest that cariobu may avoid or have weak responses to cutblocks when they are realtively new (less than five years old), but selection of cutblocks from five up to 30 years old (dpending on teh DU and season) adn avoidance of cutblocks over 10 to 30 years old. Therefore, I reclassifed disatcne to cutblock into four classes: one to four years old, five to nine years old, ten to 29 years old and 30 and over. 