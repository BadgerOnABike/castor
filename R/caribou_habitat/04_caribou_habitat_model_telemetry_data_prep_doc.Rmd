# Copyright 2018 Province of British Columbia
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and limitations under the License.

---
title: "Caribou habitat model telemetry data preparation"
author: "Tyler Muhly"
date: "September 12, 2018"
output: word_document
#  Script Name: 04_caribou_habitat_model_telemetry_data_prep_doc.Rmd
#  Script Version: 1.0
#  Script Purpose: Prep telemtery data for habitat model analysis. 
---

```{r setup, include = FALSE}
knitr::opts_chunk$set (echo = TRUE)
require (sf)
require (lubridate)
require (RPostgreSQL)
require (dplyr)
require (kableExtra)
require (ggplot2)
require (raster)
require (rgdal)
require (tidyr)
# require (adehabitatHR)
# require (sp) 
# require (raster) 
# require (rgeos) 
# require (maptools)
# require (spatstat)
```

## Introduction

Here I document the process to generate the point location sample used to build a criobu reseoruce selction fucntion model. This includes documentation fo how telmetry data were filtered for use int eh model as the 'used' sample (i.e., the '1' dependent values in the binary logistic regression model), how data were catergozied by biological characteristics (e.g., herd) adn time of year (e.g., season). Also includes docuemntaion of how the 'available' sample (i.e., the '0' dependent values in the binary logistic regression model) was generated, by creatign saesonal annual hoem ranges for ach anaimal and generatign randon poitns within them

For review of source telemetry data, see 01_caribou_habtiat_download...  


## Methods
telemetry data compiled  from SPI (non-public version), BCOGRIS, and from regional biologists, nto yet entered into these db's. colelcted under provicnail permist amd follwoign provincial animal care protocols. data was from a wide varaiety of indivuals (males adn females of differnet ages), telemetry collar types (VHF, GPS and ARGOS, form differetn brands, such as Lotek and ATS) adn fix rates. Type of animal colalred adn colalr type not always documented; rarely had capture information. used 'as is', with ptoential for biases in some data due to differetn fix rates (e.g., fix rates may vary by colalr type and ). Older data, prior to 2008, were nto used in the analysis, as some landscape features (particualrly lienar features such as roads, pieplines and sesimic lines) do not typically have an accurate time asscoaited with their developmebnt. We did nto use data older than 10 years because there is a higher likelyhood that these animals may have been usign areas that were less distrubed by human footprint than what coudl be measured usign teh available data.   


```{r telemetry data summary, warning = F, include = F, message = F}
# connKyle <- dbConnect(drv = dbDriver ("PostgreSQL"), 
#                      host = "DC052586", # Kyle's computer name
#                      user = "Tyler",
#                      dbname = "clus",
#                      password = "tyler",
#                      port = "5432")
conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
locs.caribou <- sf::st_read  (dsn = conn, # connKyle
                              query = "SELECT * FROM caribou.telemetry_caribou_all")
dbDisconnect (conn) # connKyle

# filter data before 2008
locs.caribou.new <-  dplyr::filter (locs.caribou, year > 2007)
locs.caribou.new$animal_id <- as.factor (locs.caribou.new$animal_id)

# Building a summary table of telemetry data
loc.year <- data.frame (table (locs.caribou.new$year)) # table of locations per year
names (loc.year) [1] <- "Year" 
loc.year$Year <- as.factor (loc.year$Year)
names (loc.year) [2] <- "Number of Locations" 
animal.year <- aggregate (data = locs.caribou.new, # number animals/year
                          animal_id ~ year, 
                          function(x) length(unique(x)))
names (animal.year) [2] <- "Number of Animals" 
names (animal.year) [1] <- "Year" 
animal.year$Year <- as.factor (animal.year$Year)
table.data.summary <- full_join (animal.year, loc.year, by = c ("Year", "Year"))
rm (loc.year, animal.year)
gc ()
knitr::kable (table.data.summary, 
              caption = "Table 1. Number of caribou collared and telemetry lcoations collected per year.", 
              align = 'c', format.args = list (big.mark   = ","))  
```


Data were split into 3 seasons, based on lit. review (see caariobu seasosn spreadsheet):
 calving/summer/fall	(summer) = 15-May to 31-Oct 
early winter =	01-Nov	to 15-Jan
late winter	= 16-Jan to 14-May

```{r telemetry data seasonal summary, warning = F, include = F, message = F}
#=================================
#  Subset the data by season
#=================================
# identified based on lit. review; a decent amount of variability there, but settled on:
# calving/summer/fall	(summer) = 15-May to 31-Oct 
# early winter =	01-Nov	to 15-Jan
# late winter	= 16-Jan to 14-May
# note that I tried a seperate calving season, but estimating calving season home ranges was 
# difficult in the boreal because of apparent variability in calving dates and associated movements
# resulting in highly variable home range sizes depending if and when the animal moved to calve
# also, on further reflection I don't know if an animal was male or female, and habitat use
# of each is obviously different, so I went with a more broader seasonal definition  
locs.caribou.summer <- subset (locs.caribou.new, 
                                   locs.caribou.new$month == 5 & 
                                   locs.caribou.new$day >= 15 |
                                   locs.caribou.new$month >= 6 &
                                   locs.caribou.new$month < 11)
locs.caribou.summer$season <- "Summer"
locs.caribou.early.winter <- subset (locs.caribou.new, 
                                     locs.caribou.new$month > 10 |
                                     locs.caribou.new$month == 1 &
                                     locs.caribou.new$day < 16)
locs.caribou.early.winter$season <- "EarlyWinter"
locs.caribou.late.winter <- subset (locs.caribou.new, 
                                    locs.caribou.new$month == 1 & 
                                    locs.caribou.new$day > 15 |
                                    locs.caribou.new$month == 5 &
                                    locs.caribou.new$day < 15 |
                                    locs.caribou.new$month > 1 &
                                    locs.caribou.new$month < 5)
locs.caribou.late.winter$season <- "LateWinter"

# recombine data
locs.caribou.new <- rbind (locs.caribou.summer, locs.caribou.early.winter, locs.caribou.late.winter)
locs.caribou.new$season <- as.factor (locs.caribou.new$season)
locs.caribou.new$year <- as.factor (locs.caribou.new$year)

# Seasonal summary table of telemetry data
loc.year.season <- data.frame (locs.caribou.new %>%
                                  group_by (year, season) %>%
                                  summarise (count = n ()))
loc.year.season <- loc.year.season [, c(1:3)]
names (loc.year.season) [1] <- "Year" 
names (loc.year.season) [2] <- "Season" 
names (loc.year.season) [3] <- "Number of Locations" 
animal.year.season <- aggregate (data = locs.caribou.new, # number animals/year and season
                                 animal_id ~ year + season, 
                                 function(x) length(unique(x)))
names (animal.year.season) [1] <- "Year" 
names (animal.year.season) [2] <- "Season" 
names (animal.year.season) [3] <- "Number of Animals" 
table.data.summary.year.season <- full_join (animal.year.season, loc.year.season, 
                                             by = c ("Year", "Year"))
rm (animal.year.season, loc.year.season)
gc ()
knitr::kable (table.data.summary.year.season, 
              caption = "Table 2. Number of caribou collared and telemetry lcoations collected per year and season.", 
              align = 'c', format.args = list (big.mark   = ","))  

```


data were clipped ot the province
data were assigned to each ecotype adn herd by intersectign with the location data
assigned cariobu lcoaitons outside of herd boudnaries to nearest iherd or hered where majority of locaitons occurred 
rrmoved data prior to 2008
removed data form columbia north adn south becuase inlfuence of Revy pen (ther as very little data there anyway)


```{r, assign ecotype to telemetry locations and clean the data, warning = F, include = F, message = F}

# Load caribou range boundaries to identify ranges and Ecotypes 
caribou.range <- st_read (dsn = "C:\\Work\\caribou\\clus_data\\caribou\\caribou_herd\\GCPB_CARIBOU_POPULATION_SP\\GCBP_CARIB_polygon.shp", stringsAsFactors = T)
# remove Haida Gwaii
caribou.range <- caribou.range [caribou.range$OBJECTID != 138, ]
 # NOTE: the polygon ID was obtained using ArcGIS; not sure how to get that using R 
# clip data outside province
prov.bnd <- st_read ( dsn = "C:\\Work\\caribou\\clus_data\\admin_boundaries\\province\\gpr_000b11a_e.shp", stringsAsFactors = T)
prov.bnd <- st_transform (prov.bnd, 3005)
prov.bnd <- prov.bnd [prov.bnd$PRENAME == "British Columbia", ]  
locs.caribou.bc <- locs.caribou.new [prov.bnd, ] # clip locations to BC

# saved data, because clip process took awhile
conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
st_write (obj = locs.caribou.bc, 
          dsn = conn, 
          layer = c ("caribou", "telemetry_caribou_bc"))
dbDisconnect (conn)

# Select fields to intersect with points 
caribou.ecotype.herd <- caribou.range %>% 
                          select (HERD_NAME, ECOTYPE)
locs.caribou.ecotype.herd <- st_intersection (locs.caribou, caribou.ecotype.herd)

# saved data, because intersect process took awhile 
conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
st_write (obj = locs.caribou.ecotype.herd, 
          dsn = conn, 
          layer = c ("caribou", "telemetry_caribou_bc_ecotype_herd"))
dbDisconnect (conn)

# some locations occur outside of the herd boundaries; here I am assigning appropriate 
# values to those NA values

# subset of locations with no herd name values
locs.caribou.ecotype.herd.na <- locs.caribou.ecotype.herd [is.na (locs.caribou.ecotype.herd$HERD_NAME), ]

# animals with NA values for herd/ecotype
table.animal.id.na <- data.frame (unique (locs.caribou.ecotype.herd.na$animal_id))

# subset the data to see where these anaiamls are from
# e.g., 
locs.caribou.ecotype.herd.c234c <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id == "C234C", ] # only three locations total, delete from data
locs.caribou.ecotype.herd.C310T <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id == "C310T", ] # no locations in herd ranges; closest to Chase (looked at map) so assigned there 

# assigned herd and ecotype
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C310T"] <- "Chase"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C310T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C307T"] <- "Finlay"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C307T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C306T"] <- "Frog"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C306T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C305T"] <- "Frog"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C305T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C303T"] <- "Spatsizi"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C303T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C302T"] <- "Chase"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C302T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C301T"] <- "Spatsizi"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C301T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C296T"] <- "Chase"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C296T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C295T"] <- "Chase"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C295T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C298T"] <- "Spatsizi"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C298T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C297T"] <- "Spatsizi"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C297T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C294T"] <- "Frog"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C294T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C293T"] <- "Frog"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C293T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "40"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "40"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "39"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "39"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "37"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "37"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "49"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "49"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "46"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "46"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "42"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "42"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "CS1"] <- "Nakusp"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "CS1"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "CS3"] <- "Nakusp"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "CS3"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "CS7"] <- "Nakusp"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "CS7"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "34"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "34"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "CS4"] <- "Nakusp"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "CS4"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "CS5"] <- "Nakusp"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "CS5"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "81"] <- "Wells Gray"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "81"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SS 1"] <- "South Selkirks"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SS 1"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SS 4"] <- "South Selkirks"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SS 4"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SL26"] <- "Swan Lake"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SL26"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "HSCEK077"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "HSCEK077"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK002"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK002"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK003"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK003"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK007"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK007"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK007b"] <- "Muskwa"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK007b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK009"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK009"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK009b"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK009b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK026"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK026"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK044"] <- "Prophet"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK044"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK050"] <- "Prophet"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK050"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK066b"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK066b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK079"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK079"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK133"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK133"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK136"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK136"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK136b"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK136b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK143"] <- "Prophet"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK143"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK161"] <- "Prophet"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK161"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK161b"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK161b"] <- "Boreal"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK143"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK161"] <- "Prophet"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK161"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK161b"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK161b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK163"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK163"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK166"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK166"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK167"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK167"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK168"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK168"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK169"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK169"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK170"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK170"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK170b"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK170b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK172"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK172"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK181"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK181"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK194"] <- "Parker"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK194"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK196"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK196"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK217"] <- "Prophet"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK217"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK219"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK219"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK225"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK225"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK237"] <- "Parker"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK237"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "NX05"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "NX05"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "car119"] <- "Kennedy Siding"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "car119"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "car158"] <- "Quintette"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "car158"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "car190"] <- "Quintette"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "car190"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "car194"] <- "Quintette"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "car194"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "car077"] <- "Quintette"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "car077"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "GC21"] <- "Graham"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "GC21"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "CS8"] <- "Nakusp"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "CS8"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SL10"] <- "Swan Lake"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SL10"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK014"] <- "Parker"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK014"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK016"] <- "Parker"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK016"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK016b"] <- "Parker"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK016b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK175"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK175"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK177"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK177"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK178"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK178"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK179"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK179"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK191"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK191"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK201"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK201"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK214"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK214"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK215"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK215"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK216"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK216"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "NX15"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "NX15"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "car116"] <- "Moberly"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "car116"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "car169"] <- "Scott"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "car169"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C304T"] <- "Spatsizi"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C304T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C300T"] <- "Spatsizi"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C300T"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "3"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "3"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "48"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "48"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C24A"] <- "Hart Ranges"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C24A"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "41"] <- "Itcha-Ilgachuz"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "41"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "187"] <- "Frisby-Boulder"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "187"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C125W"] <- "Wolverine"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C125W"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "C050A"] <- "Chase"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "C050A"] <- "Northern"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SS 2"] <- "South Selkirks"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SS 2"] <- "Mountain"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "HSCEK063"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "HSCEK063"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK014b"] <- "Parker"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK014b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK111"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK111"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK126b"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK126b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK139"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK139"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK142"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK142"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK146b"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK146b"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK165"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK165"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK180"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK180"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK183"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK183"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK189"] <- "Chinchaga"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK189"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK193"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK193"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK210"] <- "Maxhamish"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK210"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "SCEK239"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "SCEK239"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "NX16"] <- "Calendar"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "NX16"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "NX06"] <- "Calendar" 
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "NX06"] <- "Boreal"
locs.caribou.ecotype.herd$HERD_NAME [locs.caribou.ecotype.herd$animal_id == "NX17"] <- "Snake-Sahtaneh"
locs.caribou.ecotype.herd$ECOTYPE [locs.caribou.ecotype.herd$animal_id == "NX17"] <- "Boreal"

# deleted data
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id != "C234C", ]
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id != "162", ]
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id != "C299T", ]
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id != "C309T", ]
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id != "C308T", ]
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id != "C284C", ]

# remove Columbia South and North data, as those cariobu affected by revelstoke pen
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$HERD_NAME != "Columbia North", ]
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$HERD_NAME != "Columbia South", ]

# removed two animals that couldn't estimate home ranges
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$animal_id != "C297T" | locs.caribou.ecotype.herd$animal_id != "41265" | locs.caribou.ecotype.herd$animal_id != "41255", ]
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$uniqueID != "du7_EarlyWinter_41247_2016", ]

# added DU to further subdivide by ecological classfications
locs.caribou.ecotype.herd$du <-  with (locs.caribou.ecotype.herd, ifelse (
                                        HERD_NAME == "Maxhamish" | HERD_NAME == "Calendar" |
                                        HERD_NAME == "Snake-Sahtaneh" | HERD_NAME == "Parker" |
                                        HERD_NAME == "Prophet" | HERD_NAME == "Chinchaga", 
                                        'du6', ifelse (
                                        HERD_NAME == "Graham" | HERD_NAME == "Charlotte Alplands" |
                                        HERD_NAME == "Itcha-Ilgachuz" | HERD_NAME == "Rainbows" |
                                        HERD_NAME == "Tweedsmuir" | HERD_NAME == "Telkwa" |
                                        HERD_NAME == "Wolverine" | HERD_NAME == "Chase" |
                                        HERD_NAME == "Pink Mountain"| HERD_NAME ==  "Finlay" |
                                        HERD_NAME == "Tsenaglode" |  HERD_NAME == "Swan Lake" |
                                        HERD_NAME ==  "Muskwa" | HERD_NAME == "Frog" |
                                        HERD_NAME == "Spatsizi" | HERD_NAME == "Rabbit" |
                                        HERD_NAME == "Little Rancheria", 'du7', ifelse (
                                        HERD_NAME ==  "Quintette" | HERD_NAME == "Scott" |
                                        HERD_NAME == "Moberly" |   HERD_NAME == "Burnt Pine" |
                                        HERD_NAME ==  "Kennedy Siding" |  HERD_NAME == "Narraway", 
                                        'du8', ifelse (
                                        HERD_NAME == "Hart Ranges" | HERD_NAME == "Wells Gray" |
                                        HERD_NAME == "Groundhog" | HERD_NAME == "Frisby-Boulder" |
                                        HERD_NAME == "Nakusp" | HERD_NAME == "South Selkirks", 'du9',
                                        'unk')))))
```



Next I create a unique ID for each caribou, ecotype, year and season. this allows me to identify unique grousp fo data for teh analysis, i.e., ecotype and season, and also allows me to account for unique individuals and years in the data using, for example, random effects; each unique id reprsents a unique indivual 'sampled' in teh analsysi


```{r, create a unique ID for each caribou, ecotype, warning = F, include = F, message = F}
locs.caribou.ecotype.herd$season <- gsub("Early Winter", "EarlyWinter", locs.caribou.ecotype.herd$season)
locs.caribou.ecotype.herd$season <- gsub("Late Winter", "LateWinter", locs.caribou.ecotype.herd$season)

locs.caribou.ecotype.herd <- mutate (locs.caribou.ecotype.herd, 
                                     uniqueID = paste 
                                               (locs.caribou.ecotype.herd$du,
                                                locs.caribou.ecotype.herd$season,
                                                locs.caribou.ecotype.herd$animal_id,
                                                locs.caribou.ecotype.herd$year,
                                                sep = "_")) 
locs.caribou.ecotype.herd$uniqueID <- as.factor (locs.caribou.ecotype.herd$uniqueID)
```


remove animals with <50 locations  
literature recommends minimum 50 locatiosn to calcualte a hoem range (eaman 1999, Kernohan 2001)

Seaman, D. E., Millspaugh, J. J., Kernohan, B. J., Brundige, G. C., Raedeke, K. J., & Gitzen, R. A. (1999). Effects of sample size on kernel home range estimates. The journal of wildlife management, 739-747.
Kernohan, B. J., R. A. Gitzen, and J. J. Millspaugh. 2001. Analysis of animal space use and movements. Pages 125–166 in J. J. Millspaugh and J. M. Marzluff, editors. Radio tracking and animal populations. Academic Press, San Diego, CA, USA


```{r, remove unique ids with < 50 locations, warning = F, include = F, message = F}
locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$uniqueID %in% names (table (locs.caribou.ecotype.herd$uniqueID)) [table (locs.caribou.ecotype.herd$uniqueID) >= 50], ]

# count.check <- data.frame (locs.caribou.ecotype.herd %>% group_by (uniqueID) %>% summarize (count = n ()))

# saved data 
conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
st_write (obj = locs.caribou.ecotype.herd, 
          dsn = conn, 
          layer = c ("caribou", "telemetry_caribou_bc_used_final"))
dbDisconnect (conn)
```


create home ranges for each unique id

estimate Kernel home range Utiliation Distribution Using adehabitatHR (Calenge et al. 2011) (https://cran.r-project.org/web/packages/adehabitatHR/vignettes/adehabitatHR.pdf)

used a bivariate normal kernel
varied h size and interpreted visually to determine size to use; a subjective visual choice for the smoothing parameter, based on successive trials (Hemson et al. 2005; Calenge et al. 2011)

Hemson, G., Johnson, P., South, A., Kenward, R., Ripley, R., & MACDONALD, D. (2005). Are kernels the mustard? Data from global positioning system (GPS) collars suggests problems for kernel home‐range analyses with least‐squares cross‐validation. Journal of Animal Ecology, 74(3), 455-463.


```{r calculate home ranges for each unique id, warning = F, include = F, message = F}

library (adehabitatHR)
library (rgdal)

# need to convert sf to spatialpoints object
locs.caribou.hr <- as (locs.caribou.ecotype.herd, 'Spatial')

# need to break up data to make it manageable for RAM
# DU 6 (Boreal)
# Summer
locs.caribou.hr.summer.du6 <- locs.caribou.hr [locs.caribou.hr@data$season == "Summer" & locs.caribou.hr@data$du == "du6", ]
locs.caribou.hr.summer.du6@data$uniqueID <- factor (locs.caribou.hr.summer.du6@data$uniqueID) # drop animals with no locations

# Early Winter
locs.caribou.hr.ewinter.du6 <- locs.caribou.hr [locs.caribou.hr@data$season == "EarlyWinter" & locs.caribou.hr@data$du == "du6", ]
locs.caribou.hr.ewinter.du6@data$uniqueID <- factor (locs.caribou.hr.ewinter.du6@data$uniqueID)

# Late Winter
locs.caribou.hr.lwinter.du6 <- locs.caribou.hr [locs.caribou.hr@data$season == "LateWinter" & locs.caribou.hr@data$du == "du6", ]
locs.caribou.hr.lwinter.du6@data$uniqueID <- factor (locs.caribou.hr.lwinter.du6@data$uniqueID)

# DU7 
# Summer
locs.caribou.hr.summer.du7 <- locs.caribou.hr [locs.caribou.hr@data$season == "Summer" & locs.caribou.hr@data$du == "du7", ]

locs.caribou.hr.summer.du7.south <- locs.caribou.hr.summer.du7 [locs.caribou.hr.summer.du7@data$HERD_NAME == "Itcha-Ilgachuz" | locs.caribou.hr.summer.du7@data$HERD_NAME == "Rainbows" | locs.caribou.hr.summer.du7@data$HERD_NAME == "Charlotte Alplands" | locs.caribou.hr.summer.du7@data$HERD_NAME == "Tweedsmuir" | locs.caribou.hr.summer.du7@data$HERD_NAME == "Telkwa" , ]
locs.caribou.hr.summer.du7.south@data$uniqueID <- factor (locs.caribou.hr.summer.du7.south@data$uniqueID)

locs.caribou.hr.summer.du7.ne <- locs.caribou.hr.summer.du7 [locs.caribou.hr.summer.du7@data$HERD_NAME == "Graham" | locs.caribou.hr.summer.du7@data$HERD_NAME == "Chase" | locs.caribou.hr.summer.du7@data$HERD_NAME == "Muskwa" |
locs.caribou.hr.summer.du7@data$HERD_NAME == "Frog" | locs.caribou.hr.summer.du7@data$HERD_NAME == "Finlay" , ]

locs.caribou.hr.summer.du7.spat <- locs.caribou.hr.summer.du7 [locs.caribou.hr.summer.du7@data$HERD_NAME == "Spatsizi" , ]
locs.caribou.hr.summer.du7.spat.C297T <- locs.caribou.hr.summer.du7.spat [locs.caribou.hr.summer.du7.spat@data$animal_id == "C297T" , ]
locs.caribou.hr.summer.du7.spat.C301T <- locs.caribou.hr.summer.du7.spat [locs.caribou.hr.summer.du7.spat@data$animal_id == "C301T" , ]
locs.caribou.hr.summer.du7.spat.C303T <- locs.caribou.hr.summer.du7.spat [locs.caribou.hr.summer.du7.spat@data$animal_id == "C303T" , ]
locs.caribou.hr.summer.du7.spat.C298T <- locs.caribou.hr.summer.du7.spat [locs.caribou.hr.summer.du7.spat@data$animal_id == "C298T" , ]

locs.caribou.hr.summer.du7.pink <- locs.caribou.hr.summer.du7 [locs.caribou.hr.summer.du7@data$HERD_NAME == "Pink Mountain" , ]
locs.caribou.hr.summer.du7.pink.41243 <- locs.caribou.hr.summer.du7.pink [locs.caribou.hr.summer.du7.pink@data$animal_id == "41243" , ]
locs.caribou.hr.summer.du7.pink.41253 <- locs.caribou.hr.summer.du7.pink [locs.caribou.hr.summer.du7.pink@data$animal_id == "41253" , ]
locs.caribou.hr.summer.du7.pink.41255 <- locs.caribou.hr.summer.du7.pink [locs.caribou.hr.summer.du7.pink@data$animal_id == "41255" , ]
locs.caribou.hr.summer.du7.pink.41249 <- locs.caribou.hr.summer.du7.pink [locs.caribou.hr.summer.du7.pink@data$animal_id == "41249" , ]
locs.caribou.hr.summer.du7.pink.41258 <- locs.caribou.hr.summer.du7.pink [locs.caribou.hr.summer.du7.pink@data$animal_id == "41258" , ]
locs.caribou.hr.summer.du7.pink.41262 <- locs.caribou.hr.summer.du7.pink [locs.caribou.hr.summer.du7.pink@data$animal_id == "41262" , ]
locs.caribou.hr.summer.du7.pink.41265 <- locs.caribou.hr.summer.du7.pink [locs.caribou.hr.summer.du7.pink@data$animal_id == "41265" , ]

# Early Winter
locs.caribou.hr.ewinter.du7 <- locs.caribou.hr [locs.caribou.hr@data$season == "EarlyWinter" & locs.caribou.hr@data$du == "du7", ]

locs.caribou.hr.ewinter.du7.south <- locs.caribou.hr.ewinter.du7 [locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Itcha-Ilgachuz" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Rainbows" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Charlotte Alplands" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Tweedsmuir" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Telkwa", ]
locs.caribou.hr.ewinter.du7.south@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.south@data$uniqueID)

locs.caribou.hr.ewinter.du7.ne <- locs.caribou.hr.ewinter.du7 [locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Graham" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Chase" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Frog" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Finlay" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Spatsizi" | locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Pink Mountain", ]
locs.caribou.hr.ewinter.du7.ne@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.ne@data$uniqueID)

locs.caribou.hr.ewinter.du7.muskwa <- locs.caribou.hr.ewinter.du7 [locs.caribou.hr.ewinter.du7@data$HERD_NAME == "Muskwa", ]
locs.caribou.hr.ewinter.du7.muskwa@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.muskwa@data$uniqueID)
locs.caribou.hr.ewinter.du7.muskwa.41241 <- locs.caribou.hr.ewinter.du7.muskwa [locs.caribou.hr.ewinter.du7.muskwa@data$animal_id == "41241" , ]
locs.caribou.hr.ewinter.du7.muskwa.41241@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.muskwa.41241@data$uniqueID)
locs.caribou.hr.ewinter.du7.muskwa.41247 <- locs.caribou.hr.ewinter.du7.muskwa [locs.caribou.hr.ewinter.du7.muskwa@data$animal_id == "41247" , ]
locs.caribou.hr.ewinter.du7.muskwa.41247@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.muskwa.41247@data$uniqueID)
locs.caribou.hr.ewinter.du7.muskwa.41248 <- locs.caribou.hr.ewinter.du7.muskwa [locs.caribou.hr.ewinter.du7.muskwa@data$animal_id == "41248" , ]
locs.caribou.hr.ewinter.du7.muskwa.41248@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.muskwa.41248@data$uniqueID)
locs.caribou.hr.ewinter.du7.muskwa.41250 <- locs.caribou.hr.ewinter.du7.muskwa [locs.caribou.hr.ewinter.du7.muskwa@data$animal_id == "41250" , ]
locs.caribou.hr.ewinter.du7.muskwa.41250@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.muskwa.41250@data$uniqueID)
locs.caribou.hr.ewinter.du7.muskwa.41251 <- locs.caribou.hr.ewinter.du7.muskwa [locs.caribou.hr.ewinter.du7.muskwa@data$animal_id == "41251" , ]
locs.caribou.hr.ewinter.du7.muskwa.41251@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.muskwa.41251@data$uniqueID)
locs.caribou.hr.ewinter.du7.muskwa.SCEK007b <- locs.caribou.hr.ewinter.du7.muskwa [locs.caribou.hr.ewinter.du7.muskwa@data$animal_id == "SCEK007b" , ]
locs.caribou.hr.ewinter.du7.muskwa.SCEK007b@data$uniqueID <- factor (locs.caribou.hr.ewinter.du7.muskwa.SCEK007b@data$uniqueID)

# Late Winter
locs.caribou.hr.lwinter.du7 <- locs.caribou.hr [locs.caribou.hr@data$season == "LateWinter" & locs.caribou.hr@data$du == "du7", ]
locs.caribou.hr.lwinter.du7@data$uniqueID <- factor (locs.caribou.hr.lwinter.du7@data$uniqueID)


locs.caribou.hr.lwinter.du7.south <- locs.caribou.hr.lwinter.du7 [locs.caribou.hr.lwinter.du7@data$HERD_NAME == "Itcha-Ilgachuz" | locs.caribou.hr.lwinter.du7@data$HERD_NAME == "Rainbows" | locs.caribou.hr.lwinter.du7@data$HERD_NAME == "Charlotte Alplands" | locs.caribou.hr.lwinter.du7@data$HERD_NAME == "Tweedsmuir" | locs.caribou.hr.lwinter.du7@data$HERD_NAME == "Telkwa" , ]
locs.caribou.hr.lwinter.du7.south@data$uniqueID <- factor (locs.caribou.hr.lwinter.du7.south@data$uniqueID)


# DU8
# Summer
locs.caribou.hr.summer.du8 <- locs.caribou.hr [locs.caribou.hr@data$season == "Summer" & locs.caribou.hr@data$du == "du8", ]
locs.caribou.hr.summer.du8@data$uniqueID <- factor (locs.caribou.hr.summer.du8@data$uniqueID)

# Early Winter
locs.caribou.hr.ewinter.du8 <- locs.caribou.hr [locs.caribou.hr@data$season == "EarlyWinter" & locs.caribou.hr@data$du == "du8", ]
locs.caribou.hr.ewinter.du8@data$uniqueID <- factor (locs.caribou.hr.ewinter.du8@data$uniqueID)

# Late Winter
locs.caribou.hr.lwinter.du8 <- locs.caribou.hr [locs.caribou.hr@data$season == "LateWinter" & locs.caribou.hr@data$du == "du8", ]
locs.caribou.hr.lwinter.du8@data$uniqueID <- factor (locs.caribou.hr.lwinter.du8@data$uniqueID)

# DU9
# Summer
locs.caribou.hr.summer.du9 <- locs.caribou.hr [locs.caribou.hr@data$season == "Summer" & locs.caribou.hr@data$du == "du9", ]
locs.caribou.hr.summer.du9@data$uniqueID <- factor (locs.caribou.hr.summer.du9@data$uniqueID)

# Early Winter
locs.caribou.hr.ewinter.du9 <- locs.caribou.hr [locs.caribou.hr@data$season == "EarlyWinter" & locs.caribou.hr@data$du == "du9", ]
locs.caribou.hr.ewinter.du9@data$uniqueID <- factor (locs.caribou.hr.ewinter.du9@data$uniqueID)

# Late Winter
locs.caribou.hr.lwinter.du9 <- locs.caribou.hr [locs.caribou.hr@data$season == "LateWinter" & locs.caribou.hr@data$du == "du9", ]
locs.caribou.hr.lwinter.du9@data$uniqueID <- factor (locs.caribou.hr.lwinter.du9@data$uniqueID)


# hr's with h = 750
# DU6
# Summer
locs.caribou.hr.summer.du6.h750 <- kernelUD (locs.caribou.hr.summer.du6 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du6.h750 <- getverticeshr (locs.caribou.hr.summer.du6.h750, percent = 95)
writeOGR (homerange.summer.du6.h750, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du6_h750.shp", 
          layer = "hr_summer_du6_h750.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du6.h750 <- kernelUD (locs.caribou.hr.ewinter.du6 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du6.h750 <- getverticeshr (locs.caribou.hr.ewinter.du6.h750, percent = 95)
writeOGR (homerange.ewinter.du6.h750, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du6_h750.shp", 
          layer = "hr_ewinter_du6_h750.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du6.h750 <- kernelUD (locs.caribou.hr.lwinter.du6 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du6.h750 <- getverticeshr (locs.caribou.hr.lwinter.du6.h750, percent = 95)
writeOGR (homerange.lwinter.du6.h750, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du6_h750.shp", 
          layer = "hr_lwinter_du6_h750.shp", driver = "ESRI Shapefile")

# DU7
# Summer
locs.caribou.hr.summer.du7.south.h750 <- kernelUD (locs.caribou.hr.summer.du7.south [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.h750.south <- getverticeshr (locs.caribou.hr.summer.du7.south.h750, percent = 95)
writeOGR (homerange.summer.du7.h750.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_south_h750.shp", 
          layer = "hr_summer_du7_south_h750.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du7.south.h750 <- kernelUD (locs.caribou.hr.ewinter.du7.south [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.h750.south <- getverticeshr (locs.caribou.hr.ewinter.du7.south.h750, percent = 95)
writeOGR (homerange.ewinter.du7.h750.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_south_h750.shp", 
          layer = "hr_ewinter_du7_south_h750.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du7.south.h750 <- kernelUD (locs.caribou.hr.lwinter.du7.south [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du7.h750.south <- getverticeshr (locs.caribou.hr.lwinter.du7.south.h750, percent = 95)
writeOGR (homerange.lwinter.du7.h750.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du7_south_h750.shp", 
          layer = "hr_lwinter_du7_south_h750.shp", driver = "ESRI Shapefile")

# DU8
# Summer
locs.caribou.hr.summer.du8.h750 <- kernelUD (locs.caribou.hr.summer.du8 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du8 <- getverticeshr (locs.caribou.hr.summer.du8.h750, percent = 95)
writeOGR (homerange.summer.du8, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du8_h750.shp", 
          layer = "hr_summer_du8_h750.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du8.h750 <- kernelUD (locs.caribou.hr.lwinter.du8 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du8 <- getverticeshr (locs.caribou.hr.lwinter.du8.h750, percent = 95)
writeOGR (homerange.lwinter.du8, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du8_h750.shp", 
          layer = "hr_lwinter_du8_h750.shp", driver = "ESRI Shapefile")

# DU9
# Summer
locs.caribou.hr.summer.du9.h750 <- kernelUD (locs.caribou.hr.summer.du9 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du9 <- getverticeshr (locs.caribou.hr.summer.du9.h750, percent = 95)
writeOGR (homerange.summer.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du9_h750.shp", 
          layer = "hr_summer_du9_h750.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du9.h750 <- kernelUD (locs.caribou.hr.ewinter.du9 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du9 <- getverticeshr (locs.caribou.hr.ewinter.du9.h750, percent = 95)
writeOGR (homerange.ewinter.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du9_h750.shp", 
          layer = "hr_ewinter_du9_h750.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du9.h750 <- kernelUD (locs.caribou.hr.lwinter.du9 [, 14],
                                          h = 750, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du9 <- getverticeshr (locs.caribou.hr.lwinter.du9.h750, percent = 95)
writeOGR (homerange.lwinter.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du9_h750.shp", 
          layer = "hr_lwinter_du9_h750.shp", driver = "ESRI Shapefile")

# hr's with h = 500
# DU6
# Summer
locs.caribou.hr.summer.du6.h500 <- kernelUD (locs.caribou.hr.summer.du6 [, 14], # column of unique ID
                                          h = 500, # smoothing parameter (h) tried different h values 
                                          grid = 1000, # grid 1km x 1km
                                          extent = 2)  # extent is 2x the 'normal' size
homerange.summer.du6.h500 <- getverticeshr (locs.caribou.hr.summer.du6.h500, percent = 95)
# save data 
writeOGR (homerange.summer.du6.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du6_h500.shp", 
          layer = "hr_summer_du6_h500.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du6.h500 <- kernelUD (locs.caribou.hr.ewinter.du6 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du6.h500 <- getverticeshr (locs.caribou.hr.ewinter.du6.h500, percent = 95)
writeOGR (homerange.ewinter.du6.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du6_h500.shp", 
          layer = "hr_ewinter_du6_h500.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du6.h500 <- kernelUD (locs.caribou.hr.lwinter.du6 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du6.h500 <- getverticeshr (locs.caribou.hr.lwinter.du6.h500, percent = 95)
writeOGR (homerange.lwinter.du6.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du6_h500.shp", 
          layer = "hr_lwinter_du6_h500.shp", driver = "ESRI Shapefile")

# DU7
# Summer
locs.caribou.hr.summer.du7.h500 <- kernelUD (locs.caribou.hr.summer.du7 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.h500 <- getverticeshr (locs.caribou.hr.summer.du7.h500, percent = 95)
writeOGR (homerange.summer.du7.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_h500.shp", 
          layer = "hr_summer_du7_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.south.h500 <- kernelUD (locs.caribou.hr.summer.du7.south [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.h500.south <- getverticeshr (locs.caribou.hr.summer.du7.south.h500, percent = 95)
writeOGR (homerange.summer.du7.h500.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_south_h500.shp", 
          layer = "hr_summer_du7_south_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.ne.h500 <- kernelUD (locs.caribou.hr.summer.du7.ne [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.ne.h500 <- getverticeshr (locs.caribou.hr.summer.du7.ne.h500, percent = 95)
writeOGR (homerange.summer.du7.ne.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_ne_h500.shp", 
          layer = "hr_summer_du7_ne_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.spat.C301T.h500 <- kernelUD (locs.caribou.hr.summer.du7.spat.C301T [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.spat.C301T.h500 <- getverticeshr (locs.caribou.hr.summer.du7.spat.C301T.h500, percent = 95)
writeOGR (homerange.summer.du7.spat.C301T.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_spat_C301T_h500.shp", 
          layer = "hr_summer_du7_spat_C301T_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.spat.C303T.h500 <- kernelUD (locs.caribou.hr.summer.du7.spat.C303T [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.spat.C303T.h500 <- getverticeshr (locs.caribou.hr.summer.du7.spat.C303T.h500, percent = 95)
writeOGR (homerange.summer.du7.spat.C303T.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_spat_C303T_h500.shp", 
          layer = "hr_summer_du7_spat_C303T_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.spat.C298T.h500 <- kernelUD (locs.caribou.hr.summer.du7.spat.C298T [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.spat.C298T.h500 <- getverticeshr (locs.caribou.hr.summer.du7.spat.C298T.h500, percent = 95)
writeOGR (homerange.summer.du7.spat.C298T.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_spat_C298T_h500.shp", 
          layer = "hr_summer_du7_spat_C298T_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.pink.41243.h500 <- kernelUD (locs.caribou.hr.summer.du7.pink.41243 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.pink.41243.h500 <- getverticeshr (locs.caribou.hr.summer.du7.pink.41243.h500, percent = 95)
writeOGR (homerange.summer.du7.pink.41243.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41243_h500.shp", 
          layer = "hr_summer_du7_pink_41243_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.pink.41253.h500 <- kernelUD (locs.caribou.hr.summer.du7.pink.41253 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.pink.41253.h500 <- getverticeshr (locs.caribou.hr.summer.du7.pink.41253.h500, percent = 95)
writeOGR (homerange.summer.du7.pink.41253.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41253_h500.shp", 
          layer = "hr_summer_du7_pink_41253_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.pink.41255.h500 <- kernelUD (locs.caribou.hr.summer.du7.pink.41255 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.pink.41255.h500 <- getverticeshr (locs.caribou.hr.summer.du7.pink.41255.h500, percent = 95)
writeOGR (homerange.summer.du7.pink.41255.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41255_h500.shp", 
          layer = "hr_summer_du7_pink_41255_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.pink.41249.h500 <- kernelUD (locs.caribou.hr.summer.du7.pink.41249 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.pink.41249.h500 <- getverticeshr (locs.caribou.hr.summer.du7.pink.41249.h500, percent = 95)
writeOGR (homerange.summer.du7.pink.41249.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41249_h500.shp", 
          layer = "hr_summer_du7_pink_41249_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.pink.41258.h500 <- kernelUD (locs.caribou.hr.summer.du7.pink.41258 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.pink.41258.h500 <- getverticeshr (locs.caribou.hr.summer.du7.pink.41258.h500, percent = 95)
writeOGR (homerange.summer.du7.pink.41258.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41258_h500.shp", 
          layer = "hr_summer_du7_pink_41258_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.pink.41262.h500 <- kernelUD (locs.caribou.hr.summer.du7.pink.41262 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.pink.41262.h500 <- getverticeshr (locs.caribou.hr.summer.du7.pink.41262.h500, percent = 95)
writeOGR (homerange.summer.du7.pink.41262.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41262_h500.shp", 
          layer = "hr_summer_du7_pink_41262_h500.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du7.south.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.south [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.h500.south <- getverticeshr (locs.caribou.hr.ewinter.du7.south.h500, percent = 95)
writeOGR (homerange.ewinter.du7.h500.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_south_h500.shp", 
          layer = "hr_ewinter_du7_south_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du7.ne.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.ne [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.ne.h500 <- getverticeshr (locs.caribou.hr.ewinter.du7.ne.h500, percent = 95)
writeOGR (homerange.ewinter.du7.ne.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_ne_h500.shp", 
          layer = "hr_ewinter_du7_ne_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du7.muskwa.41241.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.muskwa.41241 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.muskwa.41241.h500 <- getverticeshr (locs.caribou.hr.ewinter.du7.muskwa.41241.h500, percent = 95)
writeOGR (homerange.ewinter.du7.muskwa.41241.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41241_h500.shp", 
          layer = "hr_ewinter_du7_muskwa_41241_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du7.muskwa.41247.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.muskwa.41247 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.muskwa.41247.h500 <- getverticeshr (locs.caribou.hr.ewinter.du7.muskwa.41247.h500, percent = 95)
writeOGR (homerange.ewinter.du7.muskwa.41247.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41247_h500.shp", 
          layer = "hr_ewinter_du7_muskwa_41247_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du7.muskwa.41248.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.muskwa.41248 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.muskwa.41248.h500 <- getverticeshr (locs.caribou.hr.ewinter.du7.muskwa.41248.h500, percent = 95)
writeOGR (homerange.ewinter.du7.muskwa.41248.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41248_h500.shp", 
          layer = "hr_ewinter_du7_muskwa_41248_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du7.muskwa.41250.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.muskwa.41250 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.muskwa.41250.h500 <- getverticeshr (locs.caribou.hr.ewinter.du7.muskwa.41250.h500, percent = 95)
writeOGR (homerange.ewinter.du7.muskwa.41250.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41250_h500.shp", 
          layer = "hr_ewinter_du7_muskwa_41250_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du7.muskwa.41251.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.muskwa.41251 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.muskwa.41251.h500 <- getverticeshr (locs.caribou.hr.ewinter.du7.muskwa.41251.h500, percent = 95)
writeOGR (homerange.ewinter.du7.muskwa.41251.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41251_h500.shp", 
          layer = "hr_ewinter_du7_muskwa_41251_h500.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du7.muskwa.SCEK007b.h500 <- kernelUD (locs.caribou.hr.ewinter.du7.muskwa.SCEK007b [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.muskwa.SCEK007b.h500 <- getverticeshr (locs.caribou.hr.ewinter.du7.muskwa.SCEK007b.h500, percent = 95)
writeOGR (homerange.ewinter.du7.muskwa.SCEK007b.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_SCEK007b_h500.shp", 
          layer = "hr_ewinter_du7_muskwa_SCEK007b_h500.shp", driver = "ESRI Shapefile")
 
# Late Winter
locs.caribou.hr.lwinter.du7.h500 <- kernelUD (locs.caribou.hr.lwinter.du7 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du7.h500 <- getverticeshr (locs.caribou.hr.lwinter.du7.h500, percent = 95)
writeOGR (homerange.lwinter.du7.h500, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du7_h500.shp", 
          layer = "hr_lwinter_du7_h500.shp", driver = "ESRI Shapefile")

# DU8
# Summer
locs.caribou.hr.summer.du8.h500 <- kernelUD (locs.caribou.hr.summer.du8 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du8 <- getverticeshr (locs.caribou.hr.summer.du8.h500, percent = 95)
writeOGR (homerange.summer.du8, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du8_h500.shp", 
          layer = "hr_summer_du8_h500.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du8.h500 <- kernelUD (locs.caribou.hr.ewinter.du8 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du8 <- getverticeshr (locs.caribou.hr.ewinter.du8.h500, percent = 95)
writeOGR (homerange.ewinter.du8, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du8_h500.shp", 
          layer = "hr_ewinter_du8_h500.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du8.h500 <- kernelUD (locs.caribou.hr.lwinter.du8 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du8 <- getverticeshr (locs.caribou.hr.lwinter.du8.h500, percent = 95)
writeOGR (homerange.lwinter.du8, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du8_h500.shp", 
          layer = "hr_lwinter_du8_h500.shp", driver = "ESRI Shapefile")

# DU9
# Summer
locs.caribou.hr.summer.du9.h500 <- kernelUD (locs.caribou.hr.summer.du9 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du9 <- getverticeshr (locs.caribou.hr.summer.du9.h500, percent = 95)
writeOGR (homerange.summer.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du9_h500.shp", 
          layer = "hr_summer_du9_h500.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du9.h500 <- kernelUD (locs.caribou.hr.ewinter.du9 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du9 <- getverticeshr (locs.caribou.hr.ewinter.du9.h500, percent = 95)
writeOGR (homerange.ewinter.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du9_h500.shp", 
          layer = "hr_ewinter_du9_h500.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du9.h500 <- kernelUD (locs.caribou.hr.lwinter.du9 [, 14],
                                          h = 500, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du9 <- getverticeshr (locs.caribou.hr.lwinter.du9.h500, percent = 95)
writeOGR (homerange.lwinter.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du9_h500.shp", 
          layer = "hr_lwinter_du9_h500.shp", driver = "ESRI Shapefile")


# hr's with h = 350
locs.caribou.hr.summer.du6.h350 <- kernelUD (locs.caribou.hr.summer.du6 [, 14],
                                          h = 350, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du6.h350 <- getverticeshr (locs.caribou.hr.summer.du6.h350, percent = 95)
writeOGR (homerange.summer.du6.h350, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du6_h350.shp", 
          layer = "hr_summer_du6_h350.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du6.h350 <- kernelUD (locs.caribou.hr.ewinter.du6 [, 14],
                                          h = 350, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du6.h350 <- getverticeshr (locs.caribou.hr.ewinter.du6.h350, percent = 95)
writeOGR (homerange.ewinter.du6.h350, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du6_h350.shp", 
          layer = "hr_ewinter_du6_h350.shp", driver = "ESRI Shapefile")

locs.caribou.hr.lwinter.du6.h350 <- kernelUD (locs.caribou.hr.lwinter.du6 [, 14],
                                          h = 350, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du6.h350 <- getverticeshr (locs.caribou.hr.lwinter.du6.h350, percent = 95)
writeOGR (homerange.lwinter.du6.h350, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du6_h350.shp", 
          layer = "hr_lwinter_du6_h350.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.south.h350 <- kernelUD (locs.caribou.hr.summer.du7.south [, 14],
                                          h = 350, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.h350.south <- getverticeshr (locs.caribou.hr.summer.du7.south.h350, percent = 95)
writeOGR (homerange.summer.du7.h350.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_south_h350.shp", 
          layer = "hr_summer_du7_south_h350.shp", driver = "ESRI Shapefile")

# hr's with h = 250
locs.caribou.hr.summer.du6.h250 <- kernelUD (locs.caribou.hr.summer.du6 [, 14], 
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du6.h250 <- getverticeshr (locs.caribou.hr.summer.du6.h250, percent = 95)
writeOGR (homerange.summer.du6.h250, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du6_h250.shp", 
          layer = "hr_summer_du6_h250.shp", driver = "ESRI Shapefile")

locs.caribou.hr.ewinter.du6.h250 <- kernelUD (locs.caribou.hr.ewinter.du6 [, 14], 
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du6.h250 <- getverticeshr (locs.caribou.hr.ewinter.du6.h250, percent = 95)
writeOGR (homerange.ewinter.du6.h250, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du6_h250.shp", 
          layer = "hr_ewinter_du6_h250.shp", driver = "ESRI Shapefile")


locs.caribou.hr.lwinter.du6.h250 <- kernelUD (locs.caribou.hr.lwinter.du6 [, 14], 
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du6.h250 <- getverticeshr (locs.caribou.hr.lwinter.du6.h250, percent = 95)
writeOGR (homerange.lwinter.du6.h250, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du6_h250.shp", 
          layer = "hr_lwinter_du6_h250.shp", driver = "ESRI Shapefile")

locs.caribou.hr.summer.du7.south.h250 <- kernelUD (locs.caribou.hr.summer.du7.south [, 14],
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du7.h250.south <- getverticeshr (locs.caribou.hr.summer.du7.south.h250, percent = 95)
writeOGR (homerange.summer.du7.h250.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_south_h250.shp", 
          layer = "hr_summer_du7_south_h250.shp", driver = "ESRI Shapefile")


locs.caribou.hr.ewinter.du7.south.h250 <- kernelUD (locs.caribou.hr.ewinter.du7.south [, 14],
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du7.h250.south <- getverticeshr (locs.caribou.hr.ewinter.du7.south.h250, percent = 95)
writeOGR (homerange.ewinter.du7.h250.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_south_h250.shp", 
          layer = "hr_ewinter_du7_south_h250.shp", driver = "ESRI Shapefile")


locs.caribou.hr.lwinter.du7.south.h250 <- kernelUD (locs.caribou.hr.lwinter.du7.south [, 14],
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du7.h250.south <- getverticeshr (locs.caribou.hr.lwinter.du7.south.h250, percent = 95)
writeOGR (homerange.lwinter.du7.h250.south, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du7_south_h250.shp", 
          layer = "hr_lwinter_du7_south_h250.shp", driver = "ESRI Shapefile")

# DU8
# Summer
locs.caribou.hr.summer.du8.h250 <- kernelUD (locs.caribou.hr.summer.du8 [, 14],
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du8 <- getverticeshr (locs.caribou.hr.summer.du8.h250, percent = 95)
writeOGR (homerange.summer.du8, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du8_h250.shp", 
          layer = "hr_summer_du8_h250.shp", driver = "ESRI Shapefile")

# DU9
# Summer
locs.caribou.hr.summer.du9.h250 <- kernelUD (locs.caribou.hr.summer.du9 [, 14],
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.summer.du9 <- getverticeshr (locs.caribou.hr.summer.du9.h250, percent = 95)
writeOGR (homerange.summer.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du9_h250.shp", 
          layer = "hr_summer_du9_h250.shp", driver = "ESRI Shapefile")

# Early Winter
locs.caribou.hr.ewinter.du9.h250 <- kernelUD (locs.caribou.hr.ewinter.du9 [, 14],
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.ewinter.du9 <- getverticeshr (locs.caribou.hr.ewinter.du9.h250, percent = 95)
writeOGR (homerange.ewinter.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du9_h250.shp", 
          layer = "hr_ewinter_du9_h250.shp", driver = "ESRI Shapefile")

# Late Winter
locs.caribou.hr.lwinter.du9.h250 <- kernelUD (locs.caribou.hr.lwinter.du9 [, 14],
                                          h = 250, 
                                          grid = 1000, 
                                          extent = 2)  
homerange.lwinter.du9 <- getverticeshr (locs.caribou.hr.lwinter.du9.h250, percent = 95)
writeOGR (homerange.lwinter.du9, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du9_h250.shp", 
          layer = "hr_lwinter_du9_h250.shp", driver = "ESRI Shapefile")


```

tried differtn smoothign factors, including 750, 500, 350 and 250


show exampels of each size for why picked
resoltuion of data: smallest size (h=250) is ~200 m from point locations to egde of hr in some cases, leaving littel room for avriability in habitat between used and avalable for analysis @1ha resoltuion; larger sizes (h = 750) tended to estiamet large outer extents form teh points (>1 km) that may not realistially be a part of a hoem rnage

h=500 seemed to provide rasonable trade-off between capturing contiguous ranges encompassign lcoations, but not estimatign large extents outside teh bounds of the locations

![Example of home ranges exstimated using different smoothing factors (h) in DU7, early winter. ](caribou33_homerange_example_20181022.jpg) 

![Example of home ranges exstimated uisng different smoothing factors (h) in DU8, summer.](caribou056_homerange_example_20181022.jpg) 

![Example of home ranges exstimated uisng different smoothing factors (h) in DU6, late winter.](caribou143_homerange_example_20181022.jpg) 

![Example of home ranges exstimated uisng different smoothing factors (h) in DU7, summer.](cariboutc009_homerange_example_20181022.jpg) 

```{r, example of 3 hr sizes, warning = F, include = F, message = F}
conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
locs.caribou <- sf::st_read (dsn = conn,
                             query = "SELECT * FROM caribou.telemetry_caribou_bc_used_final")
dbDisconnect (conn)  

locs.caribou.SCEK143 <- locs.caribou.example %>%
  filter (uniqueID == 'du6_LateWinter_SCEK143_2015')
locs.caribou.SCEK143 <- as (locs.caribou.SCEK143, "Spatial")
writeOGR (locs.caribou.SCEK143, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\locs_caribou_SCEK143.shp", 
          layer = "locs_caribou_SCEK143.shp", driver = "ESRI Shapefile")

locs.caribou.TC009 <- locs.caribou.example %>%
  filter (uniqueID == 'du7_Summer_TC009_2013')
locs.caribou.TC009 <- as (locs.caribou.TC009, "Spatial")
writeOGR (locs.caribou.TC009, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\locs_caribou_TC009.shp", 
          layer = "locs_caribou_TC009.shp", driver = "ESRI Shapefile")

locs.caribou.33 <- locs.caribou.example %>% 
  filter (uniqueID == 'du7_EarlyWinter_33_2012')
locs.caribou.33 <- as (locs.caribou.33, "Spatial")
writeOGR (locs.caribou.33, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\locs_caribou_33.shp", 
          layer = "locs_caribou_33.shp", driver = "ESRI Shapefile")

locs.caribou.056 <- locs.caribou.example %>%
  filter (uniqueID == 'du8_Summer_car056_2008')
locs.caribou.056 <- as (locs.caribou.056, "Spatial")
writeOGR (locs.caribou.056, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\locs_caribou_056.shp", 
          layer = "locs_caribou_056.shp", driver = "ESRI Shapefile")

hr.750.caribou.SCEK143 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_lwinter_du6_h750.shp")
hr.750.caribou.SCEK143 <- hr.750.caribou.SCEK143 %>%
                            filter (id == 'du6_LateWinter_SCEK143_2015')
hr.750.caribou.SCEK143 <- as (hr.750.caribou.SCEK143, "Spatial")
writeOGR (hr.750.caribou.SCEK143, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_750_caribou_SCEK143.shp", 
          layer = "hr_750_caribou_SCEK143.shp", driver = "ESRI Shapefile")
hr.500.caribou.SCEK143 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du6_h500.shp")
hr.500.caribou.SCEK143 <- hr.500.caribou.SCEK143 %>%
                            filter (id == 'du6_LateWinter_SCEK143_2015')
hr.500.caribou.SCEK143 <- as (hr.500.caribou.SCEK143, "Spatial")
writeOGR (hr.500.caribou.SCEK143, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_500_caribou_SCEK143.shp", 
          layer = "hr_500_caribou_SCEK143.shp", driver = "ESRI Shapefile")
hr.250.caribou.SCEK143 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_lwinter_du6_h250.shp")
hr.250.caribou.SCEK143 <- hr.250.caribou.SCEK143 %>%
                            filter (id == 'du6_LateWinter_SCEK143_2015')
hr.250.caribou.SCEK143 <- as (hr.250.caribou.SCEK143, "Spatial")
writeOGR (hr.250.caribou.SCEK143, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_250_caribou_SCEK143.shp", 
          layer = "hr_250_caribou_SCEK143.shp", driver = "ESRI Shapefile")

hr.750.caribou.TC009 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_summer_du7_south_h750.shp")
hr.750.caribou.TC009 <- hr.750.caribou.TC009 %>%
                            filter (id == 'du7_Summer_TC009_2013')
hr.750.caribou.TC009 <- as (hr.750.caribou.TC009, "Spatial")
writeOGR (hr.750.caribou.TC009, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_750_caribou_TC009.shp", 
          layer = "hr_750_caribou_TC009.shp", driver = "ESRI Shapefile")
hr.500.caribou.TC009 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_south_h500.shp")
hr.500.caribou.TC009 <- hr.500.caribou.TC009 %>%
                            filter (id == 'du7_Summer_TC009_2013')
hr.500.caribou.TC009 <- as (hr.500.caribou.TC009, "Spatial")
writeOGR (hr.500.caribou.TC009, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_500_caribou_TC009.shp", 
          layer = "hr_500_caribou_TC009.shp", driver = "ESRI Shapefile")
hr.250.caribou.TC009 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_summer_du7_south_h250.shp")
hr.250.caribou.TC009 <- hr.250.caribou.TC009 %>%
                            filter (id == 'du7_Summer_TC009_2013')
hr.250.caribou.TC009 <- as (hr.250.caribou.TC009, "Spatial")
writeOGR (hr.250.caribou.TC009, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_250_caribou_TC009.shp", 
          layer = "hr_250_caribou_TC009.shp", driver = "ESRI Shapefile")

hr.750.caribou.33 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_ewinter_du7_south_h750.shp")
hr.750.caribou.33 <- hr.750.caribou.33 %>%
                            filter (id == 'du7_EarlyWinter_33_2012')
hr.750.caribou.33 <- as (hr.750.caribou.33, "Spatial")
writeOGR (hr.750.caribou.33, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_750_caribou_33.shp", 
          layer = "hr_750_caribou_33.shp", driver = "ESRI Shapefile")
hr.500.caribou.33 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_south_h500.shp")
hr.500.caribou.33 <- hr.500.caribou.33 %>%
                            filter (id == 'du7_EarlyWinter_33_2012')
hr.500.caribou.33 <- as (hr.500.caribou.33, "Spatial")
writeOGR (hr.500.caribou.33, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_500_caribou_33.shp", 
          layer = "hr_500_caribou_33.shp", driver = "ESRI Shapefile")
hr.250.caribou.33 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_ewinter_du7_south_h250.shp")
hr.250.caribou.33 <- hr.250.caribou.33 %>%
                            filter (id == 'du7_EarlyWinter_33_2012')
hr.250.caribou.33 <- as (hr.250.caribou.33, "Spatial")
writeOGR (hr.250.caribou.33, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_250_caribou_33.shp", 
          layer = "hr_250_caribou_33.shp", driver = "ESRI Shapefile")

hr.750.caribou.056 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_summer_du8_h750.shp")
hr.750.caribou.056 <- hr.750.caribou.056 %>%
                            filter (id == 'du8_Summer_car056_2008')
hr.750.caribou.056 <- as (hr.750.caribou.056, "Spatial")
writeOGR (hr.750.caribou.056, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_750_caribou_056.shp", 
          layer = "hr_750_caribou_056.shp", driver = "ESRI Shapefile")
hr.500.caribou.056 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du8_h500.shp")
hr.500.caribou.056 <- hr.500.caribou.056 %>%
                            filter (id == 'du8_Summer_car056_2008')
hr.500.caribou.056 <- as (hr.500.caribou.056, "Spatial")
writeOGR (hr.500.caribou.056, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_500_caribou_056.shp", 
          layer = "hr_500_caribou_056.shp", driver = "ESRI Shapefile")
hr.250.caribou.056 <- sf::st_read ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\archive\\hr_summer_du8_h250.shp")
hr.250.caribou.056 <- hr.250.caribou.056 %>%
                            filter (id == 'du8_Summer_car056_2008')
hr.250.caribou.056 <- as (hr.250.caribou.056, "Spatial")
writeOGR (hr.250.caribou.056, dsn = "C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\examples\\hr_250_caribou_056.shp", 
          layer = "hr_250_caribou_056.shp", driver = "ESRI Shapefile")

# Exported these data to arcgis to create maps
```


Sample available locatiosn at 1,000 locations per unique ID

```{r, sample available locations, warning = F, include = F, message = F}

#===============================================================
# Random sample of 'available' points in home ranges
#==============================================================
# https://gis.stackexchange.com/questions/108046/how-to-create-randomly-points-within-polygons-for-each-row-of-a-dataframe-matchi

# load the hr data, bind together and save
hr.ewinter.du6 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du6_h500.shp")
hr.summer.du6 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du6_h500.shp")
hr.lwinter.du6 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du6_h500.shp")
hr.summer.du7.south <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_south_h500.shp")
hr.summer.du7.ne <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_ne_h500.shp")
hr.summer.du7.C303T <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_spat_C303T_h500.shp")
hr.summer.du7.C298T <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_spat_C298T_h500.shp")
hr.summer.du7.41243 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41243_h500.shp")
hr.summer.du7.41253 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41253_h500.shp")
hr.summer.du7.41255 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41255_h500.shp")
hr.summer.du7.41249 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41249_h500.shp")
hr.summer.du7.41262 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41262_h500.shp")
hr.summer.du7.41255 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41255_h500.shp")
hr.summer.du7.41258 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_pink_41258_h500.shp")
hr.summer.du7.C301T <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du7_spat_C301T_h500.shp")
hr.ewinter.du7.south <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_south_h500.shp")
hr.ewinter.du7.ne <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_ne_h500.shp")
hr.ewinter.du7.007b <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_SCEK007b_h500.shp")
hr.ewinter.du7.41251 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41251_h500.shp")
hr.ewinter.du7.41250 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41250_h500.shp")
hr.ewinter.du7.41248 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41248_h500.shp")
hr.ewinter.du7.41241 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41241_h500.shp")
hr.ewinter.du7.41247 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du7_muskwa_41247_h500.shp")
hr.lwinter.du7 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du7_h500.shp")
hr.lwinter.du8 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du8_h500.shp")
hr.summer.du8 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du8_h500.shp")
hr.ewinter.du8 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du8_h500.shp")
hr.summer.du9 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_summer_du9_h500.shp")
hr.lwinter.du9 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_lwinter_du9_h500.shp")
hr.ewinter.du9 <- readOGR ("C:\\Work\\caribou\\clus_data\\caribou\\telemetry_habitat_model_20180904\\homeranges\\hr_ewinter_du9_h500.shp")

homerange.all <- rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (rbind (hr.ewinter.du6, hr.lwinter.du6), hr.summer.du6), hr.lwinter.du7), hr.ewinter.du7.007b), hr.ewinter.du7.41241), hr.ewinter.du7.41247), hr.ewinter.du7.41248), hr.ewinter.du7.41250), hr.ewinter.du7.41251), hr.ewinter.du7.ne), hr.ewinter.du7.south), hr.summer.du7.41243), hr.summer.du7.41249), hr.summer.du7.41253), hr.summer.du7.41255), hr.summer.du7.41258), hr.summer.du7.41262), hr.summer.du7.C298T), hr.summer.du7.C301T), hr.summer.du7.C303T), hr.summer.du7.ne), hr.summer.du7.south), hr.ewinter.du8), hr.lwinter.du8), hr.summer.du8), hr.ewinter.du9), hr.lwinter.du9), hr.summer.du9)

colnames (homerange.all@data)[1] <- "uniqueID"
colnames (homerange.all@data)[2] <- "area.ha"

homerange.all.sf <- st_as_sf (homerange.all)

conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
st_write (obj = homerange.all.sf, 
          dsn = conn, 
          layer = c ("caribou", "homeranges_caribou_bc"))
dbDisconnect (conn)


# create spatialpointsdataframe to bind to in loop
sample.pts.start <- spsample (homerange.all [homerange.all@data$uniqueID == "du6_EarlyWinter_HSCEK077_2012",], n = 1000, type = "random")
sample.pts.start.data <- data.frame (matrix (ncol = 2, nrow = nrow (sample.pts.start@coords)))
colnames (sample.pts.start.data) <- c ("pttype", "uniqueID")
sample.pts.start.data$pttype <- 0
sample.pts.start.data$uniqueID <- "du6_EarlyWinter_HSCEK077_2012"
id.points.out.all <- SpatialPointsDataFrame (sample.pts.start, data = sample.pts.start.data)

for (i in levels (homerange.all@data$uniqueID)) { # loop to sample 1000 random points for each polygon
  id.poly <- homerange.all [homerange.all@data$uniqueID == i,]
  id.points <- spsample (id.poly, 
                         n = 1000, type = "random", iter = 50)
  data.pts <- data.frame (matrix (ncol = 2, nrow = nrow (id.points@coords)))
  colnames (data.pts) <- c ("pttype", "uniqueID")
  data.pts$pttype <- 0
  data.pts$uniqueID <- i
  id.points.out <- SpatialPointsDataFrame (id.points, data = data.pts)
  id.points.out.all <- rbind (id.points.out.all, id.points.out)
}

id.points.out.all@data$uniqueID <- as.factor (id.points.out.all@data$uniqueID)
id.points.out.all@data$du <- gsub (".*(du6|du7|du8|du9).*$", 
                                   "\\1", 
                                   id.points.out.all@data$uniqueID, ignore.case = F)
id.points.out.all@data$du <- as.factor (id.points.out.all@data$du)

id.points.out.all@data$season <- gsub (".*(EarlyWinter|LateWinter|Summer).*$", 
                                       "\\1", 
                                       id.points.out.all@data$uniqueID, ignore.case = F)
id.points.out.all@data$season <- as.factor (id.points.out.all@data$season)

id.points.out.all@data$animal_id <- gsub ("^[^_]+_|_[^_]+$", '', id.points.out.all@data$uniqueID)
id.points.out.all@data$animal_id <- sub (".*?_", '', id.points.out.all@data$animal_id)
id.points.out.all@data$animal_id <- as.factor (id.points.out.all@data$animal_id)


id.points.out.all@data$year <- sub (".*_", '', id.points.out.all@data$uniqueID)
id.points.out.all@data$year <- as.factor (id.points.out.all@data$year)

id.points.out.all.sf <- st_as_sf (id.points.out.all)

conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
st_write (obj = id.points.out.all.sf, 
          dsn = conn, 
          layer = c ("caribou", "available_locations_caribou_bc"))
dbDisconnect (conn)


```



bind the used and available locations into a dataframe

```{r, bind used and available location data, warning = F, include = F, message = F}

conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
locs.caribou <- sf::st_read  (dsn = conn, # connKyle
                              query = "SELECT * FROM caribou.telemetry_caribou_bc_used_final")
id.points.out.all.sf <- sf::st_read  (dsn = conn, # connKyle
                              query = "SELECT * FROM caribou.available_locations_caribou_bc")
dbDisconnect (conn) # connKyle
st_crs (id.points.out.all.sf) <- 3005

locs.caribou$pttype <- 1
locs.caribou$animal_id <- as.factor (locs.caribou$animal_id)
locs.caribou$season <- as.factor (locs.caribou$season)
locs.caribou$year <- as.factor (locs.caribou$year)
locs.caribou$HERD_NAME <- as.factor (locs.caribou$HERD_NAME)
locs.caribou$ECOTYPE <- as.factor (locs.caribou$ECOTYPE)
locs.caribou$du <- as.factor (locs.caribou$du)
locs.caribou$uniqueID <- as.factor (locs.caribou$uniqueID)

locs.caribou.lean <- locs.caribou %>%
                      dplyr::select (pttype, uniqueID, du, season, animal_id, year, GEOMETRY, ECOTYPE, HERD_NAME)

id.points.out.all.sf$ECOTYPE <- "NA"
id.points.out.all.sf$ECOTYPE <- as.factor (id.points.out.all.sf$ECOTYPE)
id.points.out.all.sf$HERD_NAME <- "NA"
id.points.out.all.sf$HERD_NAME <- as.factor (id.points.out.all.sf$HERD_NAME)
id.points.out.all.sf$uniqueID <- as.factor (id.points.out.all.sf$uniqueID)
id.points.out.all.sf$du <- as.factor (id.points.out.all.sf$du)
id.points.out.all.sf$season <- as.factor (id.points.out.all.sf$season)
id.points.out.all.sf$animal_id <- as.factor (id.points.out.all.sf$animal_id)
id.points.out.all.sf$year <- as.factor (id.points.out.all.sf$year)
names (id.points.out.all.sf) [7] <- "GEOMETRY"
attr (id.points.out.all.sf, "sf_column") <- "GEOMETRY" # geometry names not consistent, need to rename one 
names (locs.caribou.lean) == names (id.points.out.all.sf) # check the consistency of column names

rsf.locations <- rbind (locs.caribou.lean, id.points.out.all.sf)

rsf.locations$uniqueID <- as.factor (rsf.locations$uniqueID)
rsf.locations$du <- as.factor (rsf.locations$du)
rsf.locations$season <- as.factor (rsf.locations$season)
rsf.locations$animal_id <- as.factor (rsf.locations$animal_id)
rsf.locations$year <- as.factor (rsf.locations$year)
rsf.locations$ECOTYPE <- as.factor (rsf.locations$ECOTYPE)
rsf.locations$HERD_NAME <- as.factor (rsf.locations$HERD_NAME)

# some cleaning-up to do
# need to fill in blank ECOTYPE and HERD_NAME
rsf.locations$ECOTYPE [rsf.locations$du == "du6"] <- 'Boreal' # make all DU6 animals 


unique.data <- rsf.locations %>% # unique IDs in the data
                  distinct (uniqueID, .keep_all = T)
  
  
  
unique.data.north <- unique.data %>%
                      filter (ECOTYPE == "Northern")

unique.data.north <- unique.data %>%
                      filter (ECOTYPE == "Northern")


list.uniqueID.north <- as.character (unique (unique.data.north$uniqueID))



rsf.locations.test <- rsf.locations %>%
                          filter (ECOTYPE == "Northern")


rsf.locations.test$ECOTYPE [rsf.locations.test$uniqueID == "du7_EarlyWinter_C303T_2014" |   rsf.locations.test$uniqueID == "du7_EarlyWinter_C303T_2013"] <- 'Northern'


for (i in list.uniqueID.north) {
  if (rsf.locations.test$uniqueID == i) {
    rsf.locations.test$ECOTYPE == "Northern"
  } else {rsf.locations.test$ECOTYPE == ""}
}


 (rsf.locations$uniqueID = list.uniqueID.north, , )









rsf.locations.test <- rsf.locations %>% 
                  dplyr::arrange (uniqueID) %>% # sort by unique identifier
                  tidyr::fill (ECOTYPE, .direction = "down") # replace empty ECOTYPE values with previous rows value




rsf.locations.test <- rsf.locations %>% 
                  dplyr::group_by (uniqueID) %>% # group by unique identifier
                  tifyr::na.locf (rsf.locations$HERD_NAME) # replace empty HERD_NAME values with previous rows value


rsf.locations$ECOTYPE <- ifelse (rsf.locations$ECOTYPE == "", rsf.locations$uniqueID, rsf.locations$ECOTYPE) # fillign in blank ecotypes and herd names



dupes <- duplicated (rsf.locations) # looking for duplicates


unique.count <- data.frame (table (rsf.locations$uniqueID))


locs.caribou.ecotype.herd <- locs.caribou.ecotype.herd [locs.caribou.ecotype.herd$uniqueID %in% names (table (locs.caribou.ecotype.herd$uniqueID)) [table (locs.caribou.ecotype.herd$uniqueID) >= 50], ]







conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
st_write (obj = rsf.locations, 
          dsn = conn, 
          layer = c ("caribou", "rsf_locations_caribou_bc"))
dbDisconnect (conn)











```








```{r, back-up to Kyle's postgres db, warning = F, include = F, message = F}

connKyle <- dbConnect(drv = dbDriver ("PostgreSQL"), 
                      host = "DC052586", # Kyle's computer name
                     user = "Tyler",                      
                     dbname = "clus",
                     password = "tyler",
                     port = "5432")
st_write (obj = rsf.locations, 
          dsn = connKyle, 
          layer = c ("public", "rsf_locations_caribou_bc"))
st_write (obj = locs.caribou, 
          dsn = connKyle, 
          layer = c ("public", "telemetry_caribou_bc_final"))
st_write (obj = id.points.out.all.sf, 
          dsn = connKyle, 
          layer = c ("public", "available_locations_caribou_bc"))
dbDisconnect (connKyle) 
```
























#================================================
# Bind the available and used locations together
#===============================================
prov.locs.all.used@data$ecotype <- as.character (prov.locs.all.used@data$ecotype)
prov.locs.all.used@data$OBSERVATION_YEAR <- as.character (prov.locs.all.used@data$OBSERVATION_YEAR)
prov.locs.all.used@data$uniqueID <- as.character (prov.locs.all.used@data$uniqueID)
prov.locs.all.used@data$season <- as.character (prov.locs.all.used@data$season)
prov.locs.all.used@data$HERD_NAME <- as.character (prov.locs.all.used@data$HERD_NAME)
prov.locs.all.used@data$ANIMAL_ID <- as.character (prov.locs.all.used@data$ANIMAL_ID)

id.points.out.all <- spTransform (id.points.out.all, CRS = proj4string (prov.locs.all.used)) # reproject
id.points.out.all@data [setdiff (names (prov.locs.all.used@data), names(id.points.out.all@data))] <- NA # create the same column names
prov.locs.all.used@data [setdiff (names (id.points.out.all@data), names(prov.locs.all.used@data))] <- NA # create the same column names
id.points.out.all@data$ptID <- c (453377:1978377)
all.locations <- rbind (prov.locs.all.used, id.points.out.all)


select ()





all.locations@data$ecotype 
all.locations@data$season 
all.locations@data$season 
all.locations@data$year 


as.factor
