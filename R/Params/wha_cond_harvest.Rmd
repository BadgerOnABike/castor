---
title: "WHA_Conditional_Harvest"
author: "Kyle Lochhead"
date: "June 24, 2019"
output: 
  html_document:
    toc: true
    toc_depth: 3
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Wildlife Habitat Areas 
Wildlife habitat areas (WHAs) are spatial areas that are designated to provide limiting habitat for identified wildlife species. WHAs are designated under the Forest and Range Practices Act. Spatial data on the location of WHAs are obtained through [DataBC](https://catalogue.data.gov.bc.ca/dataset/wildlife-habitat-areas-approved). Legal orders for WHAs are obtained [here](https://www.env.gov.bc.ca/cgi-bin/apps/faw/wharesult.cgi?search=show_approved). 
WHAs can be designated as no harvest or conditional harvest. Conditional harvesting means that there is some level of retention required during harvest operations. This may require a percentage of the harvest unit being retained according to a descriptive class - this can be age, crown closure, height and even species specific.

Below we take the spatial polygon data and assign a constraint to each unique legal zone based on interpretation of the legal order (or assign as 'no harvest' where applicable). Note that we do not include 'Data Sensitive' areas, as the constraints in these areas are not identified and are only available through special request (i.e., they are not easily available to the general public). 

Updated June 24, 2021.

## Conditional Harvest Table
```{r, WHA_cond_harv}
library(data.table)
library(sf)
library(here)
source (paste0(here(),"/R/functions/R_Postgres.R"))

wha_poly<-getSpatialQuery("SELECT ogc_fid, tag, feature_no, approval_d, wkb_geometry FROM public.wha_20210621")

lu<-getSpatialQuery("SELECT *
FROM public.rmp_lu_sp_polygon LIMIT 1") #just a dummy query to get the projection

#Get the raster and projection
ProvRast <- raster(
  nrows = 15744, ncols = 17216, xmn = 159587.5, xmx = 1881187.5, ymn = 173787.5, ymx = 1748187.5, 
  crs = st_crs(lu)$proj4string, resolution = c(100, 100), vals = 0
)

#fasterize 
wha.ras<-fasterize::fasterize(sf= wha_poly, raster = ProvRast , field = "ogc_fid")

#Create empty zone constraint table
zone_wha<-data.table(zoneid=integer(), 
                     type=character(), 
                     variable=character(), 
                     threshold=numeric(), 
                     reference_zone=character(), percentage=numeric(), ndt=integer(),
                     label = character(), multi_condition = character(), denom = character())

#get the ogc_fid from raster
ogc_fids<-data.table(unique(c(t(raster::as.matrix(wha.ras)))))
ogc_fids<-ogc_fids[!(is.na(V1)),]
wha_cond<-getTableQuery(paste0("SELECT ogc_fid, timber_har, tag, feature_no, approval_d FROM public.wha_20210621 WHERE ogc_fid IN(",paste(ogc_fids$V1, collapse = ","), ") ORDER BY tag"))

#assign all no harvest as zoneid = 0 
ogc_fids_noharv<-wha_cond[wha_cond$timber_har == 'NO HARVEST ZONE' & wha_cond$tag != '5-118', "ogc_fid"]
# here I am taking out WHA 5-118 and parameterizing it below, because I needed to make it available for harvest in a caribou planning scenario, so it needs a unique zoneid 
zone_wha<-data.table(zoneid = 0, type = 'nh', variable = '', 
                     threshold = 0, reference_zone='rast.zone_wha_2021', percentage =0, 
                     ndt =0, label = 'wha_no_harv', multi_condition = '', denom = '')

#set all to 0 in the raster as no harvest
wha.ras[wha.ras[] %in% ogc_fids_noharv] <- 0

wha_cond<-wha_cond[!(wha_cond$timber_har == 'NO HARVEST ZONE' & wha_cond$tag != '5-118'), ] #get only the conditional harvesting ones now, with 5-118 as the exception.

```

### 1-001, 1-003, 1-005, 1-006, 1-042 to 1-051, 1-085 to 1-096, 1-391 to 1-392, 1-394 to 1-395, 1-488, 1-489, 1-569, 1-572, 1-585 to 1-588, 1-698, 1-699, 1-703 to 1-706, 2-120 to 2-128, 2-130 to 2-138, 2-148, 2-149, 2-580 to 2-595, 2-656 to 2-666, 3-008 to 3-009, 3-046 to 3-063, 3-110 to 3-114, 3-138, 3-140, 3-171 to 3-183, 4-011 to 4-045, 4-105, 4-109, 4-112, 5-003 to 5-006, 5-062, 5-072, 5-073, 5-730, 5-752, 5-904 to 5-905, 5-911 to 5-916, 6-001 to 6-003, 6-283 to 6-286, 7-004 to 7-011, 7-017, 8-023 to 8-025, 8-033, 8-053 to 8-056, 8-063 to 8-064, 8-239, 8-243, 8-244, 8-368 to 8-372, 8-374, 9-025 to 9-031, 9-162 to 9-165, 9-172 to 9-180
Data sensitive; removed from data.
```{r, data sensitive}
# no constraints defined; sensitive locations that are not available to the public
# remove from analysis
wha_tags<-c('1-001', '1-003', '1-005', '1-006', '1-042', '1-043', '1-044', '1-045', '1-046', '1-047', '1-048', '1-049', '1-050', '1-051', '1-085', '1-086', '1-087', '1-088', '1-089', '1-090', '1-091', '1-092', '1-093', '1-094', '1-095', '1-096', '1-391', '1-392', '1-394', '1-395', '1-488', '1-489', '1-569', '1-572', '1-585', '1-586', '1-587', '1-588', '1-698', '1-699', '1-703', '1-704', '1-705', '1-706', '2-120', '2-121', '2-122', '2-123', '2-124', '2-125', '2-126', '2-127', '2-128', '2-130', '2-131', '2-132', '2-133', '2-134', '2-135', '2-136', '2-137', '2-138', '2-148', '2-149', '2-580', '2-581', '2-582', '2-583', '2-584', '2-585', '2-586', '2-587', '2-588', '2-589', '2-590', '2-591', '2-592', '2-593', '2-594', '2-595', '2-656', '2-657', '2-658', '2-659', '2-660', '2-661', '2-662', '2-663', '2-664', '2-665', '2-666', '3-008', '3-009', '3-046', '3-047', '3-048', '3-049', '3-050', '3-051', '3-052', '3-053', '3-054', '3-055', '3-056', '3-057', '3-058', '3-059', '3-060', '3-061', '3-062', '3-063', '3-110', '3-111', '3-112', '3-113', '3-114', '3-138', '3-140', '3-171', '3-172', '3-173', '3-174', '3-175', '3-176', '3-177', '3-178', '3-179', '3-180', '3-181', '3-182', '3-183', '4-011', '4-012', '4-013', '4-014', '4-015', '4-016', '4-017', '4-018', '4-019', '4-020', '4-021', '4-022', '4-023', '4-024', '4-025', '4-026', '4-027', '4-028', '4-029', '4-030', '4-031', '4-032', '4-033', '4-034', '4-035', '4-036', '4-037', '4-038', '4-039', '4-040', '4-041', '4-042', '4-043', '4-044', '4-045', '4-105', '4-109', '4-112', '5-003', '5-004', '5-005', '5-006', '5-062', '5-072', '5-073', '5-730', '5-752', '5-904', '5-905', '5-911', '5-912', '5-913', '5-914', '5-915', '5-916',
'6-001', '6-002', '6-003', '6-283', '6-284', '6-285', '6-286', '7-004', '7-005', '7-006', '7-007', '7-008', '7-009', '7-010', '7-011', '7-017', '8-023', '8-024', '8-025', '8-033', '8-053', '8-054', '8-055', '8-056', '8-063', '8-064', '8-239', '8-243', '8-244', '8-368', '8-369', '8-370', '8-371',
'8-372', '8-374', '9-025', '9-026', '9-027', '9-028', '9-029', '9-030','9-060', '9-031', '9-162', '9-163', '9-164', '9-165', '9-172', '9-173', '9-174', '9-175', '9-176', '9-177', '9-178', '9-179', '9-180')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
#unique (wha_cond$tag)
```

### 1-068 to 1-076
```{r, 1-068 to 1-076}
# Maintain 80% basal area; used height >5m as proxy for basal area
wha_tags <- c('1-068', '1-069', '1-070', '1-071', '1-072', '1-073', '1-074', '1-075', '1-076')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 80, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table

```

### 1-190 to 1-197
```{r, 1-190 to 1-197}
# Maintain 60% basal area; used height >5m as proxy for basal area
wha_tags <- c('1-190', '1-191', '1-192', '1-193', '1-194', '1-195', '1-196', '1-197')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 60, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 1-224
```{r, 1-224}
# Maintain 60% basal area; used height >5m as proxy for basal area
wha_tags <- c('1-224')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 60, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 2-012 - Mountain Beaver
```{r, 2-012}
# Order refers to Mountain Beaver GWM document from 1999 with a dead link; dropped from WHA data (assume no impact to forestry)
wha_tags <- c('2-012')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm] <- NA
wha_cond <- wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 2-116 - Grizzly Bear
```{r, 2-116}
# Order establishes as a no harvest area
wha_tags <- c('2-116')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm] <- 0 #reassign in the raster as zone = 0, i.e., ho harvest
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 2-129, 2-142, 2-143, 2-145 - Tall bugbane
```{r, 2-129, 2-142, 2-143, 2-145}
# Maintain 60% basal area; used height >5m as proxy for basal area
wha_tags <- c('2-129', '2-142', '2-143', '2-145')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 60, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 2-250 - stickleback
```{r, 2-250}
# orders are around prevention of stream sedimentation; set to allow for harvest
wha_tags <- c('2-250')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm] <- NA
wha_cond <- wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 2-497, 2-499, 2-500, 2-503, 2-504 - spotted owl
```{r, 2-497, 2-499, 2-500, 2-503, 2-504}
# complicated order, but essentially appears to be no harvest with some exceptions; set as a no harvest area here
wha_tags <- c('2-497', '2-499', '2-500', '2-503', '2-504')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm] <- 0 #reassign in the raster as zone = 0, i.e., ho harvest
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 2-511, 2-512 and 2-513 - coastal tailed frog
```{r, 2-511, 2-512, 2-513}
# Maintain 70% basal area; used height >5m as proxy for basal area
wha_tags <- c('2-511', '2-512', '2-513')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 70, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table

```

### 2-517, 2-518, 2-519, 2-520, 2-521, 2-523, 2-524, 2-525 - spotted owl
```{r, 2-517, 2-518, 2-519, 2-520, 2-521, 2-523, 2-524, 2-525}
# complicated order, but essentially appears to be no harvest with some exceptions; set as a no harvest area here
wha_tags <- c('2-517', '2-518', '2-519', '2-520', '2-521', '2-523', '2-524', '2-525')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm] <- 0 #reassign in the raster as zone = 0, i.e., ho harvest
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 2-539, 2-548, 2-549, 2-551, 2-552 - grizzly bear
```{r, 2-539, 2-548, 2-549, 2-551, 2-552}
# timber harvest permitted with riparian management, maintains function of cover habitat; seems to allow for harvest, so set to allow for harvest
wha_tags <- c('2-539', '2-548', '2-549', '2-551', '2-552')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm] <- NA
wha_cond <- wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table

```

### 2-567, 2-568, 2-569, 2-570, 2-571, 2-572, 2-573, 2-574, 2-575, 2-576, 2-577, 2-578, 2-579, 2-670 - tall bugbane
```{r, 2-567, 2-568, 2-569, 2-570, 2-571, 2-572, 2-573, 2-574, 2-575, 2-576, 2-577, 2-578, 2-579, 2-670}
#  Maintain 60% basal area; used height >5m as proxy for basal area
wha_tags <- c('2-567', '2-568', '2-569', '2-570', '2-571', '2-572', '2-573', '2-574', '2-575', '2-576', '2-577', '2-578', '2-579', '2-670')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 60, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table

```

### 3-004 - coastal tailed frog
```{r, 3-004}
# maintain 80% basal area;  used height >5m as proxy for basal area
wha_tags <- c('3-004')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 80, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-005 - coastal tailed frog
```{r, 3-005}
# maintain 80% basal area;  used height >5m as proxy for basal area
wha_tags <- c('3-005')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 80, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-014, 3-015, 3-016, 3-017  - coastal tailed frog
```{r, 3-014, 3-015, 3-016, 3-017}
# maintain 80% basal area;  used height >5m as proxy for basal area
wha_tags <- c('3-014', '3-015', '3-016', '3-017')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 80, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-018, 3-019  - coastal tailed frog
```{r, 3-018, 3-019}
# maintain 70% basal area; used height >5m as proxy for basal area
wha_tags <- c('3-018', '3-019')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 70, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-071, 3-072, 3-073, 3-076, 3-077, 3-078 - Lewis Woodpecker
```{r, 3-071, 3-072, 3-073, 3-076, 3-077, 3-078}
#Do not harvest or salvage mature timber. When harvest is approved: Protect or retain all ponderosa pine and block cottonwood live or dead > 30 cm dbh. Use partial cutting silvicutural systems to maintain widely spaced <25% later seral ponderosa pine and Douglas fir. Do not use pesticides. Do not construct roads unless there is no other practicable option. see http://www.env.gov.bc.ca/wld/documents/wha/LEWO_3-071to088_ord.pdf
# set to no harvesting in these areas
wha_tags<-c('3-071', '3-072', '3-073', '3-074', '3-075', '3-076','3-077','3-078')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-079 - Lewis Woodpecker
```{r, 3-079}
#Do not harvest or salvage mature timber. When harvest is approved: Protect or retain all ponderosa pine and block cottonwood live or dead > 30 cm dbh. Use partial cutting silvicutural systems to maintain widely spaced <25% later seral ponderosa pine and Douglas fir. Do not use pesticides. Do not construct roads unless there is no other practicable option. 
# set to no harvesting in these areas
wha_tags<-c('3-079')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-080, 3-081, 3-082, 3-083 - Lewis Woodpecker
```{r, 3-080, 3-081, 3-082, 3-083}
#Do not harvest or salvage mature timber. When harvest is approved: Protect or retain all ponderosa pine and block cottonwood live or dead > 30 cm dbh. Use partial cutting silvicutural systems to maintain widely spaced <25% later seral ponderosa pine and Douglas fir. Do not use pesticides. Do not construct roads unless there is no other practicable option. 
# set to no harvesting in these areas
wha_tags<-c('3-080', '3-081', '3-082', '3-083')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-084, 3-087, 3-088 - Lewis Woodpecker
```{r, 3-084, 3-087, 3-088}
#Do not harvest or salvage mature timber. When harvest is approved: Protect or retain all ponderosa pine and block cottonwood live or dead > 30 cm dbh. Use partial cutting silvicutural systems to maintain widely spaced <25% later seral ponderosa pine and Douglas fir. Do not use pesticides. Do not construct roads unless there is no other practicable option. 
# Set to no harvesting in these areas
wha_tags<-c('3-084', '3-087', '3-088')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-089 - Lewis Woodpecker
```{r, 3-089}
#Do not harvest or salvage mature timber. When harvest is approved: Protect or retain all ponderosa pine and block cottonwood live or dead > 30 cm dbh. Do not use pesticides. 
# Set to no harvesting in these areas
wha_tags<-c('3-089')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-117, 3-118, 3-119, 3-120, 3-122 - Badger
```{r, 3-117, 3-118, 3-119, 3-120, 3-122}
# No roads, no harvesting except for ecological restoration
# Set to no harvesting in these areas
wha_tags<-c('3-117', '3-118', '3-119', '3-120', '3-122')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-147 American Badger
Do not construct roads. Do not use pesticides. Do not conduct timber harvesting, except when harvesting is required to support ecological restoration where stocking <75 tph. see http://www.env.gov.bc.ca/wld/documents/wha/TATA_3-147_Order.pdf
```{r, w3147}
# Set to no harvesting in these areas
wha_tags <- c('3-147')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-148, 3-150 - coastal tailed frog
```{r, 3-148, 3-150}
# maintain 70% basal area; used height >5m as proxy for basal area
wha_tags <- c('3-148', '3-150')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha <- rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, 
                                       type = 'ge', variable = 'height', 
                                       threshold = 5, 
                                       reference_zone = 'rast.zone_wha_2021', 
                                       percentage = 70, ndt = 0, 
                                       label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 3-221 - grizzly bear
```{r, 3-221}
# orders to prevent harvest near dens, timing windows, etc.; essentialy allows for harvest
wha_tags <- c('3-221')
ogc_fids_rm <- wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm] <- NA
wha_cond <- wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-046 to 4-055 Rocky mountain tailed frog
Do not harvest in the core area (these are defined as 'no harvest' in the data, so dealt with above). In the 'management zone', maintain at least 70% basal area with the approprate structure. Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/ASMO-4-046-055.pdf
```{r, w4046}
#Maintain basal area of ? for 70% of the unit -- means very light touch
#get the ogc_fids that belong to these.
wha_tags<-c('4-046','4-047','4-048','4-049','4-050','4-051','4-052','4-053','4-054','4-055')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =70, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-056 to 4-064 Rocky mountain tailed frog
Do not harvest in the core area (these are defined as 'no harvest' in the data, so dealt with above). In the 'management zone', maintain at least 70% basal area with the approprate structure. Do not use pesticides.see http://www.env.gov.bc.ca/wld/documents/wha/ASMO-4-056-064.pdf
```{r, '4-056','4-057','4-058','4-059','4-060','4-061','4-062','4-063','4-064'}
wha_tags<-c('4-056','4-057','4-058','4-059','4-060','4-061','4-062','4-063','4-064')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =70, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-077, 4-078, 4-079, 4-080, 4-081 Flammulated owl
Do not salvage or harvest in the core area except partial harvesting systems. Do not harvest on xeric sites. In mesic or subhydric sites use selective harvesting systems that retain 50% of the co-dominant trees.see http://www.env.gov.bc.ca/wld/documents/wha/FLOW-4-077-85.pdf
```{r, 4-077, 4-078, 4-079, 4-080, 4-081}
# partial harvest only; maintain >50% of dominant or co-dominant species; used height as proxy
wha_tags<-c('4-077','4-078','4-079','4-080','4-081')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =50, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-088 to 4-092, 4-102, 4-103 American Badger 
Do not use pesticide. Harvest as required to support ecological restoration. Reduce stocking densities < 75 stems. No new road access development.
see http://www.env.gov.bc.ca/wld/documents/wha/TATA_4-088-092,102,103_ord.pdf
```{r, 4-088 to 4-092, 4-102, 4-103 }
# No roads, no harvesting except for ecological restoration
# Set to no harvesting in these areas
wha_tags<-c('4-088', '4-089', '4-090', '4-091', '4-092','4-092','4-102', '4-103')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-098 Western screech Owl 
Do not harvest or salvage in the core area. In the management zone, use selection harvest < 20% basal area for PP, IDF and ICH zone. Retain deciduous trees. Retain > 60% of tree in riparian zones. DO not construct roads in core areas. see http://www.env.gov.bc.ca/wld/documents/wha/WSOW_4-098_ord.pdf
```{r, w4098}
# maintain 80% basal area; used height >5m as proxy for basal area
wha_tags<-c('4-098')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-099 to 4-101 Flammulated owl 
Do not salvage or harvest in the core area. Do not harvest on xeric sites. In mesic or subhydric sites use selective harvesting systems that retain 50% of the co-dominant trees.see http://www.env.gov.bc.ca/wld/documents/wha/FLOW_4-099to101_ord.pdf
```{r, w4099}
wha_tags<-c('4-099','4-100','4-101')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =50, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-106 - American Badger
Do not use pesticide. Do not construct roads. Do not harvest except as required to support ecological restoration. Reduce stocking densities < 75 stems.
```{r, w4106}
# set as no harvest
wha_tags<-c('4-106')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-107  American Badger
Do not use pesticide.  Do not construct roads. Do not harvest except as required to support ecological restoration. Reduce stocking densities < 75 stems. see http://www.env.gov.bc.ca/wld/documents/wha/TATA_4-107_ord.pdf
```{r, w4107}
# set as no harvest
wha_tags<-c('4-107')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #reassign in the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-114 to 4-115  Western Screech Owl
Do not cross streams or construct roads. Do not conduct timber harvesting or salvage within the core area. Within the management zone use selective harvest of < 20% basal area. Retain deciduous trees and retain > 60% of trees within riparian management zones. see http://www.env.gov.bc.ca/wld/documents/wha/WSOW_4-113to115_Order.pdf
```{r, 4-114, 4-115}
wha_tags<-c('4-114', '4-115')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-121 to 4-126, 4-130 to 4-132, 4-134 to 4-135 - Lewis Woodpecker
Do not construct roads. Do not use pesticides. Do not harvest unless to address ecosystem restoration. Ponderosa pine and dead trees > 30 cm dbh are maintained. Treatments are managed to promote shrub structure for berry and nut production. see http://www.env.gov.bc.ca/wld/documents/wha/LEWO_4-121_135_ord.pdf
```{r, w4121}
#No harvest in these areas
wha_tags<-c('4-121', '4-122', '4-123', '4-124', '4-125', '4-126','4-130','4-131','4-132','4-134','4-135')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0 #remove from the raster
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-151 to 4-170, 4-177 - Gillettes Checkerspot
Do not construct roads except in 4-160, 4-162, 4-166 and 4-169. Do not use pesticides/herbicides. Avoid silviculture that would result in closed canopies. see http://www.env.gov.bc.ca/wld/documents/wha/EUPGIL_4-151to170_177_ord.pdf
```{r, w4151}
#Prefer open canopies
wha_tags<-c('4-151',	'4-152',	'4-153',	'4-154',	'4-155',	'4-156',	'4-157',	'4-158',	'4-159',	'4-160',	'4-161',	'4-162',	'4-163',	'4-164',	'4-165',	'4-166',	'4-167',	'4-168',	'4-169',	'4-170', '4-177')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-178 to 4-179 - Western Screech Owl
In the core area do not construct roads or stream crossings. Do not conduct harvesting or salvage within the core area. When conducting harvesting in the management zone use selective harvesting <= 20% basal area removal. Do not remove deciduous. In riparian areas retain > 60% of trees. see http://www.env.gov.bc.ca/wld/documents/wha/WSOW_4-178_to_4-179_Order.pdf
```{r, w4178}
wha_tags<-c('4-178', '4-179')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-180 Grizzly Bear
Enhance Vaccinium spp which include ICDdw1, ICHdm, ESSFdm (table 2). Ratain large CWD (> 30 cm dbh). Do not use pesticides, see http://www.env.gov.bc.ca/wld/documents/wha/URAR_4-180_SA_Order.pdf
```{r, w4180}
#get the ogc_fids that belong to these.
wha_tags<-c('4-180')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-209 - Interior Western Screech Owl
Do not construct roads or crossings in the core area. Do not timber harvest or salvage in the core area. Use selective harvesting <= 20% basal area removal. Do not remove deciduous trees. Retain > 60% of trees in riparian areas. see http://www.env.gov.bc.ca/wld/documents/wha/WESO_4-205_4-209_Order.pdf
```{r, w4209}
wha_tags<-c('4-209')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-217 to 4-232, 4-234 to 4-242 Gillettes Checkerspot
Do not construct roads. Avoid closed canopies. see http://www.env.gov.bc.ca/wld/documents/wha/EUGI_4-217_to_232_234_to242_GAR_Order.pdf
```{r, w4217}
#get the ogc_fids that belong to these.
wha_tags<-c('4-217',	'4-218',	'4-219',	'4-220',	'4-221',	'4-222',	'4-223',	'4-224',	'4-225',	'4-226',	'4-227',	'4-228',	'4-229',	'4-230',	'4-231',	'4-232','4-234',	'4-235',	'4-236',	'4-237',	'4-238',	'4-239',	'4-240',	'4-241',	'4-242')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 4-243 to 4-276 Western Screech Owl
Do not construct roads or crossings in the core area. Do not timber harvest or salvage in the core area. Use selective harvesting <= 20% basal area removal. Do not remove deciduous trees. Retain > 60% of trees in riparian areas. see http://www.env.gov.bc.ca/wld/documents/wha/WSOW_4-243_to_276_GAR_Order.pdf
```{r, w4243}
wha_tags<-c('4-243',	'4-244',	'4-245',	'4-246',	'4-247',	'4-248',	'4-249',	'4-250',	'4-251',	'4-252',	'4-253',	'4-254',	'4-255',	'4-256',	'4-257',	'4-258',	'4-259',	'4-260',	'4-261',	'4-262',	'4-263',	'4-264',	'4-265',	'4-266',	'4-267',	'4-268',	'4-269',	'4-270',	'4-271',	'4-272',	'4-273',	'4-274',	'4-275',	'4-276')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-008 - American White Pelican
Do Not harvest from April 1 to August 31 -- model harvests at annual scale, thus timing windows not a concern. see http://www.env.gov.bc.ca/wld/documents/wha/AWPE-5-008_ord.pdf
```{r, w5008}
#get the ogc_fids that belong to these.
wha_tags<-c('5-008')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-011 - American White Pelican
Do Not harvest from April 1 to August 31 -- model harvests at annual scale, thus timing windows not a concern. 
```{r, w5011}
#get the ogc_fids that belong to these.
wha_tags<-c('5-011')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-014 to 5-035 - American White Pelican
Do Not harvest from April 1 to August 31 -- model harvests at annual scale, thus timing windows not a concern. see http://www.env.gov.bc.ca/wld/documents/wha/AWPE-5-007_ord.pdf
```{r, 5-014 to 5-035}
#get the ogc_fids that belong to these.
wha_tags<-c('5-014','5-015', '5-017','5-018','5-019','5-020','5-021','5-022','5-023','5-024','5-026','5-027','5-029',
            '5-031','5-034','5-035')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-037 to 5-043 Grizzly Bear
Do not use pesticides. Protect forest cover and plant communities. No road, trail or landing construction. see http://www.env.gov.bc.ca/wld/documents/wha/URAR_5-037to043_CentalCariboo.pdf
```{r, w5037}
#No Harvest
wha_tags<-c('5-037','5-038')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-074, 5-075, 5-076, 5-077, 5-078, 5-079, 5-080, 5-081, 5-082, 5-084, 5-085 - Badger
```{r, 5-074, 5-075, 5-076, 5-077, 5-078, 5-079, 5-080, 5-081, 5-082, 5-084, 5-085}
#No Harvest
wha_tags<-c('5-074', '5-075', '5-076', '5-077', '5-078', '5-079', '5-080', '5-081', '5-082', '5-084', '5-085')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-086 to 5-087- Caribou Northern
 In caribou modified harvest for wha 5-086 retain lichen sites where 33% of the area on arboreal sites is on an 80 year cutting cycle. In caribou modified harvest for wha 5-086 retain lichen sites where 50% of the area on terrestrial lichen sites is on an 70 year cutting cycle. 
 see http://www.env.gov.bc.ca/wld/documents/wha/RATA_5-086-873_ord.pdf
```{r, w5086 and 5087}
#5-118 is a no harvest zone 0 already assigned.
#5-086 Age >80 for 45%. Age > 100 for 37%. Age 120 for 30%. Age 140 for 25%. 
wha_tags<-c('5-087') #25% is left unlogged with an age > 100 years. See Table 1
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid","tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 80, reference_zone='rast.zone_wha_2021', percentage =45, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 100, reference_zone='rast.zone_wha_2021', percentage =37, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 120, reference_zone='rast.zone_wha_2021', percentage =30, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 140, reference_zone='rast.zone_wha_2021', percentage =25, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table

wha_tags<-c('5-086') #40% > 70 and 20% > 80
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid","tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 70, reference_zone='rast.zone_wha_2021', percentage =40, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 80, reference_zone='rast.zone_wha_2021', percentage =20, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table

```

### 5-088 to 5-117 Mountain Caribou 
Do not harvest in the caribou No-harvest. Caribou modified harvest in wha 5-088 to 5-091, 5-093 to 5-095 and 5-111 to 5-116 use group selection harvesting up to 33% of each stand area on a 80 year cutting cycle.  see http://www.env.gov.bc.ca/wld/documents/wha/RATA_5-088_%205-117_ord_09Dec09.pdf
```{r, w5088}
#For the wha's that have modfied harvesting --consider 66% of the area > 80 years
wha_tags<-c('5-088',	'5-089',	'5-090',	'5-091',	'5-093',	'5-094',	'5-095',	'5-111', '5-116') #25% is left unlogged with an age > 100 years
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 80, reference_zone='rast.zone_wha_2021', percentage =66, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-118 Mountain Caribou 
No-harvest zone; parameterizing it here with a unique ID so I can modify it (make it harvestable) for a cariobu scearnio.
```{r, w5188}
#For the wha's that have modfied harvesting --consider 66% of the area > 80 years
wha_tags<-c('5-118')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'nh', variable = '', threshold = 0, reference_zone='rast.zone_wha_2021', percentage =0, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-120 to 5-123, 5-126 to 5-128, 5-131, 5-133 , 5-136 to 5-150, 5-168 to 5-171 + many more  Grizzly Bear
Primary forestry activities will result in protections of the forest cover and plant communities within the boundaries of the wha.  Pesticides shall not be used. Salvage harvesting shall not be used. see http://www.env.gov.bc.ca/wld/documents/wha/URAR-5-121to541_MidCoastTSA.pdf
```{r, w5120}
#get the ogc_fids that belong to these.
wha_tags<-c('5-120','5-121','5-122','5-123','5-126','5-127','5-128','5-131','5-133','5-136','5-137','5-138','5-139','5-140','5-141','5-142','5-143','5-144','5-145','5-146','5-147','5-148','5-149','5-150','5-168','5-169','5-170','5-171','5-172','5-173','5-174','5-175','5-176','5-177','5-178','5-179','5-180','5-181','5-182','5-183','5-184','5-185','5-186','5-187','5-188','5-190',	'5-191',	'5-192',	'5-193',	'5-194',	'5-195',	'5-196',	'5-197',	'5-198',	'5-199',	'5-200',	'5-201',	'5-202',	'5-203',	'5-204',	'5-205',	'5-206',	'5-207',	'5-208',	'5-209',	'5-210',	'5-211',	'5-212',	'5-213',	'5-214',	'5-215',	'5-216',	'5-217',	'5-218',  '5-224',	'5-225',	'5-226',	'5-227',	'5-228',	'5-229',	'5-230',	'5-231',	'5-232',	'5-233',	'5-234',	'5-235',	'5-236',	'5-237',	'5-238',	'5-239',	'5-240',	'5-241',	'5-242',	'5-243',	'5-244',	'5-245',	'5-246',	'5-247',	'5-248',	'5-249',	'5-250',	'5-251',	'5-252',	'5-253',	'5-254',	'5-255',	'5-256',	'5-257',	'5-258',	'5-259',	'5-260',	'5-261',	'5-262',	'5-263',	'5-264',	'5-265',	'5-266',	'5-267',	'5-268',	'5-269',	'5-270',	'5-271',	'5-272',	'5-273',	'5-274',	'5-275',	'5-276',	'5-277','5-279', '5-280', '5-281', '5-282', '5-283', '5-285',	'5-286',	'5-287',	'5-288',	'5-289',	'5-290',	'5-291',	'5-292',	'5-293',	'5-294',	'5-295',	'5-296',	'5-297',	'5-298',	'5-299',	'5-300',	'5-301',	'5-302',	'5-303',	'5-304',	'5-305',
'5-307',	'5-308',	'5-309',	'5-310',	'5-311',	'5-312',	'5-313',	'5-314',	'5-315',	'5-316',	'5-317',	'5-318',	'5-319',	'5-320',	'5-321',	'5-322',	'5-323',	'5-324',	'5-325',	'5-326',	'5-327',	'5-328',	'5-329','5-331',	'5-332',	'5-333',	'5-334',	'5-335',	'5-336',	'5-337',	'5-338',	'5-339',	'5-340',	'5-341',	'5-342',	'5-343',	'5-344',	'5-345',	'5-346',	'5-347',	'5-348',	'5-349',	'5-350',	'5-351','5-354',	'5-355',	'5-356',	'5-357',	'5-358','5-361',	'5-362',	'5-363',	'5-364',	'5-365',	'5-366',	'5-367',	'5-368',	'5-369',	'5-370',	'5-371',	'5-372',	'5-373',	'5-374',	'5-375',	'5-376',	'5-377',	'5-378',	'5-379',	'5-380',	'5-381',	'5-382',	'5-383',	'5-384',	'5-385',	'5-386',	'5-387',	'5-388',	'5-389',	'5-390',	'5-391',	'5-392',	'5-393',	'5-394',	'5-395',	'5-396',	'5-397',	'5-398',	'5-399',	'5-400',	'5-401',	'5-402',	'5-403',	'5-404',	'5-405',	'5-406',	'5-407',	'5-408',	'5-409',	'5-410',	'5-411',	'5-412',	'5-413',	'5-414',	'5-415',	'5-416',	'5-417',	'5-418',	'5-419',	'5-420',	'5-421',	'5-422',	'5-423',	'5-424',	'5-425',	'5-426',	'5-427',	'5-428',	'5-429',	'5-430',	'5-431',	'5-432',	'5-433',	'5-434',	'5-435',	'5-436',	'5-437',	'5-438',	'5-439',	'5-440',	'5-441',	'5-442', '5-456','5-457','5-458','5-459','5-499',	'5-500',	'5-501',	'5-502',	'5-503',	'5-504',	'5-505',	'5-506',	'5-507',	'5-508',	'5-509',	'5-510',	'5-511',	'5-512',	'5-513','5-515',	'5-516',	'5-517',	'5-518',	'5-519',	'5-520',	'5-521',	'5-522',	'5-523',	'5-524',	'5-525', '5-527',	'5-528',	'5-529',	'5-530',	'5-531',	'5-532',	'5-533',	'5-534',	'5-535',	'5-536',	'5-537',	'5-538',	'5-539',	'5-540',	'5-541')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

###  5-872 and 5-873 Caribou
In wha 5-872 and 5-873, 25% is left unlogged with an age > 100 years. see http://www.env.gov.bc.ca/wld/documents/wha/RATA_5-086-873_ord.pdf
```{r, w5872-5873}
wha_tags<-c('5-872','5-873') #25% is left unlogged with an age > 100 years
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 100, reference_zone='rast.zone_wha_2021', percentage =25, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

###  5-874 - badger
```{r, w5874}
# harvest permitted with some specific site-level orders; allow for harvest here
wha_tags<-c('5-874') 
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-875- badger
```{r, w5875}
# no forestry 
wha_tags<-c('5-875') 
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

###  5-876, 5-877, 5-877, 5-878, 5-879, 5-880, 5-881, 5-882, 5-883 - badger
```{r, 5-876, 5-877, 5-877, 5-878, 5-879, 5-880, 5-881, 5-882, 5-883}
# harvest permitted with some specific site-level orders; allow for harvest here
wha_tags<-c('5-876', '5-877', '5-877', '5-878', '5-879', '5-880', '5-881', '5-882', '5-883') 
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 5-884, 5-885, 5-886, 5-887, 5-888, 5-889, 5-890, 5-891, 5-892, 5-893, 5-894, 5-896, 5-897 - Great Basin Spadefoot
```{r, 5-884, 5-885, 5-886, 5-887, 5-888, 5-889, 5-890, 5-891, 5-892, 5-893, 5-894, 5-896, 5-897}
# harvest permitted with some specific site-level orders; allow for harvest here
wha_tags<-c('5-884', '5-885', '5-886', '5-887', '5-888', '5-889', '5-890', '5-891', '5-892', '5-893', '5-894', '5-896', '5-897') 
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```
 
### 6-055 - grizzly bear
```{r, w6055}
# site level orders; allow for harvest 
wha_tags<-c('6-055') 
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 6-056 to 6-057 - Coastal Tailed Frog
For wha 6-056: do not harvest within the core area or special management zone. For what 6-057: Use partial harvesting system that maintain 70% basal area with the appropriate structure. No salvage should be carried out. see http://www.env.gov.bc.ca/wld/documents/wha/ASTR_6-056-57_ord.pdf
```{r, w6056}
wha_tags<-c('6-056') # I broke these two out
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
#for 6-057 maintain 70% 
wha_tags<-c('6-057')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =70, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 6-058 to 6-059 - Coastal Tailed Frog
Do not harvest within the core area of special management zone.
```{r, w6058 6059}
#maintain 70% 
wha_tags<-c('6-058','6-059')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 6-060 to 6-067 - Coastal Tailed Frog
Maintain 70% of residual stand volume.
```{r, w6060 to 6067}
#maintain 70% 
wha_tags<-c('6-060', '6-061', '6-062', '6-063', '6-064', '6-065', '6-066', '6-067')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =70, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 6-333 - Caribou
Primary forestry activities will focus in-block retention to include key caribou features and provide sufficient forest retention to provide visual screening. Within the Bulkley TSA: >60% of the SBSmc > 80 years,  < 28% of SBSmc < 40 year, > 45 % of SBSdk > 80 years, < 39% of SBSdk < 40 years. Within the Morice TSA: > 17% of SBSmc > 140 years, < 48 SBSmc < 40 years, > 8 % of SBSdk > 140 years, < 64% of SBSdk < 40 years  
GWMs apply if the licensees prepare a Caribou Management Plan
see http://www.env.gov.bc.ca/wld/documents/wha/RATA_6-333_ord_replaced_2018.pdf and http://www.env.gov.bc.ca/wld/documents/wha/RATA_6-333_amend_2018.pdf
```{r, w6333}
wha_tags<-c('6-333')
# Here we simplify to a constraint to maintain high proportion of old forest
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 80, reference_zone='rast.zone_wha_2021', percentage =66, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 7-001 - grizzly bear
harvesting permitted with site-level requirements
```{r, w7001}
# site level orders; allow for harvest 
wha_tags<-c('7-001')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 7-002 - grizzly bear
harvesting permitted with site-level requirements
```{r, w7002}
# site level orders; allow for harvest 
wha_tags<-c('7-002')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-003 to 8-004 Grasshopper Sparrow
see http://www.env.gov.bc.ca/wld/documents/wha/GRSP_%208-003_8-004_ord.pdf
Do not construct roads. Do not use pesticides. No harvest constraints.
```{r, w8003}
#get the ogc_fids that belong to these.
wha_tags<-c('8-003','8-004')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-006 to 8-010 - Bighorn Sheep
Follow a guide : https://www.for.gov.bc.ca/tasb/legsregs/fpc/fpcguide/other/wild/part2-21.htm#P1655_118642. For bighorn sheep there are no forestry constraints. see http://www.env.gov.bc.ca/wld/documents/wha/OVCC-8-006_ord.pdf
```{r, w8006}
#get the ogc_fids that belong to these.
wha_tags<-c('8-006','8-007','8-008','8-009','8-010')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-011, 8-012, 8-013 - Coastal tailed frog 
Partial harvest to maintain 80% basal area.
```{r, 8-011, 8-012, 8-013}
# maintain 80% of zone as equivalent to basal area 
wha_tags<-c('8-011', '8-012', '8-013')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage = 80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-014 to 8-017 White-headed Woodpecker
Do not construct roads. Do not salvage timber. Protect and retain all ponderosa pine and douglas-fir >60cm. Use a partial cutting silvicultural system to maintain widely spaced late seral ponderosa pine and douglas fir. Group, single tree are recommended; maintain 40-70% canopy closure of late seral pondersoa pine.
see http://www.env.gov.bc.ca/wld/documents/wha/WHWO-8-014_ord.pdf
see http://www.env.gov.bc.ca/wld/documents/wha/WHWO-8-015_ord.pdf
see http://www.env.gov.bc.ca/wld/documents/wha/WHWO-8-016_ord.pdf
see http://www.env.gov.bc.ca/wld/documents/wha/WHWO-8-017_ord.pdf
```{r, w8014 to 8017}
#conservatively maintain 40% canopy closure
wha_tags<-c('8-014','8-015','8-016','8-017')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'crownclosure', threshold = 20, reference_zone='rast.zone_wha_2021', percentage = 40, ndt =0, label = ogc_fids_rm$tag, multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-047, 8-051 - Brewer's Sparrow
Do not use pesticide; no harvest constraints.
https://www.env.gov.bc.ca/wld/documents/wha/BRSP_8-047_ord.pdf
http://www.env.gov.bc.ca/wld/documents/wha/BRSP_8-051_8-319_to_8-324_ord.pdf
```{r, w8047}
# allow harvest
wha_tags<-c('8-047','8-051')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-077, 8-078, 8-079, 8-080, 8-081, 8-082 - coastal tailed frog
Partial harvest to maintain 80% basal area.
```{r, 8-077, 8-078, 8-079, 8-080, 8-081, 8-082}
# maintain 80% of zone as equivalent to basal area 
wha_tags<-c('8-077', '8-078', '8-079', '8-080', '8-081', '8-082')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, c("ogc_fid", "tag")]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage = 80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-090 to 8-094 - Blotched Tiger Salamander
Do not construct roads. Do not scarify harvested areas, do not place landings within management zone. Do not use pesticides
see http://www.env.gov.bc.ca/wld/documents/wha/AMTI_8-090_to_8-094_ord.pdf.
```{r, w8090}
#get the ogc_fids that belong to these.
wha_tags<-c('8-090',	'8-091',	'8-092',	'8-093',	'8-094')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-124 to 8-126 - Western Screech Owl
Do not use pesticides. Do not salvage or harvest in core area. Do not construct roads or crossings in the core area. Use selective harvesting <= 20% basal area removal. Do not remove deciduous trees. Retain > 60% of trees in riparian areas. see http://www.env.gov.bc.ca/wld/documents/wha/WSOW_8-124_ord.pdf
```{r, w8124}
wha_tags<-c('8-124',	'8-125',	'8-126')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-232 - Grizzly Bear
Forest practices will result in at least 10% of each management unit containing forest stands that exhibit a height of at least 19.5 m in patches that are at least 5 ha in size. Management units are defined as the area of each BEC subzone within each landscape unit. see http://www.env.gov.bc.ca/wld/documents/wha/URAR_8-232_ord.pdf
```{r, w8232}
#10% of the area > 19.5 m height. 
wha_tags<-c('8-232')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 19.5, reference_zone='rast.zone_wha_2021', percentage =10, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-233 - Caribou 
GWM 1: Forest practises will result in a minimum of 30% of the timber exhibiting heights of at least 14 m, or have undergone self-pruning of the lower branches to allow for suitable security and movement between winter ranges. see http://www.env.gov.bc.ca/wld/documents/wha/RATA_8-233_ord.pdf
```{r, w8233}
# > 30 % having height > 14 m
wha_tags<-c('8-233')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 14, reference_zone='rast.zone_wha_2021', percentage =30, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-260, 8-261, 8-262 - Western Screech Owl
Do not use pesticides. Do not salvage or harvest in core area. Do not construct roads or crossings in the core area. Use selective harvesting <= 20% basal area removal. Do not remove deciduous trees. Retain > 60% of trees in riparian areas.see http://www.env.gov.bc.ca/wld/documents/wha/WSOW_8-261,8-262_ord.pdf
```{r, 8-260, 8-261, 8-262}
# maintain 80% of zone as equivalent to basal area 
wha_tags<-c('8-260', '8-261',	'8-262')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'height', threshold = 5, reference_zone='rast.zone_wha_2021', percentage =80, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-319, 8-320, 8-321, 8-322, 8-323, 8-324 - Brewer's sparrow
Do not use pesticide; no harvest constraints.
```{r, 8-319, 8-320, 8-321, 8-322, 8-323, 8-324}
# allow harvest
wha_tags<-c('8-319', '8-320', '8-321', '8-322', '8-323', '8-324')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-325 - Grasshopper's sparrow
Do not use pesticide; no harvest constraints.
```{r, 8-325}
# allow harvest
wha_tags<-c('8-325')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-328 to 8-331 - American badger
Do not construct roads, Do not harvest unless required to support ecological restoration. Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/TATA_8_328and331_ord.pdf
https://www.env.gov.bc.ca/wld/documents/wha/TATA_8_329and330_ord.pdf
```{r, w8328 to 8-331}
# do not harvest
wha_tags<-c('8-328','8-329','8-330','8-331')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-332, 8-333 - Half-moon Hairstreak
Do not construct roads or trails; Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/SATSEM_%208-332_8-333_8-357_to_8-361_ord.pdf
```{r, w8332}
#get the ogc_fids that belong to these.
wha_tags<-c('8-332',	'8-333')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-335, 8-336 - Great Basin Spadefoot
Do not construct roads or trails; Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/SPIN_8-335_8-336_ord.pdf
```{r, w8335}
#get the ogc_fids that belong to these.
wha_tags<-c('8-335',	'8-336')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-357 to 8-361 - Half-moon Hairstreak
Do not construct roads or trails; Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/SATSEM_%208-332_8-333_8-357_to_8-361_ord.pdf
```{r, w8357 to 8361}
wha_tags<-c('8-357',	'8-358',	'8-359',	'8-360',	'8-361')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-373 Grizzly Bear
Do not conduct primary forest activities between May 1 and June 20th. Do not plant trees within a 500 m specified area of polygons. Do not construct roads within 50 m of habitat features. Primary forest activities adjacent to avalanche tracks must retain forest cover that is at least 15 meters in height for a width of 100 meters. Do not use herbicide. see http://www.env.gov.bc.ca/wld/documents/wha/URAR_8-373_Ord.pdf
S-- Assuming these are operational ground rules. 
```{r, w8373}
wha_tags<-c('8-373')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-416 to 8-420 - Blotched Tiger Salamander
Do not construct roads or trails; Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/AMTI_SPIN_8-416_ord.pdf
```{r, w8416}
wha_tags<-c('8-416',	'8-417',	'8-418',	'8-419',	'8-420')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-424 Lewis' Woodpecker
Do not construct roads or trails; Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/LEWO_8-424_ord.pdf
```{r, w8424}
#get the ogc_fids that belong to these.
wha_tags<-c('8-424')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 8-426 to 8-433 Half-moon Hairstreak
Do not construct roads or trails; Do not use pesticides. see http://www.env.gov.bc.ca/wld/documents/wha/SATSEM_%208-426_to_8-433_ord.pdf
```{r, w8426}
#get the ogc_fids that belong to these.
wha_tags<-c('8-426',	'8-427',	'8-428',	'8-429',	'8-430',	'8-431',	'8-432', '8-433')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 9-003 to 9-017 Mountain Goat
Refer to a guidebook: https://www.for.gov.bc.ca/tasb/legsregs/fpc/fpcguide/other/wild/index.htm. For Mountain goat: Do not construct roads. http://www.env.gov.bc.ca/wld/documents/wha/ORAM-9-003_ord.pdf
```{r, w9003}
#get the ogc_fids that belong to these.
wha_tags<-c('9-003',	'9-004',	'9-005',	'9-006',	'9-007',	'9-008',	'9-009', '9-010', '9-011', '9-012', '9-013', '9-014', '9-015', '9-016', '9-017')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-NA
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 9-035 to 9-040, 9-102, 9-103 - Caribou
No Harvest. No roads. see http://www.env.gov.bc.ca/wld/documents/wha/RATA_9-035_040,102,103_ord.pdf
```{r, w9035}
# no harvest
wha_tags<-c('9-035',	'9-036',	'9-037',	'9-038',	'9-039', '9-040',	'9-102',	'9-103')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags, "ogc_fid"]
wha.ras[wha.ras[] %in% ogc_fids_rm]<-0
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### 9-049, 9-073, 9-104, 9-105, 9-144, 9-145 -  Caribou
Will not adversely effect lichen productivity, result in a network of connected forest cover for visual screening and lichen, result in pre-harvest pine leading stands to be established as pine leading stands. see http://www.env.gov.bc.ca/wld/documents/wha/RATA_9-032_034_041_073,104_106,144,145_ord.pdf
```{r, w9032}
# Reduce early seral forage. >80 years for 50% of the area; should also provide security cover
wha_tags<-c('9-049', '9-073',	'9-104',	'9-105', '9-144', '9-145')
ogc_fids_rm<-wha_cond[wha_cond$tag %in% wha_tags,c("ogc_fid", "tag") ]
zone_wha<-rbind(zone_wha, data.table(zoneid = ogc_fids_rm$ogc_fid, type = 'ge', variable = 'age', threshold = 40, reference_zone='rast.zone_wha_2021', percentage =50, ndt =0, label = ogc_fids_rm$tag,
                                       multi_condition = '', denom = ''))
wha_cond<-wha_cond[!(wha_cond$tag %in% wha_tags), ] #remove from table
```

### Clean up and Commit data
```{r, clean_commit}
writeRaster(wha.ras, file=paste0(here(), "/wha.tif"), format="GTiff", overwrite=TRUE)

system("cmd.exe", input = paste0('raster2pgsql -s 3005 -d -I -C -M -N 2147483648  ', here(), '/wha.tif -t 100x100 rast.zone_wha_2021 |  psql postgres://', keyring::key_get('dbuser', keyring = 'postgreSQL'), ':', keyring::key_get('dbpass', keyring = 'postgreSQL'), '@', keyring::key_get('dbhost', keyring = 'postgreSQL'), ':5432/clus'), show.output.on.console = FALSE, invisible = TRUE)

df<-as.data.frame(zone_wha)
df$ndt<-as.integer(0)
df$zoneid<-as.integer(df$zoneid)#assign integer
df$percentage<-as.numeric(df$percentage)#assign integer

conn<-DBI::dbConnect(dbDriver("PostgreSQL"), host=keyring::key_get('dbhost', keyring = 'postgreSQL'), dbname = keyring::key_get('dbname', keyring = 'postgreSQL'), port='5432' ,user=keyring::key_get('dbuser', keyring = 'postgreSQL') ,password= keyring::key_get('dbpass', keyring = 'postgreSQL'))

DBI::dbWriteTable(conn, c("zone", "wha_2021"), value= df, row.names = FALSE, overwrite = TRUE) 
dbExecute(conn, "ALTER TABLE zone.wha_2021 ADD column start INT")
dbExecute(conn, "ALTER TABLE zone.wha_2021 ADD column stop INT")
dbExecute(conn, "ALTER TABLE zone.wha_2021 ALTER COLUMN denom TYPE VARCHAR;")
dbExecute(conn, "UPDATE zone.wha_2021 set denom = null where denom is not null;")
dbExecute(conn, "UPDATE zone.wha_2021 set multi_condition = null where multi_condition is not null;")
dbExecute(conn, "UPDATE zone.wha_2021 SET start = 0 WHERE start IS not null;")
dbExecute(conn, "UPDATE zone.wha_2021 SET stop = 250 WHERE stop IS not null;")

dbExecute (conn, paste0("ALTER TABLE zone.wha_2021 INHERIT zone.constraints"))

dbDisconnect(conn)

```