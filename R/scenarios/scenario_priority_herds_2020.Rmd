---
title: "Priority Cariobu Herd Forestry Impact Summary"
author: "Tyler Muhly"
date: "19/06/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require (kableExtra)
require(data.table)
```

## Introduction

Here is a summary of initial results of potential simaulted imapcts to forest harvest to support provincial carriobu herd planning priorities for 2020/21. 


focus on percentage not absolute amont; absolute when fine-tune the model

Sceanrios are:
- Business-as-usal (BAU)

```{r, table 1, results, echo = F, error = F, eval = T, include = T, message = F}
# data.harvest <- read.csv (here ("reports/scenarios/data", "harvest.csv"))

con <- dbConnect ("PostgreSQL",
				          host = keyring::key_get("vmdbhost", keyring="postgreSQL"), 
                  user = keyring::key_get("vmdbuser", keyring="postgreSQL"), 
                  password = keyring::key_get("vmdbpass", keyring="postgreSQL"),  
                  dbname = keyring::key_get("vmdbname", keyring="postgreSQL"),
				          port = "5432")
data.harvest <- dbGetQuery (con, "SELECT * FROM williams_lake_tsa.harvest") # mackenzie_sw_tsa, gbr_north. gbr_south, pg_tsa
dbDisconnect (con)
data.summ <- data.harvest %>% # get summary data
              filter (scenario == "willake_all_ch_hele0d_m15d") %>% 
                  summarise (sum (volume)/40)


table.volume = data.table (
  harvest_unit = c ("Arrow TSA", "Arrow TSA", "Arrow TSA", "Arrow TSA", "Arrow TSA",
                    
                    "Cascadia TSA - Kootenay Block", "Cascadia TSA - Kootenay Block", "Cascadia TSA - Kootenay Block",
                    
                    "Dawson Creek TSA", "Dawson Creek TSA", "Dawson Creek TSA", "Dawson Creek TSA", "Dawson Creek TSA", "Dawson Creek TSA", "Dawson Creek TSA",
                    
                    "Golden TSA", "Golden TSA", "Golden TSA", "Golden TSA", "Golden TSA", "Golden TSA", "Golden TSA",
                    
                    "Kamloops TSA", "Kamloops TSA", "Kamloops TSA", "Kamloops TSA", "Kamloops TSA", "Kamloops TSA", "Kamloops TSA",
                    
                    "Kootenay Lake TSA", "Kootenay Lake TSA", "Kootenay Lake TSA", "Kootenay Lake TSA", "Kootenay Lake TSA",
                    
                    "Lakes TSA", "Lakes TSA", "Lakes TSA", "Lakes TSA", "Lakes TSA",
                    
                    "Mackenzie TSA", "Mackenzie TSA", "Mackenzie TSA", "Mackenzie TSA", "Mackenzie TSA", "Mackenzie TSA", "Mackenzie TSA", "Mackenzie TSA", "Mackenzie TSA",
                    
                    "Morice TSA", "Morice TSA", "Morice TSA", "Morice TSA", "Morice TSA",
                    
                    "Okanagan TSA", "Okanagan TSA", "Okanagan TSA", "Okanagan TSA", "Okanagan TSA", 
                    
                    "Quesnel TSA", "Quesnel TSA", "Quesnel TSA", "Quesnel TSA", "Quesnel TSA",
                    
                    "Revelstoke TSA", "Revelstoke TSA", "Revelstoke TSA", "Revelstoke TSA", "Revelstoke TSA",
                    
                    "Robson Valley TSA", "Robson Valley TSA", "Robson Valley TSA", "Robson Valley TSA", "Robson Valley TSA", "Robson Valley TSA", "Robson Valley TSA", "Robson Valley TSA", "Robson Valley TSA",
                    
                    "Williams Lake TSA", "Williams Lake TSA", "Williams Lake TSA", "Williams Lake TSA", "Williams Lake TSA",
                    "TFL 14", "TFL 14", "TFL 14",
                    
                    "TFL 18", "TFL 18", "TFL 18",
                    
                    "TFL 23", "TFL 23", "TFL 23", "TFL 23", "TFL 23", "TFL 23", "TFL 23", 
                    
                    "TFL 30", "TFL 30", "TFL 30",
                    
                    "TFL 33", "TFL 33", "TFL 33",
                    
                    "TFL 48", "TFL 48", "TFL 48", "TFL 48", "TFL 48", "TFL 48", "TFL 48",
                    
                    "TFL 55", "TFL 55", "TFL 55", "TFL 55", "TFL 55",
                    
                    "TFL 56", "TFL 56", "TFL 56"),
  scenario = c ("BAU", "No harvest in Central Selkirks critical habitat", "35% disturbance in Central Selkirks matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Central Selkirks critical habitat", "35% disturbance in Central Selkirks matrix critical habitat",
                
                "BAU", "No harvest in Central Group critical habitat", "35% disturbance in Central Group matrix critical habitat", "No harvest in Central group partnership agreement areas A2, B2, and B3, maximum 35%  disturbance (15%) harvest in Central group partnership agreement areas A1, B1, B4 and B5", "No harvest in all Central group partnership agreement areas", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Central Selkirks critical habitat", "35% disturbance in Central Selkirks matrix critical habitat", "No harvest in Columbia North and South", "35% disturbance in Columbia North and South matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat", "No harvest in Wells Gray South/Groundhog critical habitat", "35% disturbance in Wells Gray South/Groundhog matrix critical habitat",
                
                "BAU", "No harvest in Central Selkirks critical habitat", "35% disturbance in Central Selkirks matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Wolverine, Chase and Takla herd", "No harvest in Chilcotin critical habitat", "35% disturbance in Chilcotin matrix critical habitat", "No harvest in Wolverine, Chase and Takla herd and Chilcotin critical habitat",
                
                "BAU", "No harvest in all central group critical habitat", "35% disturbance in central group matrix critical habitat", "No harvest in Central group partnership agreement areas A2, B2, and B3, maximum 35% buffered disturbance (15% harvest) in Central group partnership agreement areas A1, B1, B4 and B5", "No harvest in all central group partnership agreement areas", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat", "No harvest in all southern mountain herds", "No harvest in Wolverine, Chase and Takla herds",
                
                "BAU", "No harvest in Wolverine, Chase and Takla herds", "No harvest in Chilcotin critical habitat", "35% disturbance in Chilcotin matrix critical habitat", "No harvest in all southern mountain herds", 
                
                "BAU", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Chilcotin critical habitat", "35% disturbance in Chilcotin matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat", "No harvest in Hart Ranges critical habitat",  "35% disturbance in Hart Ranges matrix critical habitat", "No harvest in Wells Gray South/Groundhog critical habitat", "35% disturbance in Wells Gray South/Groundhog matrix critical habitat",
                
                "BAU", "No harvest in Chilcotin critical habitat", "35% disturbance in Chilcotin matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Central Selkirks critical habitat", "35% disturbance in Central Selkirks matrix critical habitat",
                
                "BAU", "No harvest in Wells Gray South/Groundhog critical habitat",  "35% disturbance in Hart Ranges matrix critical habitat",
                
                "BAU", "No harvest in Central Selkirks critical habitat", "35% disturbance in Central Selkirks matrix critical habitat", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Hart Ranges critical habitat", "35% disturbance in Hart Ranges matrix critical habitat",
                "BAU", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat",
                
                "BAU", "No harvest in all central group critical habitat", "35% disturbance in central group matrix critical habitat", "No harvest in Central group partnership agreement areas A2, B2, and B3, maximum 35% buffered disturbance (15% harvest) in Central group partnership agreement areas A1, B1, B4 and B5", "No harvest in all central group partnership agreement areas", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat",
                
                "BAU", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat", "No harvest in all critical habitat", "35% disturbance in all matrix critical habitat", 
                
                "BAU", "No harvest in Columbia North, Columbia South and Frisby-Boulder critical habitat", "35% disturbance in Columbia North, Columbia South and Frisby-Boulder matrix critical habitat"),
  adjacency = c (3, 3, 3, 3, 3,
                 3, 3, 3,
                 3, 3, 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3,
                 3, 3, 3,
                 3, 3, 3, 3, 3, 3, 3,
                 3, 3, 3,
                 3, 3, 3,
                 3, 3, 3, 3, 3, 3, 3,
                 3, 3, 3, 3, 3,
                 3, 3, 3),
  recovery = c (0, 40, 40, 40, 40,
                0, 40, 40, 
                0, 40, 40, 40, 40, 40, 40,
                0, 40, 40, 40, 40, 40, 40,
                0, 40, 40, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40, 40, 40, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40, 40, 40, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40,
                0, 40, 40,
                0, 40, 40, 40, 40, 40, 40,
                0, 40, 40,
                0, 40, 40,
                0, 40, 40, 40, 40, 40, 40,
                0, 40, 40, 40, 40,
                0, 40, 40),
  annual_volume = c (344356, 329267, 331990, 296705, 306363,
                     82463, 75452, 75451,
                     1409979, 721306, 841712, 1304409, 1293152, 704697, 827524,
                     382453, 362213, 368439, 344500, 357945, 251325, 308320,
                     1149967, 1122900, 1127105, 708923, 793637, 808049, 870651,
                     444956, 409556, 431200, 216099, 274717,
                     759935, 754456, 526749, 564774, 512700,
                     1691349, 1507184, 1563543, 1662831, 1657260, 1275005, 1563543, 680701, 1241252,
                     1219976, 1201526, 1028529, 1098646, 777114,
                     1139968, 1081700, 1083772, 958785, 981819,
                     1699982, 1461123, 1526577, 1279853, 1360364,
                     154964, 7664, 61869, 18, 55324,
                     194332, 193752, 193595, 108805, 155120, 189363, 190153, 185967, 191554,
                     1855974, 1569246, 1612217, 1287329, 1370006,
                     125951, 87504, 112333,
                     114969, 65855, 74131,
                     409960, 376833, 386679, 408588, 409958, 328317, 357688,
                     134972, 0, 0,
                     2129, 41, 39,
                     333816, 93500, 150468, 274222, 263835, 67776, 127813,
                     39562, 4779, 11011, 0, 10384,
                     30990, 2093, 7226),
  diff_annual_volume = c (0, -15089, -12366, -47651, -37993,
                          0, -7011, -7012,
                          0, -688673, -568267, -105570, -116827, -705282, -582455,
                          0, -20240, -14014, -37953, -24508, -131128, -74133,
                          0, -27067, -22862, -441044, -356330, -341918, -279316,
                          0, -35400, -13756, -228857, -170239,
                          0, -5479, -233186, -195161, -247235,
                          0, -184165, -127806, -28518, -34089, -416344, -127806, -1010648, -450097,
                          0, -18450, -191447, -121330, -442862,
                          0, -58268, -56196, -181183, -158149,
                          0, -238859, -173405, -420129, -339618,
                          0, -147300, -93095, -154946, -99640,
                          0, -580, -737, -85527, -39212, -4969, -4179, -8365, -2778,
                          0, -286728, -243757, -568645, -485968,
                          0, -38447, -13618,
                          0, -49114, -40838,
                          0, -33127, -23281, -1372, -2, -81643, -52272,
                          0, -134972, -134972,
                          0, -2088, -2090,
                          0, -240316, -183348, -59594, -69981, -266040, -206003,
                          0, -34783, -28551, -39562, -29178,
                          0, -28897, -23764),
  perc_diff_tot_volume = c ("0", "-4%", "-4%", "-14%", "-11%",
                            "0", "-9%", "-9%",
                            "0", "-49%", "-40%", "-7%", "-8%", "-50%","-41%",
                            "0", "-5%", "-4%", "-10%", "-6%", "-34%", "-19%",
                            "0", "-2%", "-2%", "-38%", "-31%", "-30%", "-24%",
                            "0", "-8%", "-3%", "-51%", "-38%",
                            "0", "-1%", "-31%", "-26%", "-33%",
                            "0", "-11%", "-8%", "-2%", "-2%", "-25%", "-8%", "-60%", "-27%",
                            "0", "-2%", "-16%", "-10%", "-36%",
                            "0", "-5%", "-5%", "-16%", "-14%",
                            "0", "-14%", "-10%", "-25%", "-20%",
                            "0", "-95%", "-60%", "-99%", "-65%",
                            "0", "<-1%", "<-1%", "-44%", "-20%", "-3%", "-2%", "-4%", "-1%",
                            "0", "-15%", "-13%", "-31%", "-26%",
                            "0", "-31%", "-11%",
                            "0", "-43%", "-36%",
                            "0", "-8%", "-6%", "<-1%", "<-1%", "-20%", "-13%",
                            "0", "-100%", "-100%",
                            "0", "-98%", "-98%",
                            "0", "-72%", "-55%", "-18%", "-21%", "-80%", "-62%",
                            "0", "-88%", "-72%", "-100%", "-74%",
                            "0", "-93%", "-77%"
                            )
)
kable (table.volume,
       caption = "<b>Table 1. Annual Harvested Volume Over a 200 Year Period in Timber Harvest Units Under Different  Caribou Recovery Scenarios.<b>",
       col.names = c("Harvest Unit",
                     "Scenario",
                     "Adjacency Height Requirement (m)",
                     "Habitat Recovery Time (Years)",
                     "Average Annual Volume (m3)",
                     "Difference in Annual Volume (m3)",
                     "Percent Difference in Annual Volume"),
       format.args = list (big.mark = ","),
       align = rep( c('l', 'c', 'c', 'c', 'c', 'c'))) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11) %>%
  footnote (general = "BAU = business-as-usual scenario",
            fixed_small_size = T)
```


## Summarize AAC impacts by Herd plannign area

### PArtnership agreement summayr
  - need osmehtign here about how much is harvested form PA areas under base case sceanrios
  
### Cariobu indicator sumamries???


