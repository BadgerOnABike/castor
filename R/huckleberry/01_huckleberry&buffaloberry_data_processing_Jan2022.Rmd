---
title: "Huckleberry_data_processing"
author: "Cora Skaien"
date: "29/07/2021"
output: html_document
---
<!--
Copyright 2021 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(raster)
library(data.table)
library(sf)
library(tidyverse)
library(rgeos)
library(cleangeo)
library(dplyr)
library(tidyr)
library(ggplot2)
library(rgdal)
library(sp)
library(keyring)
library(DBI)
library(rgeos)
library(car)
library(rje)
library(caret)
library(pROC)
library(visreg)


source(here::here("R/functions/R_Postgres.R"))
```

#Overview
In this file, we bring in each of our different datasets, append the necessary data from spatial files, and then combine the necessary datasets together to be able to perform analyses for huckleberry and buffaloberry. In these analyses, we explore how both climatic elements, as well as silviculture practices, influence plant P/A, percent cover and berry P/A and abundance.

Below is a the procedure used in QGIS for the first dataset, with similar approach taken for subsequent datasets.

We have a dataset provided by Clayton Lamb and Garth Mowat that contains information on numerous shrub species occurrence, cover, fruit phenology, sugar content, etc. Using the consolidated cutblock layer available online (https://catalogue.data.gov.bc.ca/dataset/harvested-areas-of-bc-consolidated-cutblocks-), I was able to use the intersect tool in QGIS to determine which of the plots in the provided data occurred in cutblocks. Here, we will bring in both layers, append the data together between the two files, and then subset the huckleberry (Vaccinium membranaceum) and buffalo berry (Shepherdia canadensis) to see how large our dataset is.

Bring in the shape file with the coordinates within cutblocks. This data was processed in QGIS, using the consolidated cutblock layer. This data also has the relevant "Openings data" and "Activity Treatment" appended to it. Note, that when selecting points by polygons within Openings and Activity Treatment data sets, often points were duplicated. To fix this issue, we used the "Delete Duplicate Geometries" function in QGIS. Because of limitations with the data, each time we intersect with more RESULTS layers, we lose data. As a result, it is important to consider which factors (and specificity) are most important for the analysis as 30-50% of the data is lost when we use the ACTIVITY TREATMENT data as opposed to just the OPENINGS data. 

This link will be very useful for determining what the codes mean:
https://www.for.gov.bc.ca/hfp/publications/00026/fs708-14-appendix_d.htm#ad_16

This may also prove useful:
https://www2.gov.bc.ca/gov/content/industry/forestry/managing-our-forest-resources/silviculture/silviculture-reporting-results/technical-documentation

We have multiple datasets to work with.

##Notes from Clayton
Keep in mind the hierarchy of the processes as your filter the data— For Occurrence>cover>fruit occurrence>fruit abundance. For example, there are lots of cover==0% because the species didn’t occur. I chose to model each processes independently and then multiply them together, but you could shortcut and try to just model berry abundance all together, see how goes.

VegModData_BEC_CL is occurrence and cover data from BEC, my plots across BC and some Proctor Huck data. This is a big dataset useful for modelling occurrence and cover only. Not fruit occurrence or productivity. You’ll see the BEC Code (for example VACCMEM= huck), and then “_cover” or “_occ” for % cover and occurrence, respectively.

Productivity_Data is occurrence, cover, fruit presence, and fruit abundance data.I think I assigned NA’s to abundance and other values when the species didn’t occur. Some records where the species and fruit occurs don’t have fruit abundance data becuase these data weren’t always collected. These rows are NA’s too.

Time since cut and Time since Fire are in there, and are calculated relative to when the plot was done. I fixed all non-cut block and non-fire areas as 118. Lots of other variables in there for you to play with.”

##Additional considerations for data and variables
1. Temp and Rainfall in t-1 and t-2 (years before) --> ClimateBC data
   - Spring temperature
   - July temperature
   - Spring rainfall
   - July rainfall
2. Solar radiation --> but does not work from ClimateBC; need to find elsewhere
3. PAS --> ClimateBC
4. Time since wildfire --> wildfire shape file
5. Whether site prep involved fire --> RESULTS OPENINGS data
6. Whether site prep involved scarification (mechanical) --> RESULTS OPENINGS data
7. Tree canopy
8. DEM: slope, elevation AND aspect all important (shift aspect to NE)


#Additional considerations for different types of analyses
Consider getting climatic variables at time t, t-1, t-2 (for berry production) and 10 year normal for cover and presence. Then append together with appropriate names for each set if variables at their timelines.

####################### BRING IN DATASETS ######################

#Dataset #1: Clayton Lamb and Garth Mowat data on huckleberry and Buffaloberry
This data has P/A of plants and of berries, and P/A of fruits and of berries. There is also a measure of sugar content (energetics) and other potentially useful and interesting response variables. This data has information for both huckleberry and buffalobery.
```{r}
cutblock_plots_openings<- st_read ( dsn = "D:\\Hucklberry\\Clayton_OPENINIGS_Plots2.shp", stringsAsFactors = T) #986 observations
str(cutblock_plots_openings)

head(cutblock_plots_openings)

st_crs(cutblock_plots_openings)
plot(cutblock_plots_openings)
table(cutblock_plots_openings$Site_ID) 
```

```{r}
## Elevation is missing from data! Need to get from DEM. Because some of the slope and aspect data differs, also append this data.

DEM_slope <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CLUS\\Data\\dem\\all_bc\\slope_ha_bc_3005.tif")
crs(DEM_slope) 

DEM_aspect <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CLUS\\Data\\dem\\all_bc\\aspect_ha_bc_3005.tif")
crs(DEM_aspect)

#Elevation
DEM_elevation <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CLUS\\Data\\dem\\all_bc\\dem_ha_bc.tif")
crs(DEM_elevation)
crs(cutblock_plots_openings) #Same!

#Stack rasters
rasStack = stack(DEM_slope, DEM_aspect, DEM_elevation)
crs(rasStack) #3005
head(rasStack)
str(rasStack)
extent(rasStack)

cutblock_plots_openings$coords_x1<-st_coordinates(cutblock_plots_openings)
head(cutblock_plots_openings)

pointCoordinates<-data.frame(cutblock_plots_openings$coords.x1, cutblock_plots_openings$coords.x2)
head(pointCoordinates)

DEM_huck1=raster::extract(rasStack, pointCoordinates)
head(DEM_huck1)

#Append
cutblock_plots_openings<-cbind(cutblock_plots_openings, DEM_huck1)
head(cutblock_plots_openings)
```

Get coordinates in decimal degrees for ClimateBC to get data at t-1 and t-2.

```{r}
crs(cutblock_plots_openings)

test<-st_transform(cutblock_plots_openings, crs="+proj=longlat  +datum=NAD83")
crs(test)
head(test)

test$coords_x1DD<-st_coordinates(test)
head(test)

pointCoordinatesDD<-data.frame(test$coords_x1DD[,1], test$coords_x1DD[,2])
head(pointCoordinatesDD)

head(test)
str(test)

cutblock_plots_openings<-test


```

This data already has Soils data (complements of Clayton Lamb), so no need to append that data (will in datasets below).

This data also already has canopy cover, time since wildfire and RESULTS OPENINGS data appended.

Now, remove spatial elements and turn into dataframe, where we can then bring in the ClimateBC data for years t-1 and t-2 to append.

```{r}
cutblock_plots_openings_Huck_ALL_df<-st_drop_geometry(cutblock_plots_openings)
cutblock_plots_openings_Huck_ALL_df<-st_drop_geometry(test)
head(cutblock_plots_openings_Huck_ALL_df)

write.csv(cutblock_plots_openings_Huck_ALL_df, file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\cutblock_plots_openings_Huck_ALL_df.csv")

```

Once the above has been run through ClimateBC for the year of the data, the year prior, and 2 years prior for annual and seasonal variables, we will bring these files back in, append them to each other, and then append to our dataset above. Note that the conditions in the year of collection should already be present, and these do not need to be brought in at this time for this dataset.

First, let's bring in the decadal normal values.

After using many combinations of Project, Site.ID, Species and longitude, we end up with duplicates despite each data set having the same number of rows. Thus, at the end, we must remove the duplicates.

```{r}
HuckBuff_Clayton_Normal<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_HuckBuff_Decade_2011_2020Y.csv")
head(HuckBuff_Clayton_Normal) #986 observations - this matches productivity data


#Try to round to ensure matching correctly
HuckBuff_Clayton_Normal$Long2<-round(HuckBuff_Clayton_Normal$Longitude, 4)
HuckBuff_Clayton_Normal$Long2

#HuckBuff_Clayton_Normal$ID2<-paste(HuckBuff_Clayton_Normal$Project, HuckBuff_Clayton_Normal$Species,HuckBuff_Clayton_Normal$Long2)
#HuckBuff_Clayton_Normal$ID2

cutblock_plots_openings_Huck_ALL_df$Long2<-round(cutblock_plots_openings_Huck_ALL_df$coords_x1DD[,1], 4)

cutblock_plots_openings_Huck_ALL_df$Long2
table(cutblock_plots_openings_Huck_ALL_df$Long2)

##ID
HuckBuff_Clayton_Normal$ID3<-paste(HuckBuff_Clayton_Normal$Site.ID, HuckBuff_Clayton_Normal$Species, HuckBuff_Clayton_Normal$Long2)
#HuckBuff_Clayton_Normal$ID3
table(HuckBuff_Clayton_Normal$ID3) #Still have more than 1 record per naming

cutblock_plots_openings_Huck_ALL_df$ID3<-paste(cutblock_plots_openings_Huck_ALL_df$Site.ID, cutblock_plots_openings_Huck_ALL_df$Species, cutblock_plots_openings_Huck_ALL_df$Long2)
#cutblock_plots_openings_Huck_ALL_df$ID3 
table(cutblock_plots_openings_Huck_ALL_df$ID3)

head(cutblock_plots_openings_Huck_ALL_df2)

cutblock_plots_openings_HuckBuff_ALL_df2<-left_join(cutblock_plots_openings_Huck_ALL_df, HuckBuff_Clayton_Normal, by="ID3")
head(cutblock_plots_openings_HuckBuff_ALL_df2)

duplicated(cutblock_plots_openings_HuckBuff_ALL_df2)

cutblock_plots_openings_HuckBuff_ALL_df2b<- cutblock_plots_openings_HuckBuff_ALL_df2 %>% distinct()

head(cutblock_plots_openings_HuckBuff_ALL_df2b) #986 data points, good

```

Compare with the values provided in dataset to ensure not identical (assuming Clayton's data had specific year climate data)

```{r}
plot(cutblock_plots_openings_Huck_ALL_df2$Tave_at, cutblock_plots_openings_Huck_ALL_df2$Tave_at_norm)
#Not a perfect 1:1 - excellent!
```

Now bring in the datasets for each year.

#2013
```{r}
#Huckleberry
huck_Clayton_2013_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2013_Year_2012SY.csv")
head(huck_Clayton_2013_1)

huck_Clayton_2013_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2013_Year_2011SY.csv")

huck_Clayton_2013<-cbind(huck_Clayton_2013_1, huck_Clayton_2013_2)
head(huck_Clayton_2013)
names(huck_Clayton_2013)
huck_Clayton_2013<-huck_Clayton_2013[-(91:95)]

#Buffaloberry
Buff_Clayton_2013_1<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2013_Year_2012SY.csv")
head(Buff_Clayton_2013_1)

Buff_Clayton_2013_2<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2013_Year_2011SY.csv")

Buff_Clayton_2013<-cbind(Buff_Clayton_2013_1, Buff_Clayton_2013_2)
head(Buff_Clayton_2013)
names(Buff_Clayton_2013)
Buff_Clayton_2013<-Buff_Clayton_2013[-(91:95)]

HuckBuff_Clayton_13<-rbind(huck_Clayton_2013, Buff_Clayton_2013)
head(HuckBuff_Clayton_13)
table(HuckBuff_Clayton_13$Species)
```

#2014
```{r}
#Huckleberry
huck_Clayton_2014_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2014_Year_2013SY.csv")
head(huck_Clayton_2014_1)

huck_Clayton_2014_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2014_Year_2012SY.csv")

huck_Clayton_2014<-cbind(huck_Clayton_2014_1, huck_Clayton_2014_2)
head(huck_Clayton_2014)
names(huck_Clayton_2014)
huck_Clayton_2014<-huck_Clayton_2014[-(91:95)]

#Buffaloberry
Buff_Clayton_2014_1<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2014_Year_2013SY.csv")
head(Buff_Clayton_2014_1)

Buff_Clayton_2014_2<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2014_Year_2012SY.csv")

Buff_Clayton_2014<-cbind(Buff_Clayton_2014_1, Buff_Clayton_2014_2)
head(Buff_Clayton_2014)
names(Buff_Clayton_2014)
Buff_Clayton_2014<-Buff_Clayton_2014[-(91:95)]

HuckBuff_Clayton_14<-rbind(huck_Clayton_2014, Buff_Clayton_2014)
head(HuckBuff_Clayton_14)
table(HuckBuff_Clayton_14$Species)
```

#2015
```{r}
#Huckleberry
huck_Clayton_2015_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2015_Year_2014SY.csv")
head(huck_Clayton_2015_1)

huck_Clayton_2015_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2015_Year_2013SY.csv")

huck_Clayton_2015<-cbind(huck_Clayton_2015_1, huck_Clayton_2015_2)
head(huck_Clayton_2015)
names(huck_Clayton_2015)
huck_Clayton_2015<-huck_Clayton_2015[-(91:95)]

#Buffaloberry
Buff_Clayton_2015_1<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2015_Year_2014SY.csv")
head(Buff_Clayton_2015_1)

Buff_Clayton_2015_2<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2015_Year_2013SY.csv")

Buff_Clayton_2015<-cbind(Buff_Clayton_2015_1, Buff_Clayton_2015_2)
head(Buff_Clayton_2015)
names(Buff_Clayton_2015)
Buff_Clayton_2015<-Buff_Clayton_2015[-(91:95)]

HuckBuff_Clayton_15<-rbind(huck_Clayton_2015, Buff_Clayton_2015)
head(HuckBuff_Clayton_15)
table(HuckBuff_Clayton_15$Species)
```

#2016
```{r}
#Huckleberry
huck_Clayton_2016_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2016_Year_2015SY.csv")
head(huck_Clayton_2016_1)

huck_Clayton_2016_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2016_Year_2014SY.csv")

huck_Clayton_2016<-cbind(huck_Clayton_2016_1, huck_Clayton_2016_2)
head(huck_Clayton_2016)
names(huck_Clayton_2016)
huck_Clayton_2016<-huck_Clayton_2016[-(91:95)]

#Buffaloberry
Buff_Clayton_2016_1<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2016_Year_2015SY.csv")
head(Buff_Clayton_2016_1)

Buff_Clayton_2016_2<-read.csv(file="D:\\hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Buff_2016_Year_2014SY.csv")

Buff_Clayton_2016<-cbind(Buff_Clayton_2016_1, Buff_Clayton_2016_2)
head(Buff_Clayton_2016)
names(Buff_Clayton_2016)
Buff_Clayton_2016<-Buff_Clayton_2016[-(91:95)]

HuckBuff_Clayton_16<-rbind(huck_Clayton_2016, Buff_Clayton_2016)
head(HuckBuff_Clayton_16)
table(HuckBuff_Clayton_16$Species)
```

#2017
```{r}
#Huckleberry
huck_Clayton_2017_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2017_Year_2016SY.csv")
head(huck_Clayton_2017_1)

huck_Clayton_2017_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2017_Year_2015SY.csv")

huck_Clayton_2017<-cbind(huck_Clayton_2017_1, huck_Clayton_2017_2)
head(huck_Clayton_2017)
names(huck_Clayton_2017)
huck_Clayton_2017<-huck_Clayton_2017[-(91:95)]
```

#2018
```{r}
#Huckleberry
huck_Clayton_2018_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2018_Year_2017SY.csv")
head(huck_Clayton_2018_1)

huck_Clayton_2018_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Clayton_Data_Coord_ClimateBC\\Clayton_OPENINGS_coords_Huck_2018_Year_2016SY.csv")

huck_Clayton_2018<-cbind(huck_Clayton_2018_1, huck_Clayton_2018_2)
head(huck_Clayton_2018)
names(huck_Clayton_2018)
huck_Clayton_2018<-huck_Clayton_2018[-(91:95)]
```

Combine the data sets together.

```{r}
HuckBuff_climate_data<-rbind(huck_Clayton_2018, huck_Clayton_2017, HuckBuff_Clayton_16, HuckBuff_Clayton_15, HuckBuff_Clayton_14, HuckBuff_Clayton_13)

head(HuckBuff_climate_data)
  
names(HuckBuff_climate_data)
  
HuckBuff_climate_data$Long2<-round(HuckBuff_climate_data$Longitude, 4)

#Create the same ID column as prior  
HuckBuff_climate_data$ID3<-paste(HuckBuff_climate_data$Site.ID, HuckBuff_climate_data$Species, HuckBuff_climate_data$Long2)
table(HuckBuff_climate_data$ID3)
head(HuckBuff_climate_data)

cutblock_plots_openings_HuckBuff_ALL_df3<-left_join(cutblock_plots_openings_HuckBuff_ALL_df2b, HuckBuff_climate_data, by="ID3")
head(cutblock_plots_openings_HuckBuff_ALL_df3)


cutblock_plots_openings_HuckBuff_ALL_df3b<- cutblock_plots_openings_HuckBuff_ALL_df3 %>% distinct() #Back to expected 986 data rows

head(cutblock_plots_openings_HuckBuff_ALL_df3b)
##Note that the climate in the year of data collection here does not have a"_0" afterwards, whereas subsequent data files do have "_0".

```

Add heatload as a form of solar radiation. Equation and methodology taken from here: https://www.davidzeleny.net/anadat-r/doku.php/en:customized_functions:heatload

```{r}
# Function "heatload"
# Calculates heat load or potential annual direct incident radiation, using the formulas published in 
# McCune & Keon (2002) based on aspect, slope and latitude.
 
heatload <- function (aspect, slope, latitude, method = 'heatload', units = 'degrees', equation = 1)
{
  if (units == 'degrees')   # convert degrees to radians
    {
    aspect <- aspect/180*pi
    slope <- slope/180*pi
    aspect[slope == 0] <- 0
    latitude <- latitude/180*pi
    }  
  A <- if (method == 'heatload') abs (pi - abs (aspect - (5*pi/4))) else pi - abs (aspect-pi)
  S <- slope
  L <- if (length (latitude) == 1) rep (latitude, length (A)) else latitude
  if (equation == 1) res <- exp (-1.467 +1.582*cos(L)*cos(S) -1.500*cos(A)*sin(S)*sin(L) -0.262*sin(L)*sin(S) +0.607*sin(A)*sin(S))
  if (equation == 2) res <- exp (-1.236 +1.350*cos(L)*cos(S) -1.376*cos(A)*sin(S)*sin(L) -0.331*sin(L)*sin(S) +0.375*sin(A)*sin(S))
  if (equation == 3) res <-      +0.339 +0.808*cos(L)*cos(S)                             -0.196*sin(L)*sin(S)                       - 0.482*cos(A)*sin(S)
  return (res)
}
```

```{r}
cutblock_plots_openings_HuckBuff_ALL_df3b$heatload <- heatload (aspect = cutblock_plots_openings_HuckBuff_ALL_df3b$aspect_ha_bc, slope = cutblock_plots_openings_HuckBuff_ALL_df3b$slope_ha_bc, latitude = cutblock_plots_openings_HuckBuff_ALL_df3b$Latitude.x, equation = 3)
 
cutblock_plots_openings_HuckBuff_ALL_df3b$heatload 
hist(cutblock_plots_openings_HuckBuff_ALL_df3b$heatload)

```


Save file with processed data. 
```{r}
write.csv(cutblock_plots_openings_HuckBuff_ALL_df3b, file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\cutblock_plots_openings_HuckBuff_ALL_df3b.csv")
```


#Dataset #2: Additional dataset from Laura Smit for Huckleberry 2011-2021. 
This data comes from repeated measure plots. As a result, for percent cover, we will only use one year's worth of data and compare to climate variables for the decade. For berry abundance, annual data will be used to compare to climate annually.

#Some Notes
1. Percent cover of plant and canopy cover was not present in every year, and estimates have been extrapolated for those.

Bring data in. 
```{r}
#Data for percent cover
Huck_Laura_Plant<-st_read ( dsn = "D:\\Hucklberry\\Laura_OPENINGS_PerCov.shp", stringsAsFactors = T)
head(Huck_Laura_Plant) #17 data points
crs(Huck_Laura_Plant) #Will need to convert to 3005, or 9001, to use rasters

#Data for abundance
Huck_Laura_Berries<-st_read ( dsn = "D:\\Hucklberry\\Laura_OPENINGS_All.shp", stringsAsFactors = T)
head(Huck_Laura_Berries) #42 datapoints
crs(Huck_Laura_Berries) #Will need to convert to 3005, or 9001, to use rasters
names(Huck_Laura_Berries)
```
Alter CRS so can append DEM data. Start with the plant data and then repeat for the berry data.

```{r}
Huck_Laura_Plant_3005<-st_transform(Huck_Laura_Plant, 3005)
crs(Huck_Laura_Plant_3005)

#Check crs of DEM stack
crs(rasStack)

Huck_Laura_Plant_3005$coords_x1<-st_coordinates(Huck_Laura_Plant_3005)
head(Huck_Laura_Plant_3005)

pointCoordinates_LauraPlant<-data.frame(Huck_Laura_Plant_3005$coords_x1[,1], Huck_Laura_Plant_3005$coords_x1[,2])
head(pointCoordinates_LauraPlant)

DEM_huck1_Laura=raster::extract(rasStack, pointCoordinates_LauraPlant)
head(DEM_huck1_Laura)

#Append
Huck_Laura_Plant_3005<-cbind(Huck_Laura_Plant_3005, DEM_huck1_Laura)
head(Huck_Laura_Plant_3005)

```

#Repeat for berries

```{r}
Huck_Laura_Berries_3005<-st_transform(Huck_Laura_Berries, 3005)
crs(Huck_Laura_Berries_3005)

#Check crs of DEM stack
crs(rasStack)

Huck_Laura_Berries_3005$coords_x1<-st_coordinates(Huck_Laura_Berries_3005)
head(Huck_Laura_Berries_3005)

pointCoordinates_LauraBerries<-data.frame(Huck_Laura_Berries_3005$coords_x1[,1], Huck_Laura_Berries_3005$coords_x1[,2])
head(pointCoordinates_LauraBerries)

DEM_huck1_Laura=raster::extract(rasStack, pointCoordinates_LauraBerries)
head(DEM_huck1_Laura)

#Append
Huck_Laura_Berries_3005<-cbind(Huck_Laura_Berries_3005, DEM_huck1_Laura)
head(Huck_Laura_Berries_3005)

```

Also need to append the soils data, layers provided by Clayton Lamb who did extensive processing to create these layers from:http://www.env.gov.bc.ca/esd/distdata/ecosystems/Soil_Data/SOIL_DATA_FGDB/

Note: The rasters provided by Clayton only cover the SE corner of BC and thus do not apply to all datapoints. 

#First for P/A data
```{r}
cofrag <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\cofrag_3005.tif")
orgcarb <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\orgcarb_3005.tif")
PH2 <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\ph2_3005.tif")
phca <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\phca_3005.tif")
tclay <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\tclay_3005.tif")
tsand <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\tsand_3005.tif")
tsilt <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\tsilt_3005.tif")
vfsand <- raster("D:\\Hucklberry\\Soil_Layers_Clayton\\vfsand_3005.tif")

#Check crs
crs(cofrag) #ESPG 3005
crs(vfsand) #3005

SoilStack<- stack(cofrag, orgcarb, PH2, phca, tclay, tsand, tsilt, vfsand)
crs(SoilStack) #ESPG 3005

#Extract values from SoilStack_2 for GPS coordinates in data file
SOIL_huck1_LauraPlant=raster::extract(SoilStack, pointCoordinates_LauraPlant)
head(SOIL_huck1_LauraPlant) #Looks good

#Combine back into original data set
Huck_Laura_Plant_3005<-cbind(Huck_Laura_Plant_3005, SOIL_huck1_LauraPlant)
head(Huck_Laura_Plant_3005)

```

Repeat for berry data.

```{r}
#Extract values from SoilStack_2 for GPS coordinates in data file
SOIL_huck1_LauraBerries=raster::extract(SoilStack, pointCoordinates_LauraBerries)
head(SOIL_huck1_LauraBerries) #Looks good

#Combine back into original data set
Huck_Laura_Berries_3005<-cbind(Huck_Laura_Berries_3005, SOIL_huck1_LauraBerries)
head(Huck_Laura_Berries_3005)
```

We also have data on plots that experienced wildfire, but need to append it. Will be easiest to append after make into dataframes. So append soils and DEM data bove prior to this step.

Make into data frame.
```{r}
Huck_Laura_Plant_df<-st_drop_geometry(Huck_Laura_Plant_3005)
str(Huck_Laura_Plant_df)
names(Huck_Laura_Plant_df)

Huck_Laura_Berries_df<-st_drop_geometry(Huck_Laura_Berries_3005)
str(Huck_Laura_Berries_df)
names(Huck_Laura_Berries_df)
```

```{r}
#Data for percent cover
Huck_Laura_Plant_burn<-st_read ( dsn = "D:\\Hucklberry\\Laura_OPENINGS_PA_FirePoints.shp", stringsAsFactors = T)

Huck_Laura_Plant_burn_df<-st_drop_geometry(Huck_Laura_Plant_burn)

#Data for abundance
Huck_Laura_Berries_burn<-st_read ( dsn = "D:\\Hucklberry\\Laura_OPENINGS_All_FirePoints.shp", stringsAsFactors = T)

Huck_Laura_Berries_burn_df<-st_drop_geometry(Huck_Laura_Berries_burn)
```

Create a time since fire category.
```{r}
Huck_Laura_Plant_burn_df$TimeSinceFire<-(Huck_Laura_Plant_burn_df$Year - Huck_Laura_Plant_burn_df$FIRE_YEAR)
head(Huck_Laura_Plant_burn_df)

Huck_Laura_Berries_burn_df$TimeSinceFire<-(Huck_Laura_Berries_burn_df$Year - Huck_Laura_Berries_burn_df$FIRE_YEAR)
head(Huck_Laura_Berries_burn_df)


```


Now combine files.
```{r}
Huck_Laura_Plant_df2<-full_join(Huck_Laura_Plant_df, Huck_Laura_Plant_burn_df)

head(Huck_Laura_Plant_df2)

Huck_Laura_Berries_df2<-full_join(Huck_Laura_Berries_df, Huck_Laura_Berries_burn_df)

head(Huck_Laura_Berries_df2)
Huck_Laura_Berries_df2$FIRE_DATE

```

Modify Time Since Fire so that NAs are maximum value in Clayton's data of 118.

```{r}
Huck_Laura_Plant_df2$TimeSinceFire[is.na(Huck_Laura_Plant_df2$TimeSinceFire)]<- 118
Huck_Laura_Plant_df2$TimeSinceFire

Huck_Laura_Berries_df2$TimeSinceFire[is.na(Huck_Laura_Berries_df2$TimeSinceFire)]<- 118
Huck_Laura_Berries_df2$TimeSinceFire
```

#Append ClimateBC Data
In the below data being brought in, ALL data points from the file are included. However, not all were present within cutblocks, and thus, there will be more data points below than there is in the data brought in above.

#First, we will get the data for the percetn cover, which involves the decadal means
```{r}
huck_Laura_plantcover_climate<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_forPerCov_coords_Decade_2011_2020SY.csv")
head(huck_Laura_plantcover_climate)
```

Append to data.
```{r}
huck_Laura_plantcover_climate$ID1<-paste(huck_Laura_plantcover_climate$Site_ID, huck_Laura_plantcover_climate$Year)

Huck_Laura_Plant_df2$ID1<-paste(Huck_Laura_Plant_df2$Site_ID, Huck_Laura_Plant_df2$Year)

cutblock_plots_openings_Laura_Huck_Plant<-left_join(Huck_Laura_Plant_df2, huck_Laura_plantcover_climate, by="ID1")
head(cutblock_plots_openings_Laura_Huck_Plant)

```


#This series will be for each year annually for the berry abundance data
2011
```{r}
huck_Laura_2011_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2011_Year_2011SY.csv")
head(huck_Laura_2011_0)

huck_Laura_2011_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2011_Year_2010SY.csv")
head(huck_Laura_2011_1)

huck_Laura_2011_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2011_Year_2009SY.csv")
head(huck_Laura_2011_2)

huck_Laura_2011<-cbind(huck_Laura_2011_0, huck_Laura_2011_1, huck_Laura_2011_2)
head(huck_Laura_2011)
names(huck_Laura_2011)
huck_Laura_2011<-huck_Laura_2011[-(181:185)]
huck_Laura_2011<-huck_Laura_2011[-(91:95)]
huck_Laura_2011<-huck_Laura_2011[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2011$Year<-c(2011)
head(huck_Laura_2011)
```

2012
```{r}
huck_Laura_2012_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2012_Year_2012SY.csv")
head(huck_Laura_2012_0)

huck_Laura_2012_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2012_Year_2011SY.csv")
head(huck_Laura_2012_1)

huck_Laura_2012_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2012_Year_2010SY.csv")
head(huck_Laura_2012_2)

huck_Laura_2012<-cbind(huck_Laura_2012_0, huck_Laura_2012_1, huck_Laura_2012_2)
head(huck_Laura_2012)
names(huck_Laura_2012)
huck_Laura_2012<-huck_Laura_2012[-(181:185)]
huck_Laura_2012<-huck_Laura_2012[-(91:95)]
huck_Laura_2012<-huck_Laura_2012[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2012$Year<-c(2012)
head(huck_Laura_2012)
```

2013
```{r}
huck_Laura_2013_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2013_Year_2013SY.csv")
head(huck_Laura_2013_0)

huck_Laura_2013_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2013_Year_2012SY.csv")
head(huck_Laura_2013_1)

huck_Laura_2013_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2013_Year_2011SY.csv")
head(huck_Laura_2013_2)

huck_Laura_2013<-cbind(huck_Laura_2013_0, huck_Laura_2013_1, huck_Laura_2013_2)
head(huck_Laura_2013)
names(huck_Laura_2013)
huck_Laura_2013<-huck_Laura_2013[-(181:185)]
huck_Laura_2013<-huck_Laura_2013[-(91:95)]
huck_Laura_2013<-huck_Laura_2013[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2013$Year<-c(2013)
head(huck_Laura_2013)
```

2014
```{r}
huck_Laura_2014_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2014_Year_2014SY.csv")
head(huck_Laura_2014_0)

huck_Laura_2014_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2014_Year_2013SY.csv")
head(huck_Laura_2014_1)

huck_Laura_2014_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2014_Year_2012SY.csv")
head(huck_Laura_2014_2)

huck_Laura_2014<-cbind(huck_Laura_2014_0, huck_Laura_2014_1, huck_Laura_2014_2)
head(huck_Laura_2014)
names(huck_Laura_2014)
huck_Laura_2014<-huck_Laura_2014[-(181:185)]
huck_Laura_2014<-huck_Laura_2014[-(91:95)]
huck_Laura_2014<-huck_Laura_2014[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2014$Year<-c(2014)
head(huck_Laura_2014)
```

2015
```{r}
huck_Laura_2015_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2015_Year_2015SY.csv")
head(huck_Laura_2015_0)

huck_Laura_2015_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2015_Year_2014SY.csv")
head(huck_Laura_2015_1)

huck_Laura_2015_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2015_Year_2013SY.csv")
head(huck_Laura_2015_2)

huck_Laura_2015<-cbind(huck_Laura_2015_0, huck_Laura_2015_1, huck_Laura_2015_2)
head(huck_Laura_2015)
names(huck_Laura_2015)
huck_Laura_2015<-huck_Laura_2015[-(181:185)]
huck_Laura_2015<-huck_Laura_2015[-(91:95)]
huck_Laura_2015<-huck_Laura_2015[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2015$Year<-c(2015)
head(huck_Laura_2015)
```

2016
```{r}
huck_Laura_2016_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2016_Year_2016SY.csv")
head(huck_Laura_2016_0)

huck_Laura_2016_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2016_Year_2015SY.csv")
head(huck_Laura_2016_1)

huck_Laura_2016_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2016_Year_2014SY.csv")
head(huck_Laura_2016_2)

huck_Laura_2016<-cbind(huck_Laura_2016_0, huck_Laura_2016_1, huck_Laura_2016_2)
head(huck_Laura_2016)
names(huck_Laura_2016)
huck_Laura_2016<-huck_Laura_2016[-(181:185)]
huck_Laura_2016<-huck_Laura_2016[-(91:95)]
huck_Laura_2016<-huck_Laura_2016[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2016$Year<-c(2016)
head(huck_Laura_2016)
```

2017
```{r}
huck_Laura_2017_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2017_Year_2017SY.csv")
head(huck_Laura_2017_0)

huck_Laura_2017_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2017_Year_2016SY.csv")
head(huck_Laura_2017_1)

huck_Laura_2017_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2017_Year_2015SY.csv")
head(huck_Laura_2017_2)

huck_Laura_2017<-cbind(huck_Laura_2017_0, huck_Laura_2017_1, huck_Laura_2017_2)
head(huck_Laura_2017)
names(huck_Laura_2017)
huck_Laura_2017<-huck_Laura_2017[-(181:185)]
huck_Laura_2017<-huck_Laura_2017[-(91:95)]
huck_Laura_2017<-huck_Laura_2017[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2017$Year<-c(2017)
head(huck_Laura_2017)
```

2018
```{r}
huck_Laura_2018_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2018_Year_2018SY.csv")
head(huck_Laura_2018_0)

huck_Laura_2018_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2018_Year_2017SY.csv")
head(huck_Laura_2018_1)

huck_Laura_2018_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2018_Year_2016SY.csv")
head(huck_Laura_2018_2)

huck_Laura_2018<-cbind(huck_Laura_2018_0, huck_Laura_2018_1, huck_Laura_2018_2)
head(huck_Laura_2018)
names(huck_Laura_2018)
huck_Laura_2018<-huck_Laura_2018[-(181:185)]
huck_Laura_2018<-huck_Laura_2018[-(91:95)]
huck_Laura_2018<-huck_Laura_2018[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2018$Year<-c(2018)
head(huck_Laura_2018)
```

2019
```{r}
huck_Laura_2019_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2019_Year_2019SY.csv")
head(huck_Laura_2019_0)

huck_Laura_2019_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2019_Year_2018SY.csv")
head(huck_Laura_2019_1)

huck_Laura_2019_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2019_Year_2017SY.csv")
head(huck_Laura_2019_2)

huck_Laura_2019<-cbind(huck_Laura_2019_0, huck_Laura_2019_1, huck_Laura_2019_2)
head(huck_Laura_2019)
names(huck_Laura_2019)
huck_Laura_2019<-huck_Laura_2019[-(181:185)]
huck_Laura_2019<-huck_Laura_2019[-(91:95)]
huck_Laura_2019<-huck_Laura_2019[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2019$Year<-c(2019)
head(huck_Laura_2019)
```

2020
```{r}
huck_Laura_2020_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2020_Year_2020SY.csv")
head(huck_Laura_2020_0)

huck_Laura_2020_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2020_Year_2019SY.csv")
head(huck_Laura_2020_1)

huck_Laura_2020_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2020_Year_2018SY.csv")
head(huck_Laura_2020_2)

huck_Laura_2020<-cbind(huck_Laura_2020_0, huck_Laura_2020_1, huck_Laura_2020_2)
head(huck_Laura_2020)
names(huck_Laura_2020)
huck_Laura_2020<-huck_Laura_2020[-(181:185)]
huck_Laura_2020<-huck_Laura_2020[-(91:95)]
huck_Laura_2020<-huck_Laura_2020[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2020$Year<-c(2020)
head(huck_Laura_2020)
```

2021
#2021 is complicated in that ClimateBC does not yet have annual data for 2021, so the best we can do is either the decadal average, or repeating 2020. We may also wish to try and get some of the similar variables from another source, like Environment Canada? 
I tried searching Environment Canada by GPS coordinates and turned up nothing (i.e., no nearby weather stations).

```{r}
table(Huck_Laura_Berries_df2$Year) #We have 12 data points in 2021
```


```{r}
#There is no 2021 data at this time. Need to decide what to use in its place.
#huck_Laura_2021_0<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2021_Year_2021SY.csv")
#head(huck_Laura_2021_0)

huck_Laura_2021_1<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2021_Year_2020SY.csv")
head(huck_Laura_2021_1)

huck_Laura_2021_2<-read.csv(file="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Laura_data_ClimateBC\\Laura_Data_Long_2021_Year_2019SY.csv")
head(huck_Laura_2021_2)

#huck_Laura_2021<-cbind(huck_Laura_2021_0, huck_Laura_2021_1, huck_Laura_2021_2)
huck_Laura_2021<-cbind(huck_Laura_2021_1, huck_Laura_2021_2)
head(huck_Laura_2021)
names(huck_Laura_2021)
#huck_Laura_2021<-huck_Laura_2021[-(181:185)]
huck_Laura_2021<-huck_Laura_2021[-(91:95)]
huck_Laura_2021<-huck_Laura_2021[-5] #Remove elevation since unknown here

#Add the Year back in for appending later
huck_Laura_2021$Year<-c(2021)
head(huck_Laura_2021)
```

Combine the data sets together. Note: within cutblocks, we only end up with data from 2019-2021, but the data from the 2011-2021 plots inclusive are now available.

For now, make same columns.
```{r}
names(huck_Laura_2021)
names(huck_Laura_2020)
```


```{r}
#Huck_Laura_climate_data<-rbind(huck_Laura_2021, huck_Laura_2020, huck_Laura_2019, huck_Laura_2018, huck_Laura_2017, huck_Laura_2016, huck_Laura_2015, huck_Laura_2014, huck_Laura_2013, huck_Laura_2012, huck_Laura_2011)

Huck_Laura_climate_data<-rbind(huck_Laura_2020, huck_Laura_2019, huck_Laura_2018, huck_Laura_2017, huck_Laura_2016, huck_Laura_2015, huck_Laura_2014, huck_Laura_2013, huck_Laura_2012, huck_Laura_2011) #2021 excluded for now until find solution

head(Huck_Laura_climate_data)
names(Huck_Laura_climate_data)

Huck_Laura_climate_data$ID1<-paste(Huck_Laura_climate_data$Site_ID, Huck_Laura_climate_data$Year) #312 observations

#Below may need updating once file brought in to proper names
Huck_Laura_Berries_df2$ID1<-paste(Huck_Laura_Berries_df2$Site_ID, Huck_Laura_Berries_df2$Year) #42 observations
  
cutblock_plots_openings_Laura_Huck_Berries<-left_join(Huck_Laura_Berries_df2, Huck_Laura_climate_data, by="ID1")
head(cutblock_plots_openings_Laura_Huck) #192 observations


cutblock_plots_openings_Laura_Huck_Berries<- cutblock_plots_openings_Laura_Huck_Berries %>% distinct() #42 observations

head(cutblock_plots_openings_Laura_Huck_Berries)

```

Add heatload.
#Likely need to update latitude call in below

```{r}
#Plant Data
cutblock_plots_openings_Laura_Huck_Plant$heatload <- heatload (aspect = cutblock_plots_openings_Laura_Huck_Plant$aspect_ha_bc, slope = cutblock_plots_openings_Laura_Huck_Plant$slope_ha_bc, latitude = cutblock_plots_openings_Laura_Huck_Plant$Latitude, equation = 3)
 
cutblock_plots_openings_Laura_Huck_Plant$heatload 
hist(cutblock_plots_openings_Laura_Huck_Plant$heatload)

#Berry Data
cutblock_plots_openings_Laura_Huck_Berries$heatload <- heatload (aspect = cutblock_plots_openings_Laura_Huck_Berries$aspect_ha_bc, slope = cutblock_plots_openings_Laura_Huck_Berries$slope_ha_bc, latitude = cutblock_plots_openings_Laura_Huck_Berries$Latitude, equation = 3)
 
cutblock_plots_openings_Laura_Huck_Berries$heatload 
hist(cutblock_plots_openings_Laura_Huck_Berries$heatload)
```

Save files.
```{r}
write.csv(cutblock_plots_openings_Laura_Huck_Plant, file = "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\cutblock_plots_openings_Laura_Huck_Plant.csv")

write.csv(cutblock_plots_openings_Laura_Huck_Berries, file = "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\cutblock_plots_openings_Laura_Huck_Berries.csv")
```




#Datasets #3: Garth Mowat and new student's (Mackenzie) data on huckleberry and buffalo berry separately.
This dataset should have the same features as the above overall, but column names differ and will need to be re-named for binding datasets together.

#Some notes
1. Some 0s in some columns are not true 0s, but rather NAs. See original excel document with comments for details.
2. Check in with Clayton about the shep_kcal field (from a map?)
3. Time Since Cut and Time Since Fire in provided document do not match up with intersection results from spatial layers from the BC government

```{r}
cutblock_plots_openings_mowatBuff<- st_read ( dsn = "D:\\Hucklberry\\Mackenzie_Points_Buff_OPENINGS.shp", stringsAsFactors = T)

head(cutblock_plots_openings_mowatBuff)
names(cutblock_plots_openings_mowatBuff)

cutblock_plots_openings_mowatBuff<-cutblock_plots_openings_mowatBuff[-(68:78)]

cutblock_plots_openings_mowatBuff$Species<-c("Shepherdia_canadensis")
```

We could consider subsetting my whether file indicates clearcut or not, but this info does not line up with our data.
```{r}
cutblock_plots_openings_mowatBuff2<-subset(cutblock_plots_openings_mowatBuff, cutblock_plots_openings_mowatBuff$Clear_Cut=="Yes")
head(cutblock_plots_openings_mowatBuff2) #79 datapoints within cutblocks
```

#Append DEM

```{r}
crs(cutblock_plots_openings_mowatBuff)
#Set crs
cutblock_plots_openings_mowatBuff2 <- st_transform (cutblock_plots_openings_mowatBuff, 3005)
crs(cutblock_plots_openings_mowatBuff2)

#Extract GPS locations
names(cutblock_plots_openings_mowatBuff2)

##Try this first
test<-cbind(cutblock_plots_openings_mowatBuff2, st_coordinates(cutblock_plots_openings_mowatBuff2))
head(test)

pointCoordinates_Mowat<-data.frame(test$X, test$Y)
head(pointCoordinates_Mowat)


##Extract DEM values from stacked layer. Note: This DEM stack was created prior
rasValue2=raster::extract(rasStack, pointCoordinates_Mowat)
head(rasValue2) #
str(rasValue2) #68 values
str(cutblock_plots_openings_mowatBuff2)#68 values

#Append new information
cutblock_plots_openings_mowatBuff<-cbind(cutblock_plots_openings_mowatBuff2, rasValue2)
head(cutblock_plots_openings_mowatBuff)
crs(cutblock_plots_openings_mowatBuff)
```

Also need to append the soils data, layers provided by Clayton Lamb who did extensive processing to create these layers from:http://www.env.gov.bc.ca/esd/distdata/ecosystems/Soil_Data/SOIL_DATA_FGDB/

Note: The rasters provided by Clayton only cover the SE corner of BC and thus do not apply to all datapoints. For subsequent data analyses, if including soil properties, we will lose the data with NAs in the analyses.

```{r}
crs(SoilStack) #ESPG 3005

#Extract values from SoilStack_2 for GPS coordinates in data file
SOIL_huck_Mac=raster::extract(SoilStack, pointCoordinates_Mowat)
head(SOIL_huck_Mac)
SOIL_huck_Mac #Lots of NAs for the ones outside of the raster

#Combine back into original data set
cutblock_plots_openings_mowatBuff<-cbind(cutblock_plots_openings_mowatBuff, SOIL_huck_Mac)
head(cutblock_plots_openings_mowatBuff)

```

Append climate data.
```{r}
Mowat_Buff_Climate2020<-read.csv(file= "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\2020_ClusterPlots_AllDataJoined_CLEAN_Laura_Mackenzie_Year_2020SY.csv")
head(Mowat_Buff_Climate2020)

Mowat_Buff_Climate2019<-read.csv(file= "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\2020_ClusterPlots_AllDataJoined_CLEAN_Laura_Mackenzie_Year_2019SY.csv")

Mowat_Buff_Climate2018<-read.csv(file= "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\2020_ClusterPlots_AllDataJoined_CLEAN_Laura_Mackenzie_Year_2018SY.csv")

Mowat_Buff_Climate<-cbind(Mowat_Buff_Climate2020, Mowat_Buff_Climate2019, Mowat_Buff_Climate2018)

names(Mowat_Buff_Climate)

#Remove repeated columns
Mowat_Buff_Climate<-Mowat_Buff_Climate[-(181:185)]
Mowat_Buff_Climate<-Mowat_Buff_Climate[-(91:95)]

#174 variables
```

```{r}
cutblock_plots_openings_mowatBuff$ID2<-paste(cutblock_plots_openings_mowatBuff$Study_Area, cutblock_plots_openings_mowatBuff$LONGITUDE)
table(cutblock_plots_openings_mowatBuff$ID2)

Mowat_Buff_Climate$ID2<-paste(Mowat_Buff_Climate$Study_Area, Mowat_Buff_Climate$Longitude)
table(Mowat_Buff_Climate$ID2)

cutblock_plots_openings_mowatBuff2<-left_join(cutblock_plots_openings_mowatBuff, Mowat_Buff_Climate, by="ID2")

str(cutblock_plots_openings_mowatBuff2)
head(cutblock_plots_openings_mowatBuff2)
```

Bring in the fire data. Note that the fire data in the provided data does not match the provincial layers. We may wish to replace the fire year, and investigate.
```{r}
cutblock_plots_openings_mowatBuff_FIRE<- st_read ( dsn = "D:\\Hucklberry\\Mackenzie_Points_Buff_OPENINGS_Fire.shp", stringsAsFactors = T)
head(cutblock_plots_openings_mowatBuff_FIRE)


#make as dataframes
cutblock_plots_openings_mowatBuff_df<-st_drop_geometry(cutblock_plots_openings_mowatBuff2)
str(cutblock_plots_openings_mowatBuff_df) #68 observations

cutblock_plots_openings_mowatBuff_FIRE_df<-st_drop_geometry(cutblock_plots_openings_mowatBuff_FIRE)
str(cutblock_plots_openings_mowatBuff_FIRE_df) #29 observations
head(cutblock_plots_openings_mowatBuff_FIRE_df) #I think that some had more than one fire; so find out which ones duplicated, and then keep more recent fire date
cutblock_plots_openings_mowatBuff_FIRE_df$ID1<-paste(cutblock_plots_openings_mowatBuff_FIRE_df$Drainage, cutblock_plots_openings_mowatBuff_FIRE_df$LONGITUDE)
table(cutblock_plots_openings_mowatBuff_FIRE_df$ID1)
#Duplicates: 
# Tyax_Road -122.749799
# Commerce -114.485356 
# Border_FSR -114.531562 -- 4 of this one!
# Flathead_River -114.492559 

table(cutblock_plots_openings_mowatBuff_FIRE_df$ID1, cutblock_plots_openings_mowatBuff_FIRE_df$FIRE_YEAR)
# Tyax_Road -122.749799 -- both 2009
# Commerce -114.485356  -- one 1929, one 1936
# Border_FSR -114.531562 -- two 1929, one 1919, one 1934
# Flathead_River -114.492559  -- 1936 and 1945

head(cutblock_plots_openings_mowatBuff_FIRE_df)
cutblock_plots_openings_mowatBuff_FIRE_df[21,]
cutblock_plots_openings_mowatBuff_FIRE_df[22,]

#Flathead_River -114.492559
cutblock_plots_openings_mowatBuff_FIRE_df<-cutblock_plots_openings_mowatBuff_FIRE_df[-c(21),]

# Commerce -114.485356
cutblock_plots_openings_mowatBuff_FIRE_df<-cutblock_plots_openings_mowatBuff_FIRE_df[-c(10),]

#Border_FSR - all 4 are in a row, with the first one being most recent fire
cutblock_plots_openings_mowatBuff_FIRE_df<-cutblock_plots_openings_mowatBuff_FIRE_df[-c(8),]
cutblock_plots_openings_mowatBuff_FIRE_df<-cutblock_plots_openings_mowatBuff_FIRE_df[-c(7),]
cutblock_plots_openings_mowatBuff_FIRE_df<-cutblock_plots_openings_mowatBuff_FIRE_df[-c(6),]

#Tyax_Road -122.749799 -- both 2009 - appear identical, remove one
cutblock_plots_openings_mowatBuff_FIRE_df<-cutblock_plots_openings_mowatBuff_FIRE_df[-c(4),]

cutblock_plots_openings_mowatBuff_FIRE_df<-data.frame(cutblock_plots_openings_mowatBuff_FIRE_df)
head(cutblock_plots_openings_mowatBuff_FIRE_df)

#Check
table(cutblock_plots_openings_mowatBuff_FIRE_df$ID1, cutblock_plots_openings_mowatBuff_FIRE_df$FIRE_YEAR)

#When joining, we should get 68 observations
cutblock_plots_openings_mowatBuff3<-full_join(cutblock_plots_openings_mowatBuff_df, cutblock_plots_openings_mowatBuff_FIRE_df) #68 observations


```

Determine time since fire and clearcuts.

```{r}
cutblock_plots_openings_mowatBuff3$TimeSinceFire<-(cutblock_plots_openings_mowatBuff3$Year-cutblock_plots_openings_mowatBuff3$FIRE_YEAR)
cutblock_plots_openings_mowatBuff3$TimeSinceFire #Change NAs to a really long time, the max value; in Clayton's data. this is 118

cutblock_plots_openings_mowatBuff3$TimeSinceFire[is.na(cutblock_plots_openings_mowatBuff3$TimeSinceFire)]<-118


#Create cutblock year
library(stringi)
cutblock_plots_openings_mowatBuff3$Cutblock_Year<-stri_sub(cutblock_plots_openings_mowatBuff3$APP_DT,1,4)
cutblock_plots_openings_mowatBuff3$Cutblock_Year
str(cutblock_plots_openings_mowatBuff3$Cutblock_Year)
cutblock_plots_openings_mowatBuff3$Cutblock_Year<-as.numeric(cutblock_plots_openings_mowatBuff3$Cutblock_Year)

cutblock_plots_openings_mowatBuff3$TimeSinceCutblock<-(cutblock_plots_openings_mowatBuff3$Year-cutblock_plots_openings_mowatBuff3$Cutblock_Year)
cutblock_plots_openings_mowatBuff3$TimeSinceCutblock

```

Add heatload.
```{r}
cutblock_plots_openings_mowatBuff3$heatload <- heatload (aspect = cutblock_plots_openings_mowatBuff3$aspect_ha_bc_3005, slope = cutblock_plots_openings_mowatBuff3$slope_ha_bc_3005, latitude = cutblock_plots_openings_mowatBuff3$Latitude, equation = 3)
 
cutblock_plots_openings_mowatBuff3$heatload 
hist(cutblock_plots_openings_mowatBuff3$heatload)
```

Save new file.
```{r}
write.csv(cutblock_plots_openings_mowatBuff2, file = "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\MowatMac_Buff_Openings_DEM_Soil_Climate.csv")
```



#Datasets #4: BEC Plots
This dataset has presence only values for each huckleberry and buffalo berry, and only presents the percent cover of the plant itself (not berries). This can be used best for percent cover models, but because does not have absence values, may be best only to use for percent cover.

Currently, we only have the huckleberry data, but can acquire the buffaloberry data as well if we find it useful. Subsequent investigation does show that the percent cover is considerably less for these BEC plots than in the Clayton and Lamb data, and thus may not be comparable.

```{r}

cutblock_plots_openings_BECHuck<- st_read ( dsn = "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\BEC_huck_Openings_duplicates_removed.shp", stringsAsFactors = T)
head(cutblock_plots_openings_BECHuck)

cutblock_plots_openings_activity_BECHuck<- st_read ( dsn = "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\BEC_huck_Openings_Activity_duplicates_removed.shp", stringsAsFactors = T)

```

##Remove Geometry for Processing Moving Forwards
For processing below, we do not need these files to be spatial files. Turn them into dataframes and this will help speed up processing.

```{r}


cutblock_plots_openings_Huck_ALL_df<-st_drop_geometry(cutblock_plots_openings)


cutblock_plots_openings_mowatBuff_df<-st_drop_geometry(cutblock_plots_openings_mowatBuff)


cutblock_plots_openings_BECHuck_df<-st_drop_geometry(cutblock_plots_openings_BECHuck)


```

Save BEC data so can extract coordinates and append ClimateBC Data.

```{r}
names(cutblock_plots_openings_BECHuck_df)

cutblock_plots_openings_BECHuck_df<-rename(cutblock_plots_openings_BECHuck_df,
                   c("Aspect_reported"="Aspect",
                     "Elevation_reported"="Elevation"))

st_write(cutblock_plots_openings_BECHuck_df, dsn= "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\BEC_cutblock_plots_openings_BECHuck_df.csv")

```

#Bring back in and append

```{r}
BEC_ClimateBC_Data<-read.csv(file= "D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\BEC_latlong_forCLIMATEBC_Normal_1991_2020SY.csv")
head(BEC_ClimateBC_Data)


#Rename ID1 and ID2
head(cutblock_plots_openings_BECHuck_df)
names(cutblock_plots_openings_BECHuck_df)
BEC_ClimateBC_Data<-rename(BEC_ClimateBC_Data,
                   c("ProjectID"="ID1",
                     "PlotNumber"="ID2"))
head(BEC_ClimateBC_Data)

cutblock_plots_openings_BECHuck_df_<-merge(cutblock_plots_openings_BECHuck_df, BEC_ClimateBC_Data, by=c("ProjectID", "PlotNumber"))
head(cutblock_plots_openings_BECHuck_df_)
```



################# Now that we have the data in, combine files as appropriate #################

#Combine appropriate files

```{r}
head(cutblock_plots_openings_Huck_ALL_df)
table(cutblock_plots_openings_Huck_ALL_df$Species.y) #202 buffaloberry; 628 huckleberry
head(cutblock_plots_openings_mowatBuff_df) #Only Buffaloberry
head(cutblock_plots_openings_BECHuck_df) #only huckleberry

#Separate by species
cutblock_plots_openings_Huck_ALL_df_Buff<-subset(cutblock_plots_openings_Huck_ALL_df, cutblock_plots_openings_Huck_ALL_df$Species.y=="Shepherdia_canadensis")
cutblock_plots_openings_Huck_ALL_df_Huck<-subset(cutblock_plots_openings_Huck_ALL_df, cutblock_plots_openings_Huck_ALL_df$Species.y=="Vaccinium_membranaceum")

#Because sample size increased, see if in cutblocks
table(cutblock_plots_openings_Huck_ALL_df_Buff$CutBlock_Occurrence)#Suggests 16 not
table(cutblock_plots_openings_Huck_ALL_df_Huck$CutBlock_Occurrence) #Suggests 27 not

cutblock_plots_openings_Huck_ALL_df_Buff<-subset(cutblock_plots_openings_Huck_ALL_df_Buff, cutblock_plots_openings_Huck_ALL_df_Buff$CutBlock_Occurrence=="1")

cutblock_plots_openings_Huck_ALL_df_Huck<-subset(cutblock_plots_openings_Huck_ALL_df_Huck, cutblock_plots_openings_Huck_ALL_df_Huck$CutBlock_Occurrence=="1")
```

```{r}
#Ensure names consistent between files to be combined
## 1. cutblock_plots_openings_Huck_ALL_df_Huck, cutblock_plots_openings_BECHuck_df
names(cutblock_plots_openings_Huck_ALL_df_Huck) # Key names: Species.Cover, HARVEST_YE == CutBlock_Year
names(cutblock_plots_openings_BECHuck_df) #key names: TotalB, HARVESTYR 
#Many other variables may qish to acquire for BEC data, like fire year, 
##Note, all climate variables NAs... need to run through climateBC and get


#Update names in cutblock_plots_openings_BECHuck_df
cutblock_plots_openings_BECHuck_df<-rename(cutblock_plots_openings_BECHuck_df,
                   c("Species.Cover"="TotalB",
                     "HARVEST_YE"="HARVESTYR"))

cutblock_plots_openings_BECHuck_df$Species.Present<-1
table(cutblock_plots_openings_BECHuck_df$Species.Present)

#Combine
# fill in non-overlapping columns with NAs
cutblock_plots_openings_Huck_ALL_df_Huck[setdiff(names(cutblock_plots_openings_BECHuck_df), names(cutblock_plots_openings_Huck_ALL_df_Huck))] <- NA
cutblock_plots_openings_BECHuck_df[setdiff(names(cutblock_plots_openings_Huck_ALL_df_Huck), names(cutblock_plots_openings_BECHuck_df))] <- NA

cutblock_plots_openings_Huck_ALL_df<-rbind(cutblock_plots_openings_Huck_ALL_df_Huck, cutblock_plots_openings_BECHuck_df)

head(cutblock_plots_openings_Huck_ALL_df) #May need to alter additional columns to be synonymous - will find out during data processing

table(cutblock_plots_openings_Huck_ALL_df$Species.y)
table(cutblock_plots_openings_Huck_ALL_df_Huck$Species.y)
table(cutblock_plots_openings_BECHuck_df$Species) #1686
table(cutblock_plots_openings_Huck_ALL_df$Species)
head(cutblock_plots_openings_BECHuck_df)
```

Save file.

```{r}
names(cutblock_plots_openings_Huck_ALL_df)
cutblock_plots_openings_Huck_ALL_df[182]
cutblock_plots_openings_Huck_ALL_df$Elevation_1<-cutblock_plots_openings_Huck_ALL_df$Elevation

cutblock_plots_openings_Huck_ALL_df<-cutblock_plots_openings_Huck_ALL_df[-182]

cutblock_plots_openings_Huck_ALL_df[183]
cutblock_plots_openings_Huck_ALL_df$Aspect_1<-cutblock_plots_openings_Huck_ALL_df$Aspect

cutblock_plots_openings_Huck_ALL_df<-cutblock_plots_openings_Huck_ALL_df[-183]

st_write(cutblock_plots_openings_Huck_ALL_df, dsn="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\cutblock_plots_openings_Huck_ALL_df.csv")
```


Repeat for Buffaloberry

```{r}
## 2. cutblock_plots_openings_Huck_ALL_df_Buff, cutblock_plots_openings_mowatBuff_df
names(cutblock_plots_openings_Huck_ALL_df_Buff)
names(cutblock_plots_openings_mowatBuff_df)

cutblock_plots_openings_mowatBuff_df$Clear_Cut
cutblock_plots_openings_mowatBuff_df$Canopy_C_1
cutblock_plots_openings_mowatBuff_df$Canopy_Cov

plot(cutblock_plots_openings_mowatBuff_df$Canopy_C_1, cutblock_plots_openings_mowatBuff_df$Canopy_Cov)

cutblock_plots_openings_mowatBuff_df$Buff_Spe_1 #Buff Species Percent cover

#"Buff_Fruit" "Buff_Fru_1" "Buff_Fru_2" "count_of_B" "count_of_1" "Buff_Fru_3" "USED"
cutblock_plots_openings_mowatBuff_df$Buff_Fruit #Buff_Fruit_Present
cutblock_plots_openings_mowatBuff_df$Buff_Fru_1 # Buff_Fruit_Stage
cutblock_plots_openings_mowatBuff_df$Buff_Fru_2 # Buff_Fruiting_Plant_Cover_percent
cutblock_plots_openings_Huck_ALL_df_Buff$Fruit.Cover

cutblock_plots_openings_mowatBuff_df$count_of_B #--> count_of_Buff_Estimate_per_m2
cutblock_plots_openings_mowatBuff_df$count_of_1 #--> count_of_Buffaloberrries_per_plot
cutblock_plots_openings_mowatBuff_df$Buff_Fru_3 # --> Buff_Fruiting_Plant_Height_cm


#mowat
cutblock_plots_openings_mowatBuff_df2<-rename(cutblock_plots_openings_mowatBuff_df,
                   c("Species.Present"="Buffalober",
                     "Species.Cover"="Buff_Spe_1",
                     "HARVEST_YE"="Harvest_Ye",
                     "CutBlock_Occurrence"="Clear_Cut",
                     "LandsatCC_2010_Fixed" = "Canopy_C_1",
                      "Fruit.Present"="Buff_Fruit",
                     "Fruit.Cover"="Buff_Fru_2",
                     "Species.Height"="Buff_Fru_3",
                     "Fruit.Abund"="count_of_B", ##Need to check this is indeed equivalent
                     "Fruit.Phenology"="Buff_Fru_1"))

#Need to figure out how to relate Fruit.Brix and shep_KCAL between files.
#DEM_SLOPE is suspicious as all values are 89 except one that is 0.... redo DEM data?
# No PH data for this second file

#If we assume all data was collected in 2021, we can calculate time since fire and harvest
head(cutblock_plots_openings_mowatBuff_df2)
table(cutblock_plots_openings_mowatBuff_df2$WILDFIRE_Y) #I am unsure how to assess these values... there are 58 values of 0 and one value of 109??
table(cutblock_plots_openings_mowatBuff_df2$HARVEST_YE) #Are these number of years since? Cross check with RESULTS data
table(cutblock_plots_openings_mowatBuff_df2$HARVEST_YE, cutblock_plots_openings_mowatBuff_df2$HARVESTYR) #Do not make sense...


cutblock_plots_openings_mowatBuff_df2$TimeSinceCut<-(2021-cutblock_plots_openings_mowatBuff_df2$HARVESTYR)

table(cutblock_plots_openings_mowatBuff_df2$TimeSinceCut)

```
Now combine

```{r}
# fill in non-overlapping columns with NAs
cutblock_plots_openings_Huck_ALL_df_Buff[setdiff(names(cutblock_plots_openings_mowatBuff_df2), names(cutblock_plots_openings_Huck_ALL_df_Buff))] <- NA
cutblock_plots_openings_mowatBuff_df2[setdiff(names(cutblock_plots_openings_Huck_ALL_df_Buff), names(cutblock_plots_openings_mowatBuff_df2))] <- NA

#Combine
cutblock_plots_openings_Buff_ALL_df<-rbind(cutblock_plots_openings_Huck_ALL_df_Buff, cutblock_plots_openings_mowatBuff_df2)

head(cutblock_plots_openings_Buff_ALL_df)
table(cutblock_plots_openings_Buff_ALL_df$CutBlock_Occurrence) #25 without, 236 with
```
Save Buffaloberry files.

```{r}
names(cutblock_plots_openings_Buff_ALL_df)
cutblock_plots_openings_Buff_ALL_df[68]
cutblock_plots_openings_Buff_ALL_df[184]

cutblock_plots_openings_Buff_ALL_df<-cutblock_plots_openings_Buff_ALL_df[-184]

st_write(cutblock_plots_openings_Buff_ALL_df, dsn="D:\\Hucklberry\\Grizzly Bear stuff\\berries\\data\\Mowat_Buff_Openings_duplicates_removed_DEM_df2b.csv")
```
############################ PREP COMPLETE ####################

##Data sets for what purpose
1. Percent cover huckleberry: cutblock_plots_openings_Huck_ALL_df
2. Other elements huckleberry: cutblock_plots_openings_Huck_ALL_df_Huck (although if use above, NA remove will likely get same result- *should* at least)

3. Percent cover buffaloberry (plant and berries separate), Presence buffaloberry (plant and berries separate): cutblock_plots_openings_Buff_ALL_df

##############

