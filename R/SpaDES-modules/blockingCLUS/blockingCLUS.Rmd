---
title: "blockingCLUS"
author: "Kyle Lochhead"
date: "03 October 2018"
output: pdf_document
---
```{r, eval = FALSE}
# Copyright 2018 Province of British Columbia
# 
# Licensed under the Apache License, Version 2.0 (the "License");
# you may not use this file except in compliance with the License.
# You may obtain a copy of the License at
# 
# http://www.apache.org/licenses/LICENSE-2.0
# 
# Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
# WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
# See the License for the specific language governing permissions and limitations under the License.
```
# Overview


This module groups pixels together to form harvest units. The purpose of this process is for the user to specfiy the distribution of patches formed through forestry activities. For a greater description of this process and the calibration go [here](https://github.com/bcgov/clus/blob/master/reports/harvest/draft-CLUS-blocking.md) 

# Usage

```{r module_usage}
library(SpaDES.core)
source("C:/Users/KLOCHHEA/clus/R/functions/R_Postgres.R")

moduleDir <- file.path("C:/Users/KLOCHHEA/clus/R/SpaDES-modules")
inputDir <- file.path("C:/Users/KLOCHHEA/clus/R") %>% reproducible::checkPath(create = TRUE)
outputDir <- file.path("C:/Users/KLOCHHEA/clus/R")
cacheDir <- file.path("C:/Users/KLOCHHEA/clus/R")
times <- list(start = 0, end = 15)
parameters <- list(
  .progress = list(type = NA, interval = NA),
  .globals = list(),
  dataLoaderCLUS = list( dbName='clus',
                         nameBoundaryFile="study_area_compart",
                         nameBoundaryColumn="tsa_name",
                         nameBoundary='Golden TSA', 
                         nameBoundaryGeom='wkb_geometry',
                         nameMaskHarvestLandbaseRaster='rast.bc_thlb2018',
                         nameZoneRaster="rast.land_unit",
                         nameAgeRaster= "rast.vri2017_projage1"),
  blockingCLUS = list(blockMethod='pre',  
                      nameSimilarityRas='rast.similarity_vri2003',
                      useLandingsArea=FALSE, 
                      useSpreadProbRas=FALSE),
  cutblockSeqPrepCLUS = list(queryCutblocks ='cutseq_centroid',
                             startHarvestYear = 2004, 
                             getArea =TRUE)
)
modules <- list("dataLoaderCLUS","cutblockSeqPrepCLUS", "blockingCLUS")
objects <- list()
paths <- list(
  cachePath = cacheDir,
  modulePath = moduleDir,
  inputPath = inputDir,
  outputPath = outputDir
)

mySim <- simInit(times = times, params = parameters, modules = modules,
                 objects = objects, paths = paths)

system.time({
mysimout<-spades(mySim)
})
#eventDiagram(mySimOut)
```

# Events

There are two methods used in blockingCLUS: 1) pre blocking and 2) dynamic blocking. 

# Data dependencies

## Input data

A raster describing the similarity between pixels is required

## Output data

A raster of block IDs

# Links to other modules

Requires dataloaderCLUS to establish the database connections and define the area of interest.

