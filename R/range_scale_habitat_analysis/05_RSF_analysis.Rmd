---
title: "05_RSF_analysis"
author: "Elizabeth Kleynhans"
date: "01/04/2020"
output: html_document
---
  
```{r setup, include = FALSE}
knitr::opts_chunk$set(echo = TRUE)
library (dplyr)
library (ggplot2)
library (lme4)
library (arm)
library (car)
library (optimx)
library (dfoptim)
library (kableExtra)
library (here)
library (magick)
library (data.table)
require (ggcorrplot)
require (sf)
require (RPostgreSQL)
require (rpostgis)
library(sjPlot)
library(sjlabelled)
library(sjmisc)
library(ggeffects)
library(cowplot)
library(ggpubr)


```


## Introduction {#intro}
Here I develop statistical models to quantify the effect of forestry disturbance on caribou distribution. The intent is to use the models to indicate the influence of current and potential future forestry development on caribou use of habitat. The model may be implemented as a module in the caribou and land use simulator (CLUS). Seperate models were fit for the four caribou designatable units (DUs) in British Columbia (BC): DU6, boreal; DU7, northern mountain; DU8, central mountain; and DU9, southern mountain, as defined by the [Committee on the Status of Endangered Wildlife in Canada (COSEWIC)](https://www.registrelep-sararegistry.gc.ca/default.asp?lang=En&n=E6271D78-1&offset=2#_01_4). DUs were modeled independently, as they are intended to represent groups of caribou with unique ecological characteristics, and potentially different responses to forestry disturbance. 

I use a resource selection function (RSF) framework to develop the statistical models ( [Boyce et al. 1999](https://www.sciencedirect.com/science/article/pii/S0169534799015931), [Johnson et al. 2006](https://wildlife.onlinelibrary.wiley.com/doi/pdf/10.2193/0022-541X%282006%2970%5B347%3ARSFBOU%5D2.0.CO%3B2)). This framework uses a logit regression model to calculate the relationship between caribou occurence and habitat 'resources' measured using spatial data. Here I am only considering the effect of forestry disturbance 'resources', i.e., cutblocks and roads, on caribou occurrence. This approach simplifies and focuses the RSF onto modeling a statistical relationship between caribou distribution and forestry disturbance that is generalizable across a caribou DU, and is not designed to accurately identify other habitat features that influence caribou distribution. The theoretical basis for this approach is that forestry disturbance has a significant influence on caribou distribution, regardless of other habitat features. Indeed, cutblocks and linear features from forestry have routinely been shown to influence caribou distribution (e.g., [Courbin et al. 2009](https://link.springer.com/article/10.1007/s10980-009-9389-x), [DeCesare et al. 2012](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/11-1610.1), [Mumma et al. 2018](https://www.sciencedirect.com/science/article/pii/S0006320718307225)) and survival ( [Wittmer et al. 2007](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.1365-2656.2007.01220.x), [Johnson et al. 2015](https://www.sciencedirect.com/science/article/pii/S0006320715001160)).

The caribou-forestry disturbance models (CFDMs) created here can be used as a spatial indicator of current and simulated future effects of forestry activity on caribou habitat quality. For example, the sum of CFDM outputs can be calculated within caribou herd ranges or critical habitat types, and changes in the sum value over time can be used to indicate changes in forestry disturbance influencing caribou habitat quality.

## Methods {#methods}

I calculated the CFDMs using generalized linear mixed models (GLMMs) with a logit link, using the [glmer function](https://www.rdocumentation.org/packages/lme4/versions/1.1-21/topics/glmer) from the [lme4](https://cran.r-project.org/web/packages/lme4/lme4.pdf) package in [program R](https://www.r-project.org/). The model investigated whether locations within the individual home ranges of caribou (second order selection in DeCesare et al. 2012 )[https://esajournals.onlinelibrary.wiley.com/doi/10.1890/11-1610.1] were further from disturbance than randomly sampled locations within the BC defined population home ranges (third order selection in DeCesare et al. 2012).

Individual home ranges of caribou were calculated by Tyler Muhley following the methods described in the folder caribou_habitat (12_RSF_version4.Rmd). Briefly caribou location data collected from telemetry collars placed on a sample of caribou (n = 468 animals, 507,987 locations) from across BC, between 2008 to 2018 was used. Most animals were likely female as the focus of caribou monitoring in BC is on measuring survival of adult females and the recruitment of their calves. All data were collected under provincial government permits and following provincial animal care and handling protocols. 

The home ranges of individual collared animals were calculated using the kernelUD function in the adehabitatHR ( [Calenge et al. 2011](https://cran.r-project.org/web/packages/adehabitatHR/vignettes/adehabitatHR.pdf)) package of Program R. A variety of smoothing parameter (*h*) values implemented on the telemetry data and the resulting fit of the 95% kernel polygons were visually assessed. Polygons with an *h* = 500 appeared to be the best fit to the data ( [Hemson et al. 2005](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.1365-2656.2005.00944.x), [Calenge et al. 2011](https://cran.r-project.org/web/packages/adehabitatHR/vignettes/adehabitatHR.pdf)), i.e., they reasonably formed contiguous habitat areas (i.e., connected polygons) without including large extents greater than 1km from telemetry locations. Seasons were defined as: summer (15-May to 31-Oct), early winter (01-Nov to 15-Jan) and late winter (16-Jan to 14-May), based on a review of the literature on variation in the seasonal distribution of caribou in British Columbia. Within each seasonal home range 1,000 locations were randomly sampled. These points became the ones in this analysis.

BC defined population home ranges were downloaded from [https://catalogue.data.gov.bc.ca/dataset/caribou-herd-locations-for-bc]. A buffer of 25km was created around each home range. If the buffer overlapped another herds home range, the overlapping area was clipped out. I also clipped out the home ranges (estimated above) estimated for each radio collared animal. The home ranges of radio collared animals were estimated for each season in each year. I decided to lump all seasonal home ranges together to get a annual home range for each collared animal. These annual home ranges were then clipped out from the buffered BC defined home range for each year. After clipping and buffering the BC home range data points were sampled every kilometer in the remaining area. This created an average of 10 000 point per home range per year.

I estimated the distance of 'used' and 'available' caribou locations to the nearest resource road and cutblock. Cutblock locations were estimated using the [consolidated cutblocks](https://catalogue.data.gov.bc.ca/dataset/harvested-areas-of-bc-consolidated-cutblocks-) data compiled by the BC government. Road locations were estimated using data compiled to support the [British Columbia Cumulative Effects Framework](https://www2.gov.bc.ca/gov/content/environment/natural-resource-stewardship/cumulative-effects-framework). This data is not accessible to the public via a webpage, but it is not private or proprietary, and thus can be requested from the cumulative effects program. The roads data classifies roads into various types. Our focus was on roads developed specifically for resource extraction (particularly forestry), thus, we classified all unpaved road types as 'resource roads' and estimated caribou distance to these types. Cutblock and roads data were rasterized at a 1ha resolution, and the Euclidean distance of each raster pixel to a cutblock or resource road in the pixel was calculated in ArcGIS and attributed to corresponding 'used' and 'available' caribou locations.

I fit GLMMs with distance to cutblock and distance to road covariates as fixed effects and random effects at the herd levels. The random effects accounted for herd variation in response to cutblocks and roads in the model, so that the fixed effects coefficients can be considered as 'population‚Äêlevel' effects (i.e.,the effect on an 'average' animal) of cutblocks and roads on caribou distribution ( [Gillies et al. 2006](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.1365-2656.2006.01106.x)). 


```{r, Load data, eval = T, echo = F, message = F, error = F, results = 'hide'}
# load data



conn <- dbConnect (dbDriver ("PostgreSQL"), 
                   host = "",
                   user = "postgres",
                   dbname = "postgres",
                   password = "postgres",
                   port = "5432")
Range_scale_data <- sf::st_read  (dsn = conn, # connKyle
                               query = "SELECT * FROM caribou.dist_to_disturbance_summary")
dbDisconnect (conn) # connKyle

Range_scale_data1<-st_set_geometry(Range_scale_data,NULL)

#convert distances to km. I created distance rasters in QGIS in pixel (ha) scale so here I convert the number of pixels i.e. ha between points to km

Range_scale_data1$distance_to_cut_1yo<-Range_scale_data1$distance_to_cut_1yo/100
Range_scale_data1$distance_to_cut_2yo<-Range_scale_data1$distance_to_cut_2yo/100
Range_scale_data1$distance_to_cut_3yo<-Range_scale_data1$distance_to_cut_3yo/100
Range_scale_data1$distance_to_cut_4yo<-Range_scale_data1$distance_to_cut_4yo/100
Range_scale_data1$distance_to_cut_5yo<-Range_scale_data1$distance_to_cut_5yo/100
Range_scale_data1$distance_to_cut_6yo<-Range_scale_data1$distance_to_cut_6yo/100
Range_scale_data1$distance_to_cut_7yo<-Range_scale_data1$distance_to_cut_7yo/100
Range_scale_data1$distance_to_cut_8yo<-Range_scale_data1$distance_to_cut_8yo/100
Range_scale_data1$distance_to_cut_9yo<-Range_scale_data1$distance_to_cut_9yo/100
Range_scale_data1$distance_to_cut_10yo<-Range_scale_data1$distance_to_cut_10yo/100
Range_scale_data1$distance_to_cut_11yo<-Range_scale_data1$distance_to_cut_11yo/100
Range_scale_data1$distance_to_cut_12yo<-Range_scale_data1$distance_to_cut_12yo/100
Range_scale_data1$distance_to_cut_13yo<-Range_scale_data1$distance_to_cut_13yo/100
Range_scale_data1$distance_to_cut_14yo<-Range_scale_data1$distance_to_cut_14yo/100
Range_scale_data1$distance_to_cut_15yo<-Range_scale_data1$distance_to_cut_15yo/100
Range_scale_data1$distance_to_cut_16yo<-Range_scale_data1$distance_to_cut_16yo/100
Range_scale_data1$distance_to_cut_17yo<-Range_scale_data1$distance_to_cut_17yo/100
Range_scale_data1$distance_to_cut_18yo<-Range_scale_data1$distance_to_cut_18yo/100
Range_scale_data1$distance_to_cut_19yo<-Range_scale_data1$distance_to_cut_19yo/100
Range_scale_data1$distance_to_cut_20yo<-Range_scale_data1$distance_to_cut_20yo/100
Range_scale_data1$distance_to_cut_21yo<-Range_scale_data1$distance_to_cut_21yo/100
Range_scale_data1$distance_to_cut_22yo<-Range_scale_data1$distance_to_cut_22yo/100
Range_scale_data1$distance_to_cut_23yo<-Range_scale_data1$distance_to_cut_23yo/100
Range_scale_data1$distance_to_cut_24yo<-Range_scale_data1$distance_to_cut_24yo/100
Range_scale_data1$distance_to_cut_25yo<-Range_scale_data1$distance_to_cut_25yo/100
Range_scale_data1$distance_to_cut_26yo<-Range_scale_data1$distance_to_cut_26yo/100
Range_scale_data1$distance_to_cut_27yo<-Range_scale_data1$distance_to_cut_27yo/100
Range_scale_data1$distance_to_cut_28yo<-Range_scale_data1$distance_to_cut_28yo/100
Range_scale_data1$distance_to_cut_29yo<-Range_scale_data1$distance_to_cut_29yo/100
Range_scale_data1$distance_to_cut_30yo<-Range_scale_data1$distance_to_cut_30yo/100
Range_scale_data1$distance_to_cut_31yo<-Range_scale_data1$distance_to_cut_31yo/100
Range_scale_data1$distance_to_cut_32yo<-Range_scale_data1$distance_to_cut_32yo/100
Range_scale_data1$distance_to_cut_33yo<-Range_scale_data1$distance_to_cut_33yo/100
Range_scale_data1$distance_to_cut_34yo<-Range_scale_data1$distance_to_cut_34yo/100
Range_scale_data1$distance_to_cut_35yo<-Range_scale_data1$distance_to_cut_35yo/100
Range_scale_data1$distance_to_cut_36yo<-Range_scale_data1$distance_to_cut_36yo/100
Range_scale_data1$distance_to_cut_37yo<-Range_scale_data1$distance_to_cut_37yo/100
Range_scale_data1$distance_to_cut_38yo<-Range_scale_data1$distance_to_cut_38yo/100
Range_scale_data1$distance_to_cut_39yo<-Range_scale_data1$distance_to_cut_39yo/100
Range_scale_data1$distance_to_cut_40yo<-Range_scale_data1$distance_to_cut_40yo/100
Range_scale_data1$distance_to_cut_41yo<-Range_scale_data1$distance_to_cut_41yo/100
Range_scale_data1$distance_to_cut_42yo<-Range_scale_data1$distance_to_cut_42yo/100
Range_scale_data1$distance_to_cut_43yo<-Range_scale_data1$distance_to_cut_43yo/100
Range_scale_data1$distance_to_cut_44yo<-Range_scale_data1$distance_to_cut_44yo/100
Range_scale_data1$distance_to_cut_45yo<-Range_scale_data1$distance_to_cut_45yo/100
Range_scale_data1$distance_to_cut_46yo<-Range_scale_data1$distance_to_cut_46yo/100
Range_scale_data1$distance_to_cut_47yo<-Range_scale_data1$distance_to_cut_47yo/100
Range_scale_data1$distance_to_cut_48yo<-Range_scale_data1$distance_to_cut_48yo/100
Range_scale_data1$distance_to_cut_49yo<-Range_scale_data1$distance_to_cut_49yo/100
Range_scale_data1$distance_to_cut_50yo<-Range_scale_data1$distance_to_cut_50yo/100
Range_scale_data1$dist_crds_resource<-Range_scale_data1$dist_crds_resource/100
Range_scale_data1$dist_crds_loose<-Range_scale_data1$dist_crds_loose/100
Range_scale_data1$dist_crds_paved<-Range_scale_data1$dist_crds_paved/100
Range_scale_data1$dist_crds_petroleum<-Range_scale_data1$dist_crds_petroleum/100
Range_scale_data1$dist_crds_rough<-Range_scale_data1$dist_crds_rough/100
Range_scale_data1$dist_crds_trim_transport<-Range_scale_data1$dist_crds_trim_transport/100
Range_scale_data1$dist_crds_unknown<-Range_scale_data1$dist_crds_unknown/100

Range_scale_data1$cnt<-1

#Range_scale_data1$distance_to_resource_road<-Range_scale_data1$dist_crds_resource
#Range_scale_data1$distance_to_resource_road_log<-log(Range_scale_data1$distance_to_resource_road+0.00001)


# Binning the data into groups that are less correlated
Range_scale_data1 <- dplyr::mutate (Range_scale_data1, distance_to_cut_1to5yo = pmin (distance_to_cut_1yo, distance_to_cut_2yo, distance_to_cut_3yo, distance_to_cut_4yo, distance_to_cut_5yo))

Range_scale_data1 <- dplyr::mutate (Range_scale_data1, distance_to_cut_6to10yo = pmin (distance_to_cut_6yo, distance_to_cut_7yo,distance_to_cut_8yo, distance_to_cut_9yo, distance_to_cut_10yo))

Range_scale_data1 <- dplyr::mutate (Range_scale_data1, distance_to_cut_11to40yo = pmin (distance_to_cut_11yo, distance_to_cut_12yo, distance_to_cut_13yo, distance_to_cut_14yo,distance_to_cut_15yo,distance_to_cut_16yo, distance_to_cut_17yo, distance_to_cut_18yo, distance_to_cut_19yo,distance_to_cut_20yo,distance_to_cut_21yo, distance_to_cut_22yo, distance_to_cut_23yo, distance_to_cut_24yo, distance_to_cut_25yo, distance_to_cut_26yo, distance_to_cut_27yo, distance_to_cut_28yo, distance_to_cut_2yo, distance_to_cut_30yo, distance_to_cut_31yo, distance_to_cut_32yo, distance_to_cut_33yo, distance_to_cut_34yo, distance_to_cut_35yo, distance_to_cut_36yo, distance_to_cut_37yo,distance_to_cut_38yo, distance_to_cut_39yo, distance_to_cut_40yo))

Range_scale_data1 <- dplyr::mutate (Range_scale_data1, distance_to_road = pmin (dist_crds_resource, dist_crds_paved,  dist_crds_petroleum))

dist.cut.corr <- (Range_scale_data1 [c (65:68)])
corr <- round (cor (dist.cut.corr), 3)
p.mat <- round (cor_pmat (dist.cut.corr), 2)
ggcorrplot (corr, type = "lower", lab = TRUE, tl.cex = 10,  lab_size = 3,
            title = "All Data Distance to Cutblock Correlation")

du6<- Range_scale_data1 %>% filter(du=="du6")
dist.cut.corr <- (du6 [c (65:68)])
corr <- round (cor (dist.cut.corr), 3)
p.mat <- round (cor_pmat (dist.cut.corr), 2)
ggcorrplot (corr, type = "lower", lab = TRUE, tl.cex = 10,  lab_size = 3,
            title = "DU6 Distance to Cutblock Correlation")


du7<- Range_scale_data1 %>% filter(du=="du7")
dist.cut.corr <- (du7 [c (65:68)])
corr <- round (cor (dist.cut.corr), 3)
p.mat <- round (cor_pmat (dist.cut.corr), 2)
ggcorrplot (corr, type = "lower", lab = TRUE, tl.cex = 10,  lab_size = 3,
            title = "DU7 Distance to Cutblock Correlation")


du8<- Range_scale_data1 %>% filter(du=="du8")
dist.cut.corr <- (du8 [c (65:68)])
corr <- round (cor (dist.cut.corr), 3)
p.mat <- round (cor_pmat (dist.cut.corr), 2)
ggcorrplot (corr, type = "lower", lab = TRUE, tl.cex = 10,  lab_size = 3,
            title = "DU8 Distance to Cutblock Correlation")


du9<- Range_scale_data1 %>% filter(du=="du9")
dist.cut.corr <- (du9 [c (65:68)])
corr <- round (cor (dist.cut.corr), 3)
p.mat <- round (cor_pmat (dist.cut.corr), 2)
ggcorrplot (corr, type = "lower", lab = TRUE, tl.cex = 10,  lab_size = 3,
            title = "DU9 Distance to Cutblock Correlation")

```

## Results
### DU6
In DU6, the home ranges of individual animals were calculated from 160 animals from the Calendar, Chinchaga, Maxhamish, Parker and Prophet (now grouped together and known as Westside Fort Nelson), and Snake-Sahtaneh herds. Number of used and available sample points are presented in Table \@ref(tab:du6_sample_size)

```{r du6_sample_size, eval = T, echo = F, message = F, eval = T}
# number of animals, by herd
count.individual.home.range <- du6  %>%
  filter(pttype==1) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Used=count)

count.herd.range <- du6  %>%
  filter(pttype==0) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Available=count)


summary_du6 <- du6 %>% 
  group_by(HERD_NAME, pttype) %>% 
  summarise(mean=mean(distance_to_road),
            sd = sd(distance_to_road),
            count = sum(cnt),
            se= sd(distance_to_road)/(sqrt(sum(cnt))))



table <- full_join(count.individual.home.range, count.herd.range)


kable (table,
       caption = "<b>Table 1. Number of points sampled in individual caribou home ranges (Used - 1's) and across the herd ranges (Available - 0's) in DU6 (Boreal).<b>") %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11) 

```

#### Herd-Level Effect of Forestry on Caribou Distribution
Overall there was a slight tendency for caribou in DU 6 to avoid roads but this relationship was not signficant (fig \@ref(fig:du6_road_effect_plot)). For example, caribou in the Chinchaga, Maxhamish, Parker and Prophet herds were further from roads than what was available on average in their home range but the opposite pattern was observed in Calendar and Snake-Sahtaneh. Due to these differences in relationships a random effect for distance to road was included in the GLMM. 

```{r du6_road_effect_plot, fig.cap="Distance to Resource Road at Available (0) and Used (1) Locations by Caribou Herd in DU6",echo = F, message = F, eval = T}
p=ggplot (du6, aes (x = as.factor(pttype), y = distance_to_road)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to road (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))

# compute lower and upper whiskers
ylim1 = boxplot.stats(du6$distance_to_road)$stats[c(1, 5)]

# scale y limits based on ylim1
p + coord_cartesian(ylim = c(0,ylim1[2]+15))

```

There was a non-significant tendency for caribou to avoid to 1 to 5 year old cutblocks in DU6 (Fig. \@ref(fig:du6_cutblock_1to5yo)). For example, caribou in all herds except Calendar tended to utlize habitat slightly further from 1 to 5 year old cutblocks than what was available. In contrast the Calendar herd showed no preference or avoidance of 1 to 5 year old cutblocks. We included random effect for distance to 1 to 5 year old cutblocks in the GLMM to account for the variability in preference between herds.

```{r du6_cutblock_1to5yo, fig.cap="Distance to 1 to 5 year old cutblock at available (0) and used (1) locations by caribou herds in DU6", echo = F, message = F, eval = T}
ggplot (du6, aes (x = as.factor(pttype), y = distance_to_cut_1to5yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

There was variability in the response of caribou herds to 6 to 10 year old cutblocks in DU6 (Fig. \@ref(fig:du6_cutblock_6to10yo)). Caribou in the Chinchaga, Maxhamish, Parker, and Snake-Sahtaneh herds were further from 6 to 10 year old cutblocks than what was available on average in their home range. In contrast Calendar and Prophet were slightly closer to 5 to 10 year old cutblocks than what was available on average. A random effect for distance to 6 to 10 year old cutblocks was included in the GLMM to account for this variability.

```{r du6_cutblock_6to10yo,fig.cap="Distance to 6 to 10 year old cutblock at available (0) and used (1) locations by caribou herds in DU6", echo = F, message = F, eval = T}
ggplot (du6, aes (x = as.factor(pttype), y = distance_to_cut_6to10yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock(km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

All Caribou herds were further from 11 to 40 years old cutblocks than what was available on average in DU6 (Fig. \@ref(fig:du6_cutblock_11to40yo)). Although the trends were similar across herds the degree of this difference varied thus a random effect for distance to 11 to 50 year old cutblocks was included in the GLMM.

```{r du6_cutblock_11to40yo,fig.cap="Distance to 11 to 50 year old cutblock at available (0) and used (1) locations by caribou herds in DU6", echo = F, message = F, eval = T}
ggplot (du6, aes (x = as.factor(pttype), y = distance_to_cut_11to40yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```


#### Caribou-Forestry Disturbance Model
There were statistically significant (P < 0.05) positive population-level effect of 1 to 5 and 6 to 10 year old cutblocks (figure \@ref(fig:random_fixed_effects_du6) ,Table \@ref(tab:du6_fix_eff_coef)). In contrast, there was a highly significant (P << 0.00001)  negative population-level effect of 11 to 40 year old cutblocks on caribou distribution (figure \@ref(fig:random_fixed_effects_du6) ,Table \@ref(tab:du6_fix_eff_coef)). There was a general trend for caribou to avoid roads (figure \@ref(fig:random_fixed_effects_du6)) but this relationship was not statistically significant (p=0.39, Table \@ref(tab:du6_fix_eff_coef))

```{r, du6 model, echo = T, message = F, eval = F}
# model spec
# varying intercept and slope for each factor. Essentially I am assuming that a increase in 1 of resource road is not the same in each herd (slopes are allowed to vary)

# Centering and scaling the input variables. 
du6$distance_to_road_s<-scale(du6$distance_to_road)
du6$distance_to_cut_1to5yo_s<-scale(du6$distance_to_cut_1to5yo)
du6$distance_to_cut_6to10yo_s<-scale(du6$distance_to_cut_6to10yo)
du6$distance_to_cut_11to40yo_s<-scale(du6$distance_to_cut_11to40yo)

# determined specification of model using Harrison et al.2018 (https://peerj.com/articles/4794/)

model.lme4.du6.cut.rd.yr <- glmer (pttype ~ distance_to_road_s +
                                         distance_to_cut_1to5yo_s +
                                         distance_to_cut_6to10yo_s +
                                         distance_to_cut_11to40yo_s +
                                        (distance_to_road_s +
                                         distance_to_cut_1to5yo_s +
                                         distance_to_cut_6to10yo_s +
                                         distance_to_cut_11to40yo_s || HERD_NAME) +
                                        (1|year),
                                      data = du6, 
                                      family = binomial (link = "logit"),
                                      verbose = T) 
VarCorr(model.lme4.du6.cut.rd.yr)
du6$residual_val<-residuals(model.lme4.du6.cut.rd.yr, type = "response")
du6$fitted_val<-fitted(model.lme4.du6.cut.rd.yr)


```


```{r du6_fix_eff_coef, echo = F, message = F, eval = T}
# summary table
table.glm.summary.du6 <- data.frame (matrix (ncol = 5, nrow = 0))
colnames (table.glm.summary.du6) <- c ("Coefficient", "Coefficient.Estimate", "Std.Error","z.value", "p.values")

table.glm.summary.du6[1,1]<-"Intercept"
table.glm.summary.du6[2,1]<-"Distance to Resource Road"
table.glm.summary.du6[3,1]<-"Distance to Cutblock 1 to 5 years old"
table.glm.summary.du6[4,1]<-"Distance to Cutblock 6 to 10 years old"
table.glm.summary.du6[5,1]<-"Distance to Cutblock 11 to 40 years old"
table.glm.summary.du6 [1, 2] <-fixef(model.lme4.du6.cut.rd.yr)[1]
table.glm.summary.du6 [2, 2] <-fixef(model.lme4.du6.cut.rd.yr)[2]
table.glm.summary.du6 [3, 2] <-fixef(model.lme4.du6.cut.rd.yr)[3]
table.glm.summary.du6 [4, 2] <-fixef(model.lme4.du6.cut.rd.yr)[4]
table.glm.summary.du6 [5, 2] <-fixef(model.lme4.du6.cut.rd.yr)[5]
table.glm.summary.du6 [1, 3] <-se.fixef(model.lme4.du6.cut.rd.yr)[1]
table.glm.summary.du6 [2, 3] <-se.fixef(model.lme4.du6.cut.rd.yr)[2]
table.glm.summary.du6 [3, 3] <-se.fixef(model.lme4.du6.cut.rd.yr)[3]
table.glm.summary.du6 [4, 3] <-se.fixef(model.lme4.du6.cut.rd.yr)[4]
table.glm.summary.du6 [5, 3] <-se.fixef(model.lme4.du6.cut.rd.yr)[5]
table.glm.summary.du6 [1, 4] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"z value"][1]
table.glm.summary.du6 [2, 4] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"z value"][2]
table.glm.summary.du6 [3, 4] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"z value"][3]
table.glm.summary.du6 [4, 4] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"z value"][4]
table.glm.summary.du6 [5, 4] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"z value"][5]
table.glm.summary.du6 [1, 5] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"Pr(>|z|)"][1]
table.glm.summary.du6 [2, 5] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"Pr(>|z|)"][2]
table.glm.summary.du6 [3, 5] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"Pr(>|z|)"][3]
table.glm.summary.du6 [4, 5] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"Pr(>|z|)"][4]
table.glm.summary.du6 [5, 5] <-coef(summary(model.lme4.du6.cut.rd.yr))[,"Pr(>|z|)"][5]

kable (table.glm.summary.du6,
       caption = "<b>Table 2. Fixed Effect Coefficients of the DU6 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)

```

Random effects in the DU6 model indicated that there was variability in the avoidance of caribou to roads across herds (Table \@ref(tab:du6_random_effects_coeffs), Fig. \@ref(fig:random_fixed_effects_du6)A). Similarly, there was variability in the response of caribou to 1 to 5 year old and 6 to 10 year old cutblocks across herds (Table \@ref(tab:du6_random_effects_coeffs), Fig. \@ref(fig:random_fixed_effects_du6) B, C). Finally, caribou consistently avoided 11 to 40 year old cutblocks (Table \@ref(tab:du6_random_effects_coeffs), Fig. \@ref(fig:random_fixed_effects_du6) D).

```{r du6_random_effects_coeffs, echo = F, message = F, eval = T}
table.glm.summary.raneff <- data.frame (matrix (ncol = 6, nrow = 0))
colnames (table.glm.summary.raneff) <- c ("Herd", "Intercept", "Distance to road","Distance to cutblock 1 to 4 years old", "Distance to cutblock 5 to 10 years old", "Distance to cutblock 11 to 40 years old")
tab<-as.data.frame(coef(model.lme4.du6.cut.rd.yr)$HERD_NAME)

table.glm.summary.raneff[1,1]<- "Calendar"
table.glm.summary.raneff[2,1]<-"Chinchaga"
table.glm.summary.raneff[3,1]<-"Maxhamish"
table.glm.summary.raneff[4,1]<-"Parker"
table.glm.summary.raneff[5,1]<-"Prophet"
table.glm.summary.raneff[6,1]<-"Snake-Sahtaneh"
table.glm.summary.raneff[1,2]<-tab[,"(Intercept)"][1]
table.glm.summary.raneff[2,2]<-tab[,"(Intercept)"][2]
table.glm.summary.raneff[3,2]<-tab[,"(Intercept)"][3]
table.glm.summary.raneff[4,2]<-tab[,"(Intercept)"][4]
table.glm.summary.raneff[5,2]<-tab[,"(Intercept)"][5]
table.glm.summary.raneff[6,2]<-tab[,"(Intercept)"][6]
table.glm.summary.raneff[1,3]<-(tab[,"distance_to_road_s"][1])
table.glm.summary.raneff[2,3]<-(tab[,"distance_to_road_s"][2])
table.glm.summary.raneff[3,3]<-(tab[,"distance_to_road_s"][3])
table.glm.summary.raneff[4,3]<-(tab[,"distance_to_road_s"][4])
table.glm.summary.raneff[5,3]<-(tab[,"distance_to_road_s"][5])
table.glm.summary.raneff[6,3]<-(tab[,"distance_to_road_s"][6])
table.glm.summary.raneff[1,4]<-(tab[,"distance_to_cut_1to5yo_s"][1])
table.glm.summary.raneff[2,4]<-(tab[,"distance_to_cut_1to5yo_s"][2])
table.glm.summary.raneff[3,4]<-(tab[,"distance_to_cut_1to5yo_s"][3])
table.glm.summary.raneff[4,4]<-(tab[,"distance_to_cut_1to5yo_s"][4])
table.glm.summary.raneff[5,4]<-(tab[,"distance_to_cut_1to5yo_s"][5])
table.glm.summary.raneff[6,4]<-(tab[,"distance_to_cut_1to5yo_s"][6])
table.glm.summary.raneff[1,5]<-(tab[,"distance_to_cut_6to10yo_s"][1])
table.glm.summary.raneff[2,5]<-(tab[,"distance_to_cut_6to10yo_s"][2])
table.glm.summary.raneff[3,5]<-(tab[,"distance_to_cut_6to10yo_s"][3])
table.glm.summary.raneff[4,5]<-(tab[,"distance_to_cut_6to10yo_s"][4])
table.glm.summary.raneff[5,5]<-(tab[,"distance_to_cut_6to10yo_s"][5])
table.glm.summary.raneff[6,5]<-(tab[,"distance_to_cut_6to10yo_s"][6])
table.glm.summary.raneff[1,6]<-(tab[,"distance_to_cut_11to40yo_s"][1])
table.glm.summary.raneff[2,6]<-(tab[,"distance_to_cut_11to40yo_s"][2])
table.glm.summary.raneff[3,6]<-(tab[,"distance_to_cut_11to40yo_s"][3])
table.glm.summary.raneff[4,6]<-(tab[,"distance_to_cut_11to40yo_s"][4])
table.glm.summary.raneff[5,6]<-(tab[,"distance_to_cut_11to40yo_s"][5])
table.glm.summary.raneff[6,6]<-(tab[,"distance_to_cut_11to40yo_s"][6])



kable (table.glm.summary.raneff,
       caption = "<b>Table 3. Random Effect Herd-Level Coefficients of the DU6 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)
```

#### Caveats
Note that the model fit is fairly bad, as Fig. \@ref(fig:du6_model_fitted_vs_residual) shows the relationship betwen the fitted and residual values is mostly well beyond the bounds of the binned confidence intervals suggesting that this model fits poorly.

```{r du6_model_fitted_vs_residual, echo = F, message = F, eval = T}
binnedplot (du6$fitted_val, 
            du6$residual_val, 
             nclass = NULL, 
             xlab = "Expected Values", 
             ylab = "Average residual", 
             main = "DU6 Model Binned Residual Plot", 
             cex.pts = 0.4, 
             col.pts = 1, 
             col.int = "red")
```


```{r random_fixed_effects_du6, fig.cap="Population and herd level effects of distance to (A)roads, (B) 1 to 5 year old cutblocks, (C) 6 to 10 year old cutblocks, and (D) 11 to 40 year old cutblocks. x-axis values were centered and scaled  to 1 standard deviation to assist model fitting",  echo = F, message = F, eval = T}

re1<-ggpredict(model.lme4.du6.cut.rd.yr, terms = c("distance_to_cut_1to5yo_s", "HERD_NAME"), type = "re")
fe1<-ggpredict(model.lme4.du6.cut.rd.yr, "distance_to_cut_1to5yo_s")

p1<-ggplot(data=fe1,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe1,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
  geom_line(data=re1, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to 1 to 5 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()
  


re2<-ggpredict(model.lme4.du6.cut.rd.yr, terms = c("distance_to_cut_6to10yo_s", "HERD_NAME"), type = "re")
fe2<-ggpredict(model.lme4.du6.cut.rd.yr, "distance_to_cut_6to10yo_s")

p2<-ggplot(data=fe2,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe2,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re2, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to 6 to 10 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()

re3<-ggpredict(model.lme4.du6.cut.rd.yr, terms = c("distance_to_cut_11to40yo_s", "HERD_NAME"), type = "re")
fe3<-ggpredict(model.lme4.du6.cut.rd.yr, "distance_to_cut_11to40yo_s")

p3<-ggplot(data=fe3,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe3,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re3, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to 11 to 40 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()

re4<-ggpredict(model.lme4.du6.cut.rd.yr, terms = c("distance_to_road_s", "HERD_NAME"), type = "re")
fe4<-ggpredict(model.lme4.du6.cut.rd.yr, "distance_to_road_s")

p4<-ggplot(data=fe4,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe4,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re4, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to roads") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()

ggarrange(p4, p1, p2,p3, ncol=2, nrow=2,labels=c("A","B","C","D"), common.legend = TRUE, legend="right")

```

### DU7
In DU7, the home ranges of individual animals were calculated from 131 animals from the Charlotte Alplands, Chase, Finlay, Frog, Graham, Itcha-Ilgachuz, Muskwa, Pink Mountain, Rainbows, Spatsizi, Telkwa, Tsenaglode and Tweedsmuir herds. Sample sizes of used and available points are presented in table \@ref(tab:DU7_samp_size_table)

```{r DU7_samp_size_table, echo = F, message = F, eval = T}
# number of animals, by herd
count.individual.home.range <- du7  %>%
  filter(pttype==1) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Used=count)

count.herd.range <- du7  %>%
  filter(pttype==0) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Available=count)


summary_du7 <- du7 %>% 
  group_by(HERD_NAME, pttype) %>% 
  summarise(mean=mean(distance_to_road),
            sd = sd(distance_to_road),
            count = sum(cnt),
            se= sd(distance_to_road)/(sqrt(sum(cnt))))



table <- full_join(count.individual.home.range, count.herd.range)


kable (table,
       caption = "<b> Number of points sampled in individual caribou home ranges (Used - 1's) and across the herd ranges (Available - 0's) in du7 (Northern).<b>") %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11) 
```

#### Herd-Level Effect of Forestry on Caribou Distribution
There was a mixed response of caribou to the presence of roads (Fig. \@ref(fig:du7_road_effect)). For example, caribou in the Chase, Frog, Graham, Itcha-Ilgachuz, Muskwa, Rainbows, Telkwa, Tsenaglode, and Tweedsmuir herds were further from roads than what was available on average in their home range but the opposite pattern was observed in Charlotte Alplands, Finlay, and Spatsizi. Due to these differences in relationships a random effect for distance to road was included in the GLMM. 

```{r du7_road_effect,fig.cap="Distance to Resource Road at Available (0) and Used (1) Locations by Caribou Herd in du7", echo = F, message = F, eval = T}
ggplot (du7, aes (x = as.factor(pttype), y = distance_to_road)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to road (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))

```
Similar to road, caribou in du7 had a mixed response to 1 to 5 year old cutblocks (Fig. \@ref(fig:du7_cutblock_1to5yo)). For example, caribou in the Finlay, Frog, Graham, Itcha-Ilgachuz, Muskwa, Rainbows, Spatsizi, Telkwa, Tsenaglode, and Tweedsmuir herds tended to utlize habitat slightly further from 1 to 5 year old cutblocks than what was available. In contrast the Charlotte Alplands, Chase, and Pink Mountain herds utilized habitats closer to 1 to 5 year old cutblocks than what was available. We included random effect for distance to 1 to 5 year old cutblocks in the GLMM to account for the variability in preference between herds.

```{r du7_cutblock_1to5yo, fig.cap="Distance to 1 to 5 year old cutblock at available (0) and used (1) locations \n by caribou herds in du7",echo = F, message = F, eval = T}
ggplot (du7, aes (x = as.factor(pttype), y = distance_to_cut_1to5yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

Distance to 6 to 10 year old cutblocks and 11 to 40 year old cutblocks were highly correlated ($\rho$ = 0.89), therefore these two variables were combined into a single variable of distance to 6 to 40 year old cutblocks.

There was variability in the response of caribou herds to 6 to 40 year old cutblocks in du7 (Fig. \@ref(fig:du7_cutblock_6to40yo)). Caribou in the Chase, Grahm, Itcha-Ilgachuz, Muskwa, Rainbows, Telkwa, Tsenaglode and Tweedsmuir herds were further from 6 to 40 year old cutblocks than what was available on average in their home range. In contrast Charlotte Alplands, Finlay, Frog and Spatsizi were closer to 6 to 40 year old cutblocks than what was available on average. A random effect for distance for 6 to 40 year old cutblocks was included in the GLMM to account for this variability.

```{r du7_cutblock_6to40yo, fig.cap="Distance to 6 to 40 year old cutblock at available (0) and used (1) locations by caribou herds in du7", echo = F, message = F, eval = T}
du7 <- dplyr::mutate (du7, distance_to_cut_6to40yo = pmin (distance_to_cut_6to10yo, distance_to_cut_11to40yo))


ggplot (du7, aes (x = as.factor(pttype), y = distance_to_cut_6to40yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock(km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```


#### Caribou-Forestry Disturbance Model
There was no relationship between caribou use and distance to road (P=0.49). The model indicated a weakly significant (P=0.084) effect of 1 to 5 year old cutblocks on caribou distribution.  Thus, on average, across caribou individuals and herds, caribou used areas further from 1 to 5 year old cutblocks (note that a positive coefficient is a negative effect, because the covariate is a 'distance to' metric). Lastly, the model indicated a strongly significant (P<<0.0001) positive effect of 6 to 40 year old cutblocks on caribou, suggesting that caribou avoided 6 to 40 year old cutblocks.

```{r, du7 model, echo = T, message = F, eval = F}
# model spec
du7$distance_to_road_scale<-scale(du7$distance_to_road)
du7$distance_to_cut_1to5yo_scale<-scale(du7$distance_to_cut_1to5yo)
du7$distance_to_cut_6to40yo_scale<-scale(du7$distance_to_cut_6to40yo)

model.lme4.du7.cut.rd.yr <- glmer (pttype ~ distance_to_road_scale +
                                         distance_to_cut_1to5yo_scale +
                                         distance_to_cut_6to40yo_scale +
                                        (distance_to_road_scale +
                                         distance_to_cut_1to5yo_scale +
                                         distance_to_cut_6to40yo_scale ||HERD_NAME) +
                                         (1|year),
                                      data = du7, 
                                      family = binomial (link = "logit"),
                                      verbose = T)  

summary(model.lme4.du7.cut.rd.yr)
Anova(model.lme4.du7.cut.rd.yr,type="III")

```

```{r du7_fix_eff_coef, echo = F, message = F, eval = T}
# summary table
table.glm.summary.du7 <- data.frame (matrix (ncol = 5, nrow = 0))
colnames (table.glm.summary.du7) <- c ("Coefficient", "Coefficient.Estimate", "Std.Error","z.value", "p.values")

table.glm.summary.du7[1,1]<-"Intercept"
table.glm.summary.du7[2,1]<-"Distance to Resource Road"
table.glm.summary.du7[3,1]<-"Distance to Cutblock 1 to 5 years old"
table.glm.summary.du7[4,1]<-"Distance to Cutblock 6 to 40 years old"
table.glm.summary.du7 [1, 2] <-fixef(model.lme4.du7.cut.rd.yr)[1]
table.glm.summary.du7 [2, 2] <-fixef(model.lme4.du7.cut.rd.yr)[2]
table.glm.summary.du7 [3, 2] <-fixef(model.lme4.du7.cut.rd.yr)[3]
table.glm.summary.du7 [4, 2] <-fixef(model.lme4.du7.cut.rd.yr)[4]
table.glm.summary.du7 [1, 3] <-se.fixef(model.lme4.du7.cut.rd.yr)[1]
table.glm.summary.du7 [2, 3] <-se.fixef(model.lme4.du7.cut.rd.yr)[2]
table.glm.summary.du7 [3, 3] <-se.fixef(model.lme4.du7.cut.rd.yr)[3]
table.glm.summary.du7 [4, 3] <-se.fixef(model.lme4.du7.cut.rd.yr)[4]
table.glm.summary.du7 [1, 4] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"z value"][1]
table.glm.summary.du7 [2, 4] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"z value"][2]
table.glm.summary.du7 [3, 4] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"z value"][3]
table.glm.summary.du7 [4, 4] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"z value"][4]
table.glm.summary.du7 [1, 5] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"Pr(>|z|)"][1]
table.glm.summary.du7 [2, 5] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"Pr(>|z|)"][2]
table.glm.summary.du7 [3, 5] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"Pr(>|z|)"][3]
table.glm.summary.du7 [4, 5] <-coef(summary(model.lme4.du7.cut.rd.yr))[,"Pr(>|z|)"][4]

kable (table.glm.summary.du7,
       caption = "<b>Table 2. Fixed Effect Coefficients of the du7 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)

```

Random effects in the du7 model indicated that there was variability in the response of caribou to roads across herds (Table \@ref(tab:du7_random_effects_coeffs), Fig. \@ref(fig:random_fixed_effects_du7)A). Some herds such as Frog and Tsenaglode tended to avoid roads. While other herds, such as, Rainbow, Graham, and Tweedsmuir utlized areas closer to roads than what was generally available. On average, caribou herds avoided 1 to 5 year old cutblocks (Table \@ref(tab:du7_random_effects_coeffs), Fig. \@ref(fig:random_fixed_effects_du7) B), but again this response was variabliity between herds. For example, Pink Mountain and Tweedsmuir tended to use areas close to roads more frequently than what was available on average while the opposite was true for Itcha-Ilgachuz, Spatsizi, and Tsenglode. Lastly, most caribou herds avoid 6 to 40 year old cutblocks, with the exception of Finlay and Frog who showed a slight trend towards prefering 6 to 40 year old cutblock (Table \@ref(tab:du7_random_effects_coeffs), Fig. \@ref(fig:random_fixed_effects_du7) C).


```{r du7_random_effects_coeffs, echo = F, message = F, eval = T}
table.glm.summary.raneff <- data.frame (matrix (ncol = 5, nrow = 0))
colnames (table.glm.summary.raneff) <- c ("Herd", "Intercept", "Distance to road","Distance to cutblock 1 to 5 years old", "Distance to cutblock 6 to 40 years old")
tab<-as.data.frame(coef(model.lme4.du7.cut.rd.yr)$HERD_NAME)

table.glm.summary.raneff[1,1]<- "Charlotte Alplands"
table.glm.summary.raneff[2,1]<-"Chase"
table.glm.summary.raneff[3,1]<-"Finlay"
table.glm.summary.raneff[4,1]<-"Frog"
table.glm.summary.raneff[5,1]<-"Graham"
table.glm.summary.raneff[6,1]<-"Itcha-Ilgachuz"
table.glm.summary.raneff[7,1]<- "Muskwa"
table.glm.summary.raneff[8,1]<-"Pink Mountain"
table.glm.summary.raneff[9,1]<-"Rainbows"
table.glm.summary.raneff[10,1]<-"Spatsizi"
table.glm.summary.raneff[11,1]<-"Telkwa"
table.glm.summary.raneff[12,1]<-"Tsenaglode"
table.glm.summary.raneff[13,1]<-"Tweedsmuir"

table.glm.summary.raneff[1,2]<-tab[,"(Intercept)"][1]
table.glm.summary.raneff[2,2]<-tab[,"(Intercept)"][2]
table.glm.summary.raneff[3,2]<-tab[,"(Intercept)"][3]
table.glm.summary.raneff[4,2]<-tab[,"(Intercept)"][4]
table.glm.summary.raneff[5,2]<-tab[,"(Intercept)"][5]
table.glm.summary.raneff[6,2]<-tab[,"(Intercept)"][6]
table.glm.summary.raneff[7,2]<-tab[,"(Intercept)"][7]
table.glm.summary.raneff[8,2]<-tab[,"(Intercept)"][8]
table.glm.summary.raneff[9,2]<-tab[,"(Intercept)"][9]
table.glm.summary.raneff[10,2]<-tab[,"(Intercept)"][10]
table.glm.summary.raneff[11,2]<-tab[,"(Intercept)"][11]
table.glm.summary.raneff[12,2]<-tab[,"(Intercept)"][12]
table.glm.summary.raneff[13,2]<-tab[,"(Intercept)"][13]

table.glm.summary.raneff[1,3]<-(tab[,"distance_to_road_scale"][1])
table.glm.summary.raneff[2,3]<-(tab[,"distance_to_road_scale"][2])
table.glm.summary.raneff[3,3]<-(tab[,"distance_to_road_scale"][3])
table.glm.summary.raneff[4,3]<-(tab[,"distance_to_road_scale"][4])
table.glm.summary.raneff[5,3]<-(tab[,"distance_to_road_scale"][5])
table.glm.summary.raneff[6,3]<-(tab[,"distance_to_road_scale"][6])
table.glm.summary.raneff[7,3]<-(tab[,"distance_to_road_scale"][7])
table.glm.summary.raneff[8,3]<-(tab[,"distance_to_road_scale"][8])
table.glm.summary.raneff[9,3]<-(tab[,"distance_to_road_scale"][9])
table.glm.summary.raneff[10,3]<-(tab[,"distance_to_road_scale"][10])
table.glm.summary.raneff[11,3]<-(tab[,"distance_to_road_scale"][11])
table.glm.summary.raneff[12,3]<-(tab[,"distance_to_road_scale"][12])
table.glm.summary.raneff[13,3]<-(tab[,"distance_to_road_scale"][13])

table.glm.summary.raneff[1,4]<-(tab[,"distance_to_cut_1to5yo_scale"][1])
table.glm.summary.raneff[2,4]<-(tab[,"distance_to_cut_1to5yo_scale"][2])
table.glm.summary.raneff[3,4]<-(tab[,"distance_to_cut_1to5yo_scale"][3])
table.glm.summary.raneff[4,4]<-(tab[,"distance_to_cut_1to5yo_scale"][4])
table.glm.summary.raneff[5,4]<-(tab[,"distance_to_cut_1to5yo_scale"][5])
table.glm.summary.raneff[6,4]<-(tab[,"distance_to_cut_1to5yo_scale"][6])
table.glm.summary.raneff[7,4]<-(tab[,"distance_to_cut_1to5yo_scale"][7])
table.glm.summary.raneff[8,4]<-(tab[,"distance_to_cut_1to5yo_scale"][8])
table.glm.summary.raneff[9,4]<-(tab[,"distance_to_cut_1to5yo_scale"][9])
table.glm.summary.raneff[10,4]<-(tab[,"distance_to_cut_1to5yo_scale"][10])
table.glm.summary.raneff[11,4]<-(tab[,"distance_to_cut_1to5yo_scale"][11])
table.glm.summary.raneff[12,4]<-(tab[,"distance_to_cut_1to5yo_scale"][12])
table.glm.summary.raneff[13,4]<-(tab[,"distance_to_cut_1to5yo_scale"][13])

table.glm.summary.raneff[1,5]<-(tab[,"distance_to_cut_6to40yo_scale"][1])
table.glm.summary.raneff[2,5]<-(tab[,"distance_to_cut_6to40yo_scale"][2])
table.glm.summary.raneff[3,5]<-(tab[,"distance_to_cut_6to40yo_scale"][3])
table.glm.summary.raneff[4,5]<-(tab[,"distance_to_cut_6to40yo_scale"][4])
table.glm.summary.raneff[5,5]<-(tab[,"distance_to_cut_6to40yo_scale"][5])
table.glm.summary.raneff[6,5]<-(tab[,"distance_to_cut_6to40yo_scale"][6])
table.glm.summary.raneff[7,5]<-(tab[,"distance_to_cut_6to40yo_scale"][7])
table.glm.summary.raneff[8,5]<-(tab[,"distance_to_cut_6to40yo_scale"][8])
table.glm.summary.raneff[9,5]<-(tab[,"distance_to_cut_6to40yo_scale"][9])
table.glm.summary.raneff[10,5]<-(tab[,"distance_to_cut_6to40yo_scale"][10])
table.glm.summary.raneff[11,5]<-(tab[,"distance_to_cut_6to40yo_scale"][11])
table.glm.summary.raneff[12,5]<-(tab[,"distance_to_cut_6to40yo_scale"][12])
table.glm.summary.raneff[13,5]<-(tab[,"distance_to_cut_6to40yo_scale"][13])

kable (table.glm.summary.raneff,
       caption = "<b>Table 3. Random Effect Herd-Level Coefficients of the du7 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)
```

#### Caveats
Note that the model fit is fairly bad, as Fig. \@ref(fig:du7_model_fitted_vs_residual) shows the relationship betwen the fitted and residual values is frequently beyond the bounds of the binned confidence intervals suggesting that this model fits poorly.

```{r du7_model_fitted_vs_residual,fig.cap="DU7 Model Binned Residual Plot", echo = F, message = F, eval = T}
# check residuals
binnedplot (fitted (model.lme4.du7.cut.rd.yr), 
             residuals(model.lme4.du7.cut.rd.yr, type = "response"), 
             nclass = NULL, 
             xlab = "Expected Values", 
             ylab = "Average residual",
             cex.pts = 0.4, 
             col.pts = 1, 
             col.int = "red")
```


```{r random_fixed_effects_du7, fig.cap="Population and herd level effects of distance to (A)roads, (B) 1 to 5 year old cutblocks, and (C) 6 to 40 year old cutblocks. x-axis values were centered and scaled to 1 standard deviation to assist model fitting",  echo = F, message = F, eval = T}

re1<-ggpredict(model.lme4.du7.cut.rd.yr, terms = c("distance_to_cut_1to5yo_scale", "HERD_NAME"), type = "re")
fe1<-ggpredict(model.lme4.du7.cut.rd.yr, "distance_to_cut_1to5yo_scale")

p1<-ggplot(data=fe1,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe1,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
  geom_line(data=re1, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to 1 to 5 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash","solid",  "longdash", "solid",  "longdash", "solid", "longdash","solid")) +
  scale_color_manual (name = "Herd Name",
                      values = c ('coral', 'chartreuse', "yellowgreen", "brown", "aquamarine", "dodgerblue", "deeppink", "darkviolet", "seagreen","darkorange", "darkolivegreen", "gold", "red")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw () 
  


re2<-ggpredict(model.lme4.du7.cut.rd.yr, terms = c("distance_to_cut_6to40yo_scale", "HERD_NAME"), type = "re")
fe2<-ggpredict(model.lme4.du7.cut.rd.yr, "distance_to_cut_6to40yo_scale")

p2<-ggplot(data=fe2,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe2,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re2, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to 6 to 10 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash","solid",  "longdash", "solid",  "longdash", "solid", "longdash","solid")) +
  scale_color_manual (name = "Herd Name",
                      values = c ('coral', 'chartreuse', "yellowgreen", "brown", "aquamarine", "dodgerblue", "deeppink", "darkviolet", "seagreen","darkorange", "darkolivegreen", "gold", "red")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()+ theme(legend.position = "none")



re4<-ggpredict(model.lme4.du7.cut.rd.yr, terms = c("distance_to_road_scale", "HERD_NAME"), type = "re")
fe4<-ggpredict(model.lme4.du7.cut.rd.yr, "distance_to_road_scale")

p4<-ggplot(data=fe4,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe4,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re4, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to roads") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash","solid",  "longdash", "solid",  "longdash", "solid", "longdash","solid")) +
  scale_color_manual (name = "Herd Name",
                      values = c ('coral', 'chartreuse', "yellowgreen", "brown", "aquamarine", "dodgerblue", "deeppink", "darkviolet", "seagreen","darkorange", "darkolivegreen", "gold", "red")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()+ theme(legend.position = "none")

ggarrange(p4, p1, p2, ncol=2, nrow=2,labels=c("A","B","C"), common.legend = TRUE, legend="right")


```

### DU8
In DU8, caribou location data was collected from 152 animals from the Burnt Pine, Kennedy Siding, Moberly, Narraway, Quintette and Scott herds. The number of animals sampled per herd ranged from 8 to 57 and the number of telemetry locations per herd ranged from 5,414 to 65,431 per herd (Table \@ref(tab:DU8_sample_points)).

```{r DU8_sample_points, echo = F, message = F, eval = T}
# number of animals, by herd
count.individual.home.range <- du8  %>%
  filter(pttype==1) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Used=count)

count.herd.range <- du8  %>%
  filter(pttype==0) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Available=count)


summary_du8 <- du8 %>% 
  group_by(HERD_NAME, pttype) %>% 
  summarise(mean=mean(distance_to_road),
            sd = sd(distance_to_road),
            count = sum(cnt),
            se= sd(distance_to_road)/(sqrt(sum(cnt))))



table <- full_join(count.individual.home.range, count.herd.range)


kable (table,
       caption = "<b>Table 1. Number of points sampled in individual caribou home ranges (Used - 1's) and across the herd ranges (Available - 0's) in DU8 (Northern).<b>") %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11) 

```

#### Herd-Level Effect of Forestry on Caribou Distribution
In general caribou herds avoided roads in DU8 (Fig. \@ref(fig:du8_Herd_road_effect)). For example, caribou in the Burnt Pine, Kennedy Siding, Moberly, Narraway and Scott herds tended to be further from roads, whereas caribou in the Narraway herd utlized habitat in the same proportion as what was available. A random effect for distance to road was included in the GLMM to account for this variability.

```{r du8_Herd_road_effect, fig.cap="Distance to Resource Road at Available (0) and Used (1) Locations by Caribou Herd in DU8", echo = F, message = F, eval = T}
ggplot (du8, aes (x = as.factor(pttype), y = distance_to_road)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to road (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

Caribou tended to avoid cutblocks 1 to 5 years old across herds in DU8 (Fig. \@ref(fig:du8_Herd_cutblock_1_to_4)). For example, all herds except Narraway tended to use areas further from to 1 to 5 year old cutblocks than what was available. A random effect for distance to cutblock 1 to 4 years old was included in the GLMM to account for this variability.

```{r du8_Herd_cutblock_1_to_4,fig.cap="Distance to 1 to 5 year old cutblock at available (0) and used (1) locations by caribou herds in DU8", echo = F, message = F, eval = T}
ggplot (du8, aes (x = as.factor(pttype), y = distance_to_cut_1to5yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

Caribou tended to avoid cutblocks 6 to 10 years of age across herds in DU8 (Fig. \@ref(du8_Herd_cutblock_5_to_9)). For example, all herds except Narraway used areas further from to 6 to 10 year old cutblocks than what was available. A random effect for distance to cutblock 6 to 10 years old was included in the GLMM to account for this variability.

```{r du8_Herd_cutblock_5_to_9,fig.cap="Distance to 6 to 10 year old cutblock at available (0) and used (1) locations by caribou herds in DU8", echo = F, message = F, eval = T}
ggplot (du8, aes (x = as.factor(pttype), y = distance_to_cut_6to10yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

Caribou tended to avoid cutblocks 11 to 40 years of age across herds in DU8 (Fig. 17). For example, all herds except Narraway used areas further from to 11 to 40 year old cutblocks than what was available. A random effect for distance to cutblock 11 to 40 years old was included in the GLMM to account for this variability.

```{r du8_Herd_cutblock_5_to_40, fig.cap="Distance to 11 to 40 year old cutblock at available (0) and used (1) locations by caribou herds in DU8", echo = F, message = F, eval = T}
ggplot (du8, aes (x = as.factor(pttype), y = distance_to_cut_11to40yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```


#### Caribou-Forestry Disturbance Model
There was a statistically significant (p-value < 0.05), negative fixed (population-level) effect of roads on caribou distribution (Table 8). There were generally positive fixed effects of cutblocks on caribou distribution. There was essentially no effect of 1 to 4 year old cutblocks on caribou distribution, a weak (p = 0.166) positive effect of 5 to 9 year old cutblocks, and a close to statistically significant (p-value = 0.07) positive effect of 10 to 40 year old cutblocks on caribou distribution. 
```{r, du8 model, echo = T, message = F, eval = F}
# model spec
du8$distance_to_road_scale<-scale(du8$distance_to_road)
du8$distance_to_cut_1to5yo_scale<-scale(du8$distance_to_cut_1to5yo)
du8$distance_to_cut_6to10yo_scale<-scale(du8$distance_to_cut_6to10yo)
du8$distance_to_cut_11to50yo_scale<-scale(du8$distance_to_cut_11to50yo)

model.lme4.du8.cut.rd.yr2 <- glmer (pttype ~ distance_to_road_scale +
                                         distance_to_cut_1to5yo_scale +
                                         distance_to_cut_6to10yo_scale +
                                         distance_to_cut_11to50yo_scale +
                                        (distance_to_road_scale +
                                         distance_to_cut_1to5yo_scale +
                                         distance_to_cut_6to10yo_scale +
                                         distance_to_cut_11to50yo_scale||HERD_NAME) +
                                        (1|year),
                                      data = du8, 
                                      family = binomial (link = "logit"),
                                      verbose = T)  
 

summary(model.lme4.du8.cut.rd.yr2)
Anova(model.lme4.du8.cut.rd.yr2,type="III")
# check residuals
binnedplot (fitted (model.lme4.du8.cut.rd.yr2), 
             residuals(model.lme4.du8.cut.rd.yr2, type = "response"), 
             nclass = NULL, 
             xlab = "Expected Values", 
             ylab = "Average residual", 
             main = "DU8 Model Binned Residual Plot", 
             cex.pts = 0.4, 
             col.pts = 1, 
             col.int = "red")
```

```{r du6_fix_eff_coef, echo = F, message = F, eval = T}
# summary table
table.glm.summary.du8 <- data.frame (matrix (ncol = 5, nrow = 0))
colnames (table.glm.summary.du8) <- c ("Coefficient", "Coefficient.Estimate", "Std.Error","z.value", "p.values")

table.glm.summary.du8[1,1]<-"Intercept"
table.glm.summary.du8[2,1]<-"Distance to Resource Road"
table.glm.summary.du8[3,1]<-"Distance to Cutblock 1 to 5 years old"
table.glm.summary.du8[4,1]<-"Distance to Cutblock 6 to 10 years old"
table.glm.summary.du8[5,1]<-"Distance to Cutblock 11 to 40 years old"
table.glm.summary.du8 [1, 2] <-fixef(model.lme4.du8.cut.rd.yr2)[1]
table.glm.summary.du8 [2, 2] <-fixef(model.lme4.du8.cut.rd.yr2)[2]
table.glm.summary.du8 [3, 2] <-fixef(model.lme4.du8.cut.rd.yr2)[3]
table.glm.summary.du8 [4, 2] <-fixef(model.lme4.du8.cut.rd.yr2)[4]
table.glm.summary.du8 [5, 2] <-fixef(model.lme4.du8.cut.rd.yr2)[5]
table.glm.summary.du8 [1, 3] <-se.fixef(model.lme4.du8.cut.rd.yr2)[1]
table.glm.summary.du8 [2, 3] <-se.fixef(model.lme4.du8.cut.rd.yr2)[2]
table.glm.summary.du8 [3, 3] <-se.fixef(model.lme4.du8.cut.rd.yr2)[3]
table.glm.summary.du8 [4, 3] <-se.fixef(model.lme4.du8.cut.rd.yr2)[4]
table.glm.summary.du8 [5, 3] <-se.fixef(model.lme4.du8.cut.rd.yr2)[5]
table.glm.summary.du8 [1, 4] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"z value"][1]
table.glm.summary.du8 [2, 4] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"z value"][2]
table.glm.summary.du8 [3, 4] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"z value"][3]
table.glm.summary.du8 [4, 4] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"z value"][4]
table.glm.summary.du8 [5, 4] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"z value"][5]
table.glm.summary.du8 [1, 5] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"Pr(>|z|)"][1]
table.glm.summary.du8 [2, 5] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"Pr(>|z|)"][2]
table.glm.summary.du8 [3, 5] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"Pr(>|z|)"][3]
table.glm.summary.du8 [4, 5] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"Pr(>|z|)"][4]
table.glm.summary.du8 [5, 5] <-coef(summary(model.lme4.du8.cut.rd.yr2))[,"Pr(>|z|)"][5]

kable (table.glm.summary.du8,
       caption = "<b>Table 2. Fixed Effect Coefficients of the DU8 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)

```

Random effects in the DU8 model indicated that caribou avoided roads consistently across herds, although there was variability in the strength of avoidance (Table 9, Fig. 20). Caribou in the Burnt Pine, Quintette and Scott avoided cutblocks 1 to 4 years old, whereas caribou in the Kennedy Siding, Moberly and Narraway used areas closer to cutblocks 1 to 4 years old (Fig. 21). Caribou in the Narraway and Quintette avoided cutblocks 5 to 9 years old, whereas caribou in the Burnt Pine, Kennedy Siding, Moberly and Scott used areas closer to cutblocks 5 to 9 years old (Fig. 22). All caribou herds selected cutblocks 10 to 40 years old (Fig. 23).

```{r du6_random_effects_coeffs, echo = F, message = F, eval = T}
table.glm.summary.raneff8 <- data.frame (matrix (ncol = 6, nrow = 0))
colnames (table.glm.summary.raneff8) <- c ("Herd", "Intercept", "Distance to road","Distance to cutblock 1 to 5 years old", "Distance to cutblock 6 to 10 years old", "Distance to cutblock 11 to 40 years old")
tab<-as.data.frame(coef(model.lme4.du8.cut.rd.yr2)$HERD_NAME)

table.glm.summary.raneff8[1,1]<- "Burnt Pine"
table.glm.summary.raneff8[2,1]<-"Kennedy Sidin"
table.glm.summary.raneff8[3,1]<-"Moberly"
table.glm.summary.raneff8[4,1]<-"Narraway"
table.glm.summary.raneff8[5,1]<-"Quintette"
table.glm.summary.raneff8[6,1]<-"Scott"
table.glm.summary.raneff8[1,2]<-tab[,"(Intercept)"][1]
table.glm.summary.raneff8[2,2]<-tab[,"(Intercept)"][2]
table.glm.summary.raneff8[3,2]<-tab[,"(Intercept)"][3]
table.glm.summary.raneff8[4,2]<-tab[,"(Intercept)"][4]
table.glm.summary.raneff8[5,2]<-tab[,"(Intercept)"][5]
table.glm.summary.raneff8[6,2]<-tab[,"(Intercept)"][6]
table.glm.summary.raneff8[1,3]<-(tab[,"distance_to_road_scale"][1])
table.glm.summary.raneff8[2,3]<-(tab[,"distance_to_road_scale"][2])
table.glm.summary.raneff8[3,3]<-(tab[,"distance_to_road_scale"][3])
table.glm.summary.raneff8[4,3]<-(tab[,"distance_to_road_scale"][4])
table.glm.summary.raneff8[5,3]<-(tab[,"distance_to_road_scale"][5])
table.glm.summary.raneff8[6,3]<-(tab[,"distance_to_road_scale"][6])
table.glm.summary.raneff8[1,4]<-(tab[,"distance_to_cut_1to5yo_scale"][1])
table.glm.summary.raneff8[2,4]<-(tab[,"distance_to_cut_1to5yo_scale"][2])
table.glm.summary.raneff8[3,4]<-(tab[,"distance_to_cut_1to5yo_scale"][3])
table.glm.summary.raneff8[4,4]<-(tab[,"distance_to_cut_1to5yo_scale"][4])
table.glm.summary.raneff8[5,4]<-(tab[,"distance_to_cut_1to5yo_scale"][5])
table.glm.summary.raneff8[6,4]<-(tab[,"distance_to_cut_1to5yo_scale"][6])
table.glm.summary.raneff8[1,5]<-(tab[,"distance_to_cut_6to10yo_scale"][1])
table.glm.summary.raneff8[2,5]<-(tab[,"distance_to_cut_6to10yo_scale"][2])
table.glm.summary.raneff8[3,5]<-(tab[,"distance_to_cut_6to10yo_scale"][3])
table.glm.summary.raneff8[4,5]<-(tab[,"distance_to_cut_6to10yo_scale"][4])
table.glm.summary.raneff8[5,5]<-(tab[,"distance_to_cut_6to10yo_scale"][5])
table.glm.summary.raneff8[6,5]<-(tab[,"distance_to_cut_6to10yo_scale"][6])
table.glm.summary.raneff8[1,6]<-(tab[,"distance_to_cut_11to40yo_scale"][1])
table.glm.summary.raneff8[2,6]<-(tab[,"distance_to_cut_11to40yo_scale"][2])
table.glm.summary.raneff8[3,6]<-(tab[,"distance_to_cut_11to40yo_scale"][3])
table.glm.summary.raneff8[4,6]<-(tab[,"distance_to_cut_11to40yo_scale"][4])
table.glm.summary.raneff8[5,6]<-(tab[,"distance_to_cut_11to40yo_scale"][5])
table.glm.summary.raneff8[6,6]<-(tab[,"distance_to_cut_11to40yo_scale"][6])



kable (table.glm.summary.raneff8,
       caption = "<b>Table 3. Random Effect Herd-Level Coefficients of the DU8 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)
```


```{r random_fixed_effects_du8, fig.cap="Population and herd level effects of distance to (A)roads, (B) 1 to 5 year old cutblocks, (C) 6 to 10 year old cutblocks, and (D) 11 to 40 year old cutblocks in DU8. x-axis values were centered and scaled  to 1 standard deviation to assist model fitting",  echo = F, message = F, eval = T}

re1<-ggpredict(model.lme4.du8.cut.rd.yr2, terms = c("distance_to_cut_1to5yo_scale", "HERD_NAME"), type = "re")
fe1<-ggpredict(model.lme4.du8.cut.rd.yr2, "distance_to_cut_1to5yo_scale")

p1<-ggplot(data=fe1,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe1,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
  geom_line(data=re1, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to 1 to 5 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()
  


re2<-ggpredict(model.lme4.du8.cut.rd.yr2, terms = c("distance_to_cut_6to10yo_scale", "HERD_NAME"), type = "re")
fe2<-ggpredict(model.lme4.du8.cut.rd.yr2, "distance_to_cut_6to10yo_scale")

p2<-ggplot(data=fe2,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe2,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re2, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to 6 to 10 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()

re3<-ggpredict(model.lme4.du8.cut.rd.yr2, terms = c("distance_to_cut_11to40yo_scale", "HERD_NAME"), type = "re")
fe3<-ggpredict(model.lme4.du8.cut.rd.yr2, "distance_to_cut_11to40yo_scale")

p3<-ggplot(data=fe3,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe3,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re3, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  ylab("Probability") +
  xlab("Distance to 11 to 40 year old cutblocks") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()

re4<-ggpredict(model.lme4.du8.cut.rd.yr2, terms = c("distance_to_road_scale", "HERD_NAME"), type = "re")
fe4<-ggpredict(model.lme4.du8.cut.rd.yr2, "distance_to_road_scale")

p4<-ggplot(data=fe4,aes(x=x,y=predicted)) +
         geom_line(size=1.5) +
         geom_ribbon(data=fe4,aes(ymin=conf.low,ymax=conf.high),alpha=.1) +
   geom_line(data=re4, aes(x,predicted,colour=group,
                  linetype = group, 
                  size = group)) +
  #ggtitle("Distance to 1 to 5 year old cutblocks") +
  ylab("Probability") +
  xlab("Distance to roads") +
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid",  "longdash", "solid",  "longdash", "solid", "longdash")) +
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "darkblue", "darkviolet", "seagreen", "darkorange")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.8, 0.8, 0.8, 0.8, 0.8, 0.8)) +
  theme_bw ()

ggarrange(p4, p1, p2,p3, ncol=2, nrow=2,labels=c("A","B","C","D"), common.legend = TRUE, legend="right")

```


### DU9
In DU9, caribou location data was collected from 25 animals from the Hart Ranges, Nakusp and South Selkirks herds (Table 10). The number of animals sampled per herd ranged from 6 to 11 and the number of telemetry locations per herd ranged from 1,821 to 4,917 per herd.

```{r, du9, data summary, echo = F, message = F, eval = T}
# number of animals, by herd
count.individual.home.range <- du9  %>%
  filter(pttype==1) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Used=count)

count.herd.range <- du9  %>%
  filter(pttype==0) %>%
  group_by(HERD_NAME,year) %>%
  summarise(count = n()) %>% 
  rename(Available=count)


summary_du9 <- du9 %>% 
  group_by(HERD_NAME, pttype) %>% 
  summarise(mean=mean(distance_to_road),
            sd = sd(distance_to_road),
            count = sum(cnt),
            se= sd(distance_to_road)/(sqrt(sum(cnt))))



table <- full_join(count.individual.home.range, count.herd.range)


kable (table,
       caption = "<b>Table 1. Number of points sampled in individual caribou home ranges (Used - 1's) and across the herd ranges (Available - 0's) in du9 (Northern).<b>") %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11) 
```

#### Herd-Level Effect of Forestry on Caribou Distribution
All herds in DU9 avoided roads, however, the degree to which they avoided roads varied between herds. Hart Ranges avoided roads most strongly while South Selkirks only showed minor avoidance. A random effect for distance to road was included in the GLMM to account for this variability. Distance to resource road has highly correlated with distance to 10 to 40 year old cutblock ($\rho$ = 0.84), amd thus was not included in this analysis.

```{r, du9 Herd road effect plot, echo = F, message = F, eval = T}
ggplot (du9, aes (x = as.factor(pttype), y = distance_to_road)) +
  geom_boxplot (outlier.colour = "red") +
  labs (title = "Figure 24. Distance to Road at Available (0) and Used (1) Locations /n by Caribou Herd in DU9",
        x = "Available (0) and Used (1) Locations",
        y = "Distance to Resource Road") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 11))
```

Caribou in avoided 1 to 5 year old cutblocks in du9. This was consistend across all herds. A random effect for distance to 1 to 4 year old cutblock was included in the GLMM to account for this variability.

```{r, du9 Herd 1 to 4 yo cutblock effect plot, echo = F, message = F, eval = T}
ggplot (du9, aes (x = as.factor(pttype), y = distance_to_cut_1to5yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (title = "Figure 17. Distance to 1 to 5 year old cutblock at available (0) and used (1) locations \n by caribou herds in DU9",
        x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```


Caribou in avoided 6 to 10 year old cutblocks in du9. This was consistend across all herds. A random effect for distance to 6 to 10 year old cutblock was included in the GLMM to account for this variability.

```{r, du9 Herd 5 to 9 yo cutblock effect plot, echo = F, message = F, eval = T}
ggplot (du9, aes (x = as.factor(pttype), y = distance_to_cut_6to10yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (title = "Figure 17. Distance to 6 to 10 year old cutblock at available (0) and used (1) locations \n by caribou herds in DU9",
        x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

There was variability in the response of Caribou to 11 to 40 year old cutblocks in du9. Hart Ranges and Nakusp avoided 11 to 40 year old roads while South Selkirks appeared to utilize habitat closer to 11 to 40 year old cutblocks than what is available. A random effect for distance to 11 to 40 year old cutblock was included in the GLMM to account for this variability.

```{r, du9 Herd 5 to 9 yo cutblock effect plot, echo = F, message = F, eval = T}
ggplot (du9, aes (x = as.factor(pttype), y = distance_to_cut_11to40yo)) +
  geom_boxplot (outlier.colour = "red") +
  labs (title = "Figure 17. Distance to 11 to 40 year old cutblock at available (0) and used (1) locations \n by caribou herds in DU9",
        x = "Available (0) and used (1) locations",
        y = "Distance to cutblock (km)") +
  facet_grid (. ~ HERD_NAME, scales='free_x', space='free_x') +
  theme (strip.text.x = element_text (size = 8),
         plot.title = element_text (size = 12))
```

#### Caribou-Forestry Disturbance Model
The model included a statistically significant (p < 0.05), negative population-level (fixed) effect of roads on caribou distribution (Table 11). The population-level effect of 1 to 4 year old cutblocks was also negative, but weak and not statistically significant (p = 0.95). However, the effect of 5 to 9 year old cutblocks was positive, but not statistically significant (p = 0.06).

```{r, du9 model, echo = T, message = F, eval = F}
# model spec
du9$distance_to_resource_road_scale<-scale(du9$distance_to_resource_road)
du9$distance_to_cut_1to5yo_scale<-scale(du9$distance_to_cut_1to5yo)
du9$distance_to_cut_6to10yo_scale<-scale(du9$distance_to_cut_6to10yo)
du9$distance_to_cut_11to50yo_scale<-scale(du9$distance_to_cut_11to50yo)

model.lme4.du9.cut.rd <- glmer (pttype ~ distance_to_resource_road_scale +
                                         distance_to_cut_1to5yo_scale +
                                         distance_to_cut_6to10yo_scale +
                                         distance_to_cut_11to50yo_scale +
                                        (distance_to_resource_road_scale +
                                         distance_to_cut_1to5yo_scale +
                                         distance_to_cut_6to10yo_scale +
                                         distance_to_cut_11to50yo_scale || HERD_NAME) +                                          (1|year),
                                      data = du9, 
                                      family = binomial (link = "logit"),
                                      verbose = T) 


summary(model.lme4.du9.cut.rd)
Anova(model.lme4.du9.cut.rd,type="III")
# check residuals
binnedplot (fitted (model.lme4.du9.cut.rd), 
             residuals(model.lme4.du9.cut.rd, type = "response"), 
             nclass = NULL, 
             xlab = "Expected Values", 
             ylab = "Average residual", 
             main = "DU9 Model Binned Residual Plot", 
             cex.pts = 0.4, 
             col.pts = 1, 
             col.int = "red")
```

```{r, du9 model fixed effects coeffs, echo = F, message = F, eval = T}
# model.coeffs <- as.data.frame (coef (summary (model.lme4.du9.cut.rd.fxn)))
du9.fe <- read.csv (here ("R/caribou_habitat/data", "table_du9_model_fixed_coeffs_v4.csv"))
kable (du9.fe,
       caption = "<b>Table 11. Fixed Effect Coefficients of the DU9 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)
```

Random effects in the DU9 model indicated that caribou avoided roads consistently across herds, although there was variability in the strength of avoidance (Table 12, Fig. 27). There was variability in use of areas close to 1 to 4 year cutblocks across herds, where caribou in the South Selkirks herd used areas closer to cutblocks and caribou in the Hart Ranges and Nakusp avoided cutblocks (Fig. 28). There was a consitent postivie response to cutblocks 5 to 9 years old across herds (Fig. 29).

```{r, du9 model random effects coeffs, echo = F, message = F, eval = T}
du9.re <- read.csv (here ("R/caribou_habitat/data", "table_du9_model_herd_re_coeffs_v4.csv"))
kable (du9.re,
       caption = "<b>Table 12. Random Effect Herd-Level Coefficients of the DU9 Caribou-Forestry Disturbance Model.<b>",
       digits = 3) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)
```

```{r, du9 figure random and fixed effects roads,  echo = F, message = F, eval = T}
data.pred.road <- read.csv (here ("R/caribou_habitat/data", "data_predict_road.csv"))
data.plot.rd <- as.data.table (data.pred.road)
data.plot.rd <- data.plot.rd [HERD_NAME == "Population" | HERD_NAME == "Nakusp" | 
                              HERD_NAME == "Hart Ranges" | HERD_NAME == "South Selkirks"]
ggplot (data = data.plot.rd,
        aes (x = distance_to_resource_road, 
             y = predict_du9)) +
  geom_line (aes (color = HERD_NAME,
                  linetype = HERD_NAME, 
                  size = HERD_NAME))+
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid", "longdash", "solid", "longdash"))+
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "black", "darkviolet")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.3, 0.3, 1.1, 0.3)) +
  labs (title = "Figure 27. Population and herd level effects of roads on caribou 
habitat use in DU9.",
        x = "Distance to Road (km)",
        y = "Caribou Use") +
  theme_bw ()
```

```{r, du9 figure random and fixed effects cut 1 to 4,  echo = F, message = F, eval = T}
data.pred.cut14 <- read.csv (here ("R/caribou_habitat/data", "data_predict_cut1to4.csv"))
data.plot.c14 <- as.data.table (data.pred.cut14)
data.plot.c14 <- data.plot.c14 [HERD_NAME == "Population" | HERD_NAME == "Nakusp" | 
                                HERD_NAME == "Hart Ranges" | HERD_NAME == "South Selkirks"]
ggplot (data = data.plot.c14,
        aes (x = distance_to_cut_1to4, 
             y = predict_du9)) +
  geom_line (aes (color = HERD_NAME,
                  linetype = HERD_NAME, 
                  size = HERD_NAME))+
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid", "longdash", "solid", "longdash"))+
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "black", "darkviolet")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.3, 0.3, 1.1, 0.3)) +
  labs (title = "Figure 28. Population and herd level effects of 1 to 4 year old cutblocks on 
caribou habitat use in DU9.",
        x = "Distance to 1 to 4 Year Old Cutblock (km)",
        y = "Caribou Use") +
  theme_bw ()

```

```{r, du9 figure random and fixed effects cut 5 to 9,  echo = F, message = F, eval = T}
data.pred.cut59 <- read.csv (here ("R/caribou_habitat/data", "data_predict_cut5to9.csv"))
data.plot.c59 <- as.data.table (data.pred.cut59)
data.plot.c59 <- data.plot.c59 [HERD_NAME == "Population" | HERD_NAME == "Nakusp" | 
                                HERD_NAME == "Hart Ranges" | HERD_NAME == "South Selkirks"]
ggplot (data = data.plot.c59,
        aes (x = distance_to_cut_5to9, 
             y = predict_du9)) +
  geom_line (aes (color = HERD_NAME,
                  linetype = HERD_NAME, 
                  size = HERD_NAME))+
  scale_linetype_manual (name = "Herd Name",
                         values = c ("solid", "longdash", "solid", "longdash"))+
  scale_color_manual (name = "Herd Name",
                      values = c ("red", "dodgerblue", "black", "darkviolet")) +
  scale_size_manual (name = "Herd Name",
                     values = c (0.3, 0.3, 1.1, 0.3)) +
  labs (title = "Figure 29. Population and herd level effects of 5 to 9 year old cutblocks on 
caribou habitat use in DU9.",
        x = "Distance to 5 to 9 Year Old Cutblock (km)",
        y = "Caribou Use") +
  theme_bw ()
```

## Conclusions
Research has repeatedly shown that caribou are negatively influenced by forestry activity. This can include negative density effects, for example, on caribou survival ( [Wittmer et al. 2007](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.1365-2656.2007.01220.x), [Johnson et al. 2015](https://www.sciencedirect.com/science/article/pii/S0006320715001160)), and behavioural effects, for example, on caribou distribution (e.g., [Courbin et al. 2009](https://link.springer.com/article/10.1007/s10980-009-9389-x), [DeCesare et al. 2012](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/11-1610.1), [Mumma et al. 2018](https://www.sciencedirect.com/science/article/pii/S0006320718307225)). Here we built on this evidence and developed a CFDM that empirically related forestry disturbance to caribou distribution. The model provides an indicator of forestry influences on caribou habitat, and thus can be linked to forestry simulator models, i.e., the caribou and land use simualtor (CLUS), to indicate spatial-temporal changes in caribou habitat quality from forestry. 

Our CFDM showed a strong negative effect of resource roads on caribou distribution across DU's. Roads are likely representative of many ecological effects of resource development on caribou. Roads can act as semi-permeable barriers to caribou, resulting in loss of functional habitat due to caribou avoidance of areas near roads ( [Dyer et al. 2001](https://www.jstor.org/stable/3803106), [Dyer et al. 2002](https://www.nrcresearchpress.com/doi/abs/10.1139/z02-060#.XkXNFTFKikw), [Wilson et al. 2016](https://www.sciencedirect.com/science/article/pii/S0006320715302147)). Caribou may also avoid roads to minimize predation risk ( [Dussault et al. 2012](https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2012.1700)), as predators such as wolves and bears may make use of these areas to hunt prey ( [Whittington et al. 2011](https://besjournals.onlinelibrary.wiley.com/doi/full/10.1111/j.1365-2664.2011.02043.x), [Latham et al 2011](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/11-0666.1)). The CFDM does not attempt to  measure or disentangle the effects of these different ecological processes, but it is assumed that the negative relationship between caribou and roads is indicative of these processes.  
                                                                                                                                                                                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                                                                                                                                                                                        In general, the CFDM indicated that the effect of cutblocks on caribou distribution was highly variable and weaker than the effect of roads. For example, caribou in the boreal (DU6), consistently selected cutblcosk 1 to 9 years old, but avoided cutblocks 10 to 40 years old, whereas the effect of 1 to 40 year old cutblocks varied across northern mountain (DU7) herds. Cutblocks can have a negative effect on caribou, as they provide forage for ungulates such as moose, thus supporting higher densities of ungulates and their predators, such as wolves, that then predate on caribou ( [Seip 1992](https://www.nrcresearchpress.com/doi/abs/10.1139/z92-206#.XkXfPTFKikw), [DeCesare et al. 2010](https://zslpublications.onlinelibrary.wiley.com/doi/full/10.1111/j.1469-1795.2009.00328.x), [Serrouya et al. 2017](https://peerj.com/articles/3736/?utm_source=TrendMD&utm_campaign=PeerJ_TrendMD_1&utm_medium=TrendMD)). However, there may be reasons why we detected a weak negative, or sometimes positive effect of cutblocks on caribou in some herds and DU's. First, caribou may use cutblocks periodically throughout the year to access forage. Caribou will select for deciduous shrub species during summer foraging ( [Denryter et al. 2017](https://www.nrcresearchpress.com/doi/full/10.1139/cjz-2016-0114#.XkbFSjFKikw)), and these species tend to increase in cutblocks ( [Strong and Gates 2006](https://www.sciencedirect.com/science/article/pii/S0378112705006456)). Indeed, research in Quebec has found that caribou selected younger cutblocks, presumably because of their forage benefit ( [Dussault et al. 2012](https://royalsocietypublishing.org/doi/pdf/10.1098/rspb.2012.1700)). Second, the negative effect of cutblocks may occur at larger scales, outside of the home range. [DeCesare et al. 2012](https://esajournals.onlinelibrary.wiley.com/doi/abs/10.1890/11-1610.1) found that caribou avoided cutblocks at the range scale (i.e., caribou home ranges occurred in areas with fewer cutblocks), but not within their home ranges. This suggests the negative predation effect of cutblocks occurs at larger scales, that caribou are less likely to establish home ranges in areas with more cutblocks, perhaps because they are avoiding predation risk or they are unable to survive in those areas. Clearly, the effects of cutblocks on caribou distribution is more nuanced than roads, and the CFDM appears to represent these nuanced effects by representing a variable effect of cutblocks on caribou across herds and DUs.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            The CFDM provides a framework for testing the effects of simulated future forestry activities on caribou. It includes random effects to account for individual and herd-level variability in caribou responses to cutblocks and roads, which provides a great deal of flexibility in estimating the effects of proposed future forestry activities on caribou. This model has been incorporated into the rsfCLUS module of the CLUS model.
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                                            Future work will focus on developing a similar model that accounts for the effects of roads and cutblocks at a larger scale, i.e., on the establishment of home rages by cariobu. In addition, we are relating these models to caribou population measures (e.g., trend) at a herd scale to assess their utility as indicators of caribou population responses to forestry disturbance.  