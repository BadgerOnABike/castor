---
title: "Create_probability_maps_ignition_escape_spread"
author: "Elizabeth Kleynhans"
date: "2023-01-31"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
source(here::here("R/functions/R_Postgres.R"))
library(data.table)
library(sf)
library(tidyverse)
library(rgeos)

```

# Import the data and fire regime types layer
```{r}
dat<-st_read( "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\BC_all_dat_400m_final.gpkg")
#dat<-st_transform(dat, 3005)
dat$frt[dat$frt==3]<-5

# for escaped fires I combine frt 9 and 11 because the number of escaped fires are very small and this bolsters my sample size. I dont do it for the others though because I think the fire dynamics are a little different in the two different areas and so its better to leave them separate. 
dat$frt_escape<-dat$frt
dat$frt_escape[dat$frt_escape==9]<-11
head(dat)

dat2<- dat %>% dplyr::select(idno, frt, frt_escape, FWI_veg, bclcs_level_5)
names(dat2)
table(dat2$frt, dat2$FWI_veg)

no_ignition1<-dat2 %>% 
  filter(FWI_veg =="W")

ignition1<-dat2 %>% 
  filter(FWI_veg !="W")

no_ignition2<-ignition1 %>% 
  filter(bclcs_level_5 %in% c("GL", "LA"))

no_ignition<-rbind(no_ignition1, no_ignition2)

ignition2<-ignition1 %>% 
  filter(!bclcs_level_5 %in% c("GL", "LA"))

```

```{r}
clim2010_2060<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_4GCMsM.csv")

clim2060_2100<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_2GCMsM.csv")


clim2020<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_Year_2020M.csv")

clim2021<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_Year_2021M.csv")

clim2024<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_8GCMs_ensemble_ssp370_2024M.csv")

clim2029<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_8GCMs_ensemble_ssp370_2029M.csv")

clim2034<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_8GCMs_ensemble_ssp370_2034M.csv")

clim2039<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_8GCMs_ensemble_ssp370_2039M.csv")

clim2044<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_8GCMs_ensemble_ssp370_2044M.csv")

clim2049<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\Future_climate_bc\\bc_dem_frt_8GCMs_ensemble_ssp370_2049M.csv")
```

```{r}
 # Lightning caused fires

clim<-clim2010_2060 %>% filter (Year=="8GCMs_ensemble_ssp370_2041-2060.gcm")

clim$mean_Tave05_Tave06_Tave07_Tave08 <- (clim$Tave05 + clim$Tave06 + clim$Tave07 + clim$Tave08)/4
clim$mean_PPT05_PPT06_PPT07_PPT08<-(clim$PPT05 + clim$PPT06 + clim$PPT07 + clim$PPT08)/4

clim$meanRH05_RH06_RH07<-(clim$RH05 + clim$RH06 + clim$RH07)/3

clim$mean_Tave07_Tave08_Tave09 <- (clim$Tave07 + clim$Tave08 + clim$Tave09)/3
clim$mean_PPT07_PPT08_PPT09<-(clim$PPT07 + clim$PPT08 + clim$PPT09)/3
clim$mean_Tmax07_Tmax08_Tmax09<-(clim$Tmax07 + clim$Tmax08 + clim$Tmax09)/3

clim$mean_Tmax07_Tmax08<-(clim$Tmax07 + clim$Tmax08)/2

clim$mean_Tave07_Tave08<- (clim$Tave07 + clim$Tave08)/2

clim$mean_Tave06_Tave07_Tave08 <- (clim$Tave06 + clim$Tave07 + clim$Tave08)/3
clim$mean_PPT06_PPT07_PPT08 <- (clim$PPT06 + clim$PPT07 + clim$PPT08)/3

# ignition person
clim$mean_PPT06_PPT07 <-(clim$PPT06 + clim$PPT07)/2

clim$mean_Tave04_Tave05_Tave06_Tave07_Tave08_Tave09_Tave10<-(clim$Tave04 + clim$Tave05 + clim$Tave06 + clim$Tave07 +clim$Tave08 + clim$Tave09 + clim$Tave10)/7

clim$mean_PPT06_PPT07_PPT08_PPT09 <- (clim$PPT06 + clim$PPT07 + clim$PPT08 + clim$PPT09)/4

clim$mean_Tave08_Tave09_Tave10<-(clim$Tave08 + clim$Tave09 + clim$Tave10)/3

clim$mean_Tmax04_Tmax05_Tmax06_Tmax07_Tmax08_Tmax09_Tmax10<-(clim$Tmax04 + clim$Tmax05 + clim$Tmax06 + clim$Tmax07 +clim$Tmax08 + clim$Tmax09 + clim$Tmax10)/7

# escape

clim$mean_PPT06_PPT07_PPT08 <- (clim$PPT06 + clim$PPT07 + clim$PPT08)/3
clim$mean_Tave04_Tave05_Tave06<- (clim$Tave04 + clim$Tave05 + clim$Tave06 )/3
clim$tot_spring_PPT<-clim$PPT04+ clim$PPT05 + clim$PPT06
clim$summer_Tave<-(clim$Tave07+ clim$Tave08 + clim$Tave09)/3
clim$spring_Tave<-(clim$Tave04+ clim$Tave05 + clim$Tave06)/3
clim$tot_summer_PPT<-clim$PPT07+ clim$PPT08 + clim$PPT09
clim$summer_Tmax<-(clim$Tmax07+ clim$Tmax08 + clim$Tmax09)/3
clim$mean_PPT05_PPT06<- (clim$PPT05 + clim$PPT06)/2

#Spread
clim$mean_RH05_RH06_RH07_RH08<-(clim$RH05+clim$RH06+clim$RH07+clim$RH08)/4
clim$mean_PPT05_PPT06_PPT07_PPT08<-(clim$PPT05+ clim$PPT06 + clim$PPT07 + clim$PPT08)/4
clim$mean_PPT05_PPT06_PPT07<- (clim$PPT05+ clim$PPT06 + clim$PPT07)/3


###################################################
# get variables for climate for lightning ignitions
###################################################
clim<-clim %>% dplyr::select(ID1, ID2, mean_Tave05_Tave06_Tave07_Tave08,
                      meanRH05_RH06_RH07,
                      Tmax05,
                      Tave07,
                      mean_Tave07_Tave08_Tave09,
                      mean_Tmax07_Tmax08_Tmax09,
                      mean_Tmax07_Tmax08,
                      mean_Tave07_Tave08, 
                      mean_Tave06_Tave07_Tave08,
                      mean_PPT05_PPT06_PPT07_PPT08,
                      mean_PPT07_PPT08_PPT09,
                      PPT07,
                      mean_PPT06_PPT07_PPT08,
                      mean_PPT06_PPT07,
                      mean_Tave04_Tave05_Tave06_Tave07_Tave08_Tave09_Tave10,
                      Tmax05,
                      mean_PPT06_PPT07_PPT08_PPT09,
                      mean_Tave08_Tave09_Tave10,
                      mean_Tmax04_Tmax05_Tmax06_Tmax07_Tmax08_Tmax09_Tmax10,
                      PPT05,
                      tot_spring_PPT,
                      summer_Tave,
                      spring_Tave,
                      summer_Tmax,
                      mean_PPT05_PPT06,
                      tot_summer_PPT,
                      Tmax07,
                      mean_RH05_RH06_RH07_RH08,
                      PPT08,
                      mean_PPT05_PPT06_PPT07)

names(clim)
```


```{r}

ignition2$frt<-as.numeric(as.character(ignition2$frt))

clim<-clim %>% rename(idno=ID1,
                      frt=ID2)

clim<-left_join(ignition2, clim, by=c("idno", "frt"))


head(clim)

table(is.na(clim$Tmax07))
```


# get climate variables to combinations needed for models
```{r}
dat2<-clim

#If you need to open the table listing the top climate
climate_variables_lightning<-read.csv("C:/Work/caribou/castor_data/Fire/Fire_sim_data/data/climate_AIC_results_lightning_FRT_summary.csv")

climate_variables_person<-read.csv("C:/Work/caribou/castor_data/Fire/Fire_sim_data/data/climate_AIC_results_person_FRT_summary.csv")

climate_escape<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\climate_AIC_results_escape_summary_March2023.csv")

climate_variables_lightning
climate_variables_person


dat2$climate1_lightning<-"NA"
dat2<-dat2 %>%
    mutate(climate1_lightning = case_when(
                            frt == "5" ~ mean_Tave05_Tave06_Tave07_Tave08 ,
                            frt == "7" ~ meanRH05_RH06_RH07,
                            frt == "9" ~ Tmax05,
                            frt == "10" ~ mean_Tave07_Tave08_Tave09 ,
                            frt == "11" ~ mean_Tmax07_Tmax08_Tmax09,
                            frt == "12" ~ mean_Tmax07_Tmax08,
                            frt == "13" ~ Tave07,
                            frt == "14" ~ mean_Tave07_Tave08,
                            frt == "15" ~ mean_Tave06_Tave07_Tave08 ,
                            TRUE ~ NA_real_))

#Repeat for climate 2
dat2$climate2_lightning<-"NA"
# # 

dat2 <- dat2 %>%
  mutate(climate2_lightning = if_else(frt==5, mean_PPT05_PPT06_PPT07_PPT08,
                            if_else(frt==10, mean_PPT07_PPT08_PPT09,
                                    if_else(frt==11, mean_PPT07_PPT08_PPT09,
                                    if_else(frt==13, as.numeric(PPT07),
                                            if_else(frt==15, mean_PPT06_PPT07_PPT08, NA_real_))))))

###################################################
# get variables for climate for human ignitions
###################################################
dat2$climate1_person<-"NA"
dat2<-dat2 %>%
    mutate(climate1_person = case_when(
                                frt == "5" ~ as.numeric(mean_PPT06_PPT07),
                                frt == "7" ~ mean_Tave04_Tave05_Tave06_Tave07_Tave08_Tave09_Tave10,
                                frt == "9" ~ Tmax05, # NDT4
                                frt == "10" ~ mean_PPT06_PPT07_PPT08_PPT09,
                                frt == "11" ~ mean_Tave08_Tave09_Tave10,
                                frt == "12" ~ mean_Tmax04_Tmax05_Tmax06_Tmax07_Tmax08_Tmax09_Tmax10,
                                frt == "13" ~ mean_Tave07_Tave08_Tave09,
                                frt == "14" ~ mean_Tmax04_Tmax05_Tmax06_Tmax07_Tmax08_Tmax09_Tmax10,
                                frt == "15" ~ mean_Tave07_Tave08_Tave09,
                               TRUE ~ NA_real_))

# #Repeat for climate 2
 dat2$climate2_person<-"NA"
dat2<-dat2 %>%
    mutate(climate2_person = case_when(
                                frt == "13" ~ as.numeric(mean_PPT07_PPT08_PPT09),
                                frt == "15" ~ as.numeric(mean_PPT07_PPT08_PPT09),
                               TRUE ~ NA_real_))

###############
##escape
###############
climate_escape<-read.csv("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\climate_AIC_results_escape_summary_March2023.csv")
dat2$climate1_escape<-"NA"

names(dat2)

dat2<-dat2 %>%
    mutate(climate1_escape = case_when(
                            frt_escape == "5" ~ as.numeric(PPT05) ,
                            frt_escape == "7" ~ as.numeric(mean_PPT06_PPT07_PPT08),
                            #frt_escape == "9" ~ Tave05,
                            frt_escape == "10" ~ as.numeric(tot_spring_PPT),
                            frt_escape == "11" ~ summer_Tave,
                            frt_escape == "12" ~ spring_Tave,
                            frt_escape == "13" ~ summer_Tmax,
                            frt_escape == "14" ~ as.numeric(mean_PPT05_PPT06),
                            frt_escape == "15" ~ summer_Tave ,
                            TRUE ~ NA_real_))

#Repeat for climate 2
dat2$climate2_escape<-"NA"

dat2<-dat2 %>%
    mutate(climate2_escape = case_when(
                            frt_escape == "12" ~ as.numeric(tot_spring_PPT) ,
                            frt_escape == "13" ~ as.numeric(tot_summer_PPT),
                            frt_escape == "15" ~ as.numeric(tot_summer_PPT),
                            TRUE ~ NA_real_))

###################
##Spread
###################
dat2<-dat2 %>%
    mutate(climate1_spread = case_when(
                            frt == "5" ~ Tmax07 ,
                            frt == "7" ~ summer_Tmax,
                            frt == "9" ~ spring_Tave,
                            frt == "10" ~ as.numeric(mean_RH05_RH06_RH07_RH08),
                            frt == "11" ~ as.numeric(PPT08),
                            frt == "12" ~  as.numeric(mean_PPT05_PPT06_PPT07_PPT08),
                            frt == "13" ~  as.numeric(mean_PPT05_PPT06_PPT07_PPT08),
                            frt == "14" ~  as.numeric(mean_PPT05_PPT06_PPT07),
                            frt == "15" ~ summer_Tave ,
                            TRUE ~ NA_real_))

#Repeat for climate 2

dat2<-dat2 %>%
    mutate(climate2_spread = case_when(
                            frt == "5" ~ as.numeric(PPT07),
                            frt == "7" ~ as.numeric(tot_summer_PPT),
                            frt == "9" ~ as.numeric(tot_spring_PPT),
                            frt == "10" ~ as.numeric(mean_PPT05_PPT06_PPT07_PPT08) ,
                            #frt == "11" ~ as.numeric(PPT08),
                            #frt == "12" ~ as.numeric(mean_PPT05_PPT06_PPT07_PPT08),
                            #frt == "13" ~ as.numeric(mean_PPT05_PPT06_PPT07_PPT08),
                            frt == "14" ~ as.numeric(mean_PPT05_PPT06_PPT07),
                            frt == "15" ~ as.numeric(tot_summer_PPT),
                            TRUE ~ NA_real_))

head(dat2)
```

# create dummy variables for FWI_veg
```{r}
#########################################################
# create dummy variables for FWI_veg
dat2$veg_C1 <- ifelse(dat2$FWI_veg == 'C-1', 1, 0)
dat2$veg_C2 <- ifelse(dat2$FWI_veg == 'C-2', 1, 0)
dat2$veg_C3 <- ifelse(dat2$FWI_veg == 'C-3', 1, 0)
dat2$veg_C4 <- ifelse(dat2$FWI_veg == 'C-4', 1, 0)
dat2$veg_C5 <- ifelse(dat2$FWI_veg == 'C-5', 1, 0)
dat2$veg_C7 <- ifelse(dat2$FWI_veg == 'C-7', 1, 0)
dat2$veg_D12 <- ifelse(dat2$FWI_veg == 'D-1/2', 1, 0)
dat2$veg_M12 <- ifelse(dat2$FWI_veg == 'M-1/2', 1, 0)
dat2$veg_M3 <- ifelse(dat2$FWI_veg == 'M-3', 1, 0)
dat2$veg_N <- ifelse(dat2$FWI_veg == 'N', 1, 0)
dat2$veg_O1ab <- ifelse(dat2$FWI_veg == 'O-1a/b', 1, 0)
dat2$veg_S1 <- ifelse(dat2$FWI_veg == 'S-1', 1, 0)
dat2$veg_S2 <- ifelse(dat2$FWI_veg == 'S-2', 1, 0)
dat2$veg_S3 <- ifelse(dat2$FWI_veg == 'S-3', 1, 0)
#dat2$veg_W <- ifelse(dat2$FWI_veg == 'W', 1, 0)

```


### FRT 5
```{r}
frt5<- dat2 %>% filter(frt==5)
table(is.na(frt5$PPT05))

table(frt5$FWI_veg)

#NOTE C-2 is the intercept
frt5$veg_C7 <- ifelse(frt5$FWI_veg == 'C-5', 1, frt5$veg_C7) # change C-5 to C-7
frt5$veg_C2 <- ifelse(frt5$FWI_veg == 'C-4', 1, frt5$veg_C2) # change C-4 to C-2
frt5$veg_M12 <- ifelse(frt5$FWI_veg == 'S-1', 1, frt5$veg_M12) # change S-1 to M-1/2
frt5$veg_C7 <- ifelse(frt5$FWI_veg == 'S-2', 1, frt5$veg_C7)
frt5$veg_O1ab <- ifelse(frt5$FWI_veg == 'N', 1, frt5$veg_O1ab)

model_coef_table_lightning<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt5_lightning.csv")

model_coef_table_lightning

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_lightning<- 
  model_coef_table_lightning$coef_climate_2*frt5$climate2_lightning  +
  model_coef_table_lightning$coef_FWI_veg_C.1*frt5$veg_C1 +
  model_coef_table_lightning$coef_FWI_veg_C.3*frt5$veg_C3 +
  model_coef_table_lightning$coef_FWI_veg_C.7*frt5$veg_C7 +
  model_coef_table_lightning$coef_FWI_veg_D.1.2*frt5$veg_D12 +
  model_coef_table_lightning$coef_FWI_veg_M.1.2*frt5$veg_M12 +
  model_coef_table_lightning$coef_FWI_veg_O.1a.b*frt5$veg_O1ab 

####################################
# PErson ignitions
frt5<- dat2 %>% filter(frt==5)

model_coef_table_person<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT5_person.csv")

model_coef_table_person

logit_P_person<-
  model_coef_table_person[[3]]*frt5$climate1_person 


##########################
# probability of escape

frt5<- dat2 %>% filter(frt==5)

model_coef_table_escape<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt5_escape.csv")

model_coef_table_escape

table(frt5$FWI_veg)

frt5$veg_D12 <- ifelse(frt5$FWI_veg == 'C-5', 1, frt5$veg_D12) # change C-5 to C-7
frt5$veg_C2 <- ifelse(frt5$FWI_veg == 'C-4', 1, frt5$veg_C2) # change C-4 to C-2
frt5$veg_D12 <- ifelse(frt5$FWI_veg == 'C-7', 1, frt5$veg_D12)
frt5$veg_M12 <- ifelse(frt5$FWI_veg == 'S-1', 1, frt5$veg_M12)
frt5$veg_M12 <- ifelse(frt5$FWI_veg == 'S-2', 1, frt5$veg_M12)

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_escape<- 
  model_coef_table_escape$coef_climate_1*frt5$climate1_escape +
  model_coef_table_escape$coef_FWI_veg_C.2*frt5$veg_C2 +
  model_coef_table_escape$coef_FWI_veg_C.3*frt5$veg_C3 +
  model_coef_table_escape$coef_FWI_veg_D.1.2*frt5$veg_D12 +
  model_coef_table_escape$coef_FWI_veg_M.1.2*frt5$veg_M12 +
  model_coef_table_escape$coef_FWI_veg_O.1a.b*frt5$veg_O1ab 
  

##################################
# spread probabilities

frt5<- dat2 %>% filter(frt==5)

model_coef_table_spread<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt5_spread.csv")

model_coef_table_spread

table(frt5$FWI_veg)
frt5$veg_C2 <- ifelse(frt5$FWI_veg == 'C-4', 1, frt5$veg_C2) # change C-4 to C-2
frt5$veg_M12 <- ifelse(frt5$FWI_veg == 'S-1', 1, frt5$veg_M12)

logit_P_spread<- 
  model_coef_table_spread$coef_PPT07*frt5$PPT07 +
  model_coef_table_spread$coef_FWI_veg_C.2*frt5$veg_C2 +
  model_coef_table_spread$coef_FWI_veg_C.3*frt5$veg_C3 +
  model_coef_table_spread$coef_FWI_veg_C.5*frt5$veg_C5 +
  model_coef_table_spread$coef_FWI_veg_C.7*frt5$veg_C7 +
  model_coef_table_spread$coef_FWI_veg_D.1.2*frt5$veg_D12 +
  model_coef_table_spread$coef_FWI_veg_M.1.2*frt5$veg_M12 +
  model_coef_table_spread$coef_FWI_veg_M.3*frt5$veg_M3 +
  model_coef_table_spread$coef_FWI_veg_N*frt5$veg_N +
  model_coef_table_spread$coef_FWI_veg_O.1a.b*frt5$veg_O1ab +
  model_coef_table_spread$coef_FWI_veg_S.2*frt5$veg_S2
  
logit_P_spread

frt5$varying_coef_lightning<-logit_P_lightning
frt5$varying_coef_person<-logit_P_person
frt5$varying_coef_escape<-logit_P_escape
frt5$varying_coef_spread<-logit_P_spread

# in two of the models I had to make the N's have a probability of zero.
frt5$varying_coef_lightning[frt5$FWI_veg=="N"]<-0
frt5$varying_coef_escape[frt5$FWI_veg=="N"]<-0

rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread, logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()
```

## FRT 7
```{r}
frt7<- dat2 %>% filter(frt==7)

table(frt7$FWI_veg)

#NOTE C-2 is the intercept
frt7$veg_C2 <- ifelse(frt7$FWI_veg == 'C-4', 1, frt7$veg_C2)
frt7$veg_D12 <- ifelse(frt7$FWI_veg == 'C-7', 1, frt7$veg_D12)
frt7$veg_D12 <- ifelse(frt7$FWI_veg == 'C-5', 1, frt7$veg_D12)
frt7$veg_M12 <- ifelse(frt7$FWI_veg == 'S-1', 1, frt7$veg_M12)
frt7$veg_M12 <- ifelse(frt7$FWI_veg == 'S-2', 1, frt7$veg_M12)

model_coef_table_lightning<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt7_lightning.csv")

model_coef_table_lightning

logit_P_lightning<- 
  model_coef_table_lightning$coef_climate_1*frt7$climate1_lightning +
  model_coef_table_lightning$coef_FWI_veg_C.1*frt7$veg_C1 +
  model_coef_table_lightning$coef_FWI_veg_C.3*frt7$veg_C3 +
  model_coef_table_lightning$coef_FWI_veg_D.1.2*frt7$veg_D12 +
  model_coef_table_lightning$coef_FWI_veg_M.1.2*frt7$veg_M12 +
  model_coef_table_lightning$coef_FWI_veg_O.1a.b*frt7$veg_O1ab

#####################
# Ignition Person
frt7<- dat2 %>% filter(frt==7) # I wipe this clean everytime because I change some dummy fields a round and I dont want those changes to be reflected in the next model. 

model_coef_table_person<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT7_person.csv")

model_coef_table_person

table(frt7$FWI_veg)
frt7$veg_C2 <- ifelse(frt7$FWI_veg == 'C-4', 1, frt7$veg_C2)
frt7$veg_C7 <- ifelse(frt7$FWI_veg == 'C-5', 1, frt7$veg_C7)
frt7$veg_M12 <- ifelse(frt7$FWI_veg == 'S-1', 1, frt7$veg_M12)
frt7$veg_M12 <- ifelse(frt7$FWI_veg == 'S-2', 1, frt7$veg_M12)

logit_P_person<-
  model_coef_table_person$coef_climate1*frt7$climate1_person +
  model_coef_table_person$coef_FWI_veg_C.2*frt7$veg_C2 +
  model_coef_table_person$coef_FWI_veg_C.3*frt7$veg_C3 +
  model_coef_table_person$coef_FWI_veg_C.7*frt7$veg_C7 +
  model_coef_table_person$coef_FWI_veg_D.1.2*frt7$veg_D12 +
  model_coef_table_person$coef_FWI_veg_M.1.2*frt7$veg_M12 +
  model_coef_table_person$coef_FWI_veg_M.3*frt7$veg_M3 +
  model_coef_table_person$coef_FWI_veg_N*frt7$veg_N +
  model_coef_table_person$coef_FWI_veg_O.1a.b*frt7$veg_O1ab 


###################
# escape
frt7<- dat2 %>% filter(frt==7)
table(frt7$FWI_veg)

frt7$veg_C2 <- ifelse(frt7$FWI_veg == 'C-4', 1, frt7$veg_C2)
frt7$veg_D12 <- ifelse(frt7$FWI_veg == 'C-5', 1, frt7$veg_D12)
frt7$veg_D12 <- ifelse(frt7$FWI_veg == 'C-7', 1, frt7$veg_D12)
frt7$veg_M12 <- ifelse(frt7$FWI_veg == 'S-1', 1, frt7$veg_M12)
frt7$veg_M12 <- ifelse(frt7$FWI_veg == 'S-2', 1, frt7$veg_M12)

model_coef_table_escape<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt7_escape.csv")

model_coef_table_escape

logit_P_escape<- 
  model_coef_table_escape$coef_climate_1*frt7$climate1_escape +
  model_coef_table_escape$coef_FWI_veg_C.2*frt7$veg_C2 +
  model_coef_table_escape$coef_FWI_veg_C.3*frt7$veg_C3 +
  model_coef_table_escape$coef_FWI_veg_D.1.2*frt7$veg_D12 +
  model_coef_table_escape$coef_FWI_veg_M.1.2*frt7$veg_M12 +
  model_coef_table_escape$coef_FWI_veg_N*frt7$veg_N +
  model_coef_table_escape$coef_FWI_veg_O.1a.b*frt7$veg_O1ab 

######################
## spread

frt7<- dat2 %>% filter(frt==7)

model_coef_table_spread<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt7_spread.csv")

model_coef_table_spread
table(frt7$FWI_veg)
frt7$veg_C2 <- ifelse(frt7$FWI_veg == 'C-4', 1, frt7$veg_C2)
frt7$veg_C7 <- ifelse(frt7$FWI_veg == 'C-5', 1, frt7$veg_C7)
frt7$veg_O1ab <- ifelse(frt7$FWI_veg == 'M-3', 1, frt7$veg_O1ab)

logit_P_spread<- model_coef_table_spread$coef_summer_Tmax*frt7$summer_Tmax +
  model_coef_table_spread$coef_tot_summer_PPT*frt7$tot_summer_PPT +
  model_coef_table_spread$coef_FWI_veg_C.2*frt7$veg_C2 +
  model_coef_table_spread$coef_FWI_veg_C.3*frt7$veg_C3 +
  model_coef_table_spread$coef_FWI_veg_C.7*frt7$veg_C7 +
  model_coef_table_spread$coef_FWI_veg_D.1.2*frt7$veg_D12 +
  model_coef_table_spread$coef_FWI_veg_M.1.2*frt7$veg_M12 +
  model_coef_table_spread$coef_FWI_veg_N*frt7$veg_N +
  model_coef_table_spread$coef_FWI_veg_O.1a.b*frt7$veg_O1ab +
  model_coef_table_spread$coef_FWI_veg_S.1*frt7$veg_S1 +
  model_coef_table_spread$coef_FWI_veg_S.2*frt7$veg_S2

frt7$varying_coef_lightning<-logit_P_lightning
frt7$varying_coef_person<-logit_P_person
frt7$varying_coef_escape<-logit_P_escape
frt7$varying_coef_spread<-logit_P_spread

frt7$varying_coef_lightning[frt7$FWI_veg=="N"]<-0


rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread, logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()

```

## FRT9

```{r}
frt9<- dat2 %>% filter(frt==9)

table(is.na(frt9$climate1_lightning))

table(frt9$FWI_veg)
#NOTE C-3 is the intercept
frt9$veg_C2 <- ifelse(frt9$FWI_veg == 'C-4', 1, frt9$veg_C2)
frt9$veg_M12 <- ifelse(frt9$FWI_veg == 'D-1/2', 1, frt9$veg_M12)
frt9$veg_C7 <- ifelse(frt9$FWI_veg == 'C-5', 1, frt9$veg_C7)
frt9$veg_M12 <- ifelse(frt9$FWI_veg == 'S-1', 1, frt9$veg_M12)

model_coef_table_lightning<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt9_lightning.csv")
model_coef_table_lightning

logit_P_lightning<- 
  model_coef_table_lightning$coef_climate_1*frt9$climate1_lightning +
  model_coef_table_lightning$coef_FWI_veg_C.1*frt9$veg_C1 +
  model_coef_table_lightning$coef_FWI_veg_C.2*frt9$veg_C2 +
  model_coef_table_lightning$coef_FWI_veg_C.7*frt9$veg_C7 +
  model_coef_table_lightning$coef_FWI_veg_M.1.2*frt9$veg_M12 +
  model_coef_table_lightning$coef_FWI_veg_N*frt9$veg_N +
  model_coef_table_lightning$coef_FWI_veg_O.1a.b*frt9$veg_O1ab


######################################3
# person caused ignitions

frt9<- dat2 %>% filter(frt==9)
#table(is.na(frt9$climate1_lightning))

model_coef_table_person<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt9_person.csv")
model_coef_table_person

logit_P_person<-
  model_coef_table_person$coef_climate_1*frt9$climate1_person 
logit_P_person

##################################
# escape
frt9<- dat2 %>% filter(frt==9)
#table(is.na(frt9$climate1_lightning))

model_coef_table_escape<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt11_escape.csv")

model_coef_table_escape

logit_P_escape<- 
  model_coef_table_escape$coef_climate_1*frt9$climate1_escape 
logit_P_escape

################################3
# spread
frt9<- dat2 %>% filter(frt==9)

model_coef_table_spread<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt9_spread.csv")

model_coef_table_spread
table(frt9$FWI_veg)

frt9$veg_C2 <- ifelse(frt9$FWI_veg == 'C-4', 1, frt9$veg_C2)
frt9$veg_C7 <- ifelse(frt9$FWI_veg == 'C-5', 1, frt9$veg_C7)
frt9$veg_M12 <- ifelse(frt9$FWI_veg == 'S-1', 1, frt9$veg_M12)

logit_P_spread<- 
  model_coef_table_spread$coef_spring_Tave*frt9$spring_Tave +
  model_coef_table_spread$coef_tot_spring_PPT*frt9$tot_spring_PPT +
  model_coef_table_spread$coef_FWI_veg_C.2*frt9$veg_C2 +
  model_coef_table_spread$coef_FWI_veg_C.3*frt9$veg_C3 +
  model_coef_table_spread$coef_FWI_veg_C.7*frt9$veg_C7 +
  model_coef_table_spread$coef_FWI_veg_D.1.2*frt9$veg_D12 +
  model_coef_table_spread$coef_FWI_veg_M.1.2*frt9$veg_M12 +
  model_coef_table_spread$coef_FWI_veg_N*frt9$veg_N +
  model_coef_table_spread$coef_FWI_veg_O.1a.b*frt9$veg_O1ab

frt9$varying_coef_lightning<-logit_P_lightning
frt9$varying_coef_person<-logit_P_person
frt9$varying_coef_escape<-logit_P_escape
frt9$varying_coef_spread<-logit_P_spread


rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread, logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()

```

## FRT10
```{r}
frt10<- dat2 %>% filter(frt==10)

model_coef_table_lightning<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT10_lightning.csv")

model_coef_table_lightning
table(frt10$FWI_veg)

frt10$veg_C3 <- ifelse(frt10$FWI_veg == 'C-1', 1, frt10$veg_C3)
frt10$veg_C2 <- ifelse(frt10$FWI_veg == 'C-4', 1, frt10$veg_C2)
frt10$veg_M12 <- ifelse(frt10$FWI_veg == 'S-1', 1, frt10$veg_M12)
frt10$veg_M12 <- ifelse(frt10$FWI_veg == 'S-2', 1, frt10$veg_M12)

logit_P_lightning<- 
  model_coef_table_lightning$coef_climate_1*frt10$climate1_lightning +
  model_coef_table_lightning$coef_climate_2*frt10$climate2_lightning +
  model_coef_table_lightning$coef_FWI_veg_C.3*frt10$veg_C3 +
  model_coef_table_lightning$coef_FWI_veg_C.5*frt10$veg_C5 +
  model_coef_table_lightning$coef_FWI_veg_C.7*frt10$veg_C7 +
  model_coef_table_lightning$coef_FWI_veg_D.1.2*frt10$veg_D12 +
  model_coef_table_lightning$coef_FWI_veg_M.1.2*frt10$veg_M12 +
  model_coef_table_lightning$coef_FWI_veg_N*frt10$veg_N +
  model_coef_table_lightning$coef_FWI_veg_O.1a.b*frt10$veg_O1ab

logit_P_lightning

########################################
# Person
frt10<- dat2 %>% filter(frt==10)

#NOTE C-2 is the intercept
model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT10_person.csv")
model_coef_table
table(frt10$FWI_veg)

frt10$veg_C3 <- ifelse(frt10$FWI_veg == 'C-1', 1, frt10$veg_C3)
frt10$veg_C2 <- ifelse(frt10$FWI_veg == 'C-4', 1, frt10$veg_C2)
frt10$veg_C2 <- ifelse(frt10$FWI_veg == 'S-1', 1, frt10$veg_C2)
frt10$veg_C7 <- ifelse(frt10$FWI_veg == 'S-2', 1, frt10$veg_C7)
frt10$veg_C5 <- ifelse(frt10$FWI_veg == 'M-1/2', 1, frt10$veg_C5)
frt10$veg_C3 <- ifelse(frt10$FWI_veg == 'O-1a/b', 1, frt10$veg_C3)

logit_P_person<-
  model_coef_table$coef_climate_1*frt10$climate1_person +
  model_coef_table$coef_FWI_veg_C.3*frt10$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt10$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt10$veg_C7 +
  model_coef_table$coef_FWI_veg_N*frt10$veg_N

#################################
# escape
frt10<- dat2 %>% filter(frt==10)

model_coef_table_escape<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt10_escape.csv")
model_coef_table_escape

logit_P_escape<-
  model_coef_table_escape$coef_climate_1*frt10$climate1_escape 

logit_P_escape
rm(frt10)

###########################
# Spread

frt10<- dat2 %>% filter(frt==10)

model_coef_table_spread<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt10_spread.csv")
model_coef_table_spread
table(frt10$FWI_veg)

frt10$veg_C2 <- ifelse(frt10$FWI_veg == 'C-4', 1, frt10$veg_C2)
frt10$veg_C7 <- ifelse(frt10$FWI_veg == 'S-2', 1, frt10$veg_C7)

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_spread<- 
  model_coef_table_spread$coef_climate1*frt10$climate1_spread +
  model_coef_table_spread$coef_climate2*frt10$climate2_spread + 
  model_coef_table_spread$coef_FWI_veg_C.2*frt10$veg_C2 +
  model_coef_table_spread$coef_FWI_veg_C.3*frt10$veg_C3 +
  model_coef_table_spread$coef_FWI_veg_C.5*frt10$veg_C5 +
  model_coef_table_spread$coef_FWI_veg_C.7*frt10$veg_C7 +
  model_coef_table_spread$coef_FWI_veg_D.1.2*frt10$veg_D12 +
  model_coef_table_spread$coef_FWI_veg_M.1.2*frt10$veg_M12 +
  model_coef_table_spread$coef_FWI_veg_N*frt10$veg_N +
  model_coef_table_spread$coef_FWI_veg_O.1a.b*frt10$veg_O1ab +
  model_coef_table_spread$coef_FWI_veg_S.1*frt10$veg_S1

logit_P_spread

frt10$varying_coef_lightning<-logit_P_lightning
frt10$varying_coef_person<-logit_P_person
frt10$varying_coef_escape<-logit_P_escape
frt10$varying_coef_spread<-logit_P_spread

rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread,  logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()

```


## FRT 11 

```{r}
frt11<- dat2 %>% filter(frt==11)

#NOTE C-3 is the intercept
table(frt11$FWI_veg)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT11_lightning.csv")
model_coef_table

frt11$veg_C7 <- ifelse(frt11$FWI_veg == 'C-5', 1, frt11$veg_C7)
frt11$veg_C7 <- ifelse(frt11$FWI_veg == 'D-1/2', 1, frt11$veg_C7)
frt11$veg_M12 <- ifelse(frt11$FWI_veg == 'S-1', 1, frt11$veg_M12)
frt11$veg_M12 <- ifelse(frt11$FWI_veg == 'S-2', 1, frt11$veg_M12)
frt11$veg_M12 <- ifelse(frt11$FWI_veg == 'S-3', 1, frt11$veg_M12)
frt11$veg_C3 <- ifelse(frt11$FWI_veg == 'O-1a/b', 1, frt11$veg_C3)

#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

logit_P_lightning<-
  model_coef_table$coef_climate_1*frt11$climate1_lightning +
  model_coef_table$coef_climate_2*frt11$climate2_lightning +
  model_coef_table$coef_FWI_veg_C.1*frt11$veg_C1 +
  model_coef_table$coef_FWI_veg_C.2*frt11$veg_C2 +
  model_coef_table$coef_FWI_veg_C.7*frt11$veg_C7 +
  model_coef_table$coef_FWI_veg_M.1.2*frt11$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt11$veg_N


##########################
#Person

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt11_person.csv")
model_coef_table

logit_P_person<-
  model_coef_table$coef_climate_1*frt11$climate1_person

logit_P_person

################################
# Escape
model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt11_escape.csv")
model_coef_table

logit_P_escape<- 
  model_coef_table$coef_climate_1*frt11$climate1_escape

logit_P_escape

##########################
# Spread
frt11<- dat2 %>% filter(frt==11)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt11_spread.csv")

model_coef_table
table(frt11$FWI_veg)

frt11$veg_C7 <- ifelse(frt11$FWI_veg == 'S-2', 1, frt11$veg_C7)
frt11$veg_M12 <- ifelse(frt11$FWI_veg == 'S-1', 1, frt11$veg_M12)
frt11$veg_M12 <- ifelse(frt11$FWI_veg == 'S-3', 1, frt11$veg_M12)

logit_P_spread<- 
  model_coef_table$coef_PPT08*frt11$PPT08 +
  model_coef_table[[10]]*frt11$veg_C2 +
  model_coef_table[[11]]*frt11$veg_C3 +
  model_coef_table[[12]]*frt11$veg_C5 +
  model_coef_table[[13]]*frt11$veg_C7 +
  model_coef_table[[14]]*frt11$veg_D12 +
  model_coef_table[[15]]*frt11$veg_M12 +
  model_coef_table[[16]]*frt11$veg_N +
  model_coef_table[[17]]*frt11$veg_O1ab 

logit_P_spread

frt11$varying_coef_lightning<-logit_P_lightning
frt11$varying_coef_person<-logit_P_person
frt11$varying_coef_escape<-logit_P_escape
frt11$varying_coef_spread<-logit_P_spread

rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread,  logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()

```

## FRT 12

```{r}
frt12<- dat2 %>% filter(frt==12)

#NOTE C-1 is the intercept
table(frt12$FWI_veg)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT12_lightning.csv")
model_coef_table

frt12$veg_S1 <- ifelse(frt12$FWI_veg == 'S-3', 1, frt12$veg_S1)

#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

logit_P_lightning<-
  model_coef_table$coef_climate_1*frt12$climate1_lightning +
  model_coef_table$coef_FWI_veg_C.2*frt12$veg_C2 +
  model_coef_table$coef_FWI_veg_C.3*frt12$veg_C3 +
  model_coef_table$coef_FWI_veg_C.4*frt12$veg_C4 +
  model_coef_table$coef_FWI_veg_C.5*frt12$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt12$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt12$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt12$veg_M12 +
  model_coef_table$coef_FWI_veg_M.3*frt12$veg_M3 +
  model_coef_table$coef_FWI_veg_N*frt12$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt12$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt12$veg_S1 +
  model_coef_table$coef_FWI_veg_S.2*frt12$veg_S2

logit_P_lightning

##########################
# Person
frt12<- dat2 %>% filter(frt==12)

#NOTE C-2 is the intercept
table(frt12$FWI_veg)

frt12$veg_S1 <- ifelse(frt12$FWI_veg == 'S-3', 1, frt12$veg_S1)
frt12$veg_C7 <- ifelse(frt12$FWI_veg == 'S-2', 1, frt12$veg_C7)
frt12$veg_C3 <- ifelse(frt12$FWI_veg == 'C-1', 1, frt12$veg_C3)
frt12$veg_C2 <- ifelse(frt12$FWI_veg == 'C-4', 1, frt12$veg_C2)
frt12$veg_O1ab <- ifelse(frt12$FWI_veg == 'M-3', 1, frt12$veg_O1ab)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT12_person.csv")
model_coef_table

#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

logit_P_person<- 
  model_coef_table$coef_climate_1*frt12$climate1_person +
  model_coef_table$coef_FWI_veg_C.3*frt12$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt12$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt12$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt12$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt12$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt12$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt12$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt12$veg_S1 
  

logit_P_person

##################################
#escape
frt12<- dat2 %>% filter(frt==12)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt12_escape.csv")

model_coef_table

table(frt12$FWI_veg)

frt12$veg_C2 <- ifelse(frt12$FWI_veg == 'C-4', 1, frt12$veg_C2)
frt12$veg_S1 <- ifelse(frt12$FWI_veg == 'S-3', 1, frt12$veg_S1)
frt12$veg_O1ab <- ifelse(frt12$FWI_veg == 'M-3', 1, frt12$veg_O1ab)
frt12$veg_C7 <- ifelse(frt12$FWI_veg == 'S-2', 1, frt12$veg_C7)

logit_P_escape<- 
  model_coef_table$coef_climate_2*frt12$climate2_escape +
  model_coef_table$coef_FWI_vegC.2*frt12$veg_C2 +
  model_coef_table$coef_FWI_vegC.3*frt12$veg_C3 +
  model_coef_table$coef_FWI_vegC.5*frt12$veg_C5 +
  model_coef_table$coef_FWI_vegC.7*frt12$veg_C7 +
  model_coef_table$coef_FWI_vegD.1.2*frt12$veg_D12 +
  model_coef_table$coef_FWI_vegM.1.2*frt12$veg_M12 +
  model_coef_table$coef_FWI_vegN*frt12$veg_N +
  model_coef_table$coef_FWI_vegO.1a.b*frt12$veg_O1ab +
  model_coef_table$coef_FWI_vegS.1*frt12$veg_S1 

logit_P_escape

########################
# Spread
frt12<- dat2 %>% filter(frt==12)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt12_spread.csv")

model_coef_table
table(frt12$FWI_veg)
frt12$veg_M12 <- ifelse(frt12$FWI_veg == 'S-3', 1, frt12$veg_M12)

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_spread<-
  model_coef_table$coef_mean_PPT05_PPT06_PPT07_PPT08.*frt12$mean_PPT05_PPT06_PPT07_PPT08 +
  model_coef_table$coef_FWI_veg_C.2*frt12$veg_C2 +
  model_coef_table$coef_FWI_veg_C.3*frt12$veg_C3 +
  model_coef_table$coef_FWI_veg_C.4*frt12$veg_C4 +
  model_coef_table$coef_FWI_veg_C.5*frt12$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt12$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt12$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt12$veg_M12 +
  model_coef_table$coef_FWI_veg_M.3*frt12$veg_M3 +
  model_coef_table$coef_FWI_veg_N*frt12$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt12$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt12$veg_S1 +
  model_coef_table$coef_FWI_veg_S.2*frt12$veg_S2

logit_P_spread

frt12$varying_coef_lightning<-logit_P_lightning
frt12$varying_coef_person<-logit_P_person
frt12$varying_coef_escape<-logit_P_escape
frt12$varying_coef_spread<-logit_P_spread

rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread, logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()

#plot(frt12$prob_ignition_escape, frt12$prob_ignition_spread)
```

## FRT13
```{r}
frt13<- dat2 %>% filter(frt==13)

table(frt13$FWI_veg)
# NOTE C2 is the intercept
frt13$veg_C2 <- ifelse(frt13$FWI_veg == 'C-4', 1, frt13$veg_C2)
frt13$veg_C3 <- ifelse(frt13$FWI_veg == 'C-1', 1, frt13$veg_C3)
frt13$veg_O1ab <- ifelse(frt13$FWI_veg == 'M-3', 1, frt13$veg_O1ab)
model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT13_lightning.csv")
model_coef_table

#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

logit_P_lightning<- 
  model_coef_table$coef_climate_1*frt13$climate1_lightning +
  model_coef_table$coef_climate2*frt13$climate2_lightning +
  model_coef_table$coef_FWI_veg_C.3*frt13$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt13$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt13$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt13$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt13$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt13$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt13$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt13$veg_S1 +
  model_coef_table$coef_FWI_veg_S.2*frt13$veg_S2 + 
  model_coef_table$coef_FWI_veg_S.3*frt13$veg_S3

logit_P_lightning

#############################
# person

frt13<- dat2 %>% filter(frt==13)

table(frt13$FWI_veg)
# NOTE C2 is the intercept
#frt13$FWI_veg[frt13$FWI_veg=="C-2"]<-"C-3"
frt13$veg_C3 <- ifelse(frt13$FWI_veg == 'C-1', 1, frt13$veg_C3)
frt13$veg_C2 <- ifelse(frt13$FWI_veg == 'C-4', 1, frt13$veg_C2)
frt13$veg_C7 <- ifelse(frt13$FWI_veg == 'S-2', 1, frt13$veg_C7)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT13_person.csv")
model_coef_table

#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

logit_P_person<- 
  model_coef_table$coef_climate_1*frt13$climate1_person +
  model_coef_table$coef_climate_2*frt13$climate2_person +  model_coef_table$coef_FWI_veg_C.3*frt13$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt13$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt13$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt13$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt13$veg_M12 +
  model_coef_table$coef_FWI_veg_M.3*frt13$veg_M3 +
  model_coef_table$coef_FWI_veg_N*frt13$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt13$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt13$veg_S1 +
  model_coef_table$coef_FWI_veg_S.3*frt13$veg_S3 
logit_P_person# y = e^(b0 + b1*x) / (1 + e^(b0 + b1*x))

################################
#escape
frt13<- dat2 %>% filter(frt==13)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt13_escape.csv")

model_coef_table

table(frt13$FWI_veg)

frt13$veg_C3 <- ifelse(frt13$FWI_veg == 'C-1', 1, frt13$veg_C3)
frt13$veg_C2 <- ifelse(frt13$FWI_veg == 'C-4', 1, frt13$veg_C2)
# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_escape<- 
  model_coef_table$coef_climate_1*frt13$climate1_escape +
  model_coef_table$coef_climate_2*frt13$climate2_escape +
  model_coef_table$coef_FWI_vegC.3*frt13$veg_C3 +
  model_coef_table$coef_FWI_vegC.5*frt13$veg_C5 +
  model_coef_table$coef_FWI_vegC.7*frt13$veg_C7 +
  model_coef_table$coef_FWI_vegD.1.2*frt13$veg_D12 +
  model_coef_table$coef_FWI_vegM.1.2*frt13$veg_M12 +
  model_coef_table$coef_FWI_vegM.3*frt13$veg_M3 +
  model_coef_table$coef_FWI_vegN*frt13$veg_N +
  model_coef_table$coef_FWI_vegO.1a.b*frt13$veg_O1ab +
  model_coef_table$coef_FWI_vegS.1*frt13$veg_S1 +
  model_coef_table$coef_FWI_vegS.2*frt13$veg_S2 +
  model_coef_table$coef_FWI_vegS.3*frt13$veg_S3
  
logit_P_escape

##########################
#spread
frt13<- dat2 %>% filter(frt==13)
model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt13_spread.csv")

model_coef_table

table(frt13$FWI_veg)

frt13$veg_C3 <- ifelse(frt13$FWI_veg == 'C-1', 1, frt13$veg_C3)
frt13$veg_C2 <- ifelse(frt13$FWI_veg == 'C-4', 1, frt13$veg_C2)

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_spread<- 
  model_coef_table$coef_mean_PPT05_PPT06_PPT07_PPT08.*frt13$mean_PPT05_PPT06_PPT07_PPT08 +
  model_coef_table$coef_FWI_veg_C.3*frt13$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt13$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt13$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt13$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt13$veg_M12 +
  model_coef_table$coef_FWI_veg_M.3*frt13$veg_M3 +
  model_coef_table$coef_FWI_veg_N*frt13$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt13$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt13$veg_S1 +
  model_coef_table$coef_FWI_veg_S.2*frt13$veg_S2 +
  model_coef_table$coef_FWI_veg_S.3*frt13$veg_S3 

logit_P_spread

frt13$varying_coef_lightning<-logit_P_lightning
frt13$varying_coef_person<-logit_P_person
frt13$varying_coef_escape<-logit_P_escape
frt13$varying_coef_spread<-logit_P_spread


rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread, logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()


```

#FRT 14
```{r}
frt14<- dat2 %>% filter(frt==14)

table(frt14$FWI_veg)
# NOTE C-2 is the intercept

frt14$veg_C2 <- ifelse(frt14$FWI_veg == 'C-4', 1, frt14$veg_C2)
frt14$veg_C7 <- ifelse(frt14$FWI_veg == 'S-2', 1, frt14$veg_C7)
frt14$veg_M12 <- ifelse(frt14$FWI_veg == 'S-3', 1, frt14$veg_M12)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT14_lightning.csv")
model_coef_table
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

logit_P_lightning<- 
  model_coef_table$coef_climate_1*frt14$climate1_lightning +
  model_coef_table$coef_FWI_veg_C.3*frt14$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt14$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt14$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt14$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt14$veg_M12 +
  model_coef_table$coef_FWI_veg_M.3*frt14$veg_M3 +
  model_coef_table$coef_FWI_veg_N*frt14$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt14$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt14$veg_S1 

logit_P_lightning

############################
# person
frt14<- dat2 %>% filter(frt==14)

table(frt14$FWI_veg)
# NOTE C-2 is the intercept
frt14$veg_C2 <- ifelse(frt14$FWI_veg == 'C-4', 1, frt14$veg_C2)
frt14$veg_C7 <- ifelse(frt14$FWI_veg == 'S-2', 1, frt14$veg_C7)
frt14$veg_S1 <- ifelse(frt14$FWI_veg == 'S-3', 1, frt14$veg_S1)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT14_person.csv")
model_coef_table

#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

logit_P_person<-
  model_coef_table$coef_climate_1*frt14$climate1_person +
  model_coef_table$coef_FWI_veg_C.3*frt14$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt14$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt14$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt14$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt14$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt14$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt14$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt14$veg_S1 

logit_P_person

##############################
#escape  
frt14<- dat2 %>% filter(frt==14)
model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt14_escape.csv")

model_coef_table

table(frt14$FWI_veg)

frt14$veg_C3 <- ifelse(frt14$FWI_veg == 'C-4', 1, frt14$veg_C3)
frt14$veg_C7 <- ifelse(frt14$FWI_veg == 'C-5', 1, frt14$veg_C7)
frt14$veg_C3 <- ifelse(frt14$FWI_veg == 'C-2', 1, frt14$veg_C3)
frt14$veg_M12 <- ifelse(frt14$FWI_veg == 'S-1', 1, frt14$veg_M12)
frt14$veg_C7 <- ifelse(frt14$FWI_veg == 'S-2', 1, frt14$veg_C7)
frt14$veg_M12 <- ifelse(frt14$FWI_veg == 'S-3', 1, frt14$veg_M12)

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_escape<- 
  model_coef_table$coef_climate_1*frt14$climate1_escape +
  model_coef_table$coef_FWI_vegC.7*frt14$veg_C7 +
  model_coef_table$coef_FWI_vegD.1.2*frt14$veg_D12 +
  model_coef_table$coef_FWI_vegM.1.2*frt14$veg_M12 +
  model_coef_table$coef_FWI_vegN*frt14$veg_N +
  model_coef_table$coef_FWI_vegO.1a.b*frt14$veg_O1ab
  

logit_P_escape

################################
#spread

frt14<- dat2 %>% filter(frt==14)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt14_spread.csv")

model_coef_table
table(frt14$FWI_veg)

frt14$veg_C2 <- ifelse(frt14$FWI_veg == 'C-4', 1, frt14$veg_C2)
frt14$veg_C7 <- ifelse(frt14$FWI_veg == 'S-2', 1, frt14$veg_C7)
frt14$veg_S1 <- ifelse(frt14$FWI_veg == 'S-3', 1, frt14$veg_S1)

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_spread<- 
  model_coef_table$coef_climate2*frt14$climate2_spread +
  model_coef_table$coef_FWI_veg_C.3*frt14$veg_C3 +
  model_coef_table$coef_FWI_veg_C.5*frt14$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt14$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt14$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt14$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt14$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt14$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.1*frt14$veg_S1

logit_P_spread

frt14$varying_coef_lightning<-logit_P_lightning
frt14$varying_coef_person<-logit_P_person
frt14$varying_coef_escape<-logit_P_escape
frt14$varying_coef_spread<-logit_P_spread


rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread, logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()


```

## FRT15
```{r}
frt15<- dat2 %>% filter(frt==15)
table(frt15$FWI_veg)
# C-3 is the intercept
frt15$veg_C3 <- ifelse(frt15$FWI_veg == 'C-2', 1, frt15$veg_C3)
frt15$veg_C3 <- ifelse(frt15$FWI_veg == 'O-1a/b', 1, frt15$veg_C3)
frt15$veg_S3 <- ifelse(frt15$FWI_veg == 'S-1', 1, frt15$veg_S3)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT15_lightning.csv")
model_coef_table

#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk

# note climate 1 and elevation were correlated 0.76 so I removed climate 1 because the model without climate 1 but with elevation had a smaller AIC than the opposite
logit_P_lightning<- 
  model_coef_table$coef_climate_2*frt15$climate2_lightning +
  model_coef_table$coef_FWI_veg_C.5*frt15$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt15$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt15$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt15$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt15$veg_N +
  model_coef_table$coef_FWI_veg_S.3*frt15$veg_S3

logit_P_lightning

################################
# Person

frt15<- dat2 %>% filter(frt==15)
table(frt15$FWI_veg)
# C-3 is the intercept
frt15$veg_C3 <- ifelse(frt15$FWI_veg == 'C-2', 1, frt15$veg_C3)
frt15$veg_C5 <- ifelse(frt15$FWI_veg == 'C-7', 1, frt15$veg_C5)
frt15$veg_S3 <- ifelse(frt15$FWI_veg == 'S-1', 1, frt15$veg_S3)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_FRT15_person.csv")
model_coef_table

logit_P_person<- 
  model_coef_table$coef_climate_1*frt15$climate1_person +
  model_coef_table$coef_climate2*frt15$climate2_person +
  model_coef_table$coef_FWI_veg_C.5*frt15$veg_C5 +
  model_coef_table$coef_FWI_veg_D.1.2*frt15$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt15$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt15$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt15$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.3*frt15$veg_S3

logit_P_person

################################
# escape

frt15<- dat2 %>% filter(frt==15)

model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt15_escape.csv")
model_coef_table

table(frt15$FWI_veg)

frt15$veg_C3 <- ifelse(frt15$FWI_veg == 'C-2', 1, frt15$veg_C3)
frt15$veg_C5 <- ifelse(frt15$FWI_veg == 'C-7', 1, frt15$veg_C5)
frt15$veg_S3 <- ifelse(frt15$FWI_veg == 'S-1', 1, frt15$veg_S3)
frt15$veg_C3 <- ifelse(frt15$FWI_veg == 'O-1a/b', 1, frt15$veg_C3)
# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_escape<- 
  model_coef_table$coef_climate_2*frt15$climate2_escape +
  model_coef_table$coef_FWI_vegC.5*frt15$veg_C5 +
  model_coef_table$coef_FWI_vegD.1.2*frt15$veg_D12 +
  model_coef_table$coef_FWI_vegM.1.2*frt15$veg_M12 +
  model_coef_table$coef_FWI_vegN*frt15$veg_N +
  model_coef_table$coef_FWI_vegS.3*frt15$veg_S3

logit_P_escape

#################################
# spread

frt15<- dat2 %>% filter(frt==15)
model_coef_table<-read.csv("C:\\Work\\caribou\\castor\\R\\fire_sim\\Analysis_results\\BC\\Coefficient_tables\\top_mod_table_frt15_spread.csv")
model_coef_table
table(frt15$FWI_veg)

frt15$veg_C3 <- ifelse(frt15$FWI_veg == 'C-2', 1, frt15$veg_C3)
frt15$veg_S3 <- ifelse(frt15$FWI_veg == 'S-1', 1, frt15$veg_S3)

# put coefficients into model formula
#logit(p) = b0+b1X1+b2X2+b3X3….+bkXk
logit_P_spread<- 
  model_coef_table$coef_summer_Tave*frt15$summer_Tave +
  model_coef_table$coef_tot_summer_PPT*frt15$tot_summer_PPT +
  model_coef_table$coef_FWI_veg_C.5*frt15$veg_C5 +
  model_coef_table$coef_FWI_veg_C.7*frt15$veg_C7 +
  model_coef_table$coef_FWI_veg_D.1.2*frt15$veg_D12 +
  model_coef_table$coef_FWI_veg_M.1.2*frt15$veg_M12 +
  model_coef_table$coef_FWI_veg_N*frt15$veg_N +
  model_coef_table$coef_FWI_veg_O.1a.b*frt15$veg_O1ab +
  model_coef_table$coef_FWI_veg_S.3*frt15$veg_S3

logit_P_spread
# y = e^(b0 + b1*x) / (1 + e^(b0 + b1*x))

frt15$varying_coef_lightning<-logit_P_lightning
frt15$varying_coef_person<-logit_P_person
frt15$varying_coef_escape<-logit_P_escape
frt15$varying_coef_spread<-logit_P_spread


rm(model_coef_table, model_coef_table_escape, model_coef_table_lightning, model_coef_table_person, model_coef_table_spread, logit_P_escape, logit_P_lightning, logit_P_person, logit_P_spread)
gc()

```

# now join all the frt's back together. 
```{r}
frt_all<-rbind(rbind(rbind(rbind(rbind(rbind(rbind(rbind(frt5, frt7), frt9), frt10), frt11), frt12), frt13), frt14), frt15)

dim(frt_all)

dim(no_ignition)
no_ignition$varying_coef_lightning<-0
no_ignition$varying_coef_person<-0
no_ignition$varying_coef_escape<-0
no_ignition$varying_coef_spread<-0
head(no_ignition)

no_ignition<-no_ignition %>% dplyr::select(idno, frt, FWI_veg,bclcs_level_5, varying_coef_lightning :varying_coef_spread)

no_ignition$bclcs_level_5<-NA

frt_all2<-frt_all %>% dplyr::select(idno, frt, FWI_veg, bclcs_level_5,  varying_coef_lightning :varying_coef_spread)

frt_all2<-rbind(frt_all2, no_ignition)

hist(frt_all2$varying_coef_spread)

table(is.na(frt_all2$varying_coef_spread))
dim(frt_all2)

names(frt_all2)

```

# save it!
```{r}
st_write(frt_all2, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\BC\\estimated_coefficients\\BC_ignit_escape_spread_varying_coefficient_2041_2060.gpkg", delete_layer=TRUE, driver="GPKG")
```


```{r}
rm(frt10, frt11, frt12, frt13, frt14, frt15, frt5, frt7, frt9, clim, frt_var, frt_all2, frt_all)
gc()
```

# Now join these values to the constant coefficients and then open QGIS and make each probability layer into a raster

rasterizing the above file in QGIS:

 go to raster -> Conversion -> Rasterize (Vector to raster)

 then use the shapefile as the input layer, 
 prob ignition as the field to use for burn-in value. 
 output raster size units -> georeferenced units
 resolution = 400m
 note: make sure you use the file rast.bc_bounds as the extent. Its found in postgres kyle clus. If you dont do this the extent will be wrong and the rasterization wont work properly.
 Assign a specified nodata value - make this -9 or some negative number. You need to do this or it will make no data values 0 and then change all actual values to NA so it throws out the actual 0% chance of ignion points.

 I also told it to Pre-initialize the output image with a value of -9. I did this for the same reason as just mentioned above but Im not sure how neccessary this one is. 

 the full commonad should look something like this:

 gdal_rasterize -l BC_prob_escape_final -a prob_ignition -tr 400.0 400.0 -init -9.0 -a_nodata -9.0 -te 159587.5 173787.5 1881187.5 1748187.5 -ot Float32 -of GTiff C:/Work/caribou/castor_data/Fire/Fire_sim_data/data/BC/BC_prob_escape_final.gpkg C:/Work/caribou/castor_data/Fire/Fire_sim_data/data/BC/rast_escape_400m.tif

