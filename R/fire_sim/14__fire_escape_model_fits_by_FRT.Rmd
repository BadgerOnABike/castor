---
title: "fire_escape_model_fits_by_NDT_data_prep"
author: "Cora Skaien"
date: "25/07/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!--
Copyright 2021 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->

#=================================
#  Script Name: 12_fire_escape_model_fits_by_NDT_data_prep.R
#  Script Version: 1.0
#  Script Purpose: Data prep for other variables for escape models.
#  Script Author: Cora Skaien, Ecological Modeling Specialist, Forest Analysis and Inventory Branch, B.C. Ministry of Forests, Lands, and Natural Resource Operations.
#=================================

#Overview
Similar to the ignition_models_fit_by_NDT file, we will be selecting the top variables for models predicting whether or not fires escaped or not, defined currently as fires that have exceeded 1 ha in size. Note, this code could also apply to the cut off of 3 hectares and 10 hectares with simple modifications as the data is already prepared for these cutoffs.

```{r}
#Load relevant libraries
library(sf)
library(tidyverse)
library(ggplot2)
library (ggcorrplot)
library (RPostgreSQL)
library (rpostgis)
library (dplyr)
library (lme4)
library (arm)
library(ggpubr)
library(mgcv)
library(nlme)
library(purrr)
library(tidyr)
library(caret)
library(pROC)
library(keyring)
library(ggcorrplot) 
library (kableExtra)
library (data.table)
library (DBI)
library (RPostgreSQL)
library (dplyr)
library (ggplot2)
library (here)
library(AICcmodavg)
library(caret)
library(pROC)
library(rje)
library(base)
library(car)
library(visreg)

source(here::here("R/functions/R_Postgres.R"))
```

Now we must bring in the data that we created at the end of 10_fire_escape_data_prep. These will be the same files as those used in 11_escape_climate_variable_selection.

```{r}

escape <- st_read("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\escape_data.gpkg")

# put FRT 3 into FRT5
escape$Cluster[escape$Cluster==3]<-5

```

We will create one model for each FRT, combining all fire types (person, lightning, unknown) and treed and non-treed.

#Climate variable selection review
In the script "escape_climate_variable_selection.R", we performed an AIC and ROC analysis for each BEC zone including presence/available fire ignition points and a variety of climate variables. For this analysis, we split the data into a training and a validation data set where 75% of the data was used for training and 25% was used for validation. We then fit the model and extracted the AIC and AUC values. This was repeated 100 times and at the end we calculated the average AIC and AUC values. The climate variable that consistently resulted in and AIC <2 and that had the highest AUC value out of the <2 AIC subset is used in this analysis.

```{r, AIC table, echo = F, message = F, eval = T}

climate_variables_escape<-read.csv("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\climate_AIC_results_escape_summary.csv") #This current file has all the possible models instead of the top one for each NDT as prior

head(climate_variables_escape) 

kable (climate_variables_escape,
       caption = "<b>Table 3. Top candidate climate variables for the escape models for lightning caused fires as selected through an AIC analysis for each BEC zone.<b>",
       digits = 2) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)


```


Now we will create additional columns that have the climate1 and climate2 variables indicated as the top variables for climate. 

```{r}
names(escape)
unique(escape$Cluster)
escape$Cluster<-as.factor(escape$Cluster)
escape$Cluster_numeric<-as.numeric(as.character(escape$Cluster))

escape$mean_PPT04_PPT05_PPT06<-(escape$PPT04 + escape$PPT05 + escape$PPT06)/3
escape$mean_PPT05_PPT06_PPT07_PPT08  <-(escape$PPT05 + escape$PPT06 + escape$PPT07 + escape$PPT08)/4
escape$mean_Tave05_Tave06_Tave07_Tave08<-(escape$Tave05 + escape$Tave06 + escape$Tave07 + escape$Tave08)/4
escape$mean_Tave04_Tave05_Tave06<-(escape$Tave04 + escape$Tave05 + escape$Tave06)/3

## Create empty vector
escape$climate1<-0
head(escape)

escape<-escape %>%
    mutate(climate1 = case_when(Cluster_numeric == 5 ~ PPT05, 
                                Cluster_numeric == 7 ~ temp_mnthbefore, 
                                Cluster_numeric == 9 ~ Tave05, 
                                Cluster_numeric == 10 ~ mean_Tave05_Tave06_Tave07_Tave08,
                                Cluster_numeric == 11 ~ Tave09, 
                                Cluster_numeric == 12 ~ mean_Tave04_Tave05_Tave06,
                                Cluster_numeric == 13 ~ Tmax09,
                                Cluster_numeric == 14 ~ temp_atfire,
                                Cluster_numeric == 15 ~ Tave04,
                                TRUE ~ NA_real_))

#Repeat for climate 2
escape$climate2<-0

#Perform mutate to get the applicable variable for each row
escape<-escape %>%
    mutate(climate2 = case_when(Cluster_numeric == 7 ~ ppt_mnthbefore,
                                Cluster_numeric == 10 ~ mean_PPT05_PPT06_PPT07_PPT08,
                                Cluster_numeric == 12 ~ mean_PPT04_PPT05_PPT06,
                                Cluster_numeric == 14 ~ ppt_atfire,
                                Cluster_numeric == 15 ~ PPT04,TRUE ~ NA_real_))

head(escape)

##Change vegtype to factor
escape$FWI_veg<-as.factor(escape$FWI_veg)

#create new column
escape$FWI_veg<-paste(escape$escape, escape$FWI_veg)

```
View plots.

```{r}
p <- ggplot(escape, aes(aspect, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("aspect") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p
##Seems to be minimal relationship with aspect overall


p <- ggplot(escape, aes(slope, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("slope") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p
# FRT 11, 13, 15 and 7 seem to show a positive relationship with slope

ggplot(escape, aes(x = slope)) +
  geom_histogram(fill = "white", colour = "black") +
  facet_grid(escape10 ~ .)
##Seeing distribution of escapes by slope makes me believe that slope is not a big factor for escapes despite seemingly positive trend prior.

#
p <- ggplot(escape, aes(aspect*slope, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("aspect*slope") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p


p <- ggplot(escape, aes(elevatn, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("elevation") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p
# FRT 11, 12, 13, 15,5, 9 seem to show a positive relationship with elevation while FRT 14 and 7 has a negative relationship and 10 seems to have no relationship

# Wind at fire
p <- ggplot(escape, aes(wind_atfire, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Wind Speed") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p
# strong positive relationship with wind overall although 11, 15, 5 and 7 seems to show basicall no relationship
p <- ggplot(escape, aes(wind_atfire, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Wind Speed") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p

# mdc at fire
p <- ggplot(escape, aes(mdc_atfire, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("MDC at fire") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p
#Unexpectedly general negative relationship
# May contribute to fire size in opposite pattern though - negative correlation may reflect fire fighting efforts in drier regions?

# Tmax at time of fire and month before
p <- ggplot(escape, aes(tmax_2mtns, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Tmax in month of and month before fire") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p
# again weirdly I get a negative relationship which seems completely counter intuitive...
# is the trend better if I have escape size = 10ha?
p <- ggplot(escape, aes(tmax_2mtns, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Tmax in month of and month before fire") + ylab("Pr (escape10)") + 
  facet_wrap(~Cluster,scales='free')
p

# Tave at time of fire and month before
p <- ggplot(escape, aes(Tave_2mtns, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Tmax in month of and month before fire") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p

# PPT at time of fire and month before
p <- ggplot(escape, aes(ppt_2mtns, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("PPT in month of and month before fire") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p

p <- ggplot(escape, aes(PPT05, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("PPT in month of and month before fire") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p

p <- ggplot(escape, aes(Tave05, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("PPT in month of and month before fire") + ylab("Pr (escape)") + 
  facet_wrap(~Cluster,scales='free')
p



climate_variables_escape
```

Also check distance to roads as this may be related to fire-fighting capabilities and efforts.

```{r}
p <- ggplot(escape, aes(rd_dst_, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Roads") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(infr_ds, as.numeric(escape10))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Infrastructure") + ylab("Pr (escape)")
p


#Fairly weak relationship with a really long tail of more extreme values.
```

VRI.Work from here...

```{r}
p <- ggplot(escape, aes(proj_age_1, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("proj_age_1") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(proj_height_1, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("proj_height_1") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(live_stand_volume_125, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("live_stand_volume_125") + ylab("Pr (escape)")
p

```

Top climate variables.

```{r}
p <- ggplot(escape, aes(tave09, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tave09") + ylab("Pr (escape)")
p #Opposite pattern as expected - once again, may relfect forest fire fighting efforts?

p <- ggplot(escape, aes(ppt09, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt09") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(mdc_06, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mdc_06") + ylab("Pr (escape)")
p

```

#Infrastructure.

```{r}
p <- ggplot(escape, aes(dist_any, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Any Infrastructure") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(dist_mun, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Municipalities") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(dist_mine, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Mines") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(dist_nat, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Natural Power") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(dist_pow, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Power Lines") + ylab("Pr (escape)")
p

p <- ggplot(escape, aes(dist_dam, as.numeric(escape))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Distance to Dams") + ylab("Pr (escape)")
p
```

Make cos(aspect in degrees) to be the default aspect in case this did not carry over from previous code.

```{r}
##cos makes more sense for aspect, so make this the default in analyses
escape$aspect_degrees<-escape$aspect
escape$aspect<-escape$aspect_cos
hist(escape$aspect)

```

#Create new variable for partitioning the data
```{r}
escape$veg_escape<-paste( escape$vegtype2,  escape$escape)
table(escape$veg_escape)

```

#Get temperature at time of fire
```{r}
escape$T_atfire<-0
escape$ign_month<-as.numeric(escape$ign_month)
head(escape)
escape_<-escape %>%
    mutate(T_atfire = case_when(ign_month == 5 ~ tave05,
                                  ign_month == 6 ~ tave06,
                                  ign_month == 7 ~ tave07,
                                  ign_month == 8 ~ tave08,
                                  ign_month == 9 ~ tave09,
                                  ign_month == 10 ~ tave10,
                                  ign_month == 11 ~ tave11,
                                  ign_month == 4 ~ tave04,
                                  ign_month == 3 ~ tave03,
                                  ign_month == 2 ~ tave02,
                                  ign_month == 1 ~ tave01,
                                  TRUE ~ mean_tave05_tave06_tave07_tave08_tave09)) #Those areas without fire will receive the mean value for the season. 

head(escape_)
escape<-escape_
hist(escape$T_atfire)
```

```{r}
escape$Tmax_atfire<-0
escape$ign_month<-as.numeric(escape$ign_month)
head(escape)
escape_<-escape %>%
    mutate(Tmax_atfire = case_when(ign_month == 5 ~ tmax05,
                                  ign_month == 6 ~ tmax06,
                                  ign_month == 7 ~ tmax07,
                                  ign_month == 8 ~ tmax08,
                                  ign_month == 9 ~ tmax09,
                                  ign_month == 10 ~ tmax10,
                                  ign_month == 11 ~ tmax11,
                                  ign_month == 4 ~ tmax04,
                                  ign_month == 3 ~ tmax03,
                                  ign_month == 2 ~ tmax02,
                                  ign_month == 1 ~ tmax01,
                                  TRUE ~ mean_tmax05_tmax06_tmax07_tmax08_tmax09)) #Those areas without fire will receive the mean value for the season. 

head(escape_)
escape<-escape_

hist(escape$Tmax_atfire)
```


Get precipitation at fire
#Get temperature at time of fire
```{r}
escape$ppt_atfire<-0
escape$ign_month<-as.numeric(escape$ign_month)
escape$ppt01<-as.numeric(escape$ppt01)
escape$ppt02<-as.numeric(escape$ppt02)
escape$ppt03<-as.numeric(escape$ppt03)
escape$ppt04<-as.numeric(escape$ppt04)
escape$ppt05<-as.numeric(escape$ppt05)
escape$ppt06<-as.numeric(escape$ppt06)
escape$ppt07<-as.numeric(escape$ppt07)
escape$ppt08<-as.numeric(escape$ppt08)
escape$ppt09<-as.numeric(escape$ppt09)
escape$ppt10<-as.numeric(escape$ppt10)
escape$ppt11<-as.numeric(escape$ppt11)
escape$ppt12<-as.numeric(escape$ppt12)
head(escape)
escape_<-escape %>%
    mutate(ppt_atfire = case_when(ign_month == 5 ~ ppt05,
                                  ign_month == 6 ~ ppt06,
                                  ign_month == 7 ~ ppt07,
                                  ign_month == 8 ~ ppt08,
                                  ign_month == 9 ~ ppt09,
                                  ign_month == 10 ~ ppt10,
                                  ign_month == 11 ~ ppt11,
                                  ign_month == 4 ~ ppt04,
                                  ign_month == 3 ~ ppt03,
                                  ign_month == 2 ~ ppt02,
                                  ign_month == 1 ~ ppt01,
                                  TRUE ~ mean_ppt05_ppt06_ppt07_ppt08_ppt09)) #Those areas without fire will receive the mean value for the season. 

head(escape_)
escape<-escape_
```


###Combine Some Variables
Based on earlier model iterations where person and lightning-caused fires, and treed and non-treed polygons, were separately assessed, we gained knowledge on which variables may be simplified. For instance, distance to different types of infrastructure can be combined for those that tend to have a positive association, and those that tend to have a negative association. Some may also be deemed as non-intuitive and thus removed. 

#1. Infrastructure
Combine distances to municipalities, mines, power lines and dams. These tend to have positive associations, wherein probability of escape increases as further away from these. Distance to natural power has the opposite pattern for some reason... remove that one from distance to any, and investigate distance to these first 4 in one metric.

```{r}
escape$dist_any_<-0
escape$dist_any<-0

escape$dist_any_<-
  ifelse(escape$dist_mine<escape$dist_pow, escape$dist_mine, escape$dist_pow)
str(escape$dist_any_)

escape$dist_any<-
  ifelse (escape$dist_any_<escape$dist_mun, escape$dist_any_, escape$dist_mun)
str(escape$dist_any)

escape$dist_any_<-
  ifelse (escape$dist_any<escape$dist_dam, escape$dist_any, escape$dist_dam)
str(escape$dist_any_)

escape$dist_infra<-escape$dist_any_
```

#2. Landuse (bclcs_level_5_2) vs vegtype
Because we lose all the rock, water and glacier values in landuse, we should pick just one or the other.

#Save data here in case get disconnected from R

```{r}
write.csv(escape, "D:\\Fire\\fire_data\\raw_data\\ClimateBC_Data\\All_data_escape_Dec.csv")

#Load back in as needed
escape<-read.csv("D:\\Fire\\fire_data\\raw_data\\ClimateBC_Data\\All_data_escape_Dec.csv")
head(escape)

```

## Examining correlation between stand level variables

```{r}
# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.67) but age and volume are not (0.28) and neither are age and height (0.44). Because volume and height are very close to 0.7 in correlation I will leave out this combination of variables from my treed models. 

escape_t<- escape %>% dplyr::filter(bclcs_level_2=="T")
escape_nt<- escape %>% dplyr::filter(bclcs_level_2=="N")
escape_l<- escape %>% dplyr::filter(bclcs_level_2=="L")

table(escape$vegtype)
table(escape_t$vegtype) #either disturbed, open, treed broadleaf, treed conifer, or treed mixed broadleaf and conifer
table(escape_nt$vegtype) #either disturbed, open or shrub

ggscatter(escape_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(escape_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(escape_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")


##Note that some no tree areas also have tree attributes. This is likely because the majority of the polygon has no trees, but part of the polygon might have trees which are given attributes.
hist(escape_nt$proj_height_1)
hist(escape_nt$proj_age_1)
hist(escape_nt$live_stand_volume_125) #Pretty much all NAs. Can likely assume 0.
escape_nt$proj_height_1 #Also many NAs. 
escape_nt$proj_age_1 # Also many NAs. 

hist(escape_l$proj_height_1)
hist(escape_l$proj_age_1)
hist(escape_l$live_stand_volume_125)
## This is ok. Still exclude from models, because majority of polygon will not be treed

head(escape_t)

```

Save the prepped data

```{r}
write.csv(escape_t, file="D:\\Fire\\fire_data\\raw_data\\ClimateBC_Data\\escape_trees_NDT_Dec.csv")

write.csv(escape_nt, file="D:\\Fire\\fire_data\\raw_data\\ClimateBC_Data\\escape_notrees_NDT_Dec.csv")

```

############### COMPLETE: MOVE ON TO ANALYSES FOR EACH NDT #################
