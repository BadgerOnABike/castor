---
title: "fire_escape_model_fits_by_NDT"
author: "Cora Skaien"
date: "25/07/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

<!--
Copyright 2021 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->

#Overview
Similar to the ignition_models_fit_by_NDT file, we will be selecting the top variables for models predicting whether or not fires escaped or not, defined currently as fires that have exceeded 1 ha in size. Note, this code could also apply to the cut off of 3 hectares and 10 hectares with simple modifications as the data is already prepared for these cutoffs.

```{r}
#Load relevant libraries
library(sf)
library(tidyverse)
library(ggplot2)
library (ggcorrplot)
library (RPostgreSQL)
library (rpostgis)
library (dplyr)
library (lme4)
library (arm)
library(ggpubr)
library(mgcv)
library(nlme)
library(purrr)
library(tidyr)
library(caret)
library(pROC)
library(keyring)
library(ggcorrplot) 

source(here::here("R/functions/R_Postgres.R"))
```

Now we must bring in the data that we created at the end of 09_fire_escape_data_prep. These will be the same files as those used in 10_escaoe_climate_variable_selection.

```{r}
#Lightning-caused fires
Escape_data_lightning<-read.csv("D:\\Fire\\fire_data\\raw_data\\ClimateBC_Data\\escape_data_lightning.shp")
head(Escape_data_lightning)

#If continuing from last file (09_fire_escape_data_prep)
#Escape_data_lightning<-dat_lightning_escape_2

#Person-caused fires
Escape_data_person<-read.csv("D:\\Fire\\fire_data\\raw_data\\ClimateBC_Data\\escape_data_person.shp")
head(Escape_data_person)

#If continuing from last file (09_fire_escape_data_prep)
#Escape_data_person<-dat_person_escape_2

```

We will perform model separately for lightning and person caused fires, as well as for treed and not treed areas, resulting in 4 total models to be prepared for each NDT (similar to in ignition_models_fit_by_NDT). Note, however, that there are insufficient person-caused fires in NDT5 and this zone will not be modelled for this subset.

#Climate variable selection review
In the script "escape_climate_variable_selection.R", we performed an AIC and ROC analysis for each BEC zone including presence/available fire ignition points and a variety of climate variables. For this analysis, we split the data into a training and a validation data set where 75% of the data was used for training and 25% was used for validation. We then fit the model and extracted the AIC and AUC values. This was repeated 100 times and at the end we calculated the average AIC and AUC values. The climate variable that consistently resulted in the lowest average AIC value is used in this analysis. We will load tables for person and lightning caused is a summary of which climate variables fitted best for each BEC zone. 

Note: Some climate variables resulted in delta AIC values that were very similar and had much less than 2 points difference. Also, the variable with the smallest AIC value did not always have the best AUC value. Regardless of these two issues, we decided to take the climate variable with the smallest average AIC for simplicity. Results will be loaded in for each AIC table. These files were manipulated manually and then saved on to the drive before being uploaded (i.e., it is a simplified table from that generated in the last file, escape_climate_variable_selection; code for uploading not included prior).

