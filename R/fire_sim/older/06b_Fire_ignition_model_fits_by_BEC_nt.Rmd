---
title: "06b_Fire_ignition_model_fits_by_BEC_NoTrees"
author: "Cora Skaien"
date: "28/06/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

This documents comes after the first in the series (05_Fire_ignition_model_fits_by_BEC) and includes the non-treed areas for each BEC zone.

This model will likely only include climate variable + vegetation type since it is non-treed.



## BEC ZONE BG
```{r bg figures}
bg<- dat %>% dplyr::filter(zone =="BG")
bg_nt<- bg %>% dplyr::filter(bclcs_level_2!="T") # not treed

##Scale variables of interest for applicability downstream (https://besjournals.onlinelibrary.wiley.com/doi/epdf/10.1111/j.2041-210X.2010.00012.x)

##If we choose to scale variables, we could also try to back transform the coeffienct -- because B1*X = B1*(mean-value)/SD to make downstream use easier

##Check stand-level characteristics to see if anything odd
hist(bg_nt$live_stand_volume_125) #not all 0
hist(bg_nt$proj_age_1) #Still has ages
hist(bg_nt$proj_height_1) #Still up to 30 m, like in treed area...
table(bg_nt$bclcs_level_2) #says not treed, but above has tree level characteristics from VRI
table(bg_nt$bclcs_level_4)

```

## BG treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

glm1<- glm(fire_pres ~ scale(ppt09), 
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"ppt09"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_age_1), 
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"ppt09 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_height_1), 
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125), 
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(ppt09) +
             vegtype, # classification of tree type in the VRI 
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_age_1) + 
             vegtype,
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_height_1) + 
             vegtype,
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(ppt09) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= bg_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.bg<- table.glm
table.glm.bg[order(table.glm.bg$deltaAIC),] 

#Best model ppt09 + proj_height_1

####################################################

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

bg_nt2<-bg_nt %>% drop_na(proj_height_1)

glm_best<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_height_1), 
           data= bg_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


bg_nt2$resids<-resid(glm_best)

binnedplot (bg_nt2$proj_height_1, 
            bg_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (bg_nt2$ppt09, 
            bg_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

# Diagnostic plots look ok, but my sample sizes in this BEC zone are low!

# Looking at effect of forest height at the average amount of rainfall in September
plot(bg_nt2$proj_height_1,bg_nt2$fire_pres)
curve(invlogit(coef(glm_best)[1] +coef(glm_best)[2]*mean(bg_nt2$ppt09) + coef(glm_best)[3]*x), add=TRUE)

# looking at effect of ppt09 at the average forest height.
plot(bg_nt2$ppt09,bg_nt2$fire_pres)
curve(invlogit(coef(glm_best)[1] +coef(glm_best)[2]*x + coef(glm_best)[3]*mean(bg_nt2$proj_height_1)), add=TRUE)


# create model table (only do this once) and add the relevant data
top_mod_ntable_nt <- data.frame (matrix (ncol = 16, nrow = 0))
colnames (top_mod_ntable_nt) <- c ("ZONE", "TREED", "Model_nterms", "intercept", "coef_climate_1", "coef_climate_2", "coef_climate_interaction", "coef_stand_height", "coef_live_stand_volume_125", "coef_proj_age", "coef_vegtypeD", "coef_vegtypeOP", "coef_vegtypeS", "coef_vegtypeTB", "coef_vegtypeTC", "coef_vegtypeTM")

##Add data for BG
top_mod_ntable_nt[1,1]<-"BG"
top_mod_ntable_nt[1,2]<-"Y"
top_mod_ntable_nt[1,3]<-"fire_pres ~ ppt09 + proj_height_1"
top_mod_ntable_nt[1,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[1,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_ntable_nt[1,6]<- coef(glm_best)[2] #Climate variable 2
#top_mod_ntable_nt[1,7]<- coef(glm_best)[3] #Interaction climate variables
top_mod_ntable_nt[1,8]<- coef(glm_best)[3] #coef_stand_height
#top_mod_ntable_nt[1,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_ntable_nt[1,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_ntable_nt[1,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[1,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[1,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_ntable_nt[1,14]<- coef(glm_best)[4] #coefficient vegtypeTB
#top_mod_ntable_nt[1,15]<- coef(glm_best)[4] #coefficient vegtypeTC
#top_mod_ntable_nt[1,16]<- coef(glm_best)[5] #coefficient vegtypeTM
top_mod_ntable_nt ##Determine if better way to represent categories for vegtype, and if each climate variable should have its own column

```


## BEC ZONE BWBS Figures
```{r bg figures}
bwbs<- dat %>% dplyr::filter(zone =="BWBS")
bwbs_nt<- bwbs %>% dplyr::filter(bclcs_level_2!="T") # not treed

hist(bwbs_nt$mean_tave06_tave07_tave08)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(bwbs_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(bwbs_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(bwbs_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(bwbs_nt$vegtype) 

```

## BWBS treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08), 
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_tave06_tave07_tave08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1), 
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_height_1), 
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125), 
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             vegtype, # classification of tree type in the VRI 
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1) + 
             vegtype,
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
           scale(proj_height_1) + 
           vegtype,
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= bwbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.bwbs<- table.glm
table.glm.bwbs[order(table.glm.bwbs$deltaAIC),] 

##Best model mean_tave06_tave07_tave08 + live_stand_volume_125 +proj_age_1

####################################################


```

Now inspect the top model from the AIC table and alter below to match.

```{r}

##### TOP MODEL####

bwbs_nt2<-bwbs_nt %>% drop_na(live_stand_volume_125)

glm_best<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08)+
             scale(live_stand_volume_125) +
               vegtype, 
           data= bwbs_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


bwbs_nt2$resids<-resid(glm_best)

binnedplot (bwbs_nt2$live_stand_volume_125, 
            bwbs_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (bwbs_nt2$mean_tave06_tave07_tave08, 
            bwbs_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok, not great.

##Add to top model table
top_mod_ntable_nt[2,1]<-"BWBS"
top_mod_ntable_nt[2,2]<-"Y"
top_mod_ntable_nt[2,3]<-"fire_pres ~ mean_tave06_tave07_tave08 + live_stand_volume_125 +proj_age_1"
top_mod_ntable_nt[2,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[2,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_ntable_nt[2,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_ntable_nt[2,7]<- coef(glm_best)[3] #Climate variable interaction
#top_mod_ntable_nt[2,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[2,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_ntable_nt[2,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_ntable_nt[2,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[2,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[2,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_ntable_nt[2,14]<- coef(glm_best)[4] #coefficient vegtypeTB
top_mod_ntable_nt[2,15]<- coef(glm_best)[5] #coefficient vegtypeTC
top_mod_ntable_nt[2,16]<- coef(glm_best)[6] #coefficient vegtypeTM
top_mod_ntable_nt
```


## CMA treed statistical model 

```{r BG treed model fits}

cma<- dat %>% dplyr::filter(zone =="CMA")
# I will run separate analyses for treed and non-treed areas because the non-treed areas don't have information for forest height, age or volume and so these variables cant be included in the model.
cma_nt<- cma %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
cma_nt<- cma %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(cma_nt$vegtype)

##Check correlations
ggscatter(cma, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(cma, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(cma, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

ggscatter(cma_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(cma_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(cma_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(cma_nt$proj_age_1, breaks=30)
hist(scale(cma_nt$proj_age_1), breaks=30)
hist(cma_nt$live_stand_volume_125, breaks=30)
hist(scale(cma_nt$live_stand_volume_125), breaks=30)

table(cma_nt$vegtype)
```

Run chunk below. Note, if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to be models 5 and 6.

```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

##Analyses
glm1<- glm(fire_pres ~ scale(tave08) * scale(ppt08), 
           data= cma_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tave08 * ppt08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(proj_age_1), 
           data= cma_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tave08 * ppt08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(proj_height_1), 
           data= cma_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(live_stand_volume_125), 
           data= cma_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

#glm5<- glm(fire_pres ~ tave08 * ppt08 +
#             vegtype, # classification of tree type in the VRI; cannot do, because only TC 
#           data= cma_nt,
#           family = binomial,
#           na.action=na.omit)
#summary(glm5)
#i=5
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + vegtype"
#table.glm[i,3]<-AICc(glm5)

glm5<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= cma_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= cma_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm6)

#glm8<- glm(fire_pres ~ tave08 * ppt08 +
#             proj_age_1 + 
#             vegtype, #When Cora runs this, there is only one level for vegtype and thus an error arises
#           data= cma_nt,
#           family = binomial,
#           na.action=na.omit)
#summary(glm8)
#i=8
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + proj_age_1 + vegtype"
#table.glm[i,3]<-AICc(glm8)

#glm9<- glm(fire_pres ~ tave08 * ppt08 +
#             proj_height_1 + 
#             vegtype, #Only one level 
#           data= cma_nt,
#           family = binomial,
#           na.action=na.omit)
#summary(glm9)
#i=9
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + proj_height_1 + vegtype"
#table.glm[i,3]<-AICc(glm9)

#glm10<- glm(fire_pres ~ tave08 * ppt08 +
#             live_stand_volume_125 + 
#             vegtype,
#           data= cma_nt,
#           family = binomial,
#           na.action=na.omit)
#summary(glm10)
#i=10
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125 + vegtype"
#table.glm[i,3]<-AICc(glm10)

#glm11<- glm(fire_pres ~ tave08 * ppt08 +
#             live_stand_volume_125 + 
#              proj_age_1 +
#             vegtype,
#           data= cma_nt,
#           family = binomial,
#           na.action=na.omit)
#summary(glm11)
#i=11
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
#table.glm[i,3]<-AICc(glm11)

#glm12<- glm(fire_pres ~ tave08 * ppt08 +
#              proj_height_1 +
#              proj_age_1 +
#             vegtype,
#           data= cma_nt,
#           family = binomial,
#           na.action=na.omit)
#summary(glm12)
#i=12
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + proj_height_1 + proj_age_1 + vegtype"
#table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.cma<- table.glm
table.glm.cma[order(table.glm.cma$deltaAIC),] #


#    Model                                           Variable      AIC  deltaAIC
#4  glm4             tave08 * ppt08 + live_stand_volume_125 47.99134  0.000000
#5  glm5 tave08 * ppt08 + live_stand_volume_125 +proj_age_1 50.25766  2.266327
#2  glm2                        tave08 * ppt08 + proj_age_1 56.95475  8.963410
#3  glm3                     tave08 * ppt08 + proj_height_1 57.63835  9.647012
#1  glm1                                     tave08 * ppt08 58.87539 10.884057
#6  glm6        tave08 * ppt08 + proj_age_1 + proj_height_1 59.16631 11.174974

####################################################

```


Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

cma_nt2<-cma_nt %>% drop_na(live_stand_volume_125)

glm_best<- glm(fire_pres ~ scale(tave08) * scale(ppt08)+
             scale(live_stand_volume_125),
           data= cma_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


cma_nt2$resids<-resid(glm_best)

binnedplot (cma_nt2$live_stand_volume_125, 
            cma_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (cma_nt2$mean_tave06_tave07_tave08, 
            cma_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))



# Diagnostic plots look ok, not great! Fairly small sample size for this zone.


##Add to top model table
top_mod_ntable_nt[3,1]<-"CMA"
top_mod_ntable_nt[3,2]<-"Y"
top_mod_ntable_nt[3,3]<-"fire_pres ~ tave08 * ppt08 + live_stand_volume_125 + vegtype"
top_mod_ntable_nt[3,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[3,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_ntable_nt[3,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_ntable_nt[3,7]<- coef(glm_best)[5] #Climate variable interaction
#top_mod_ntable_nt[3,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[3,9]<- coef(glm_best)[4] #live_stand_volume_125
#top_mod_ntable_nt[3,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_ntable_nt[3,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[3,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[3,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_ntable_nt[3,14]<- coef(glm_best)[4] #coefficient vegtypeTB
#top_mod_ntable_nt[3,15]<- coef(glm_best)[4] #coefficient vegtypeTC
#top_mod_ntable_nt[3,16]<- coef(glm_best)[5] #coefficient vegtypeTM
top_mod_ntable_nt

```




## BEC ZONE ESSF
```{r essf climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for essf were 
essf<- dat %>%
  filter(zone=="ESSF")

#Separate by trees and no trees
essf_nt<- essf %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
essf_nt<- essf %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(essf_nt$vegtype)
table(essf_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(essf_nt, aes(tave08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("TAve08") + ylab("Pr (ignition)")
p

p <- ggplot(essf_nt, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


hist(essf_nt$tave08)
hist(essf_nt$ppt08, breaks=30)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(essf_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(essf_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(essf_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(essf_nt$proj_age_1)
hist(scale(essf_nt$proj_age_1))
hist(essf_nt$proj_height_1)
hist(scale(essf_nt$proj_height_1))
hist(essf_nt$live_stand_volume_125, breaks=30)
hist(scale(essf_nt$live_stand_volume_125), breaks=30)
```

```{r essf_1 model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then some of these models cannot be run and will need to be excluded.

essf_nt$proj_age_1_scale<-scale(essf_nt$proj_age_1)
essf_nt$live_stand_volume_125_scale<-scale(essf_nt$live_stand_volume_125)
essf_nt$proj_height_1_scale<-scale(essf_nt$proj_height_1)


glm1<- glm(fire_pres ~ tave07 * ppt07, 
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tave07 * ppt07"
table.glm[1,3]<-AIC(glm1)

glm2<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype, 
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tave07 * ppt07 + vegtype"
table.glm[i,3]<-AIC(glm2)


glm3<- glm(fire_pres ~ tave07 * ppt07 +
             proj_age_1_scale, 
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + proj_age_1_scale"
table.glm[i,3]<-AIC(glm3)

glm4<- glm(fire_pres ~ tave07 * ppt07 +
             proj_height_1_scale, 
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + proj_height_1_scale"
table.glm[i,3]<-AIC(glm4)

glm5<- glm(fire_pres ~ tave07 * ppt07 +
             live_stand_volume_125_scale, 
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + live_stand_volume_125_scale"
table.glm[i,3]<-AIC(glm5)

glm6<- glm(fire_pres ~ tave07 * ppt07 +
             live_stand_volume_125_scale +
             proj_age_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + live_stand_volume_125_scale + proj_age_1_scale"
table.glm[i,3]<-AIC(glm6)

glm7<- glm(fire_pres ~ tave07 * ppt07 +
             live_stand_volume_125_scale +
             proj_height_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + live_stand_volume_125_scale + proj_height_1_scale"
table.glm[i,3]<-AIC(glm7)

glm8<- glm(fire_pres ~ tave07 * ppt07 +
             proj_age_1_scale +
             proj_height_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + proj_height_1_scale + proj_age_1_scale"
table.glm[i,3]<-AIC(glm8)

glm9<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             live_stand_volume_125_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + live_stand_volume_125_scale"
table.glm[i,3]<-AIC(glm9)

glm10<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             proj_age_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + proj_age_1_scale"
table.glm[i,3]<-AIC(glm10)

glm11<- glm(fire_pres ~ tave07 * ppt07 +
              vegtype + 
              proj_height_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + proj_height_1_scale"
table.glm[i,3]<-AIC(glm11)

glm12<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             live_stand_volume_125_scale +
             proj_age_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + live_stand_volume_125_scale + proj_age_1_scale"
table.glm[i,3]<-AIC(glm12)

glm13<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             live_stand_volume_125_scale +
             proj_height_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm13)
i=13
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + live_stand_volume_125_scale + proj_height_1_scale"
table.glm[i,3]<-AIC(glm13)

glm14<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             proj_age_1_scale +
             proj_height_1_scale,
           data= essf_nt,
           family = binomial,
           na.action=na.omit)
summary(glm14)
i=14
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + proj_age_1_scale + proj_height_1_scale"
table.glm[i,3]<-AIC(glm14)


table.glm$delta.aic<- table.glm$AIC - min(table.glm$AIC)
table.glm[order(table.glm$delta.aic),]

# TOP MODEL IS glm13: tave07 * ppt07 + vegtype + live_stand_volume_125_scale + proj_height_1_scale
```

Now inspect the top model from the AIC table and alter below to match.

```{r essf_nt model fits}
####################################################
##### TOP MODEL####

essf_nt_red<-essf_nt %>% drop_na(live_stand_volume_125_scale, proj_age_1_scale, vegtype)

glm_best<- glm(fire_pres ~ scale(tave07) * scale(ppt07) +
             live_stand_volume_125_scale +
             proj_age_1_scale +
            vegtype,
           data= essf_nt_red,
           family = binomial,
           na.action=na.omit)
summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


essf_nt_red$resids<-resid(glm_best)

binnedplot (essf_nt_red$live_stand_volume_125_scale, 
            essf_nt_red$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (essf_nt_red$proj_age_1_scale, 
            essf_nt_red$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


### Residual plots are not amazing...

##Add to top model table
top_mod_ntable_nt[4,1]<-"ESSF"
top_mod_ntable_nt[4,2]<-"Y"
top_mod_ntable_nt[4,3]<-"fire_pres ~ tave07*ppt07 + live_stand_volume_125_scale + proj_age_1_scale + vegtype"
top_mod_ntable_nt[4,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[4,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_ntable_nt[4,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_ntable_nt[4,7]<- coef(glm_best)[11] #Climate variable interaction
#top_mod_ntable_nt[4,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[4,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_ntable_nt[4,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_ntable_nt[4,11]<- coef(glm_best)[4] #coefficient vegtypeD
top_mod_ntable_nt[4,12]<- coef(glm_best)[6] #coefficient vegtypeOP
top_mod_ntable_nt[4,13]<- coef(glm_best)[7] #coefficient vegtypeS
top_mod_ntable_nt[4,14]<- coef(glm_best)[8] #coefficient vegtypeTB
top_mod_ntable_nt[4,15]<- coef(glm_best)[9] #coefficient vegtypeTC
top_mod_ntable_nt[4,16]<- coef(glm_best)[10] #coefficient vegtypeTM
top_mod_ntable_nt

```


## BEC ZONE SBS

```{r sbs climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_ntmax07_ntmax08
sbs<- dat %>%
  filter(zone=="SBS")

#Separate by trees and no trees
sbs_nt<- sbs %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
sbs_nt<- sbs %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(sbs_nt$vegtype)
table(sbs_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(sbs_nt, aes(mean_ntmax07_ntmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Mean Tmax_07 and Tmax_08") + ylab("Pr (ignition)")
p

hist(sbs_nt$mean_ntmax07_ntmax08)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(sbs_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(sbs_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(sbs_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(sbs_nt$proj_age_1, breaks=30)
hist(sbs_nt$live_stand_volume_125, breaks=30)

```

```{r sbs model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then some of these models cannot be run and will need to be excluded.

glm1<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08), 
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_ntmax07_ntmax08"
table.glm[1,3]<-AIC(glm1)
binnedplot (fitted(glm1), 
            residuals(glm1), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm1")

#veg_variables<- c("vegtype", "proj_age_1", "proj_height_1", "live_stand_volume_125", "subzone")

glm2<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             vegtype, 
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_ntmax07_ntmax08 + vegtype"
table.glm[i,3]<-AIC(glm2)
binnedplot (fitted(glm2), 
            residuals(glm2), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm2")

glm3<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             scale(proj_age_1), 
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + proj_age_1"
table.glm[i,3]<-AIC(glm3)

glm4<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             scale(proj_height_1), 
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + proj_height_1"
table.glm[i,3]<-AIC(glm4)

glm5<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             scale(live_stand_volume_125), 
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + live_stand_volume_125"
table.glm[i,3]<-AIC(glm5)

glm6<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm6)

glm7<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm7)

glm8<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + proj_height_1 + proj_age_1"
table.glm[i,3]<-AIC(glm8)

glm9<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             vegtype +
             scale(live_stand_volume_125),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + vegtype + live_stand_volume_125"
table.glm[i,3]<-AIC(glm9)

glm10<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             vegtype +
             scale(proj_age_1),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + vegtype + proj_age_1"
table.glm[i,3]<-AIC(glm10)

glm11<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
              vegtype + 
              scale(proj_height_1),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + vegtype + proj_height_1"
table.glm[i,3]<-AIC(glm11)

glm12<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             vegtype +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + vegtype + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm12)

glm13<- glm(fire_pres ~ mean_ntmax07_ntmax08 +
             vegtype +
             live_stand_volume_125 +
             proj_height_1,
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm13)
i=13
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + vegtype + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm13)

glm14<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             vegtype +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbs_nt,
           family = binomial,
           na.action=na.omit)
summary(glm14)
i=14
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax07_ntmax08 + vegtype + proj_age_1 + proj_height_1"
table.glm[i,3]<-AIC(glm14)

table.glm$delta.aic<- table.glm$AIC - min(table.glm$AIC)
table.glm[order(table.glm$delta.aic),]

# TOP MODEL IS glm13: mean_ntmax07_ntmax08 + vegtype + live_stand_volume_125 + proj_height_1
```

Now inspect the top model from the AIC table and alter below to match.

```{r sbs model fits}
####################################################
##### TOP MODEL####

sbs_nt2<-sbs_nt %>% drop_na(live_stand_volume_125, proj_height_1, vegtype)

glm_best<- glm(fire_pres ~ scale(mean_ntmax07_ntmax08) +
             scale(live_stand_volume_125) +
             scale(proj_height_1) +
             vegtype,
           data= sbs_nt2,
           family = binomial,
           na.action=na.omit)
summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


sbs_nt2$resids<-resid(glm_best)

binnedplot (sbs_nt2$live_stand_volume_125, 
            sbs_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (sbs_nt2$proj_age_1, 
            sbs_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))
# this one has a slight up down trend. Ill try to scale proj_age_1 and see if this helps




##Add to top model table
top_mod_ntable_nt[5,1]<-"SBS"
top_mod_ntable_nt[5,2]<-"Y"
top_mod_ntable_nt[5,3]<-"fire_pres ~ mean_ntmax07_ntmax08 + live_stand_volume_125 + proj_height_1 + vegtype"
top_mod_ntable_nt[5,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[5,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_ntable_nt[5,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_ntable_nt[5,7]<- coef(glm_best)[11] #Climate variable interaction
top_mod_ntable_nt[5,8]<- coef(glm_best)[4] #coef_stand_height
top_mod_ntable_nt[5,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_ntable_nt[5,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_ntable_nt[5,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[5,12]<- coef(glm_best)[5] #coefficient vegtypeOP
#top_mod_ntable_nt[5,13]<- coef(glm_best)[6] #coefficient vegtypeS
top_mod_ntable_nt[5,14]<- coef(glm_best)[5] #coefficient vegtypeTB
top_mod_ntable_nt[5,15]<- coef(glm_best)[6] #coefficient vegtypeTC
top_mod_ntable_nt[5,16]<- coef(glm_best)[7] #coefficient vegtypeTM
top_mod_ntable_nt

```

## BEC ZONE SBPS

```{r sbps climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_ntmax07_ntmax08
sbps<- dat %>%
  filter(zone=="SBPS")

#Separate by trees and no trees
sbps_nt<- sbps %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
sbps_nt<- sbps %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(sbps_nt$vegtype)
table(sbps_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(sbps_nt, aes(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09") + ylab("Pr (ignition)")
p

hist(sbps_nt$mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(sbps_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(sbps_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(sbps_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(sbps_nt$proj_age_1, breaks=30)
hist(sbps_nt$live_stand_volume_125, breaks=30)

```

```{r sbps_nt model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then some models need to be commented out and model numbers updated.

glm1<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09), 
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09"
table.glm[1,3]<-AIC(glm1)

glm2<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             vegtype, 
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + vegtype"
table.glm[i,3]<-AIC(glm2)

glm3<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             proj_age_1, 
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + proj_age_1"
table.glm[i,3]<-AIC(glm3)

glm4<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             scale(proj_height_1), 
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + proj_height_1"
table.glm[i,3]<-AIC(glm4)

glm5<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             scale(live_stand_volume_125), 
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + live_stand_volume_125"
table.glm[i,3]<-AIC(glm5)

glm6<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm6)

glm7<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm7)

glm8<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + proj_height_1 + proj_age_1"
table.glm[i,3]<-AIC(glm8)

glm9<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             vegtype +
             scale(live_stand_volume_125),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + vegtype + live_stand_volume_125"
table.glm[i,3]<-AIC(glm9)

glm10<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             vegtype +
             scale(proj_age_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + vegtype + proj_age_1"
table.glm[i,3]<-AIC(glm10)

glm11<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
              vegtype + 
              scale(proj_height_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + vegtype + proj_height_1"
table.glm[i,3]<-AIC(glm11)

glm12<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             vegtype +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + vegtype + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm12)

glm13<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             vegtype +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm13)
i=13
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + vegtype + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm13)

glm14<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             vegtype +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbps_nt,
           family = binomial,
           na.action=na.omit)
summary(glm14)
i=14
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + vegtype + proj_age_1 + proj_height_1"
table.glm[i,3]<-AIC(glm14)

table.glm$delta.aic<- table.glm$AIC - min(table.glm$AIC)
table.glm[order(table.glm$delta.aic),]

# TOP MODEL IS glm7: mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + live_stand_volume_125 + proj_height_1

```


```{r sbps_nt model fits}
####################################################
##### TOP MODEL####

sbps_nt_red<-sbps_nt %>% drop_na(live_stand_volume_125, proj_height_1)

glm_best<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09) +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbps_nt_red,
           family = binomial,
           na.action=na.omit)
summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


sbps_nt_red$resids<-resid(glm_best)

binnedplot (sbps_nt_red$live_stand_volume_125, 
            sbps_nt_red$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (sbps_nt_red$proj_age_1, 
            sbps_nt_red$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))
# this one has a slight up down trend. Ill try to scale proj_age_1 and see if this helps


##Add to top model table
top_mod_ntable_nt[6,1]<-"SBPS"
top_mod_ntable_nt[6,2]<-"Y"
top_mod_ntable_nt[6,3]<-"fire_pres ~ mean_ntmax05_ntmax06_ntmax07_ntmax08_ntmax09 + live_stand_volume_125 + proj_height_1"
top_mod_ntable_nt[6,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[6,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_ntable_nt[6,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_ntable_nt[6,7]<- coef(glm_best)[11] #Climate variable interaction
top_mod_ntable_nt[6,8]<- coef(glm_best)[4] #coef_stand_height
top_mod_ntable_nt[6,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_ntable_nt[6,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_ntable_nt[6,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[6,12]<- coef(glm_best)[5] #coefficient vegtypeOP
#top_mod_ntable_nt[6,13]<- coef(glm_best)[6] #coefficient vegtypeS
#top_mod_ntable_nt[6,14]<- coef(glm_best)[5] #coefficient vegtypeTB
#top_mod_ntable_nt[6,15]<- coef(glm_best)[6] #coefficient vegtypeTC
#top_mod_ntable_nt[6,16]<- coef(glm_best)[7] #coefficient vegtypeTM
top_mod_ntable_nt

```


## BEC ZONE ICH Figures
```{r bg figures}
ICH<- dat %>% dplyr::filter(zone =="ICH")
# I will run separate analyses for treed and non-treed areas because the non-treed areas dont have information for forest height, age or volume and so these variables cant be included in the model.
ICH_nt<- ICH %>% dplyr::filter(bclcs_level_2=="T") # treed areas
ICH_nt<- ICH %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable (tmax08 x ppt08) and ignition for ICH 
p <- ggplot(ICH, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p


p <- ggplot(ICH_nt, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p



hist(ICH_nt$tmax08)


p <- ggplot(ICH, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


p <- ggplot(ICH_nt, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p



hist(ICH_nt$ppt08)


p <- ggplot(ICH_nt, aes(ppt08*tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08*tmax08") + ylab("Pr (ignition)")
p

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(ICH_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(ICH_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(ICH_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(ICH_nt$vegtype) # includes disturbed, so use this instead of bclcs_level4 (but note that most disturbed sites get eleiminated when NAs removed in final model)
table(ICH_nt$vegtype)

```

## ICH treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(tmax08)*scale(ppt08), 
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tmax08 * ppt08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1), 
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_height_1), 
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125), 
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             vegtype, # classification of tree type in the VRI 
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             vegtype,
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
           scale(proj_height_1) + 
           vegtype,
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= ICH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.ICH<- table.glm
table.glm.ICH[order(table.glm.ICH$deltaAIC),] 

#Model                                                      Variable       AIC  deltaAIC
#11 glm11 tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype  9905.907    0.0000
#6   glm6            tmax08 * ppt08 + live_stand_volume_125 +proj_age_1 10014.752  108.8450
#10 glm10              tmax08 * ppt08 + live_stand_volume_125 + vegtype 10071.034  165.1262
#4   glm4                        tmax08 * ppt08 + live_stand_volume_125 10232.234  326.3266
#8   glm8                         tmax08 * ppt08 + proj_age_1 + vegtype 10546.895  640.9872
#12 glm12         tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype 10547.330  641.4222
#9   glm9                      tmax08 * ppt08 + proj_height_1 + vegtype 10683.185  777.2771
#7   glm7                   tmax08 * ppt08 + proj_age_1 + proj_height_1 10693.948  788.0405
#2   glm2                                   tmax08 * ppt08 + proj_age_1 10705.446  799.5384
#3   glm3                                tmax08 * ppt08 + proj_height_1 10901.324  995.4168
#5   glm5                                      tmax08 * ppt08 + vegtype 11237.079 1331.1718
#1   glm1                                                tmax08 * ppt08 11468.882 1562.9745


##Best model tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype 

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

ICH_nt2<-ICH_nt %>% drop_na(live_stand_volume_125, proj_age_1, vegtype)
table(ICH_nt2$vegtype) # 5 disturbed remain from the initial 203

glm_best<- glm(fire_pres ~ scale(tmax08) * scale(ppt08)+
             scale(live_stand_volume_125) +
               scale(proj_age_1) +
               vegtype, 
           data= ICH_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


ICH_nt2$resids<-resid(glm_best)

binnedplot (ICH_nt2$live_stand_volume_125, 
            ICH_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (ICH_nt2$ppt08, 
            ICH_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (ICH_nt2$tmax08, 
            ICH_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look good

##Add to top model table
top_mod_ntable_nt[7,1]<-"ICH"
top_mod_ntable_nt[7,2]<-"Y"
top_mod_ntable_nt[7,3]<-"fire_pres ~ tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
top_mod_ntable_nt[7,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[7,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_ntable_nt[7,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_ntable_nt[7,7]<- coef(glm_best)[10] #Climate variable interaction
#top_mod_ntable_nt[7,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[7,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_ntable_nt[7,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_ntable_nt[7,11]<- coef(glm_best)[4] #coefficient vegtypeD
top_mod_ntable_nt[7,12]<- coef(glm_best)[6] #coefficient vegtypeOP
#top_mod_ntable_nt[7,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_ntable_nt[7,14]<- coef(glm_best)[7] #coefficient vegtypeTB
top_mod_ntable_nt[7,15]<- coef(glm_best)[8] #coefficient vegtypeTC
top_mod_ntable_nt[7,16]<- coef(glm_best)[9] #coefficient vegtypeTM
top_mod_ntable_nt
```


## BEC ZONE CWH Figures
```{r bg figures}
CWH<- dat %>% dplyr::filter(zone =="CWH")
# I will run separate analyses for treed and non-treed areas because the non-treed areas dont have information for forest height, age or volume and so these variables cant be included in the model.
CWH_nt<- CWH %>% dplyr::filter(bclcs_level_2=="T") # treed areas
CWH_nt<- CWH %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable (tmax08 x ppt08) and ignition for CWH 
p <- ggplot(CWH, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p


p <- ggplot(CWH_nt, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p



hist(CWH_nt$tmax08)


p <- ggplot(CWH, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


p <- ggplot(CWH_nt, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p



hist(CWH_nt$ppt08)


p <- ggplot(CWH_nt, aes(ppt08*tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08*tmax08") + ylab("Pr (ignition)")
p

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(CWH_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(CWH_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(CWH_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(CWH_nt$vegtype) # includes disturbed, so use this instead of bclcs_level4 (but note that most disturbed sites get eliminated when NAs removed in final model)
table(CWH_nt$vegtype)

```

## CWH treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(tmax08)*scale(ppt08), 
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tmax08 * ppt08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1), 
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_height_1), 
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125), 
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             vegtype, # classification of tree type in the VRI 
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             vegtype,
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
           scale(proj_height_1) + 
           vegtype,
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= CWH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.CWH<- table.glm
table.glm.CWH[order(table.glm.CWH$deltaAIC),] 

#Model                                                      Variable      AIC   deltaAIC
#11 glm11 tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype 1509.225   0.000000
#10 glm10              tmax08 * ppt08 + live_stand_volume_125 + vegtype 1510.235   1.009148
#6   glm6            tmax08 * ppt08 + live_stand_volume_125 +proj_age_1 1513.546   4.320642
#4   glm4                        tmax08 * ppt08 + live_stand_volume_125 1516.041   6.815567
#8   glm8                         tmax08 * ppt08 + proj_age_1 + vegtype 2034.670 525.444982
#12 glm12         tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype 2036.429 527.203644
#9   glm9                      tmax08 * ppt08 + proj_height_1 + vegtype 2038.001 528.775371
#2   glm2                                   tmax08 * ppt08 + proj_age_1 2044.248 535.022831
#7   glm7                   tmax08 * ppt08 + proj_age_1 + proj_height_1 2046.259 537.033472
#3   glm3                                tmax08 * ppt08 + proj_height_1 2048.887 539.661851
#5   glm5                                      tmax08 * ppt08 + vegtype 2195.610 686.384638
#1   glm1                                                tmax08 * ppt08 2205.378 696.152180


##Best model tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

CWH_nt2<-CWH_nt %>% drop_na(live_stand_volume_125, proj_age_1, vegtype)
table(CWH_nt2$vegtype) # 5 disturbed remain from the initial 203

glm_best<- glm(fire_pres ~ scale(tmax08) * scale(ppt08)+
             scale(live_stand_volume_125) +
               scale(proj_age_1) +
               vegtype, 
           data= CWH_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


CWH_nt2$resids<-resid(glm_best)

binnedplot (CWH_nt2$live_stand_volume_125, 
            CWH_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (CWH_nt2$ppt08, 
            CWH_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (CWH_nt2$tmax08, 
            CWH_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_ntable_nt[8,1]<-"CWH"
top_mod_ntable_nt[8,2]<-"Y"
top_mod_ntable_nt[8,3]<-"fire_pres ~ tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
top_mod_ntable_nt[8,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[8,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_ntable_nt[8,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_ntable_nt[8,7]<- coef(glm_best)[9] #Climate variable interaction
#top_mod_ntable_nt[8,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[8,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_ntable_nt[8,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_ntable_nt[8,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[8,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[8,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_ntable_nt[8,14]<- coef(glm_best)[6] #coefficient vegtypeTB
top_mod_ntable_nt[8,15]<- coef(glm_best)[7] #coefficient vegtypeTC
top_mod_ntable_nt[8,16]<- coef(glm_best)[8] #coefficient vegtypeTM
top_mod_ntable_nt

```



## BEC ZONE IDF Figures
```{r bg figures}
IDF<- dat %>% dplyr::filter(zone =="IDF")
# I will run separate analyses for treed and non-treed areas because the non-treed areas dont have information for forest height, age or volume and so these variables cant be included in the model.
IDF_nt<- IDF %>% dplyr::filter(bclcs_level_2=="T") # treed areas
IDF_nt<- IDF %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable (tmax08 x ppt08) and ignition for IDF 
p <- ggplot(IDF, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p


p <- ggplot(IDF_nt, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p



hist(IDF_nt$tmax08)


p <- ggplot(IDF, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


p <- ggplot(IDF_nt, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p



hist(IDF_nt$ppt08)


p <- ggplot(IDF_nt, aes(ppt08*tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08*tmax08") + ylab("Pr (ignition)")
p

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(IDF_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(IDF_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(IDF_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(IDF_nt$vegtype) # includes disturbed, so use this instead of bclcs_level4 (but note that most disturbed sites get eliminated when NAs removed in final model)
table(IDF_nt$vegtype)

```


## IDF treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(tmax07)*scale(ppt07), 
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tmax07 * ppt07"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_age_1), 
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tmax07 * ppt07 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_height_1), 
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125), 
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             vegtype, # classification of tree type in the VRI 
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_age_1) + 
             vegtype,
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
           scale(proj_height_1) + 
           vegtype,
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= IDF_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.IDF<- table.glm
table.glm.IDF[order(table.glm.IDF$deltaAIC),] 

#Model                                                      Variable      AIC   deltaAIC
#11 glm11 tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype 7229.607   0.000000
#10 glm10              tmax07 * ppt07 + live_stand_volume_125 + vegtype 7239.183   9.576046
#6   glm6            tmax07 * ppt07 + live_stand_volume_125 +proj_age_1 7251.285  21.678483
#4   glm4                        tmax07 * ppt07 + live_stand_volume_125 7268.595  38.988212
#12 glm12         tmax07 * ppt07 + proj_height_1 + proj_age_1 + vegtype 7641.474 411.866710
#8   glm8                         tmax07 * ppt07 + proj_age_1 + vegtype 7642.318 412.710785
#9   glm9                      tmax07 * ppt07 + proj_height_1 + vegtype 7643.739 414.131779
#2   glm2                                   tmax07 * ppt07 + proj_age_1 7666.938 437.331375
#7   glm7                   tmax07 * ppt07 + proj_age_1 + proj_height_1 7667.244 437.637481
#3   glm3                                tmax07 * ppt07 + proj_height_1 7675.991 446.383862
#5   glm5                                      tmax07 * ppt07 + vegtype 8108.856 879.249464
#1   glm1                                                tmax07 * ppt07 8142.728 913.121436


##Best model tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

IDF_nt2<-IDF_nt %>% drop_na(live_stand_volume_125, proj_age_1, vegtype)
table(IDF_nt2$vegtype) # Most disturbed sites lost

glm_best<- glm(fire_pres ~ scale(tmax07) * scale(ppt07)+
             scale(live_stand_volume_125) +
               scale(proj_age_1) +
               vegtype, 
           data= IDF_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


IDF_nt2$resids<-resid(glm_best)

binnedplot (IDF_nt2$live_stand_volume_125, 
            IDF_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (IDF_nt2$ppt07, 
            IDF_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (IDF_nt2$tmax07, 
            IDF_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_ntable_nt[9,1]<-"IDF"
top_mod_ntable_nt[9,2]<-"Y"
top_mod_ntable_nt[9,3]<-"fire_pres ~ tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype"
top_mod_ntable_nt[9,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[9,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_ntable_nt[9,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_ntable_nt[9,7]<- coef(glm_best)[9] #Climate variable interaction
#top_mod_ntable_nt[9,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[9,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_ntable_nt[9,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_ntable_nt[9,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[9,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[9,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_ntable_nt[9,14]<- coef(glm_best)[6] #coefficient vegtypeTB
top_mod_ntable_nt[9,15]<- coef(glm_best)[7] #coefficient vegtypeTC
top_mod_ntable_nt[9,16]<- coef(glm_best)[8] #coefficient vegtypeTM
top_mod_ntable_nt
```




## BEC ZONE IMA

```{r IMA climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_ntmax07_ntmax08
IMA<- dat %>%
  filter(zone=="IMA")

#Separate by trees and no trees
IMA_nt<- IMA %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
IMA_nt<- IMA %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(IMA_nt$vegtype)
table(IMA_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(IMA_nt, aes(mean_ntave05_ntave06, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_ntave05_ntave06") + ylab("Pr (ignition)")
p

hist(IMA_nt$mean_ntave05_ntave06)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(IMA_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(IMA_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(IMA_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(IMA_nt$proj_age_1, breaks=30)
hist(IMA_nt$live_stand_volume_125, breaks=30)

```


## IMA treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ mean_ntave05_ntave06, 
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_ntave05_ntave06"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(proj_age_1), 
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_ntave05_ntave06 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(proj_height_1), 
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(live_stand_volume_125), 
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ mean_ntave05_ntave06 +
             vegtype, # classification of tree type in the VRI 
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(proj_age_1) + 
             vegtype,
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ mean_ntave05_ntave06 +
           scale(proj_height_1) + 
           vegtype,
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(live_stand_volume_125) + 
             vegtype,
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ mean_ntave05_ntave06 +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ mean_ntave05_ntave06 +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= IMA_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntave05_ntave06 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.IMA<- table.glm
table.glm.IMA[order(table.glm.IMA$deltaAIC),] 

#Model                                                          Variable         AIC     deltaAIC
#4   glm4                        mean_ntave05_ntave06 + live_stand_volume_125    74.02171 0.000000e+00
#6   glm6            mean_ntave05_ntave06 + live_stand_volume_125 +proj_age_1    74.91448 8.927644e-01
#1   glm1                                                mean_ntave05_ntave06    78.65020 #4.628489e+00
#2   glm2                                   mean_ntave05_ntave06 + proj_age_1    78.69108 #4.669373e+00
#3   glm3                                mean_ntave05_ntave06 + proj_height_1    78.93650 #4.914793e+00
#7   glm7                   mean_ntave05_ntave06 + proj_age_1 + proj_height_1    80.70013 6.678418e+00
#11 glm11 mean_ntave05_ntave06 + live_stand_volume_125 + proj_age_1 + vegtype  9905.90747 9.831886e+03
#10 glm10              mean_ntave05_ntave06 + live_stand_volume_125 + vegtype 10071.03368 9.997012e+03
#8   glm8                         mean_ntave05_ntave06 + proj_age_1 + vegtype 10546.89467 1.047287e+04
#12 glm12         mean_ntave05_ntave06 + proj_height_1 + proj_age_1 + vegtype 10547.32970 1.047331e+04
#9   glm9                      mean_ntave05_ntave06 + proj_height_1 + vegtype 10683.18461 1.060916e+04
#5   glm5                                      mean_ntave05_ntave06 + vegtype 11237.07931 1.116306e+04

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

IMA_nt2<-IMA_nt %>% drop_na(live_stand_volume_125)
table(IMA_nt2$vegtype) # Most disturbed sites lost

glm_best<- glm(fire_pres ~ scale(mean_ntave05_ntave06)+
             scale(live_stand_volume_125), 
           data= IMA_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


IMA_nt2$resids<-resid(glm_best)

binnedplot (IMA_nt2$live_stand_volume_125, 
            IMA_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (IMA_nt2$mean_ntave05_ntave06, 
            IMA_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))



# Diagnostic plots look ok

##Add to top model table
top_mod_ntable_nt[10,1]<-"IMA"
top_mod_ntable_nt[10,2]<-"Y"
top_mod_ntable_nt[10,3]<-"fire_pres ~ mean_ntave05_ntave06 + live_stand_volume_125"
top_mod_ntable_nt[10,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[10,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_ntable_nt[10,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_ntable_nt[10,7]<- coef(glm_best)[9] #Climate variable interaction
#top_mod_ntable_nt[10,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[10,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_ntable_nt[10,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_ntable_nt[10,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[10,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[10,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_ntable_nt[10,14]<- coef(glm_best)[6] #coefficient vegtypeTB
#top_mod_ntable_nt[10,15]<- coef(glm_best)[7] #coefficient vegtypeTC
#top_mod_ntable_nt[10,16]<- coef(glm_best)[8] #coefficient vegtypeTM
top_mod_ntable_nt
```








## BEC ZONE MH

```{r MH climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_ppt08_ppt09
MH<- dat %>%
  filter(zone=="MH")

#Separate by trees and no trees
MH_nt<- MH %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
MH_nt<- MH %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(MH_nt$vegtype)
table(MH_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(MH_nt, aes(mean_ppt08_ppt09, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_ppt08_ppt09") + ylab("Pr (ignition)")
p

hist(MH_nt$mean_ppt08_ppt09)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(MH_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(MH_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(MH_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(MH_nt$proj_age_1, breaks=30)
hist(MH_nt$live_stand_volume_125, breaks=30)

```


## MH treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(mean_ppt08_ppt09), 
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_ppt08_ppt09"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_age_1), 
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_height_1), 
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125), 
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             vegtype, # classification of tree type in the VRI 
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_age_1) + 
             vegtype,
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
           scale(proj_height_1) + 
           vegtype,
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= MH_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.MH<- table.glm
table.glm.MH[order(table.glm.MH$deltaAIC),] 

#Model                                                        Variable      AIC   deltaAIC
#6   glm6            mean_ppt08_ppt09 + live_stand_volume_125 +proj_age_1 369.9763   0.000000
#4   glm4                        mean_ppt08_ppt09 + live_stand_volume_125 372.6720   2.695711
#11 glm11 mean_ppt08_ppt09 + live_stand_volume_125 + proj_age_1 + vegtype 372.6859   2.709637
#10 glm10              mean_ppt08_ppt09 + live_stand_volume_125 + vegtype 375.0995   5.123233
#12 glm12         mean_ppt08_ppt09 + proj_height_1 + proj_age_1 + vegtype 519.3666 149.390325
#2   glm2                                   mean_ppt08_ppt09 + proj_age_1 519.6185 149.642232
#8   glm8                         mean_ppt08_ppt09 + proj_age_1 + vegtype 519.6352 149.658917
#7   glm7                   mean_ppt08_ppt09 + proj_age_1 + proj_height_1 520.0387 150.062410
#9   glm9                      mean_ppt08_ppt09 + proj_height_1 + vegtype 522.5865 152.610244
#3   glm3                                mean_ppt08_ppt09 + proj_height_1 525.1243 155.148022
#5   glm5                                      mean_ppt08_ppt09 + vegtype 552.3049 182.328601
#1   glm1                                                mean_ppt08_ppt09 554.1078 184.131559

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

MH_nt2<-MH_nt %>% drop_na(live_stand_volume_125, proj_age_1)

glm_best<- glm(fire_pres ~ scale(mean_ppt08_ppt09)+
             scale(live_stand_volume_125) +
               scale(proj_age_1), 
           data= MH_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


MH_nt2$resids<-resid(glm_best)

binnedplot (MH_nt2$live_stand_volume_125, 
            MH_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (MH_nt2$mean_ppt08_ppt09, 
            MH_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_ntable_nt[11,1]<-"MH"
top_mod_ntable_nt[11,2]<-"Y"
top_mod_ntable_nt[11,3]<-"fire_pres ~ mean_ppt08_ppt09 + live_stand_volume_125 +proj_age_1"
top_mod_ntable_nt[11,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[11,5]<- coef(glm_best)[2] #ClMHte variable 1
#top_mod_ntable_nt[11,6]<- coef(glm_best)[3] #ClMHte variable 2 (if applicable)
#top_mod_ntable_nt[11,7]<- coef(glm_best)[9] #ClMHte variable interaction
#top_mod_ntable_nt[11,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[11,9]<- coef(glm_best)[3] #live_stand_volume_125
top_mod_ntable_nt[11,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_ntable_nt[11,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[11,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[11,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_ntable_nt[11,14]<- coef(glm_best)[6] #coefficient vegtypeTB
#top_mod_ntable_nt[11,15]<- coef(glm_best)[7] #coefficient vegtypeTC
#top_mod_ntable_nt[11,16]<- coef(glm_best)[8] #coefficient vegtypeTM
top_mod_ntable_nt
```





## BEC ZONE MS

```{r MS climate figure}
# look at the data graphically in this BEC zone

# top clMStic variables for SBS were mean_ntmax07_ntmax08
MS<- dat %>%
  filter(zone=="MS")

#Separate by trees and no trees
MS_nt<- MS %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
MS_nt<- MS %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(MS_nt$vegtype)
table(MS_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(MS_nt, aes(mean_tave06_tave07_tave08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_tave06_tave07_tave08") + ylab("Pr (ignition)")
p

hist(MS_nt$mean_tave06_tave07_tave08)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(MS_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(MS_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(MS_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(MS_nt$proj_age_1, breaks=30)
hist(MS_nt$live_stand_volume_125, breaks=30)

```


## MS treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08), 
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_tave06_tave07_tave08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1), 
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_height_1), 
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125), 
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             vegtype, # classification of tree type in the VRI 
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1) + 
             vegtype,
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
           scale(proj_height_1) + 
           vegtype,
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= MS_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.MS<- table.glm
table.glm.MS[order(table.glm.MS$deltaAIC),] 

#Model                                                                 Variable      AIC    deltaAIC
#11 glm11 mean_tave06_tave07_tave08 + live_stand_volume_125 + proj_age_1 + vegtype 2153.255   0.0000000
#6   glm6            mean_tave06_tave07_tave08 + live_stand_volume_125 +proj_age_1 2154.118   0.8630376
#10 glm10              mean_tave06_tave07_tave08 + live_stand_volume_125 + vegtype 2163.379  10.1238511
#4   glm4                        mean_tave06_tave07_tave08 + live_stand_volume_125 2164.554  11.2989558
#12 glm12         mean_tave06_tave07_tave08 + proj_height_1 + proj_age_1 + vegtype 2312.630 159.3744499
#9   glm9                      mean_tave06_tave07_tave08 + proj_height_1 + vegtype 2312.743 159.4881535
#7   glm7                   mean_tave06_tave07_tave08 + proj_age_1 + proj_height_1 2319.125 165.8694262
#3   glm3                                mean_tave06_tave07_tave08 + proj_height_1 2319.322 166.0672661
#8   glm8                         mean_tave06_tave07_tave08 + proj_age_1 + vegtype 2326.132 172.8767789
#2   glm2                                   mean_tave06_tave07_tave08 + proj_age_1 2329.669 176.4139646
#5   glm5                                      mean_tave06_tave07_tave08 + vegtype 2495.537 342.2821384
#1   glm1                                                mean_tave06_tave07_tave08 2503.033 349.7775403

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

MS_nt2<-MS_nt %>% drop_na(live_stand_volume_125, proj_age_1)

glm_best<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08)+
             scale(live_stand_volume_125) +
               scale(proj_age_1) +
               vegtype, 
           data= MS_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


MS_nt2$resids<-resid(glm_best)

binnedplot (MS_nt2$live_stand_volume_125, 
            MS_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (MS_nt2$mean_tave06_tave07_tave08, 
            MS_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))



# Diagnostic plots look ok

##Add to top model table
top_mod_ntable_nt[12,1]<-"MS"
top_mod_ntable_nt[12,2]<-"Y"
top_mod_ntable_nt[12,3]<-"fire_pres ~ mean_tave06_tave07_tave08 + live_stand_volume_125 + proj_age_1 + vegtype"
top_mod_ntable_nt[12,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[12,5]<- coef(glm_best)[2] #climate variable 1
#top_mod_ntable_nt[12,6]<- coef(glm_best)[3] #climate variable 2 (if applicable)
#top_mod_ntable_nt[12,7]<- coef(glm_best)[9] #climate variable interaction
#top_mod_ntable_nt[12,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[12,9]<- coef(glm_best)[3] #live_stand_volume_125
top_mod_ntable_nt[12,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_ntable_nt[12,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[12,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[12,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_ntable_nt[12,14]<- coef(glm_best)[5] #coefficient vegtypeTB
top_mod_ntable_nt[12,15]<- coef(glm_best)[6] #coefficient vegtypeTC
top_mod_ntable_nt[12,16]<- coef(glm_best)[7] #coefficient vegtypeTM
top_mod_ntable_nt

```







## BEC ZONE PP

```{r PP climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_ntmax07_ntmax08
PP<- dat %>%
  filter(zone=="PP")

#Separate by trees and no trees
PP_nt<- PP %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
PP_nt<- PP %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(PP_nt$vegtype)
table(PP_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(PP_nt, aes(mean_ntmax05_ntmax06, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_ntmax05_ntmax06") + ylab("Pr (ignition)")
p

hist(PP_nt$mean_ntmax05_ntmax06)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(PP_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(PP_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(PP_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(PP_nt$proj_age_1, breaks=30)
hist(PP_nt$live_stand_volume_125, breaks=30)

```


## PP treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06), 
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_ntmax05_ntmax06"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(proj_age_1), 
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_ntmax05_ntmax06 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(proj_height_1), 
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(live_stand_volume_125), 
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             vegtype, # classification of tree type in the VRI 
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(proj_age_1) + 
             vegtype,
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
           scale(proj_height_1) + 
           vegtype,
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= PP_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ntmax05_ntmax06 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.PP<- table.glm
table.glm.PP[order(table.glm.PP$deltaAIC),] 

#Model                                                          Variable      AIC   deltaAIC
#10 glm10              mean_ntmax05_ntmax06 + live_stand_volume_125 + vegtype 654.2600  0.0000000
#4   glm4                        mean_ntmax05_ntmax06 + live_stand_volume_125 654.3807  0.1206701
#11 glm11 mean_ntmax05_ntmax06 + live_stand_volume_125 + proj_age_1 + vegtype 655.7796  1.5196213
#6   glm6            mean_ntmax05_ntmax06 + live_stand_volume_125 +proj_age_1 655.9487  1.6887108
#2   glm2                                   mean_ntmax05_ntmax06 + proj_age_1 667.2082 12.9481824
#3   glm3                                mean_ntmax05_ntmax06 + proj_height_1 667.5180 13.2579662
#7   glm7                   mean_ntmax05_ntmax06 + proj_age_1 + proj_height_1 669.0634 14.8034331
#8   glm8                         mean_ntmax05_ntmax06 + proj_age_1 + vegtype 670.8152 16.5552232
#9   glm9                      mean_ntmax05_ntmax06 + proj_height_1 + vegtype 671.3666 17.1066272
#12 glm12         mean_ntmax05_ntmax06 + proj_height_1 + proj_age_1 + vegtype 672.7682 18.5082398
#1   glm1                                                mean_ntmax05_ntmax06 715.9461 61.6861181
#5   glm5                                      mean_ntmax05_ntmax06 + vegtype 720.3849 66.1249404

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

PP_nt2<-PP_nt %>% drop_na(live_stand_volume_125)

glm_best<- glm(fire_pres ~ scale(mean_ntmax05_ntmax06)+
             scale(live_stand_volume_125) +
               vegtype, 
           data= PP_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


PP_nt2$resids<-resid(glm_best)

binnedplot (PP_nt2$live_stand_volume_125, 
            PP_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (PP_nt2$mean_ntmax05_ntmax06, 
            PP_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_ntable_nt[13,1]<-"PP"
top_mod_ntable_nt[13,2]<-"Y"
top_mod_ntable_nt[13,3]<-"fire_pres ~ mean_ntmax05_ntmax06 + live_stand_volume_125 + vegtype"
top_mod_ntable_nt[13,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[13,5]<- coef(glm_best)[2] #climate variable 1
#top_mod_ntable_nt[13,6]<- coef(glm_best)[3] #climate variable 2 (if applicable)
#top_mod_ntable_nt[13,7]<- coef(glm_best)[9] #climate variable interaction
#top_mod_ntable_nt[13,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[13,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_ntable_nt[13,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_ntable_nt[13,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[13,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[13,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_ntable_nt[13,14]<- coef(glm_best)[5] #coefficient vegtypeTB
top_mod_ntable_nt[13,15]<- coef(glm_best)[4] #coefficient vegtypeTC
top_mod_ntable_nt[13,16]<- coef(glm_best)[5] #coefficient vegtypeTM
top_mod_ntable_nt

```






BEC zones still need to do: SWB


## BEC ZONE SWB

```{r SWB climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_ppt08_ppt09
SWB<- dat %>%
  filter(zone=="SWB")

#Separate by trees and no trees
SWB_nt<- SWB %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
SWB_nt<- SWB %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(SWB_nt$vegtype)
table(SWB_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(SWB_nt, aes(mean_ppt08_ppt09, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_ppt08_ppt09") + ylab("Pr (ignition)")
p

hist(SWB_nt$mean_ppt08_ppt09)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(SWB_nt, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(SWB_nt, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(SWB_nt, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(SWB_nt$proj_age_1, breaks=30)
hist(SWB_nt$live_stand_volume_125, breaks=30)

```


## SWB treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(mean_ppt08_ppt09), 
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_ppt08_ppt09"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_age_1), 
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_height_1), 
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125), 
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             vegtype, # classification of tree type in the VRI 
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(proj_age_1) + 
             vegtype,
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
           scale(proj_height_1) + 
           vegtype,
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(mean_ppt08_ppt09) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= SWB_nt,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_ppt08_ppt09 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.SWB<- table.glm
table.glm.SWB[order(table.glm.SWB$deltaAIC),] 

#Model                                                        Variable      AIC   deltaAIC
#6   glm6            mean_ppt08_ppt09 + live_stand_volume_125 +proj_age_1 161.9424  0.0000000
#4   glm4                        mean_ppt08_ppt09 + live_stand_volume_125 162.2117  0.2693224
#10 glm10              mean_ppt08_ppt09 + live_stand_volume_125 + vegtype 162.6238  0.6814437
#11 glm11 mean_ppt08_ppt09 + live_stand_volume_125 + proj_age_1 + vegtype 163.5823  1.6398883
#9   glm9                      mean_ppt08_ppt09 + proj_height_1 + vegtype 194.1706 32.2282507
#7   glm7                   mean_ppt08_ppt09 + proj_age_1 + proj_height_1 194.8174 32.8750438
#3   glm3                                mean_ppt08_ppt09 + proj_height_1 194.8991 32.9567578
#12 glm12         mean_ppt08_ppt09 + proj_height_1 + proj_age_1 + vegtype 195.4663 33.5238680
#2   glm2                                   mean_ppt08_ppt09 + proj_age_1 195.5106 33.5681977
#5   glm5                                      mean_ppt08_ppt09 + vegtype 195.7991 33.8567427
#8   glm8                         mean_ppt08_ppt09 + proj_age_1 + vegtype 196.2433 34.3008879
#1   glm1                                                mean_ppt08_ppt09 197.0064 35.0640439

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

SWB_nt2<-SWB_nt %>% drop_na(live_stand_volume_125, proj_age_1)

glm_best<- glm(fire_pres ~ scale(mean_ppt08_ppt09)+
             scale(live_stand_volume_125) +
               scale(proj_age_1), 
           data= SWB_nt2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


SWB_nt2$resids<-resid(glm_best)

binnedplot (SWB_nt2$live_stand_volume_125, 
            SWB_nt2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (SWB_nt2$mean_ppt08_ppt09, 
            SWB_nt2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_ntable_nt[14,1]<-"SWB"
top_mod_ntable_nt[14,2]<-"Y"
top_mod_ntable_nt[14,3]<-"fire_pres ~ mean_ppt08_ppt09 + live_stand_volume_125 +proj_age_1"
top_mod_ntable_nt[14,4]<- coef(glm_best)[1] #Intercept
top_mod_ntable_nt[14,5]<- coef(glm_best)[2] #climate variable 1
#top_mod_ntable_nt[14,6]<- coef(glm_best)[3] #climate variable 2 (if aSWBlicable)
#top_mod_ntable_nt[14,7]<- coef(glm_best)[9] #climate variable interaction
#top_mod_ntable_nt[14,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_ntable_nt[14,9]<- coef(glm_best)[3] #live_stand_volume_125
top_mod_ntable_nt[14,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_ntable_nt[14,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_ntable_nt[14,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_ntable_nt[14,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_ntable_nt[14,14]<- coef(glm_best)[5] #coefficient vegtypeTB
#top_mod_ntable_nt[14,15]<- coef(glm_best)[4] #coefficient vegtypeTC
#top_mod_ntable_nt[14,16]<- coef(glm_best)[5] #coefficient vegtypeTM
top_mod_ntable_nt

```

