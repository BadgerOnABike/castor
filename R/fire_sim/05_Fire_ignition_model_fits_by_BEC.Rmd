---
title: "Fire ignition model fit by BEC zone"
author: "Elizabeth Kleynhans"
contributor: "Cora Skaien"
date: "20/04/2021"
output: html_document
editor_options: 
  chunk_output_type: console
---

editor_options:
  chunk_output_type: console
  
<style> 
p.caption {
  font-size: 1.2em;
}
</style>


```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
require (kableExtra)
require (data.table)
require (DBI)
require (RPostgreSQL)
require (dplyr)
require (ggplot2)
require (here)
library(ggpubr)
library(arm)
library(tidyr)
library(AICcmodavg)
library(keyring)
```


<!--
Copyright 2021 Province of British Columbia

Licensed under the Apache License, Version 2.0 (the "License");
you may not use this file except in compliance with the License.
You may obtain a copy of the License at

http://www.apache.org/licenses/LICENSE-2.0

Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS,
WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
See the License for the specific language governing permissions and limitations under the License.
-->

## Introduction

Here I am running a glm for each separate bec zone to develop a predictive equation so that I can extrapolate fire ignitions into the future. The data that I include in these glms is both vegetation and climate date. The top climate variable for each BEC zone was determined in the script "04_ignition_climate_variable_selection.R". When ran by Cora on June 23, 2021, some zones had different top models than when Liz ran code. Vegetation data is a little complicated by the fact that the VRI does not have age, height or volume data for any vegetation types that are not classified as treed. Also, it seems like forests on private land lack age, volume and height data. Because I think volume, age and height are likely good predictors of fire severity and occurrence I split up this analysis into two parts in each BEC zone. 
Firstly, in each BEC zone I split the data into treed and non-treed then I run a glm with climate and vegetation for areas that are classified as treed in the VRI and then I run another separate analysis for areas that are classified as not treed. The fixed effects I include in these analyses are slightly different, i.e. no age, volume or height data in the non-treed areas, which is why I split them up.  

# climate variable selection
In the script "04_ignition_climate_variable_selection.R" I perform an AIC and ROC analysis for each BEC zone including presence/available fire ignition points and a variety of climate variables. For this analysis I split the data into a training and a validation data set where 75% of the data was used for training and 25% was used for validation. I then fit the model and extracted the AIC and AUC values. This was repeated 100 times and at the end I calculated the average AIC and AUC values. The climate variable that results in the lowest average AIC value I decided to use in this analysis. Table 1 is a summary of which climate variables fitted best for each BEC zone. 

Note: Some climate variables resulted in delta AIC values that were very similar and had much less than 2 points difference. Also, the variable with the smallest AIC value did not always have the best AUC value. Regardless of these two issues I decided to take the climate variable with the smallest average AIC for simplicity. Results can be found in table 1 below. This file was manipulated manually and then saved on to the drive before being uploaded (i.e., it is a simplified table from that generated in the last file, 04_ignition_climate_variable_selection; code for uploading not included prior).

Note: when the rows with NAs are removed, the distutbed ("D") vegtype is removed from the data set and we are losing information on disturbed sites.

```{r, AIC table, echo = F, message = F, eval = T}

 climate.aic <- read.csv ("D:/Fire/fire_data/raw_data/ClimateBC_Data/AIC_table.csv")

kable (climate.aic,
       caption = "<b>Table 1. Top candidate climate variables as selected through an AIC analysis for each BEC zone.<b>",
       digits = 2) %>%
  kable_styling (position = "left",
                 bootstrap_options = c("striped", "hover"),
                 fixed_thead = T,
                 full_width = F,
                 font_size = 11)

```
## Pull in the data. 
```{r}
connKyle <- dbConnect(drv = RPostgreSQL::PostgreSQL(), 
                      host = key_get('dbhost', keyring = 'postgreSQL'),
                      user = key_get('dbuser', keyring = 'postgreSQL'),
                      dbname = key_get('dbname', keyring = 'postgreSQL'),
                      password = key_get('dbpass', keyring = 'postgreSQL'),
                      port = "5432")
dat <- sf::st_read  (dsn = connKyle, # connKyle
                               query = "SELECT * FROM fire_ignitions_veg_climate_clean")
dbDisconnect (connKyle)

head(dat)

```
## Examining correlation between stand level variables
```{r}
# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.67) but age and volume are not (0.28) and neither are age and height (0.44). Because volume and height are very close to 0.7 in correlation I will leave out this combination of variables from my treed models.  
dat_t<- dat %>% dplyr::filter(bclcs_level_2=="T")


ggscatter(dat_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(dat_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(dat_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

```

## BEC ZONE BG
```{r bg figures}
bg<- dat %>% dplyr::filter(zone =="BG")
# I will run separate analyses for treed and non-treed areas because the non-treed areas don't have information for forest height, age or volume and so these variables cant be included in the model.
bg_t<- bg %>% dplyr::filter(bclcs_level_2=="T") # treed areas
bg_nt<- bg %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable and ignition for bg  
p <- ggplot(bg, aes(ppt09, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt09") + ylab("Pr (ignition)")
p

p1 <- ggplot(bg_t, aes(ppt09, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt09") + ylab("Pr (ignition)")
p1

p2 <- ggplot(bg_nt, aes(ppt09, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt09") + ylab("Pr (ignition)")
p2

hist(bg_t$ppt09)
hist(scale(bg_t$ppt09))
hist(bg_nt$ppt09)
hist(scale(bg_nt$ppt09))

hist(bg_t$live_stand_volume_125)
hist(scale(bg_t$live_stand_volume_125))
hist(log(bg_t$live_stand_volume_125+1))
hist(bg_nt$live_stand_volume_125)
hist(scale(bg_nt$live_stand_volume_125))
hist(log(bg_nt$live_stand_volume_125+1))

hist(bg_t$proj_height_1)
hist(scale(bg_t$proj_height_1))
hist(scale(bg_nt$proj_height_1))
hist(bg_nt$proj_height_1)

hist(bg_t$proj_age_1)
hist(scale(bg_t$proj_age_1))
hist(bg_nt$proj_age_1)
hist(scale(bg_nt$proj_age_1))

##Scale variables of interest for applicability downstream (https://besjournals.onlinelibrary.wiley.com/doi/epdf/10.1111/j.2041-210X.2010.00012.x)

##If we choose to scale variables, we could also try to back transform the coeffienct -- because B1*X = B1*(mean-value)/SD to make downstream use easier

```

## BG treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

##For this zone, vegtype and bclcs_type_4 are identical

glm1<- glm(fire_pres ~ scale(ppt09), 
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"ppt09"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_age_1), 
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"ppt09 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_height_1), 
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125), 
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(ppt09) +
             vegtype, # classification of tree type in the VRI 
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_age_1) + 
             vegtype,
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_height_1) + 
             vegtype,
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(ppt09) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(ppt09) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= bg_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"ppt09 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.bg<- table.glm
table.glm.bg[order(table.glm.bg$deltaAIC),] 

# # 
#    Model                                                   Variable      AIC   deltaAIC
#3   glm3                                      ppt09 + proj_height_1    49.74731 0.000000
#9   glm9                      ppt09 + proj_height_1 + vegtype          51.98902 2.241716
#7   glm7                         ppt09 + proj_age_1 + proj_height_1    52.01726 2.269958
#2   glm2                                         ppt09 + proj_age_1    54.00719 4.259886
#4   glm4                              ppt09 + live_stand_volume_125    54.46260 4.715296
#12 glm12         ppt09 + proj_height_1 + proj_age_1 + vegtype          54.79458 5.047279
#1   glm1                                                      ppt09    55.85794 6.110631
#8   glm8                         ppt09 + proj_age_1 + vegtype          56.38755 6.640244
#6   glm6                  ppt09 + live_stand_volume_125 +proj_age_1    56.49051 6.743202
#10 glm10              ppt09 + live_stand_volume_125 + vegtype          57.59831 7.851009
#5   glm5                                      ppt09 + vegtype          58.75094 9.003635
#11 glm11 ppt09 + live_stand_volume_125 + proj_age_1 + vegtype          59.18188 9.434572

#TOP MODEL = glm3    ppt09 + proj_height_1 45.80242 0.0000000


####################################################

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

bg_t2<-bg_t %>% drop_na(proj_height_1)

glm_best<- glm(fire_pres ~ scale(ppt09) +
             scale(proj_height_1), 
           data= bg_t2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


bg_t2$resids<-resid(glm_best)

binnedplot (bg_t2$proj_height_1, 
            bg_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (bg_t2$ppt09, 
            bg_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

# Diagnostic plots look ok, but my sample sizes in this BEC zone are low!

# Looking at effect of forest height at the average amount of rainfall in September
plot(bg_t2$proj_height_1,bg_t2$fire_pres)
curve(invlogit(coef(glm_best)[1] +coef(glm_best)[2]*mean(bg_t2$ppt09) + coef(glm_best)[3]*x), add=TRUE)

# looking at effect of ppt09 at the average forest height.
plot(bg_t2$ppt09,bg_t2$fire_pres)
curve(invlogit(coef(glm_best)[1] +coef(glm_best)[2]*x + coef(glm_best)[3]*mean(bg_t2$proj_height_1)), add=TRUE)


# create model table (only do this once) and add the relevant data
top_mod_table <- data.frame (matrix (ncol = 16, nrow = 0))
colnames (top_mod_table) <- c ("ZONE", "TREED", "Model_terms", "intercept", "coef_climate_1", "coef_climate_2", "coef_climate_interaction", "coef_stand_height", "coef_live_stand_volume_125", "coef_proj_age", "coef_vegtypeD", "coef_vegtypeOP", "coef_vegtypeS", "coef_vegtypeTB", "coef_vegtypeTC", "coef_vegtypeTM")

##Add data for BG
top_mod_table[1,1]<-"BG"
top_mod_table[1,2]<-"Y"
top_mod_table[1,3]<-"fire_pres ~ ppt09 + proj_height_1"
top_mod_table[1,4]<- coef(glm_best)[1] #Intercept
top_mod_table[1,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_table[1,6]<- coef(glm_best)[2] #Climate variable 2
#top_mod_table[1,7]<- coef(glm_best)[3] #Interaction climate variables
top_mod_table[1,8]<- coef(glm_best)[3] #coef_stand_height
#top_mod_table[1,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_table[1,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_table[1,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[1,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_table[1,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_table[1,14]<- coef(glm_best)[4] #coefficient vegtypeTB
#top_mod_table[1,15]<- coef(glm_best)[4] #coefficient vegtypeTC
#top_mod_table[1,16]<- coef(glm_best)[5] #coefficient vegtypeTM
top_mod_table ##Determine if better way to represent categories for vegtype, and if each climate variable should have its own column

```


## BEC ZONE BWBS Figures
```{r bg figures}
bwbs<- dat %>% dplyr::filter(zone =="BWBS")
# I will run separate analyses for treed and non-treed areas because the non-treed areas dont have information for forest height, age or volume and so these variables cant be included in the model.
bwbs_t<- bwbs %>% dplyr::filter(bclcs_level_2=="T") # treed areas
bwbs_nt<- bwbs %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable (mean_tave06_tave07_tave08) and ignition for bwbs 
p <- ggplot(bwbs, aes(mean_tave06_tave07_tave08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_tave06_tave07_tave08") + ylab("Pr (ignition)")
p


p <- ggplot(bwbs_t, aes(mean_tave06_tave07_tave08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_tave06_tave07_tave08") + ylab("Pr (ignition)")
p



hist(bwbs_t$mean_tave06_tave07_tave08)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(bwbs_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(bwbs_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(bwbs_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(bwbs_t$vegtype) # includes disturbed, so use this instead of bclcs_level4
table(bwbs_t$bclcs_level4)

```

## BWBS treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08), 
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_tave06_tave07_tave08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1), 
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_height_1), 
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125), 
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             vegtype, # classification of tree type in the VRI 
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(proj_age_1) + 
             vegtype,
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
           scale(proj_height_1) + 
           vegtype,
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= bwbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave06_tave07_tave08 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.bwbs<- table.glm
table.glm.bwbs[order(table.glm.bwbs$deltaAIC),] 

#Model                                                                 Variable      AIC     deltaAIC
#10 glm10              mean_tave06_tave07_tave08 + live_stand_volume_125 + vegtype 3077.657    0.0000000
#11 glm11 mean_tave06_tave07_tave08 + live_stand_volume_125 + proj_age_1 + vegtype 3077.760    0.1022174
#6   glm6            mean_tave06_tave07_tave08 + live_stand_volume_125 +proj_age_1 3151.168   73.5104173
#4   glm4                        mean_tave06_tave07_tave08 + live_stand_volume_125 3168.809   91.1516085
#12 glm12         mean_tave06_tave07_tave08 + proj_height_1 + proj_age_1 + vegtype 4035.163  957.5056233
#8   glm8                         mean_tave06_tave07_tave08 + proj_age_1 + vegtype 4035.906  958.2482586
#9   glm9                      mean_tave06_tave07_tave08 + proj_height_1 + vegtype 4037.444  959.7863034
#5   glm5                                      mean_tave06_tave07_tave08 + vegtype 4085.880 1008.2224722
#7   glm7                   mean_tave06_tave07_tave08 + proj_age_1 + proj_height_1 4103.615 1025.9575807
#3   glm3                                mean_tave06_tave07_tave08 + proj_height_1 4142.327 1064.6701668
#2   glm2                                   mean_tave06_tave07_tave08 + proj_age_1 4152.729 1075.0719111
#1   glm1                                                mean_tave06_tave07_tave08 4210.062 1132.4045046
####################################################


```

Now inspect the top model from the AIC table and alter below to match.

```{r}

##### TOP MODEL####

bwbs_t2<-bwbs_t %>% drop_na(live_stand_volume_125)

glm_best<- glm(fire_pres ~ scale(mean_tave06_tave07_tave08)+
             scale(live_stand_volume_125) +
               vegtype, 
           data= bwbs_t2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


bwbs_t2$resids<-resid(glm_best)

binnedplot (bwbs_t2$live_stand_volume_125, 
            bwbs_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (bwbs_t2$mean_tave06_tave07_tave08, 
            bwbs_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok, not great.

##Add to top model table
top_mod_table[2,1]<-"BWBS"
top_mod_table[2,2]<-"Y"
top_mod_table[2,3]<-"fire_pres ~ mean_tave06_tave07_tave08 + live_stand_volume_125 + vegtype"
top_mod_table[2,4]<- coef(glm_best)[1] #Intercept
top_mod_table[2,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_table[2,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_table[2,7]<- coef(glm_best)[3] #Climate variable interaction
#top_mod_table[2,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_table[2,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_table[2,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_table[2,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[2,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_table[2,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_table[2,14]<- coef(glm_best)[4] #coefficient vegtypeTB
top_mod_table[2,15]<- coef(glm_best)[5] #coefficient vegtypeTC
top_mod_table[2,16]<- coef(glm_best)[6] #coefficient vegtypeTM
top_mod_table
```


## CMA treed statistical model 

```{r BG treed model fits}

cma<- dat %>% dplyr::filter(zone =="CMA")
# I will run separate analyses for treed and non-treed areas because the non-treed areas don't have information for forest height, age or volume and so these variables cant be included in the model.
cma_t<- cma %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
cma_nt<- cma %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(cma_t$vegtype)

##Check correlations
ggscatter(cma, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(cma, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(cma, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

ggscatter(cma_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(cma_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(cma_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(cma_t$proj_age_1, breaks=30)
hist(scale(cma_t$proj_age_1), breaks=30)
hist(cma_t$live_stand_volume_125, breaks=30)
hist(scale(cma_t$live_stand_volume_125), breaks=30)

table(cma_t$vegtype)
```

Run chunk below. Note, if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to be models 5 and 6.

```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

##Analyses
glm1<- glm(fire_pres ~ scale(tave08) * scale(ppt08), 
           data= cma_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tave08 * ppt08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(proj_age_1), 
           data= cma_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tave08 * ppt08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(proj_height_1), 
           data= cma_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(live_stand_volume_125), 
           data= cma_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

#glm5<- glm(fire_pres ~ tave08 * ppt08 +
#             vegtype, # classification of tree type in the VRI; cannot do, because only TC 
#           data= cma_t,
#           family = binomial,
#           na.action=na.omit)
#summary(glm5)
#i=5
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + vegtype"
#table.glm[i,3]<-AICc(glm5)

glm5<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= cma_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tave08) * scale(ppt08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= cma_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave08 * ppt08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm6)

#glm8<- glm(fire_pres ~ tave08 * ppt08 +
#             proj_age_1 + 
#             vegtype, #When Cora runs this, there is only one level for vegtype and thus an error arises
#           data= cma_t,
#           family = binomial,
#           na.action=na.omit)
#summary(glm8)
#i=8
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + proj_age_1 + vegtype"
#table.glm[i,3]<-AICc(glm8)

#glm9<- glm(fire_pres ~ tave08 * ppt08 +
#             proj_height_1 + 
#             vegtype, #Only one level 
#           data= cma_t,
#           family = binomial,
#           na.action=na.omit)
#summary(glm9)
#i=9
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + proj_height_1 + vegtype"
#table.glm[i,3]<-AICc(glm9)

#glm10<- glm(fire_pres ~ tave08 * ppt08 +
#             live_stand_volume_125 + 
#             vegtype,
#           data= cma_t,
#           family = binomial,
#           na.action=na.omit)
#summary(glm10)
#i=10
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125 + vegtype"
#table.glm[i,3]<-AICc(glm10)

#glm11<- glm(fire_pres ~ tave08 * ppt08 +
#             live_stand_volume_125 + 
#              proj_age_1 +
#             vegtype,
#           data= cma_t,
#           family = binomial,
#           na.action=na.omit)
#summary(glm11)
#i=11
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
#table.glm[i,3]<-AICc(glm11)

#glm12<- glm(fire_pres ~ tave08 * ppt08 +
#              proj_height_1 +
#              proj_age_1 +
#             vegtype,
#           data= cma_t,
#           family = binomial,
#           na.action=na.omit)
#summary(glm12)
#i=12
#table.glm[i,1]<-paste0("glm",i)
#table.glm[i,2]<-"tave08 * ppt08 + proj_height_1 + proj_age_1 + vegtype"
#table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.cma<- table.glm
table.glm.cma[order(table.glm.cma$deltaAIC),] #


#    Model                                           Variable      AIC  deltaAIC
#4  glm4             tave08 * ppt08 + live_stand_volume_125 47.99134  0.000000
#5  glm5 tave08 * ppt08 + live_stand_volume_125 +proj_age_1 50.25766  2.266327
#2  glm2                        tave08 * ppt08 + proj_age_1 56.95475  8.963410
#3  glm3                     tave08 * ppt08 + proj_height_1 57.63835  9.647012
#1  glm1                                     tave08 * ppt08 58.87539 10.884057
#6  glm6        tave08 * ppt08 + proj_age_1 + proj_height_1 59.16631 11.174974

####################################################

```


Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

cma_t2<-cma_t %>% drop_na(live_stand_volume_125)

glm_best<- glm(fire_pres ~ scale(tave08) * scale(ppt08)+
             scale(live_stand_volume_125),
           data= cma_t2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


cma_t2$resids<-resid(glm_best)

binnedplot (cma_t2$live_stand_volume_125, 
            cma_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (cma_t2$mean_tave06_tave07_tave08, 
            cma_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))



# Diagnostic plots look ok, not great! Fairly small sample size for this zone.


##Add to top model table
top_mod_table[3,1]<-"CMA"
top_mod_table[3,2]<-"Y"
top_mod_table[3,3]<-"fire_pres ~ tave08 * ppt08 + live_stand_volume_125 + vegtype"
top_mod_table[3,4]<- coef(glm_best)[1] #Intercept
top_mod_table[3,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_table[3,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_table[3,7]<- coef(glm_best)[5] #Climate variable interaction
#top_mod_table[3,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_table[3,9]<- coef(glm_best)[4] #live_stand_volume_125
#top_mod_table[3,10]<- coef(glm_best)[4] #proj_age_1
#top_mod_table[3,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[3,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_table[3,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_table[3,14]<- coef(glm_best)[4] #coefficient vegtypeTB
#top_mod_table[3,15]<- coef(glm_best)[4] #coefficient vegtypeTC
#top_mod_table[3,16]<- coef(glm_best)[5] #coefficient vegtypeTM
top_mod_table

```




## BEC ZONE ESSF
```{r essf climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for essf were 
essf<- dat %>%
  filter(zone=="ESSF")

#Separate by trees and no trees
essf_t<- essf %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
essf_nt<- essf %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(essf_t$vegtype)
table(essf_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(essf_t, aes(tave08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("TAve08") + ylab("Pr (ignition)")
p

p <- ggplot(essf_t, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


hist(essf_t$tave08)
hist(essf_t$ppt08, breaks=30)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(essf_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(essf_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(essf_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(essf_t$proj_age_1)
hist(scale(essf_t$proj_age_1))
hist(essf_t$proj_height_1)
hist(scale(essf_t$proj_height_1))
hist(essf_t$live_stand_volume_125, breaks=30)
hist(scale(essf_t$live_stand_volume_125), breaks=30)
```

```{r essf_1 model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then some of these models cannot be run and will need to be excluded.

essf_t$proj_age_1_scale<-scale(essf_t$proj_age_1)
essf_t$live_stand_volume_125_scale<-scale(essf_t$live_stand_volume_125)
essf_t$proj_height_1_scale<-scale(essf_t$proj_height_1)


glm1<- glm(fire_pres ~ tave07 * ppt07, 
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tave07 * ppt07"
table.glm[1,3]<-AIC(glm1)

glm2<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype, 
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tave07 * ppt07 + vegtype"
table.glm[i,3]<-AIC(glm2)


glm3<- glm(fire_pres ~ tave07 * ppt07 +
             proj_age_1_scale, 
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + proj_age_1_scale"
table.glm[i,3]<-AIC(glm3)

glm4<- glm(fire_pres ~ tave07 * ppt07 +
             proj_height_1_scale, 
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + proj_height_1_scale"
table.glm[i,3]<-AIC(glm4)

glm5<- glm(fire_pres ~ tave07 * ppt07 +
             live_stand_volume_125_scale, 
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + live_stand_volume_125_scale"
table.glm[i,3]<-AIC(glm5)

glm6<- glm(fire_pres ~ tave07 * ppt07 +
             live_stand_volume_125_scale +
             proj_age_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + live_stand_volume_125_scale + proj_age_1_scale"
table.glm[i,3]<-AIC(glm6)

glm7<- glm(fire_pres ~ tave07 * ppt07 +
             live_stand_volume_125_scale +
             proj_height_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + live_stand_volume_125_scale + proj_height_1_scale"
table.glm[i,3]<-AIC(glm7)

glm8<- glm(fire_pres ~ tave07 * ppt07 +
             proj_age_1_scale +
             proj_height_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + proj_height_1_scale + proj_age_1_scale"
table.glm[i,3]<-AIC(glm8)

glm9<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             live_stand_volume_125_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + live_stand_volume_125_scale"
table.glm[i,3]<-AIC(glm9)

glm10<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             proj_age_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + proj_age_1_scale"
table.glm[i,3]<-AIC(glm10)

glm11<- glm(fire_pres ~ tave07 * ppt07 +
              vegtype + 
              proj_height_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + proj_height_1_scale"
table.glm[i,3]<-AIC(glm11)

glm12<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             live_stand_volume_125_scale +
             proj_age_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + live_stand_volume_125_scale + proj_age_1_scale"
table.glm[i,3]<-AIC(glm12)

glm13<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             live_stand_volume_125_scale +
             proj_height_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm13)
i=13
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + live_stand_volume_125_scale + proj_height_1_scale"
table.glm[i,3]<-AIC(glm13)

glm14<- glm(fire_pres ~ tave07 * ppt07 +
             vegtype +
             proj_age_1_scale +
             proj_height_1_scale,
           data= essf_t,
           family = binomial,
           na.action=na.omit)
summary(glm14)
i=14
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tave07 * ppt07 + vegtype + proj_age_1_scale + proj_height_1_scale"
table.glm[i,3]<-AIC(glm14)


table.glm$delta.aic<- table.glm$AIC - min(table.glm$AIC)
table.glm[order(table.glm$delta.aic),]

# TOP MODEL IS glm13: tave07 * ppt07 + vegtype + live_stand_volume_125_scale + proj_height_1_scale
```

Now inspect the top model from the AIC table and alter below to match.

```{r essf_t model fits}
####################################################
##### TOP MODEL####

essf_t_red<-essf_t %>% drop_na(live_stand_volume_125_scale, proj_age_1_scale, vegtype)

glm_best<- glm(fire_pres ~ scale(tave07) * scale(ppt07) +
             live_stand_volume_125_scale +
             proj_age_1_scale +
            vegtype,
           data= essf_t_red,
           family = binomial,
           na.action=na.omit)
summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


essf_t_red$resids<-resid(glm_best)

binnedplot (essf_t_red$live_stand_volume_125_scale, 
            essf_t_red$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (essf_t_red$proj_age_1_scale, 
            essf_t_red$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


### Residual plots are not amazing...

##Add to top model table
top_mod_table[4,1]<-"ESSF"
top_mod_table[4,2]<-"Y"
top_mod_table[4,3]<-"fire_pres ~ tave07*ppt07 + live_stand_volume_125_scale + proj_age_1_scale + vegtype"
top_mod_table[4,4]<- coef(glm_best)[1] #Intercept
top_mod_table[4,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_table[4,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_table[4,7]<- coef(glm_best)[11] #Climate variable interaction
#top_mod_table[4,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_table[4,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_table[4,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_table[4,11]<- coef(glm_best)[4] #coefficient vegtypeD
top_mod_table[4,12]<- coef(glm_best)[6] #coefficient vegtypeOP
top_mod_table[4,13]<- coef(glm_best)[7] #coefficient vegtypeS
top_mod_table[4,14]<- coef(glm_best)[8] #coefficient vegtypeTB
top_mod_table[4,15]<- coef(glm_best)[9] #coefficient vegtypeTC
top_mod_table[4,16]<- coef(glm_best)[10] #coefficient vegtypeTM
top_mod_table

```


## BEC ZONE SBS

```{r sbs climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_tmax07_tmax08
sbs<- dat %>%
  filter(zone=="SBS")

#Separate by trees and no trees
sbs_t<- sbs %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
sbs_nt<- sbs %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(sbs_t$vegtype)
table(sbs_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(sbs_t, aes(mean_tmax07_tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("Mean Tmax_07 and Tmax_08") + ylab("Pr (ignition)")
p

hist(sbs_t$mean_tmax07_tmax08)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(sbs_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(sbs_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(sbs_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(sbs_t$proj_age_1, breaks=30)
hist(sbs_t$live_stand_volume_125, breaks=30)

```

```{r sbs model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then some of these models cannot be run and will need to be excluded.

glm1<- glm(fire_pres ~ scale(mean_tmax07_tmax08), 
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_tmax07_tmax08"
table.glm[1,3]<-AIC(glm1)
binnedplot (fitted(glm1), 
            residuals(glm1), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm1")

#veg_variables<- c("vegtype", "proj_age_1", "proj_height_1", "live_stand_volume_125", "subzone")

glm2<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             vegtype, 
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_tmax07_tmax08 + vegtype"
table.glm[i,3]<-AIC(glm2)
binnedplot (fitted(glm2), 
            residuals(glm2), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm2")

glm3<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             scale(proj_age_1), 
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + proj_age_1"
table.glm[i,3]<-AIC(glm3)

glm4<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             scale(proj_height_1), 
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + proj_height_1"
table.glm[i,3]<-AIC(glm4)

glm5<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             scale(live_stand_volume_125), 
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + live_stand_volume_125"
table.glm[i,3]<-AIC(glm5)

glm6<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm6)

glm7<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm7)

glm8<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + proj_height_1 + proj_age_1"
table.glm[i,3]<-AIC(glm8)

glm9<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             vegtype +
             scale(live_stand_volume_125),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + vegtype + live_stand_volume_125"
table.glm[i,3]<-AIC(glm9)

glm10<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             vegtype +
             scale(proj_age_1),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + vegtype + proj_age_1"
table.glm[i,3]<-AIC(glm10)

glm11<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
              vegtype + 
              scale(proj_height_1),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + vegtype + proj_height_1"
table.glm[i,3]<-AIC(glm11)

glm12<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             vegtype +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + vegtype + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm12)

glm13<- glm(fire_pres ~ mean_tmax07_tmax08 +
             vegtype +
             live_stand_volume_125 +
             proj_height_1,
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm13)
i=13
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + vegtype + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm13)

glm14<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             vegtype +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbs_t,
           family = binomial,
           na.action=na.omit)
summary(glm14)
i=14
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax07_tmax08 + vegtype + proj_age_1 + proj_height_1"
table.glm[i,3]<-AIC(glm14)

table.glm$delta.aic<- table.glm$AIC - min(table.glm$AIC)
table.glm[order(table.glm$delta.aic),]

# TOP MODEL IS glm13: mean_tmax07_tmax08 + vegtype + live_stand_volume_125 + proj_height_1
```

Now inspect the top model from the AIC table and alter below to match.

```{r sbs model fits}
####################################################
##### TOP MODEL####

sbs_t2<-sbs_t %>% drop_na(live_stand_volume_125, proj_height_1, vegtype)

glm_best<- glm(fire_pres ~ scale(mean_tmax07_tmax08) +
             scale(live_stand_volume_125) +
             scale(proj_height_1) +
             vegtype,
           data= sbs_t2,
           family = binomial,
           na.action=na.omit)
summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


sbs_t2$resids<-resid(glm_best)

binnedplot (sbs_t2$live_stand_volume_125, 
            sbs_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (sbs_t2$proj_age_1, 
            sbs_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))
# this one has a slight up down trend. Ill try to scale proj_age_1 and see if this helps




##Add to top model table
top_mod_table[5,1]<-"SBS"
top_mod_table[5,2]<-"Y"
top_mod_table[5,3]<-"fire_pres ~ mean_tmax07_tmax08 + live_stand_volume_125 + proj_height_1 +
             vegtype"
top_mod_table[5,4]<- coef(glm_best)[1] #Intercept
top_mod_table[5,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_table[5,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_table[5,7]<- coef(glm_best)[11] #Climate variable interaction
top_mod_table[5,8]<- coef(glm_best)[4] #coef_stand_height
top_mod_table[5,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_table[5,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_table[5,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[5,12]<- coef(glm_best)[5] #coefficient vegtypeOP
#top_mod_table[5,13]<- coef(glm_best)[6] #coefficient vegtypeS
top_mod_table[5,14]<- coef(glm_best)[5] #coefficient vegtypeTB
top_mod_table[5,15]<- coef(glm_best)[6] #coefficient vegtypeTC
top_mod_table[5,16]<- coef(glm_best)[7] #coefficient vegtypeTM
top_mod_table

```

## BEC ZONE SBPS

```{r sbps climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_tmax07_tmax08
sbps<- dat %>%
  filter(zone=="SBPS")

#Separate by trees and no trees
sbps_t<- sbps %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
sbps_nt<- sbps %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(sbps_t$vegtype)
table(sbps_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(sbps_t, aes(mean_tmax05_tmax06_tmax07_tmax08_tmax09, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_tmax05_tmax06_tmax07_tmax08_tmax09") + ylab("Pr (ignition)")
p

hist(sbps_t$mean_tmax05_tmax06_tmax07_tmax08_tmax09)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(sbps_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(sbps_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(sbps_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(sbps_t$proj_age_1, breaks=30)
hist(sbps_t$live_stand_volume_125, breaks=30)

```

```{r sbps_t model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then some models need to be commented out and model numbers updated.

glm1<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09), 
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09"
table.glm[1,3]<-AIC(glm1)

glm2<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             vegtype, 
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + vegtype"
table.glm[i,3]<-AIC(glm2)

glm3<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             proj_age_1, 
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + proj_age_1"
table.glm[i,3]<-AIC(glm3)

glm4<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             scale(proj_height_1), 
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + proj_height_1"
table.glm[i,3]<-AIC(glm4)

glm5<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             scale(live_stand_volume_125), 
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + live_stand_volume_125"
table.glm[i,3]<-AIC(glm5)

glm6<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm6)

glm7<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm7)

glm8<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + proj_height_1 + proj_age_1"
table.glm[i,3]<-AIC(glm8)

glm9<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             vegtype +
             scale(live_stand_volume_125),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + vegtype + live_stand_volume_125"
table.glm[i,3]<-AIC(glm9)

glm10<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             vegtype +
             scale(proj_age_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + vegtype + proj_age_1"
table.glm[i,3]<-AIC(glm10)

glm11<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
              vegtype + 
              scale(proj_height_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + vegtype + proj_height_1"
table.glm[i,3]<-AIC(glm11)

glm12<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             vegtype +
             scale(live_stand_volume_125) +
             scale(proj_age_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + vegtype + live_stand_volume_125 + proj_age_1"
table.glm[i,3]<-AIC(glm12)

glm13<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             vegtype +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm13)
i=13
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + vegtype + live_stand_volume_125 + proj_height_1"
table.glm[i,3]<-AIC(glm13)

glm14<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             vegtype +
             scale(proj_age_1) +
             scale(proj_height_1),
           data= sbps_t,
           family = binomial,
           na.action=na.omit)
summary(glm14)
i=14
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tmax05_tmax06_tmax07_tmax08_tmax09 + vegtype + proj_age_1 + proj_height_1"
table.glm[i,3]<-AIC(glm14)

table.glm$delta.aic<- table.glm$AIC - min(table.glm$AIC)
table.glm[order(table.glm$delta.aic),]

# TOP MODEL IS glm7: mean_tmax05_tmax06_tmax07_tmax08_tmax09 + live_stand_volume_125 + proj_height_1

```


```{r sbps_t model fits}
####################################################
##### TOP MODEL####

sbps_t_red<-sbps_t %>% drop_na(live_stand_volume_125, proj_height_1)

glm_best<- glm(fire_pres ~ scale(mean_tmax05_tmax06_tmax07_tmax08_tmax09) +
             scale(live_stand_volume_125) +
             scale(proj_height_1),
           data= sbps_t_red,
           family = binomial,
           na.action=na.omit)
summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


sbps_t_red$resids<-resid(glm_best)

binnedplot (sbps_t_red$live_stand_volume_125, 
            sbps_t_red$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (sbps_t_red$proj_age_1, 
            sbps_t_red$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))
# this one has a slight up down trend. Ill try to scale proj_age_1 and see if this helps


##Add to top model table
top_mod_table[6,1]<-"SBPS"
top_mod_table[6,2]<-"Y"
top_mod_table[6,3]<-"fire_pres ~ mean_tmax05_tmax06_tmax07_tmax08_tmax09 + live_stand_volume_125 + proj_height_1"
top_mod_table[6,4]<- coef(glm_best)[1] #Intercept
top_mod_table[6,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_table[6,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_table[6,7]<- coef(glm_best)[11] #Climate variable interaction
top_mod_table[6,8]<- coef(glm_best)[4] #coef_stand_height
top_mod_table[6,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_table[6,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_table[6,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[6,12]<- coef(glm_best)[5] #coefficient vegtypeOP
#top_mod_table[6,13]<- coef(glm_best)[6] #coefficient vegtypeS
#top_mod_table[6,14]<- coef(glm_best)[5] #coefficient vegtypeTB
#top_mod_table[6,15]<- coef(glm_best)[6] #coefficient vegtypeTC
#top_mod_table[6,16]<- coef(glm_best)[7] #coefficient vegtypeTM
top_mod_table

```


## BEC ZONE ICH Figures
```{r bg figures}
ICH<- dat %>% dplyr::filter(zone =="ICH")
# I will run separate analyses for treed and non-treed areas because the non-treed areas dont have information for forest height, age or volume and so these variables cant be included in the model.
ICH_t<- ICH %>% dplyr::filter(bclcs_level_2=="T") # treed areas
ICH_nt<- ICH %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable (tmax08 x ppt08) and ignition for ICH 
p <- ggplot(ICH, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p


p <- ggplot(ICH_t, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p



hist(ICH_t$tmax08)


p <- ggplot(ICH, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


p <- ggplot(ICH_t, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p



hist(ICH_t$ppt08)


p <- ggplot(ICH_t, aes(ppt08*tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08*tmax08") + ylab("Pr (ignition)")
p

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(ICH_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(ICH_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(ICH_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(ICH_t$vegtype) # includes disturbed, so use this instead of bclcs_level4 (but note that most disturbed sites get eleiminated when NAs removed in final model)
table(ICH_t$vegtype)

```

## ICH treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(tmax08)*scale(ppt08), 
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tmax08 * ppt08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1), 
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_height_1), 
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125), 
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             vegtype, # classification of tree type in the VRI 
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             vegtype,
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
           scale(proj_height_1) + 
           vegtype,
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= ICH_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.ICH<- table.glm
table.glm.ICH[order(table.glm.ICH$deltaAIC),] 

#Model                                                      Variable       AIC  deltaAIC
#11 glm11 tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype  9905.907    0.0000
#6   glm6            tmax08 * ppt08 + live_stand_volume_125 +proj_age_1 10014.752  108.8450
#10 glm10              tmax08 * ppt08 + live_stand_volume_125 + vegtype 10071.034  165.1262
#4   glm4                        tmax08 * ppt08 + live_stand_volume_125 10232.234  326.3266
#8   glm8                         tmax08 * ppt08 + proj_age_1 + vegtype 10546.895  640.9872
#12 glm12         tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype 10547.330  641.4222
#9   glm9                      tmax08 * ppt08 + proj_height_1 + vegtype 10683.185  777.2771
#7   glm7                   tmax08 * ppt08 + proj_age_1 + proj_height_1 10693.948  788.0405
#2   glm2                                   tmax08 * ppt08 + proj_age_1 10705.446  799.5384
#3   glm3                                tmax08 * ppt08 + proj_height_1 10901.324  995.4168
#5   glm5                                      tmax08 * ppt08 + vegtype 11237.079 1331.1718
#1   glm1                                                tmax08 * ppt08 11468.882 1562.9745


##Best model tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype 

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

ICH_t2<-ICH_t %>% drop_na(live_stand_volume_125, proj_age_1, vegtype)
table(ICH_t2$vegtype) # 5 disturbed remain from the initial 203

glm_best<- glm(fire_pres ~ scale(tmax08) * scale(ppt08)+
             scale(live_stand_volume_125) +
               scale(proj_age_1) +
               vegtype, 
           data= ICH_t2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


ICH_t2$resids<-resid(glm_best)

binnedplot (ICH_t2$live_stand_volume_125, 
            ICH_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (ICH_t2$ppt08, 
            ICH_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (ICH_t2$tmax08, 
            ICH_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look good

##Add to top model table
top_mod_table[7,1]<-"ICH"
top_mod_table[7,2]<-"Y"
top_mod_table[7,3]<-"fire_pres ~ tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
top_mod_table[7,4]<- coef(glm_best)[1] #Intercept
top_mod_table[7,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_table[7,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_table[7,7]<- coef(glm_best)[10] #Climate variable interaction
#top_mod_table[7,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_table[7,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_table[7,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_table[7,11]<- coef(glm_best)[4] #coefficient vegtypeD
top_mod_table[7,12]<- coef(glm_best)[6] #coefficient vegtypeOP
#top_mod_table[7,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_table[7,14]<- coef(glm_best)[7] #coefficient vegtypeTB
top_mod_table[7,15]<- coef(glm_best)[8] #coefficient vegtypeTC
top_mod_table[7,16]<- coef(glm_best)[9] #coefficient vegtypeTM
top_mod_table
```


## BEC ZONE CWH Figures
```{r bg figures}
CWH<- dat %>% dplyr::filter(zone =="CWH")
# I will run separate analyses for treed and non-treed areas because the non-treed areas dont have information for forest height, age or volume and so these variables cant be included in the model.
CWH_t<- CWH %>% dplyr::filter(bclcs_level_2=="T") # treed areas
CWH_nt<- CWH %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable (tmax08 x ppt08) and ignition for CWH 
p <- ggplot(CWH, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p


p <- ggplot(CWH_t, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p



hist(CWH_t$tmax08)


p <- ggplot(CWH, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


p <- ggplot(CWH_t, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p



hist(CWH_t$ppt08)


p <- ggplot(CWH_t, aes(ppt08*tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08*tmax08") + ylab("Pr (ignition)")
p

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(CWH_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(CWH_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(CWH_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(CWH_t$vegtype) # includes disturbed, so use this instead of bclcs_level4 (but note that most disturbed sites get eliminated when NAs removed in final model)
table(CWH_t$vegtype)

```

## CWH treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(tmax08)*scale(ppt08), 
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tmax08 * ppt08"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1), 
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_height_1), 
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125), 
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             vegtype, # classification of tree type in the VRI 
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(proj_age_1) + 
             vegtype,
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
           scale(proj_height_1) + 
           vegtype,
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(tmax08)*scale(ppt08) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= CWH_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.CWH<- table.glm
table.glm.CWH[order(table.glm.CWH$deltaAIC),] 

#Model                                                      Variable      AIC   deltaAIC
#11 glm11 tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype 1509.225   0.000000
#10 glm10              tmax08 * ppt08 + live_stand_volume_125 + vegtype 1510.235   1.009148
#6   glm6            tmax08 * ppt08 + live_stand_volume_125 +proj_age_1 1513.546   4.320642
#4   glm4                        tmax08 * ppt08 + live_stand_volume_125 1516.041   6.815567
#8   glm8                         tmax08 * ppt08 + proj_age_1 + vegtype 2034.670 525.444982
#12 glm12         tmax08 * ppt08 + proj_height_1 + proj_age_1 + vegtype 2036.429 527.203644
#9   glm9                      tmax08 * ppt08 + proj_height_1 + vegtype 2038.001 528.775371
#2   glm2                                   tmax08 * ppt08 + proj_age_1 2044.248 535.022831
#7   glm7                   tmax08 * ppt08 + proj_age_1 + proj_height_1 2046.259 537.033472
#3   glm3                                tmax08 * ppt08 + proj_height_1 2048.887 539.661851
#5   glm5                                      tmax08 * ppt08 + vegtype 2195.610 686.384638
#1   glm1                                                tmax08 * ppt08 2205.378 696.152180


##Best model tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

CWH_t2<-CWH_t %>% drop_na(live_stand_volume_125, proj_age_1, vegtype)
table(CWH_t2$vegtype) # 5 disturbed remain from the initial 203

glm_best<- glm(fire_pres ~ scale(tmax08) * scale(ppt08)+
             scale(live_stand_volume_125) +
               scale(proj_age_1) +
               vegtype, 
           data= CWH_t2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


CWH_t2$resids<-resid(glm_best)

binnedplot (CWH_t2$live_stand_volume_125, 
            CWH_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (CWH_t2$ppt08, 
            CWH_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (CWH_t2$tmax08, 
            CWH_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_table[8,1]<-"CWH"
top_mod_table[8,2]<-"Y"
top_mod_table[8,3]<-"fire_pres ~ tmax08 * ppt08 + live_stand_volume_125 + proj_age_1 + vegtype"
top_mod_table[8,4]<- coef(glm_best)[1] #Intercept
top_mod_table[8,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_table[8,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_table[8,7]<- coef(glm_best)[9] #Climate variable interaction
#top_mod_table[8,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_table[8,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_table[8,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_table[8,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[8,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_table[8,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_table[8,14]<- coef(glm_best)[6] #coefficient vegtypeTB
top_mod_table[8,15]<- coef(glm_best)[7] #coefficient vegtypeTC
top_mod_table[8,16]<- coef(glm_best)[8] #coefficient vegtypeTM
top_mod_table

```



## BEC ZONE IDF Figures
```{r bg figures}
IDF<- dat %>% dplyr::filter(zone =="IDF")
# I will run separate analyses for treed and non-treed areas because the non-treed areas dont have information for forest height, age or volume and so these variables cant be included in the model.
IDF_t<- IDF %>% dplyr::filter(bclcs_level_2=="T") # treed areas
IDF_nt<- IDF %>% dplyr::filter(bclcs_level_2!="T") # not treed

# examining  relationship between top climatic variable (tmax08 x ppt08) and ignition for IDF 
p <- ggplot(IDF, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p


p <- ggplot(IDF_t, aes(tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("tmax08") + ylab("Pr (ignition)")
p



hist(IDF_t$tmax08)


p <- ggplot(IDF, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p


p <- ggplot(IDF_t, aes(ppt08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08") + ylab("Pr (ignition)")
p



hist(IDF_t$ppt08)


p <- ggplot(IDF_t, aes(ppt08*tmax08, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("ppt08*tmax08") + ylab("Pr (ignition)")
p

# Examining the relationship between some stand level variables. Volume and height are fairly correlated (0.72) but age and volume are not. 
ggscatter(IDF_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(IDF_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(IDF_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

table(IDF_t$vegtype) # includes disturbed, so use this instead of bclcs_level4 (but note that most disturbed sites get eliminated when NAs removed in final model)
table(IDF_t$vegtype)

```


## IDF treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ scale(tmax07)*scale(ppt07), 
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"tmax07 * ppt07"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_age_1), 
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"tmax07 * ppt07 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_height_1), 
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125), 
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             vegtype, # classification of tree type in the VRI 
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(proj_age_1) + 
             vegtype,
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
           scale(proj_height_1) + 
           vegtype,
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125) + 
             vegtype,
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ scale(tmax07)*scale(ppt07) +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= IDF_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"tmax07 * ppt07 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.IDF<- table.glm
table.glm.IDF[order(table.glm.IDF$deltaAIC),] 

#Model                                                      Variable      AIC   deltaAIC
#11 glm11 tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype 7229.607   0.000000
#10 glm10              tmax07 * ppt07 + live_stand_volume_125 + vegtype 7239.183   9.576046
#6   glm6            tmax07 * ppt07 + live_stand_volume_125 +proj_age_1 7251.285  21.678483
#4   glm4                        tmax07 * ppt07 + live_stand_volume_125 7268.595  38.988212
#12 glm12         tmax07 * ppt07 + proj_height_1 + proj_age_1 + vegtype 7641.474 411.866710
#8   glm8                         tmax07 * ppt07 + proj_age_1 + vegtype 7642.318 412.710785
#9   glm9                      tmax07 * ppt07 + proj_height_1 + vegtype 7643.739 414.131779
#2   glm2                                   tmax07 * ppt07 + proj_age_1 7666.938 437.331375
#7   glm7                   tmax07 * ppt07 + proj_age_1 + proj_height_1 7667.244 437.637481
#3   glm3                                tmax07 * ppt07 + proj_height_1 7675.991 446.383862
#5   glm5                                      tmax07 * ppt07 + vegtype 8108.856 879.249464
#1   glm1                                                tmax07 * ppt07 8142.728 913.121436


##Best model tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

IDF_t2<-IDF_t %>% drop_na(live_stand_volume_125, proj_age_1, vegtype)
table(IDF_t2$vegtype) # Most disturbed sites lost

glm_best<- glm(fire_pres ~ scale(tmax07) * scale(ppt07)+
             scale(live_stand_volume_125) +
               scale(proj_age_1) +
               vegtype, 
           data= IDF_t2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


IDF_t2$resids<-resid(glm_best)

binnedplot (IDF_t2$live_stand_volume_125, 
            IDF_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (IDF_t2$ppt07, 
            IDF_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (IDF_t2$tmax07, 
            IDF_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_table[9,1]<-"IDF"
top_mod_table[9,2]<-"Y"
top_mod_table[9,3]<-"fire_pres ~ tmax07 * ppt07 + live_stand_volume_125 + proj_age_1 + vegtype"
top_mod_table[9,4]<- coef(glm_best)[1] #Intercept
top_mod_table[9,5]<- coef(glm_best)[2] #Climate variable 1
top_mod_table[9,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
top_mod_table[9,7]<- coef(glm_best)[9] #Climate variable interaction
#top_mod_table[9,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_table[9,9]<- coef(glm_best)[4] #live_stand_volume_125
top_mod_table[9,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_table[9,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[9,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_table[9,13]<- coef(glm_best)[4] #coefficient vegtypeS
top_mod_table[9,14]<- coef(glm_best)[6] #coefficient vegtypeTB
top_mod_table[9,15]<- coef(glm_best)[7] #coefficient vegtypeTC
top_mod_table[9,16]<- coef(glm_best)[8] #coefficient vegtypeTM
top_mod_table
```




## BEC ZONE IMA

```{r IMA climate figure}
# look at the data graphically in this BEC zone

# top climatic variables for SBS were mean_tmax07_tmax08
IMA<- dat %>%
  filter(zone=="IMA")

#Separate by trees and no trees
IMA_t<- IMA %>% dplyr::filter(bclcs_level_2=="T") # treed areas; note, only TC (no TM or TB)
IMA_nt<- IMA %>% dplyr::filter(bclcs_level_2!="T") # not treed
table(IMA_t$vegtype)
table(IMA_nt$vegtype)

# Plotting Probability of ignition versus temp and precipitation.
p <- ggplot(IMA_t, aes(mean_tave05_tave06, as.numeric(fire_pres))) +
  geom_smooth(method="glm", formula=y~x,
              method.args=list(family="binomial"),
              alpha=0.3, size=1) +
  geom_point(position=position_jitter(height=0.03, width=0)) +
  xlab("mean_tave05_tave06") + ylab("Pr (ignition)")
p

hist(IMA_t$mean_tave05_tave06)

# Examining the relationship between some stand level variables. Volume and height are fairly correlated but age and volume are not. However, none of the variables are more correlated than 0.7. So Ill try all combinations
ggscatter(IMA_t, x = "live_stand_volume_125", y = "proj_age_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand age")

ggscatter(IMA_t, x = "live_stand_volume_125", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "live stand volume", ylab = "Stand height")

ggscatter(IMA_t, x = "proj_age_1", y = "proj_height_1", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "kendall",
          xlab = "proj_age_1", ylab = "Stand height")

hist(IMA_t$proj_age_1, breaks=30)
hist(IMA_t$live_stand_volume_125, breaks=30)

```


## IMA treed statistical model 
```{r BG treed model fits}
################################
#### Fitting statistical models
################################

##Note: if only one level of vegtype exists, then these models cannot be run. In this case, models 5 and 8 through 12 must be commented out, and models 6 and 7 must be altered to models 5 and 6.

glm1<- glm(fire_pres ~ mean_tave05_tave06, 
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm1)

table.glm <- data.frame (matrix (ncol = 3, nrow = 0))
colnames (table.glm) <- c ("Model", "Variable", "AIC")
table.glm[1,1]<-"glm1"
table.glm[1,2]<-"mean_tave05_tave06"
table.glm[1,3]<-AICc(glm1)

glm2<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(proj_age_1), 
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm2)
i=2
table.glm[i,1]<-"glm2"
table.glm[i,2]<-"mean_tave05_tave06 + proj_age_1"
table.glm[i,3]<-AICc(glm2)


glm3<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(proj_height_1), 
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm3)
i=3
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + proj_height_1"
table.glm[i,3]<-AICc(glm3)

glm4<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(live_stand_volume_125), 
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm4)
i=4
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + live_stand_volume_125"
table.glm[i,3]<-AICc(glm4)

glm5<- glm(fire_pres ~ mean_tave05_tave06 +
             vegtype, # classification of tree type in the VRI 
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm5)
i=5
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + vegtype"
table.glm[i,3]<-AICc(glm5)

glm6<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(live_stand_volume_125) + 
             scale(proj_age_1),
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm6)
i=6
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + live_stand_volume_125 +proj_age_1"
table.glm[i,3]<-AICc(glm6)

glm7<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(proj_age_1) + 
             scale(proj_height_1),
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm7)
i=7
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + proj_age_1 + proj_height_1"
table.glm[i,3]<-AICc(glm7)

glm8<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(proj_age_1) + 
             vegtype,
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm8)
i=8
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm8)

glm9<- glm(fire_pres ~ mean_tave05_tave06 +
           scale(proj_height_1) + 
           vegtype,
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm9)
i=9
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + proj_height_1 + vegtype"
table.glm[i,3]<-AICc(glm9)

glm10<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(live_stand_volume_125) + 
             vegtype,
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm10)
i=10
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + live_stand_volume_125 + vegtype"
table.glm[i,3]<-AICc(glm10)

glm11<- glm(fire_pres ~ mean_tave05_tave06 +
             scale(live_stand_volume_125) + 
              scale(proj_age_1) +
             vegtype,
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm11)
i=11
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + live_stand_volume_125 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm11)

glm12<- glm(fire_pres ~ mean_tave05_tave06 +
              scale(proj_height_1) +
              scale(proj_age_1) +
             vegtype,
           data= IMA_t,
           family = binomial,
           na.action=na.omit)
summary(glm12)
i=12
table.glm[i,1]<-paste0("glm",i)
table.glm[i,2]<-"mean_tave05_tave06 + proj_height_1 + proj_age_1 + vegtype"
table.glm[i,3]<-AICc(glm12)


table.glm$deltaAIC<- table.glm$AIC-min(table.glm$AIC)

table.glm.IMA<- table.glm
table.glm.IMA[order(table.glm.IMA$deltaAIC),] 

#Model                                                          Variable         AIC     deltaAIC
#4   glm4                        mean_tave05_tave06 + live_stand_volume_125    74.02171 0.000000e+00
#6   glm6            mean_tave05_tave06 + live_stand_volume_125 +proj_age_1    74.91448 8.927644e-01
#1   glm1                                                mean_tave05_tave06    78.65020 #4.628489e+00
#2   glm2                                   mean_tave05_tave06 + proj_age_1    78.69108 #4.669373e+00
#3   glm3                                mean_tave05_tave06 + proj_height_1    78.93650 #4.914793e+00
#7   glm7                   mean_tave05_tave06 + proj_age_1 + proj_height_1    80.70013 6.678418e+00
#11 glm11 mean_tave05_tave06 + live_stand_volume_125 + proj_age_1 + vegtype  9905.90747 9.831886e+03
#10 glm10              mean_tave05_tave06 + live_stand_volume_125 + vegtype 10071.03368 9.997012e+03
#8   glm8                         mean_tave05_tave06 + proj_age_1 + vegtype 10546.89467 1.047287e+04
#12 glm12         mean_tave05_tave06 + proj_height_1 + proj_age_1 + vegtype 10547.32970 1.047331e+04
#9   glm9                      mean_tave05_tave06 + proj_height_1 + vegtype 10683.18461 1.060916e+04
#5   glm5                                      mean_tave05_tave06 + vegtype 11237.07931 1.116306e+04

```

Now inspect the top model from the AIC table and alter below to match.

```{r}
##### TOP MODEL####

IMA_t2<-IMA_t %>% drop_na(live_stand_volume_125)
table(IMA_t2$vegtype) # Most disturbed sites lost

glm_best<- glm(fire_pres ~ scale(mean_tave05_tave06)+
             scale(live_stand_volume_125), 
           data= IMA_t2,
           family = binomial,
           na.action=na.omit)

summary(glm_best)

# model diagnostic plots
binnedplot (fitted(glm_best), 
            residuals(glm_best), 
            nclass = NULL, 
            xlab = "Expected Values", 
            ylab = "Average residual", 
            main = "Binned Residual Plot - glm")


IMA_t2$resids<-resid(glm_best)

binnedplot (IMA_t2$live_stand_volume_125, 
            IMA_t2$resids, 
            nclass = NULL, 
            xlab = "live stand volume", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (IMA_t2$ppt07, 
            IMA_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))

binnedplot (IMA_t2$tmax07, 
            IMA_t2$resids, 
            nclass = NULL, 
            xlab = "", 
            ylab = "Average residual", 
            main = paste("Binned Residual Plot - glm", i))


# Diagnostic plots look ok

##Add to top model table
top_mod_table[10,1]<-"IMA"
top_mod_table[10,2]<-"Y"
top_mod_table[10,3]<-"fire_pres ~ mean_tave05_tave06 + live_stand_volume_125"
top_mod_table[10,4]<- coef(glm_best)[1] #Intercept
top_mod_table[10,5]<- coef(glm_best)[2] #Climate variable 1
#top_mod_table[10,6]<- coef(glm_best)[3] #Climate variable 2 (if applicable)
#top_mod_table[10,7]<- coef(glm_best)[9] #Climate variable interaction
#top_mod_table[10,8]<- coef(glm_best)[3] #coef_stand_height
top_mod_table[10,9]<- coef(glm_best)[3] #live_stand_volume_125
#top_mod_table[10,10]<- coef(glm_best)[5] #proj_age_1
#top_mod_table[10,11]<- coef(glm_best)[4] #coefficient vegtypeD
#top_mod_table[10,12]<- coef(glm_best)[4] #coefficient vegtypeOP
#top_mod_table[10,13]<- coef(glm_best)[4] #coefficient vegtypeS
#top_mod_table[10,14]<- coef(glm_best)[6] #coefficient vegtypeTB
#top_mod_table[10,15]<- coef(glm_best)[7] #coefficient vegtypeTC
#top_mod_table[10,16]<- coef(glm_best)[8] #coefficient vegtypeTM
top_mod_table
```




BEC zones still need to do: IMA, MH, MS, PP, SWB


```{r}


```{r}