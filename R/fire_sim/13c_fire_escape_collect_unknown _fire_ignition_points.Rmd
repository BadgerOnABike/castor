---
title: "13b_data_prep_ignition_points_with_cause_unknown"
author: "Elizabeth Kleynhans"
date: '2022-10-07'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}

```


Add FRT to ignition data
```{r}
# get latest data off BCGW
ignit_unknown<-try(
  bcdc_query_geodata("WHSE_LAND_AND_NATURAL_RESOURCE.PROT_HISTORICAL_INCIDENTS_SP") %>%
    filter(FIRE_YEAR > 2001) %>%
    filter(FIRE_TYPE == "Fire") %>%
    filter(FIRE_CAUSE =="Unknown") %>%
    collect()
)
st_crs(ignit_unknown)

table(ignit_unknown$FIRE_YEAR, ignit_unknown$FIRE_CAUSE) 
ignit_unknown$ig_mnth<-stringi::stri_sub(ignit_unknown$IGNITION_DATE,6,7)

frt <- st_read ( dsn = "D:\\Fire\\fire_data\\Fire_Regime_Types\\FRT\\FRT_Canada.shp", stringsAsFactors = T) # Read simple features from file or database, or retrieve layer names and their geometry type(s)
st_crs(frt) #Retrieve coordinate reference system from sf or sfc object

ignt.unknown.frt <- st_join(ignit_unknown, frt)
names(ignt.unknown.frt)

table(ignt.unknown.frt$Cluster)

```
Extract elevation, slope, aspect, wind, road distance and infrastructure distance

```{r}
##Slope
DEM_slope <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CLUS\\Data\\dem\\all_bc\\slope_ha_bc_3005.tif")
##Aspect
DEM_aspect <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CLUS\\Data\\dem\\all_bc\\aspect_ha_bc_3005.tif")
#Elevation
DEM <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CLUS\\Data\\dem\\all_bc\\dem_ha_bc.tif")
# Roads
roads_dist <- raster("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\dist_roads.tif")

# Infrastructure
dist_rail<- raster("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\dist_rail.tif")
dist_power<- raster("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\dist_power.tif")
dist_oil<- raster("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\dist_oil.tif")
dist_mines<- raster("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\dist_mines.tif")
dist_urban<- raster("C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\data\\dist_urban.tif")

# create raster stack
rasStack = stack(DEM_slope, DEM_aspect, DEM, roads_dist, dist_rail, dist_power, dist_oil, dist_mines, dist_urban)
head(rasStack)
str(rasStack)

names(ignt.unknown.frt)

##Try this first
test<-cbind(ignt.unknown.frt, st_coordinates(ignt.unknown.frt))
head(test)

pointCoordinates<-data.frame(test$X, test$Y)
head(pointCoordinates)
#crs(pointCoordinates) #No CRS when a dataframe

##Extract DEM values from stacked layer
rasValue2=raster::extract(rasStack, pointCoordinates)
head(rasValue2)
dim(rasValue2) #200298 values
dim(ignt.unknown.frt)#200298 values

#Append new information
ignt.unknown.frt_rasts<-cbind(ignt.unknown.frt, rasValue2)
head(ignt.unknown.frt_rasts)
crs(ignt.unknown.frt_rasts)


# do some calculations on the infrastructure
#Append new information
ignt.unknown.frt_rasts$dist_roads_m<-ignt.unknown.frt_rasts$dist_roads*100
ignt.unknown.frt_rasts$dist_mines_m<-ignt.unknown.frt_rasts$dist_mines*100
ignt.unknown.frt_rasts$dist_oil_m<-ignt.unknown.frt_rasts$dist_oil*100
ignt.unknown.frt_rasts$dist_power_m<-ignt.unknown.frt_rasts$dist_power*100
ignt.unknown.frt_rasts$dist_rail_m<-ignt.unknown.frt_rasts$dist_rail*100
ignt.unknown.frt_rasts$dist_urban_m<-ignt.unknown.frt_rasts$dist_urban*100

ignt.unknown.frt_rasts2 <- ignt.unknown.frt_rasts %>% 
  dplyr::select(id:dem_ha_bc, geometry:dist_urban_m)

head(ignt.unknown.frt_rasts2)
crs(ignt.unknown.frt_rasts2)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-0

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_rail_m < ignt.unknown.frt_rasts2$dist_power_m, ignt.unknown.frt_rasts2$dist_rail_m, ignt.unknown.frt_rasts2$dist_power_m)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_oil_m < ignt.unknown.frt_rasts2$dist_infrastructure_m, ignt.unknown.frt_rasts2$dist_oil_m, ignt.unknown.frt_rasts2$dist_infrastructure_m)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_mines_m < ignt.unknown.frt_rasts2$dist_infrastructure_m, ignt.unknown.frt_rasts2$dist_mines_m, ignt.unknown.frt_rasts2$dist_infrastructure_m)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_urban_m < ignt.unknown.frt_rasts2$dist_infrastructure_m, ignt.unknown.frt_rasts2$dist_urban_m, ignt.unknown.frt_rasts2$dist_infrastructure_m)

```

```{r}
# load in wind rasters here because they have a different extent to the other rasters so the data has to be extracted separately. (I should fix this!)

# winds
summer_wind_raster<- raster("D:\\Fire\\fire_data\\raw_data\\GovCanadaWindFiles\\wind_summer_clipped_224.tif")

spring_wind_raster<- raster("D:\\Fire\\fire_data\\raw_data\\GovCanadaWindFiles\\wind_spring_raster_224.tif")

rasStackWind = stack(summer_wind_raster, spring_wind_raster)
crs(rasStackWind)

##Extract Coordinates
test<-cbind(ignt.unknown.frt_rasts2, st_coordinates(ignt.unknown.frt_rasts2))
head(test)

pointCoordinates<-data.frame(test$X, test$Y)
head(pointCoordinates)
#crs(pointCoordinates) #No CRS when a dataframe

##Extract Wind values from stacked layer
rasValue3=raster::extract(rasStackWind, pointCoordinates)
head(rasValue3)
str(rasValue3) # 200292 values
str(ignt.unknown.frt_rasts2)# 200292 values

#Append new information
ignt.unknown.frt_rasts_wind<-cbind(ignt.unknown.frt_rasts2, rasValue3)
head(ignt.unknown.frt_rasts_wind)
crs(ignt.unknown.frt_rasts_wind)



# rename wind
names(ignt.unknown.frt_rasts_wind)
ignt.unknown.frt_rasts_wind<- ignt.unknown.frt_rasts_wind %>% rename(
  win_sum=wind_summer_clipped_224,
  win_spg=wind_spring_raster_224)
names(ignt.unknown.frt_rasts_wind)

#get provincial boundary for clipping the layers to the area of interest i.e. removing any points that fall outside the area of interest.
prov.bnd <- st_read ( dsn = "T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CLUS\\Data\\admin_boundaries\\province\\gpr_000b11a_e.shp", stringsAsFactors = T) # Read simple features from file or database, or retrieve layer names and their geometry type(s)
st_crs(prov.bnd) #Retrieve coordinate reference system from sf or sfc object
prov.bnd <- prov.bnd [prov.bnd$PRENAME == "British Columbia", ] 
crs(prov.bnd)# this one needs to be transformed to 3005
bc.bnd <- st_transform (prov.bnd, 3005) #Transform coordinate system
st_crs(bc.bnd)

#Clip FRT here
unknown_clipped<-st_intersection(bc.bnd, ignt.unknown.frt_rasts_wind)
#plot(st_geometry(frt_clipped), col=sf.colors(10,categorical=TRUE))
length(unique(unknown_clipped$Cluster))
dim(unknown_clipped)
dim(ignt.unknown.frt_rasts_wind)
unknown_clipped$idno<-1:length(unknown_clipped$FIRE_CAUSE)

st_write(unknown_clipped, dsn = "C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\ignt.unknown.frt_rasts_wind.gpkg", delete_layer=TRUE)

rm(pointCoordinates, rasValue2, test, DEM, DEM_aspect, DEM_slope) # remove some files out of memory
gc()

```


```{r}
years<-c("2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021")

for (i in 1: length(years)) {
  dat<- unknown_clipped %>% filter(FIRE_YEAR==years[i])
  sample.pts.all <- data.frame (matrix (ncol = 5, nrow = nrow (dat)))
  colnames (sample.pts.all) <- c ("ID1","ID2", "lat", "long", "el")
  sample.pts.all$ID1<- dat$idno
  sample.pts.all$ID2 <- dat$FIRE_YEAR
  sample.pts.all$lat <-as.numeric(dat$LATITUDE)
  sample.pts.all$long <- as.numeric(dat$LONGITUDE)
  sample.pts.all$el <- as.numeric(dat$dem_ha_bc)
  
  nam1<-paste("unknown_ignit.points.all.frt",years[i], "csv",sep=".")
  the_dir <- "C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp"
  write.csv(sample.pts.all, file = paste0(the_dir, "\\", basename(nam1)), row.names=FALSE)
}


```

```{r}

setwd("D:/Climatebc_v730"); # set the ClimateBC root directory as the working directory
exe <- "ClimateBC_v7.30.exe"

## 2002
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2002.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2002.csv'
yearPeriod = '/Year_2002.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2003
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2003.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2003.csv'
yearPeriod = '/Year_2003.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2004
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2004.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2004.csv'
yearPeriod = '/Year_2004.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2005
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2005.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2005.csv'
yearPeriod = '/Year_2005.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2006
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2006.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2006.csv'
yearPeriod = '/Year_2006.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2007
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2007.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2007.csv'
yearPeriod = '/Year_2007.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2008
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2008.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2008.csv'
yearPeriod = '/Year_2008.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2009
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2009.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2009.csv'
yearPeriod = '/Year_2009.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2010
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2010.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2010.csv'
yearPeriod = '/Year_2010.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2011
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2011.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2011.csv'
yearPeriod = '/Year_2011.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2012
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2012.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2012.csv'
yearPeriod = '/Year_2012.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2013
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2013.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2013.csv'
yearPeriod = '/Year_2013.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2014
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2014.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2014.csv'
yearPeriod = '/Year_2014.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2015
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2015.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2015.csv'
yearPeriod = '/Year_2015.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2016
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2016.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2016.csv'
yearPeriod = '/Year_2016.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2017
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2017.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2017.csv'
yearPeriod = '/Year_2017.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2018
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2018.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2018.csv'
yearPeriod = '/Year_2018.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2019
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2019.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2019.csv'
yearPeriod = '/Year_2019.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2020
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2020.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2020.csv'
yearPeriod = '/Year_2020.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2021
inputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2021.csv' 
outputFile = '/C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2021.csv'
yearPeriod = '/Year_2021.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

```

#Import climate data and calculate Drought Code

```{r}

###############################
#Import climate data per ignition and sample location
###############################

#Depending on where you saved your output, you may need to update the directory below
file.list1<-list.files("C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output", pattern="unknown_ignit_samp_points", all.files=FALSE, full.names=FALSE)
y1<-gsub(".csv","",file.list1)
the_dir <- "C:\\Work\\caribou\\clus\\R\\fire_sim\\tmp\\output"

for (i in 1:length(file.list1)){
  assign(paste0(y1[i]),read.csv (file=paste0(the_dir, "\\", file.list1[i])))
}

```

Because much literature suggests that the monthly drought code (MDC) is an important factor, we will use information acquired from ClimateBC to get MDC values.

```{r}
# FOR EACH DATASET CALCULATE THE MONTHLY DROUGHT CODE

#############################################
#### Equations to calculate drought code ####
#############################################
   
months<- c("02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12")
  
days_month<- c(31, 30, 31, 30, 31, 31, 30, 31, 30) # number of days in each month starting in Jan
#### Daylength adjustment factor (Lf) [Development and Structure of the Canadian Forest Fire Weather Index System pg 15, https://d1ied5g1xfgpx8.cloudfront.net/pdfs/19927.pdf] ####
# Month <- Lf value
# LF[1] is the value for Jan
Lf<-c( -1.6, 0.9, 3.8, 5.8, 6.4, 5.0, 2.4, 0.4, -1.6)
####

### Calculate drought code for Fire ignition data
filenames<-list()
for (i in 1: length(y1)){
  
  x<-eval(as.name(y1[i])) %>% 
    rename(YEAR=ID2) %>%
    dplyr::select(ID1, YEAR,Latitude, Longitude, Tmax02:Tmax11, Tave02:Tave11, PPT02:PPT11, RH02:RH11, DD18_02:DD18_11)
  
  x2<- x %>% filter(Tmax05 != -9999) # there are some locations that did not have climate data, probably because they were over the ocean, so Im removing these here.
  
  for (j in 1 : length(Lf)) {

    
    x2$MDC_02<-15 # the MDC value for Feb This assumes that the ground is saturated at the start of the season. Maybe not true for all locations... may need to think about this a little more.
    
    Em<- days_month[j]*((0.36*x2[[paste0("Tmax",months[j+1])]])+Lf[j])
    Em2 <- ifelse(Em<0, 0, Em)
    DC_half<- x2[[paste0("MDC_",months[j])]] + (0.25 * Em2)
    precip<-x2[[paste0("PPT",months[j+1])]]
    RMeff<-(0.83 * (x2[[paste0("PPT",months[j+1])]]))
    Qmr<- (800 * exp((-(DC_half))/400)) + (3.937 * RMeff)
    Qmr2 <- ifelse(Qmr>800, 800, Qmr)
    MDC_m <- (400 * log(800/Qmr2)) + 0.25*Em2
    x2[[paste0("MDC_",months[j+1])]] <- (x2[[paste0("MDC_",months[j])]] + MDC_m)/2
    x2[[paste0("MDC_",months[j+1])]] <- ifelse(x2[[paste0("MDC_",months[j+1])]] <15, 15, x2[[paste0("MDC_",months[j+1])]])
  }
  nam1<-paste("DC.",y1[i],sep="") #defining the name
  assign(nam1,x2)
  filenames<-append(filenames,nam1)
}


# combined all the DC.ignition files together
mkFrameList <- function(nfiles) {
  d <- lapply(seq_len(nfiles),function(i) {
    eval(parse(text=filenames[i]))
  })
  do.call(rbind,d)
}

n<-length(filenames)
DC.ignitions<-mkFrameList(n) 
#DC.ignitions$ID1<- as.factor(DC.ignitions$ID1)

dim(DC.ignitions) 
names(DC.ignitions)
names(unknown_clipped)
dim(unknown_clipped)

DC.ignitions1<- DC.ignitions %>% rename(idno=ID1,
                                        FIRE_YEAR=YEAR)
str(DC.ignitions1)
DC.ignitions1$FIRE_YEAR<-as.numeric(DC.ignitions1$FIRE_YEAR)
DC.ignitions1$idno<-as.numeric(as.character(DC.ignitions1$idno))


unknown_clipped$idno <- as.numeric(as.character(unknown_clipped$idno))
unknown_clipped$FIRE_YEAR <- as.numeric(as.character(unknown_clipped$FIRE_YEAR))
str(unknown_clipped)

# Now join DC.ignitions back with the original fire ignition dataset
unknown_ignition_weather<-left_join(unknown_clipped, DC.ignitions1)
head(unknown_ignition_weather)
tail(unknown_ignition_weather) #Lat -Longs match
dim(unknown_ignition_weather) 
st_crs(unknown_ignition_weather) #Answer NA
head(unknown_ignition_weather) #Note, there are 2 Lat/Long columns: ensure that they are the same; otherwise, you may be using the incorrect climate csvs that were manually created.
unknown_ignition_weather <- st_as_sf(unknown_ignition_weather)
crs(unknown_ignition_weather)
unknown_ignition_weather<- st_transform(unknown_ignition_weather, 3005)
crs(unknown_ignition_weather)

```

We want to ensure that everything lines up with the BC Boundaries, so perform below

```{r}
# Check the points line up with BC boundaries!
ggplot() +
  geom_sf(data=bc.bnd, col='red') +
  geom_sf(data=unknown_ignition_weather, col='black') #looks good
#If random points appear in middle of ocean, open in QGIS to get points and see what has happened.


# A check of the fire ignition counts per year line up with the original data. So the number of fire ignitions seem good.
```


Note: in current below file saved, the lat and long do not match and thus different points were used.

```{r}
table(unknown_ignition_weather$FIRE_YEAR, unknown_ignition_weather$FIRE_CAUSE)

unknown_ignition_weather 

st_write(unknown_ignition_weather, dsn = "C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignition_weather.gpkg", delete_layer=TRUE)
##Can also open in QGis to assess for any physical outliers and their information.

#str(ignition_weather_crs)
#head(ignition_weather_crs)
#ignition_weather_crs<-st_as_sf(ignition_weather_crs)


##Below needs: (1) update to relevant credentials and (2) then enter into the OSGeo4W command line and hit enter. 
#ogr2ogr -f PostgreSQL PG:"host=DC052586 user= dbname=clus password= port=5432" C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\tmp\\samp_locations_fire_all_15x.shp -overwrite -a_srs EPSG:3005 -progress --config PG_USE_COPY YES -nlt PROMOTE_TO_MULTI
##Above may not work because ogc_fid is NA or not right character type, and the code is trying to set this as the FID when uploading.

#key_get('dbpass', keyring = 'postgreSQL')

# OR my local machine

# ogr2ogr -f "PostgreSQL" PG:"host=localhost user=postgres dbname=postgres password=postgres port=5432" C:\\Work\\caribou\\clus_data\\Fire\\Fire_sim_data\\tmp\\samp_locations_fire_all_15x.shp -overwrite -a_srs EPSG:3005 -progress --config PG_USE_COPY YES -nlt PROMOTE_TO_MULTI

```

remove some data.frames to create more space in the memory
```{r}
rm(all_sample_points, dat, DC.ignitions, DC.ignitions1, DC.samp_points_2002, DC.samp_points_2003, DC.samp_points_2004, DC.samp_points_2005, DC.samp_points_2006, DC.samp_points_2007, DC.samp_points_2008, DC.samp_points_2009, DC.samp_points_2010, DC.samp_points_2011, DC.samp_points_2012, DC.samp_points_2013, DC.samp_points_2014, DC.samp_points_2015, DC.samp_points_2016, DC.samp_points_2017, DC.samp_points_2018, DC.samp_points_2019, DC.samp_points_2020, DC.samp_points_2021, fire.igni.ndt, fire.ignition.clipped, fire.ignition.clipped2, foo.ignit.buffered, foo_ignit_sf, foo_ignit_small, foo_ignit_small_1, samp_points_2002, samp_points_2003, samp_points_2004, samp_points_2005, samp_points_2006, samp_points_2007, samp_points_2008,samp_points_2009, samp_points_2010, samp_points_2011, samp_points_2012, samp_points_2013, samp_points_2014, samp_points_2015, samp_points_2016, samp_points_2017, samp_points_2018, samp_points_2019, samp_points_2020, samp_points_2021, foo, NDT, ndt_clipped, ndt_sf, samp_locations, samp_locations_sf, samp_points, samp_points_sf, x,x1,x2, samp_joined, samp_joined2, samp_joined_new, sample.pts.all, sample.p.trans, sample.p.trans1, ignition, ignition2, frt, frt_clipped, frt_foo ,frt_sf, ignit, igni.ndt, foo.ignit.buf.union, fire.igni.frt, pnts )

gc()
```



# now import climate data back in
