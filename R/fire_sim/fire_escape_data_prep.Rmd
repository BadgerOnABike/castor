---
title: "fire_escape_data_prep"
author: "Cora Skaien"
date: "06/07/2021"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


In Marchal et al. 2020, they define escape as "the porbability that a fire will reach a size of at least 1 ha". We will inspect the ignition data and see the size of each fire. We will then separate them into those that are <1 ha in size, and those that are > 1 ha in size. From this, we can use logistic regression, including climate variables, topography (aspect and slope), and VRI data. Below currently only accounts for lightning caused fires. Human caused fires will be modelled down the road.

Must think whether or not we want VRI data. These become polygons instead of spatial points.

```{r}

##Data already prepped at end of ignition model file 04_vri_data_prep.Bring in data from end of this step.
connKyle <- dbConnect(drv = RPostgreSQL::PostgreSQL(), 
                      host = key_get('dbhost', keyring = 'postgreSQL'),
                      user = key_get('dbuser', keyring = 'postgreSQL'),
                      dbname = key_get('dbname', keyring = 'postgreSQL'),
                      password = key_get('dbpass', keyring = 'postgreSQL'),
                      port = "5432")

fire_veg_data_B <- sf::st_read  (dsn = connKyle, # connKyle
                               query = "SELECT * FROM public.fire_ignitions_veg_climate_B")

dbDisconnect (connKyle)

head(fire_veg_data_B)

```

Now, select only those locations where a fire did occur. And then create a new category where if < 1 ha, then have 0, and if > 1 ha, have 1 value.

```{r}
table(fire_veg_data_B$fire)

fire_veg_DEM_climate<-subset(fire_veg_data_B, fire_veg_data_B$fire=="1")
head(fire_veg_DEM_climate)

str(fire_veg_DEM_climate$size_ha)
fire_veg_DEM_climate$size_ha<-as.numeric(fire_veg_DEM_climate$size_ha)
hist(fire_veg_DEM_climate$size_ha) #lots of little fires
fire_veg_DEM_climate_2<- fire_veg_DEM_climate %>% drop_na(size_ha)
str(fire_veg_DEM_climate_2) #16319 obs
min(fire_veg_DEM_climate_2$size_ha) #How is min size 0? Odd.
max(fire_veg_DEM_climate_2$size_ha) 

fire_veg_DEM_climate_2$escape<- 0
fire_veg_DEM_climate_2$escape[fire_veg_DEM_climate_2$size_ha >= 1] <- 1

table(fire_veg_DEM_climate_2$escape) #We have 13257 that did not escape, and 3062 that did escape


```
Data preparations are now complete. Move on to model selection.
