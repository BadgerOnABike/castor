---
title: "13b_data_prep_ignition_points_with_cause_unknown"
author: "Elizabeth Kleynhans"
date: '2022-10-07'
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(bcdata)

```

Add FRT to ignition data
```{r}
# get latest data off BCGW
ignit_unknown<-try(
  bcdc_query_geodata("WHSE_LAND_AND_NATURAL_RESOURCE.PROT_HISTORICAL_INCIDENTS_SP") %>%
    filter(FIRE_YEAR > 2001) %>%
    filter(FIRE_TYPE == "Fire") %>%
    #filter(FIRE_CAUSE =="Unknown") %>%
    collect()
)
st_crs(ignit_unknown)

table(ignit_unknown$FIRE_YEAR, ignit_unknown$FIRE_CAUSE) 
ignit_unknown$ig_mnth<-stringi::stri_sub(ignit_unknown$IGNITION_DATE,6,7)

frt <- st_read ( dsn = "D:\\Fire\\fire_data\\Fire_Regime_Types\\FRT\\FRT_Canada.shp", stringsAsFactors = T) # Read simple features from file or database, or retrieve layer names and their geometry type(s)
st_crs(frt) #Retrieve coordinate reference system from sf or sfc object
frt <- st_transform (frt, 3005)

ignt.unknown.frt <- st_join(ignit_unknown, frt)
names(ignt.unknown.frt)

table(ignt.unknown.frt$Cluster)

```
Extract elevation, slope, aspect, wind, road distance and infrastructure distance

```{r}
##Slope
DEM_slope <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CASTOR\\Data\\dem\\all_bc\\slope_ha_bc_3005.tif")
##Aspect
DEM_aspect <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CASTOR\\Data\\dem\\all_bc\\aspect_ha_bc_3005.tif")
#Elevation
DEM <- raster("T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CASTOR\\Data\\dem\\all_bc\\dem_ha_bc.tif")
# Roads
roads_dist <- raster("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\dist_roads.tif")

# Infrastructure
dist_rail<- raster("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\dist_rail.tif")
dist_power<- raster("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\dist_power.tif")
dist_oil<- raster("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\dist_oil.tif")
dist_mines<- raster("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\dist_mines.tif")
dist_urban<- raster("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\dist_urban.tif")

# create raster stack
rasStack = stack(DEM_slope, DEM_aspect, DEM, roads_dist, dist_rail, dist_power, dist_oil, dist_mines, dist_urban)
head(rasStack)
str(rasStack)

names(ignt.unknown.frt)

##Try this first
test<-cbind(ignt.unknown.frt, st_coordinates(ignt.unknown.frt))
head(test)

pointCoordinates<-data.frame(test$X, test$Y)
head(pointCoordinates)
#crs(pointCoordinates) #No CRS when a dataframe

##Extract DEM values from stacked layer
rasValue2=raster::extract(rasStack, pointCoordinates)
head(rasValue2)
dim(rasValue2) #33724 values
dim(ignt.unknown.frt)#33724 values

#Append new information
ignt.unknown.frt_rasts<-cbind(ignt.unknown.frt, rasValue2)
head(ignt.unknown.frt_rasts)
crs(ignt.unknown.frt_rasts)


# do some calculations on the infrastructure
#Append new information
ignt.unknown.frt_rasts$dist_roads_m<-ignt.unknown.frt_rasts$dist_roads*100
ignt.unknown.frt_rasts$dist_mines_m<-ignt.unknown.frt_rasts$dist_mines*100
ignt.unknown.frt_rasts$dist_oil_m<-ignt.unknown.frt_rasts$dist_oil*100
ignt.unknown.frt_rasts$dist_power_m<-ignt.unknown.frt_rasts$dist_power*100
ignt.unknown.frt_rasts$dist_rail_m<-ignt.unknown.frt_rasts$dist_rail*100
ignt.unknown.frt_rasts$dist_urban_m<-ignt.unknown.frt_rasts$dist_urban*100

ignt.unknown.frt_rasts2 <- ignt.unknown.frt_rasts %>% 
  dplyr::select(id:dem_ha_bc, geometry:dist_urban_m)

head(ignt.unknown.frt_rasts2)
crs(ignt.unknown.frt_rasts2)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-0

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_rail_m < ignt.unknown.frt_rasts2$dist_power_m, ignt.unknown.frt_rasts2$dist_rail_m, ignt.unknown.frt_rasts2$dist_power_m)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_oil_m < ignt.unknown.frt_rasts2$dist_infrastructure_m, ignt.unknown.frt_rasts2$dist_oil_m, ignt.unknown.frt_rasts2$dist_infrastructure_m)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_mines_m < ignt.unknown.frt_rasts2$dist_infrastructure_m, ignt.unknown.frt_rasts2$dist_mines_m, ignt.unknown.frt_rasts2$dist_infrastructure_m)

ignt.unknown.frt_rasts2$dist_infrastructure_m<-
  ifelse(ignt.unknown.frt_rasts2$dist_urban_m < ignt.unknown.frt_rasts2$dist_infrastructure_m, ignt.unknown.frt_rasts2$dist_urban_m, ignt.unknown.frt_rasts2$dist_infrastructure_m)

```

```{r}
# load in wind rasters here because they have a different extent to the other rasters so the data has to be extracted separately. (I should fix this!)

# winds
summer_wind_raster<- raster("D:\\Fire\\fire_data\\raw_data\\GovCanadaWindFiles\\wind_summer_clipped_224.tif")

spring_wind_raster<- raster("D:\\Fire\\fire_data\\raw_data\\GovCanadaWindFiles\\wind_spring_raster_224.tif")

rasStackWind = stack(summer_wind_raster, spring_wind_raster)
crs(rasStackWind)
rasStackWind <- projectRaster(rasStackWind,
                crs = crs(ignt.unknown.frt_rasts))


##Extract Coordinates
test<-cbind(ignt.unknown.frt_rasts2, st_coordinates(ignt.unknown.frt_rasts2))
head(test)

pointCoordinates<-data.frame(test$X, test$Y)
head(pointCoordinates)
#crs(pointCoordinates) #No CRS when a dataframe

##Extract Wind values from stacked layer
rasValue3=raster::extract(rasStackWind, pointCoordinates)
head(rasValue3)
str(rasValue3) # 200292 values
str(ignt.unknown.frt_rasts2)# 200292 values

#Append new information
ignt.unknown.frt_rasts_wind<-cbind(ignt.unknown.frt_rasts2, rasValue3)
head(ignt.unknown.frt_rasts_wind)
crs(ignt.unknown.frt_rasts_wind)

# rename wind
names(ignt.unknown.frt_rasts_wind)
ignt.unknown.frt_rasts_wind<- ignt.unknown.frt_rasts_wind %>% rename(
  win_sum=wind_summer_clipped_224,
  win_spg=wind_spring_raster_224)
names(ignt.unknown.frt_rasts_wind)

#get provincial boundary for clipping the layers to the area of interest i.e. removing any points that fall outside the area of interest.
prov.bnd <- st_read ( dsn = "T:\\FOR\\VIC\\HTS\\ANA\\PROJECTS\\CASTOR\\Data\\admin_boundaries\\province\\gpr_000b11a_e.shp", stringsAsFactors = T) # Read simple features from file or database, or retrieve layer names and their geometry type(s)
st_crs(prov.bnd) #Retrieve coordinate reference system from sf or sfc object
prov.bnd <- prov.bnd [prov.bnd$PRENAME == "British Columbia", ] 
crs(prov.bnd)# this one needs to be transformed to 3005
bc.bnd <- st_transform (prov.bnd, 3005) #Transform coordinate system
st_crs(bc.bnd)

#Clip FRT here
#unknown_clipped<-st_intersection(bc.bnd, ignt.unknown.frt_rasts_wind)
#plot(st_geometry(frt_clipped), col=sf.colors(10,categorical=TRUE))
length(unique(unknown_clipped$Cluster))
dim(unknown_clipped)
dim(ignt.unknown.frt_rasts_wind)
ignt.unknown.frt_rasts_wind$idno<-1:length(ignt.unknown.frt_rasts_wind$FIRE_CAUSE)

st_write(ignt.unknown.frt_rasts_wind, dsn = "C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\ignt.all.frt_rasts_wind1.gpkg", delete_layer=TRUE)

rm(pointCoordinates, rasValue2, test, DEM, DEM_aspect, DEM_slope) # remove some files out of memory
gc()

unknown_clipped<-ignt.unknown.frt_rasts_wind

```


```{r}
years<-c("2002", "2003", "2004", "2005", "2006", "2007", "2008", "2009", "2010", "2011", "2012", "2013", "2014", "2015", "2016", "2017", "2018", "2019", "2020", "2021", "2022")

for (i in 1: length(years)) {
  dat<- unknown_clipped %>% filter(FIRE_YEAR==years[i])
  sample.pts.all <- data.frame (matrix (ncol = 5, nrow = nrow (dat)))
  colnames (sample.pts.all) <- c ("ID1","ID2", "lat", "long", "el")
  sample.pts.all$ID1<- dat$idno
  sample.pts.all$ID2 <- dat$FIRE_YEAR
  sample.pts.all$lat <-as.numeric(dat$LATITUDE)
  sample.pts.all$long <- as.numeric(dat$LONGITUDE)
  sample.pts.all$el <- as.numeric(dat$dem_ha_bc)
  
  nam1<-paste("unknown_ignit.points.all.frt",years[i], "csv",sep=".")
  the_dir <- "C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp"
  write.csv(sample.pts.all, file = paste0(the_dir, "\\", basename(nam1)), row.names=FALSE)
}


```

```{r}

setwd("D:/Climatebc_v742"); # set the ClimateBC root directory as the working directory
exe <- "ClimateBC_v7.42.exe"

## 2002
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2002.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2002.csv'
yearPeriod = '/Year_2002.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2003
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2003.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2003.csv'
yearPeriod = '/Year_2003.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2004
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2004.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2004.csv'
yearPeriod = '/Year_2004.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2005
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2005.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2005.csv'
yearPeriod = '/Year_2005.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2006
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2006.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2006.csv'
yearPeriod = '/Year_2006.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2007
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2007.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2007.csv'
yearPeriod = '/Year_2007.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2008
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2008.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2008.csv'
yearPeriod = '/Year_2008.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2009
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2009.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2009.csv'
yearPeriod = '/Year_2009.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2010
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2010.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2010.csv'
yearPeriod = '/Year_2010.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2011
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2011.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2011.csv'
yearPeriod = '/Year_2011.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2012
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2012.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2012.csv'
yearPeriod = '/Year_2012.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2013
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2013.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2013.csv'
yearPeriod = '/Year_2013.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2014
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2014.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2014.csv'
yearPeriod = '/Year_2014.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2015
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2015.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2015.csv'
yearPeriod = '/Year_2015.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2016
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2016.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2016.csv'
yearPeriod = '/Year_2016.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2017
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2017.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2017.csv'
yearPeriod = '/Year_2017.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2018
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2018.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2018.csv'
yearPeriod = '/Year_2018.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2019
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2019.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2019.csv'
yearPeriod = '/Year_2019.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2020
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2020.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2020.csv'
yearPeriod = '/Year_2020.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2021
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2021.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2021.csv'
yearPeriod = '/Year_2021.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))

##2022
inputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\unknown_ignit.points.all.frt.2022.csv' 
outputFile = '/C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output\\unknown_ignit_samp_points_2022.csv'
yearPeriod = '/Year_2022.ann'
system2(exe,args= c('/M', yearPeriod, inputFile, outputFile))


```

#Import climate data and calculate Drought Code

```{r}

###############################
#Import climate data per ignition and sample location
###############################

#Depending on where you saved your output, you may need to update the directory below
file.list1<-list.files("C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output", pattern="unknown_ignit_samp_points", all.files=FALSE, full.names=FALSE)
y1<-gsub(".csv","",file.list1)
the_dir <- "C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\output"

for (i in 1:length(file.list1)){
  assign(paste0(y1[i]),read.csv (file=paste0(the_dir, "\\", file.list1[i])))
}

```

Because much literature suggests that the monthly drought code (MDC) is an important factor, we will use information acquired from ClimateBC to get MDC values.

```{r}
# FOR EACH DATASET CALCULATE THE MONTHLY DROUGHT CODE

#############################################
#### Equations to calculate drought code ####
#############################################
   
months<- c("02", "03", "04", "05", "06", "07", "08", "09", "10", "11", "12")
  
days_month<- c(31, 30, 31, 30, 31, 31, 30, 31, 30) # number of days in each month starting in Jan
#### Daylength adjustment factor (Lf) [Development and Structure of the Canadian Forest Fire Weather Index System pg 15, https://d1ied5g1xfgpx8.cloudfront.net/pdfs/19927.pdf] ####
# Month <- Lf value
# LF[1] is the value for Jan
Lf<-c( -1.6, 0.9, 3.8, 5.8, 6.4, 5.0, 2.4, 0.4, -1.6)
####

### Calculate drought code for Fire ignition data
filenames<-list()
for (i in 1: length(y1)){
  
  x<-eval(as.name(y1[i])) %>% 
    rename(YEAR=ID2) %>%
    dplyr::select(ID1, YEAR,Latitude, Longitude, Tmax02:Tmax11, Tave02:Tave11, PPT02:PPT11, RH02:RH11, CMD02:CMD11, CMI02:CMI11, DD18_02:DD18_11)
  
  x2<- x %>% filter(Tmax05 != -9999) # there are some locations that did not have climate data, probably because they were over the ocean, so Im removing these here.
  
  for (j in 1 : length(Lf)) {

    
    x2$MDC_02<-15 # the MDC value for Feb This assumes that the ground is saturated at the start of the season. Maybe not true for all locations... may need to think about this a little more.
    
    Em<- days_month[j]*((0.36*x2[[paste0("Tmax",months[j+1])]])+Lf[j])
    Em2 <- ifelse(Em<0, 0, Em)
    DC_half<- x2[[paste0("MDC_",months[j])]] + (0.25 * Em2)
    precip<-x2[[paste0("PPT",months[j+1])]]
    RMeff<-(0.83 * (x2[[paste0("PPT",months[j+1])]]))
    Qmr<- (800 * exp((-(DC_half))/400)) + (3.937 * RMeff)
    Qmr2 <- ifelse(Qmr>800, 800, Qmr)
    MDC_m <- (400 * log(800/Qmr2)) + 0.25*Em2
    x2[[paste0("MDC_",months[j+1])]] <- (x2[[paste0("MDC_",months[j])]] + MDC_m)/2
    x2[[paste0("MDC_",months[j+1])]] <- ifelse(x2[[paste0("MDC_",months[j+1])]] <15, 15, x2[[paste0("MDC_",months[j+1])]])
  }
  nam1<-paste("DC.",y1[i],sep="") #defining the name
  assign(nam1,x2)
  filenames<-append(filenames,nam1)
}


# combined all the DC.ignition files together
mkFrameList <- function(nfiles) {
  d <- lapply(seq_len(nfiles),function(i) {
    eval(parse(text=filenames[i]))
  })
  do.call(rbind,d)
}

n<-length(filenames)
DC.ignitions<-mkFrameList(n) 
#DC.ignitions$ID1<- as.factor(DC.ignitions$ID1)

dim(DC.ignitions) 
names(DC.ignitions)
names(unknown_clipped)
dim(unknown_clipped)

DC.ignitions1<- DC.ignitions %>% rename(idno=ID1,
                                        FIRE_YEAR=YEAR)
str(DC.ignitions1)
DC.ignitions1$FIRE_YEAR<-as.numeric(DC.ignitions1$FIRE_YEAR)
DC.ignitions1$idno<-as.numeric(as.character(DC.ignitions1$idno))


unknown_clipped$idno <- as.numeric(as.character(unknown_clipped$idno))
unknown_clipped$FIRE_YEAR <- as.numeric(as.character(unknown_clipped$FIRE_YEAR))
str(unknown_clipped)

# Now join DC.ignitions back with the original fire ignition dataset
unknown_ignition_weather<-left_join(unknown_clipped, DC.ignitions1)
head(unknown_ignition_weather)
tail(unknown_ignition_weather) #Lat -Longs match
dim(unknown_ignition_weather) 
st_crs(unknown_ignition_weather) #Answer NA
head(unknown_ignition_weather) #Note, there are 2 Lat/Long columns: ensure that they are the same; otherwise, you may be using the incorrect climate csvs that were manually created.
unknown_ignition_weather <- st_as_sf(unknown_ignition_weather)
crs(unknown_ignition_weather)
unknown_ignition_weather<- st_transform(unknown_ignition_weather, 3005)
crs(unknown_ignition_weather)

```

We want to ensure that everything lines up with the BC Boundaries, so perform below

```{r}
# Check the points line up with BC boundaries!
ggplot() +
  geom_sf(data=bc.bnd, col='red') +
  geom_sf(data=unknown_ignition_weather, col='black') #looks good
#If random points appear in middle of ocean, open in QGIS to get points and see what has happened.


# A check of the fire ignition counts per year line up with the original data. So the number of fire ignitions seem good.
```


Note: in current below file saved, the lat and long do not match and thus different points were used.

```{r}
table(unknown_ignition_weather$FIRE_YEAR, unknown_ignition_weather$FIRE_CAUSE)

unknown_ignition_weather2 <- unknown_ignition_weather %>% select(FIRE_NUMBER:FIRE_TYPE, LATITUDE:OBJECTID, ig_mnth:geometry)
unknown_ignition_weather2$idno

unknown_veg_query<-unknown_ignition_weather %>% select(idno, FIRE_YEAR, geometry)

st_write(unknown_veg_query, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_veg_query1.gpkg")


#st_write(unknown_ignition_weather2, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignition.shp")
##Can also open in QGis to assess for any physical outliers and their information.

#str(ignition_weather_crs)
#head(ignition_weather_crs)
#ignition_weather_crs<-st_as_sf(ignition_weather_crs)


##Below needs: (1) update to relevant credentials and (2) then enter into the OSGeo4W command line and hit enter. 
#ogr2ogr -f PostgreSQL PG:"host=DC052586 user= dbname=castor password= port=5432" C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\samp_locations_unknown_ignition_weather_veg_15x.shp -overwrite -a_srs EPSG:3005 -progress --config PG_USE_COPY YES -nlt PROMOTE_TO_MULTI
##Above may not work because ogc_fid is NA or not right character type, and the code is trying to set this as the FID when uploading.

#key_get('dbpass', keyring = 'postgreSQL')

# OR my local machine

# ogr2ogr -f "PostgreSQL" PG:"host=localhost user=postgres dbname=postgres password=postgres port=5432" C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\samp_locations_unknown_ignition_weather_veg_15x.shp -overwrite -a_srs EPSG:3005 -progress --config PG_USE_COPY YES -nlt PROMOTE_TO_MULTI

```


# Save each fire year separately

```{r}
unknown_ignit_2002<- unknown_veg_query %>% filter(FIRE_YEAR==2002)
dim(unknown_ignit_2002)
sf::st_write(unknown_ignit_2002, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2002.shp", delete_layer=TRUE)

unknown_ignit_2003<- unknown_veg_query %>% filter(FIRE_YEAR==2003)
dim(unknown_ignit_2003)
sf::st_write(unknown_ignit_2003, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2003.shp", delete_layer=TRUE)

unknown_ignit_2004<- unknown_veg_query %>% filter(FIRE_YEAR==2004)
dim(unknown_ignit_2004)
sf::st_write(unknown_ignit_2004, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2004.shp", delete_layer=TRUE)

unknown_ignit_2005<- unknown_veg_query %>% filter(FIRE_YEAR==2005)
dim(unknown_ignit_2005)
sf::st_write(unknown_ignit_2005, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2005.shp", delete_layer=TRUE)

unknown_ignit_2006<- unknown_veg_query %>% filter(FIRE_YEAR==2006)
dim(unknown_ignit_2006)
sf::st_write(unknown_ignit_2006, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2006.shp", delete_layer=TRUE)

unknown_ignit_2007<- unknown_veg_query %>% filter(FIRE_YEAR==2007)
dim(unknown_ignit_2007)
sf::st_write(unknown_ignit_2007, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2007.shp", delete_layer=TRUE)

unknown_ignit_2008<- unknown_veg_query %>% filter(FIRE_YEAR==2008)
dim(unknown_ignit_2008)
sf::st_write(unknown_ignit_2008, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2008.shp", delete_layer=TRUE)

unknown_ignit_2009<- unknown_veg_query %>% filter(FIRE_YEAR==2009)
dim(unknown_ignit_2009)
sf::st_write(unknown_ignit_2009, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2009.shp", delete_layer=TRUE)

unknown_ignit_2010<- unknown_veg_query %>% filter(FIRE_YEAR==2010)
dim(unknown_ignit_2010)
sf::st_write(unknown_ignit_2010, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2010.shp", delete_layer=TRUE)

unknown_ignit_2011<- unknown_veg_query %>% filter(FIRE_YEAR==2011)
dim(unknown_ignit_2011)
sf::st_write(unknown_ignit_2011, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2011.shp", delete_layer=TRUE)

unknown_ignit_2012<- unknown_veg_query %>% filter(FIRE_YEAR==2012)
dim(unknown_ignit_2012)
sf::st_write(unknown_ignit_2012, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2012.shp", delete_layer=TRUE)

unknown_ignit_2013<- unknown_veg_query %>% filter(FIRE_YEAR==2013)
dim(unknown_ignit_2013)
sf::st_write(unknown_ignit_2013, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2013.shp", delete_layer=TRUE)

unknown_ignit_2014<- unknown_veg_query %>% filter(FIRE_YEAR==2014)
dim(unknown_ignit_2014)
sf::st_write(unknown_ignit_2014, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2014.shp", delete_layer=TRUE)

unknown_ignit_2015<- unknown_veg_query %>% filter(FIRE_YEAR==2015)
dim(unknown_ignit_2015)
sf::st_write(unknown_ignit_2015, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2015.shp", delete_layer=TRUE)

unknown_ignit_2016<- unknown_veg_query %>% filter(FIRE_YEAR==2016)
dim(unknown_ignit_2016)
sf::st_write(unknown_ignit_2016, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2016.shp", delete_layer=TRUE)

unknown_ignit_2017<- unknown_veg_query %>% filter(FIRE_YEAR==2017)
dim(unknown_ignit_2017)
sf::st_write(unknown_ignit_2017, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2017.shp", delete_layer=TRUE)

unknown_ignit_2018<- unknown_veg_query %>% filter(FIRE_YEAR==2018)
dim(unknown_ignit_2018)
sf::st_write(unknown_ignit_2018, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2018.shp", delete_layer=TRUE)

unknown_ignit_2019<- unknown_veg_query %>% filter(FIRE_YEAR==2019)
dim(unknown_ignit_2019)
sf::st_write(unknown_ignit_2019, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2019.shp", delete_layer=TRUE)

unknown_ignit_2020<- unknown_veg_query %>% filter(FIRE_YEAR==2020)
dim(unknown_ignit_2020)
sf::st_write(unknown_ignit_2020, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2020.shp", delete_layer=TRUE)

unknown_ignit_2021<- unknown_veg_query %>% filter(FIRE_YEAR==2021)
dim(unknown_ignit_2021)
sf::st_write(unknown_ignit_2021, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2021.shp", delete_layer=TRUE)

unknown_ignit_2022<- unknown_veg_query %>% filter(FIRE_YEAR==2022)
dim(unknown_ignit_2022)
sf::st_write(unknown_ignit_2022, dsn = "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\unknown_ignit_2022.shp", delete_layer=TRUE)
```


Extract vegetation data from the VRI

### Now that the ignition points have been joined to the VRI data in QGIS. I need to reimport the data so that i can join it all together and use it.

```{r}
file.list1<-list.files("C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\", pattern="Unknown_ignit_veg", all.files=FALSE, full.names=FALSE)
y1<-gsub(".gpkg","",file.list1)
the_dir <- "C:\\Work\\caribou\\castor\\R\\fire_sim\\tmp\\"

for (i in 1:length(file.list1)){
  assign(paste0(y1[i]),st_read (dsn=paste0(the_dir, "\\", file.list1[i])))
}

y2<-y1
# combined all the DC.ignition files together
mkFrameList <- function(nfiles) {
  d <- lapply(seq_len(nfiles),function(i) {
    eval(parse(text=y2[i]))
  })
  do.call(rbind,d)
}

n<-length(y2)
fire_veg<-mkFrameList(n) 
fire_veg[duplicated(fire_veg$idno),]$FIRE_YEAR # there should be no DUPLICATES

st_crs(fire_veg)

fire_veg_a<- st_drop_geometry(fire_veg)

unknown_ignition_weather_veg<-left_join(unknown_ignition_weather, fire_veg_a)

unknown_pts<-unknown_ignition_weather_veg
```



### Now Im going to try to use the VRI vegetation data to classify vegetation as Perrakis et al. (2018) British Columbia Wildfire Fuel Typing and Fuel Type Layer Description


First I need to create some new variables i.e. time since disturbance in years and time since last harvest. 

```{r}
# note: in this code fire_yr really refers to my focal year i.e. yr that i want to create this data for.

# Returns string without leading white space
trim.leading <- function (x)  sub("^\\s+", "", x)

unknown_pts$line_7b_disturbance_history<-trim.leading(unknown_pts$line_7b_disturbance_history)

unique(unknown_pts$line_7b_disturbance_history)
unique(unknown_pts$earliest_nonlogging_dist_type)

unknown_pts$dist_hist<-NA

unknown_pts<-unknown_pts %>% rename(fire_yr = FIRE_YEAR)

# split data table up into two with one having line_7b_disturbance_history with #'s and the other with the same column but no #'s. Then pull out the data separetly within each type and then combine them back.
fire_veg_1<-unknown_pts[grep("#", unknown_pts$line_7b_disturbance_history, invert=TRUE), ]
fire_veg_2<-unknown_pts[grep("#", unknown_pts$line_7b_disturbance_history, ignore.case = TRUE), ]

fire_veg_1$dist_hist<-ifelse(grepl("L", fire_veg_1$line_7b_disturbance_history, ignore.case = TRUE),"L",fire_veg_1$dist_hist)
fire_veg_1$dist_hist<-ifelse(grepl("B", fire_veg_1$line_7b_disturbance_history, ignore.case = TRUE),"burn",fire_veg_1$dist_hist)
fire_veg_1$dist_hist<-ifelse(grepl("I", fire_veg_1$line_7b_disturbance_history, ignore.case = TRUE),"insect",fire_veg_1$dist_hist)

fire_veg_1$dist_yr<-NA

# pull out the year that the disturbance occured.
fire_veg_1$dist_yr<-as.numeric(stringi::stri_sub(fire_veg_1$line_7b_disturbance_history,2,3))
unique(fire_veg_1$dist_yr)
# make the year into a proper date year e.g. 2004 or 1985 etc
fire_veg_1$dist_yr<-ifelse(fire_veg_1$dist_yr<=20 & as.numeric(fire_veg_1$fire_yr)>fire_veg_1$dist_yr, fire_veg_1$dist_yr+2000, fire_veg_1$dist_yr+1900)
unique(fire_veg_1$dist_yr)

# dealing with logging L% or L# where I think the % was changed to a # 
fire_veg_2$dist_hist<-ifelse(grepl("L", fire_veg_2$line_7b_disturbance_history, ignore.case = TRUE),"L",fire_veg_2$dist_hist)
fire_veg_2$dist_hist<-ifelse(grepl("B", fire_veg_2$line_7b_disturbance_history, ignore.case = TRUE),"burn",fire_veg_2$dist_hist)
fire_veg_2$dist_hist<-ifelse(grepl("I", fire_veg_2$line_7b_disturbance_history, ignore.case = TRUE),"insect",fire_veg_2$dist_hist)

fire_veg_2$dist_precent<-stringr::str_extract(fire_veg_2$line_7b_disturbance_history, "[\\d]{1,3}")
fire_veg_2$dist_yr<- stringr::str_split(fire_veg_2$line_7b_disturbance_history, '#', simplify = TRUE)[,2]
fire_veg_2$dist_yr<-as.numeric(as.character(stringi::stri_sub(fire_veg_2$dist_yr,1,2)))

# make the year into a proper date year e.g. 2004 or 1985 etc
fire_veg_2$dist_yr<-ifelse(fire_veg_2$dist_yr<=21 & as.numeric(fire_veg_2$fire_yr)>fire_veg_2$dist_yr, fire_veg_2$dist_yr+2000, fire_veg_2$dist_yr+1900)
unique(fire_veg_2$dist_yr)

fire_veg_2$dist_hist<-ifelse(fire_veg_2$dist_precent<50, NA, fire_veg_2$dist_hist)
fire_veg_2<-data.table(fire_veg_2)
fire_veg_1<-data.table(fire_veg_1)
fire_veg_2[,dist_precent:=NULL]

unknown_pts<-rbind(fire_veg_1, fire_veg_2)

unknown_pts$yearHarvest<-as.numeric(as.character(stringi::stri_sub(unknown_pts$harvest_date,1,4)))

unknown_pts[is.na(yearHarvest) & dist_hist =="L" & !is.na(dist_yr), yearHarvest:=dist_yr]

unknown_pts$fire_yr<-as.numeric(unknown_pts$fire_yr)
unknown_pts<- unknown_pts %>% dplyr::mutate(yearsSinceHarvest = fire_yr - yearHarvest)
unique(unknown_pts$yearsSinceHarvest)

x<-unknown_pts %>% dplyr::select(dist_hist,dist_yr, yearHarvest, earliest_nonlogging_dist_type, earliest_nonlogging_dist_date)

x[!is.na(dist_hist),]
x[dist_hist=="burn" & !is.na(earliest_nonlogging_dist_type),]

unknown_pts$yearsSinceHarvest<- ifelse(unknown_pts$yearsSinceHarvest<1, NA, unknown_pts$yearsSinceHarvest)
unknown_pts %>% filter(yearsSinceHarvest<1)
table(unknown_pts$yearsSinceHarvest)


unknown_pts$earliest_nonlogging_dist_type_2<-gsub('[" "]', '', unknown_pts$earliest_nonlogging_dist_type) # removing some weird characters
table(unknown_pts$earliest_nonlogging_dist_type)
table(unknown_pts$earliest_nonlogging_dist_type_2) # better

unknown_pts$earliest_nonlogging_dist_type<-unknown_pts$earliest_nonlogging_dist_type_2

unknown_pts$earliest_nonlogging_dist_type_2<- as.factor(unknown_pts$earliest_nonlogging_dist_type_2)
levels(unknown_pts$earliest_nonlogging_dist_type_2)<-list(burn="B",burn="BE", burn = "BG", burn="BR", burn="BW", burn="NB",drought="D",  disease="DF", disease="DMP", disease="DS", disease="DSG", insect="I", insect="IBB", insect="IBD", insect="IBF", insect="IBM", insect="IBS", flooding="NF", slide="NS", windthrow="NW", planting="P" ) # amalgamate some categories
table(unknown_pts$earliest_nonlogging_dist_type_2)
unknown_pts$earliest_nonlogging_dist_date
unknown_pts$yearDisturb<-as.numeric(as.character(stringi::stri_sub(unknown_pts$earliest_nonlogging_dist_date,1,4)))

unknown_pts[is.na(earliest_nonlogging_dist_type) & !is.na(dist_hist), earliest_nonlogging_dist_type_2:=dist_hist]

unknown_pts[is.na(earliest_nonlogging_dist_date) & !is.na(dist_yr) & dist_hist!="L", yearDisturb:=dist_yr]

unknown_pts[is.na(yearHarvest) & !is.na(dist_yr) & dist_hist=="L", yearHarvest :=dist_yr]

unknown_pts$yearsSinceDisturbance<- ifelse (unknown_pts$fire_yr > unknown_pts$yearDisturb, unknown_pts$fire_yr - unknown_pts$yearDisturb, NA)
unique(unknown_pts$yearsSinceDisturbance)

```



To save time and effort in coding I create a list of conifer and deciduous species and the bec_subzone codes that equate to wet areas. 
```{r}
conifer<-c("C","CW","Y","YC","F","FD","FDC","FDI","B","BB","BA","BG","BL","H","HM","HW","HXM","J","JR","JS","P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA","S","SB","SE","SS","SW","SX","SXW","SXL","SXS","T","TW","X", "XC","XH", "ZC")

deciduous<-c("L", "LA", "LT", "LW", "D", "DR", "U", "UP", "A", "AC", "ACB", "ACT", "AX", "AT", "R", "RA", "E", "EA", "EXP", "EP", "EW", "K", "KC", "V", "VB", "VV", "VP", "G", "M", "MB", "MV", "Q", "QG", "W", "WB", "WP", "WA", "WD", "WS", "WT", "XH", "ZH")

wet<-c("mc", "mcp", "mh", "mk", "mkp", "mks", "mm", "mmp", "mmw", "ms", "mv", "mvp", "mw", "mwp", "mww", "vc", "vcp", "vcw", "vh", "vk", "vks", "vm", "wc", "wcp", "wcw", "wh", "whp", "wk", "wm", "wmp", "wmu", "ws", "wv", "wvp", "ww")
```

calculating total percent cover by conifers regardless of species. Also pulling out the name of the most dominant conifer. 

```{r}

unknown_pts<- unknown_pts %>%
  mutate(pct1 = ifelse(species_cd_1 %in% conifer, species_pct_1, NA),
         pct2 = ifelse(species_cd_2 %in% conifer, species_pct_2, NA),
         pct3 = ifelse(species_cd_3 %in% conifer, species_pct_3, NA),
         pct4 = ifelse(species_cd_4 %in% conifer, species_pct_4, NA),
         pct5 = ifelse(species_cd_5 %in% conifer, species_pct_5, NA),
         pct6 = ifelse(species_cd_6 %in% conifer, species_pct_6, NA),
         dominant_conifer = ifelse(species_cd_1 %in% conifer, species_cd_1, 
                                   ifelse(species_cd_2 %in% conifer, species_cd_2,
                                          ifelse(species_cd_3 %in% conifer, species_cd_3,
                                                 ifelse(species_cd_4 %in% conifer, species_cd_4,
                                                        ifelse(species_cd_5 %in% conifer, species_cd_5,
                                                               ifelse(species_cd_6 %in% conifer, species_cd_6, NA)))))))

table(unknown_pts$dominant_conifer)

unknown_pts<-unknown_pts %>% mutate(conifer_pct_cover_total=rowSums(across(c(pct1:pct6)), na.rm=TRUE))

# the above calculation puts zeros in rows with NA's so Im changing them back to NA
unknown_pts$conifer_pct_cover_total<- ifelse(is.na(unknown_pts$pct1) & is.na(unknown_pts$pct2) & is.na(unknown_pts$pct3) & is.na(unknown_pts$pct4) & is.na(unknown_pts$pct5) & is.na(unknown_pts$pct6), NA, unknown_pts$conifer_pct_cover_total)

tail(unknown_pts) # looks like it worked

```


Now I can hopefully follow the rules outlined at the end of Perrakis et al (2018)
First Ill code the non-vegetated areas
```{r}

#Now coding the VEGETATED areas

# recently burned
unknown_pts$crown_closure<-as.numeric(unknown_pts$crown_closure)
 
  unknown_pts[bclcs_level_5 %in% c("GL","LA"), bclcs_level_2 := "W"]
  
  unknown_pts[is.na(bclcs_level_1) & is.na(bclcs_level_2) & crown_closure > 4,  bclcs_level_1 :="V"]
  unknown_pts[is.na(bclcs_level_1) & is.na(bclcs_level_2) & (crown_closure < 5),  bclcs_level_1 :="N"]
  unknown_pts[is.na(bclcs_level_2) & crown_closure < 10,  bclcs_level_2 :="N"]
  unknown_pts[!bclcs_level_2 %in% c("N", "T", "W", "L") & crown_closure > 9,  bclcs_level_2 :="T"]


  unknown_pts[bclcs_level_1=="N", fwveg:="N"]
  unknown_pts[land_cover_class_cd_1 =="RP", fwveg:="N"]
  unknown_pts[bclcs_level_2=="W", fwveg:="W"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "BAFA", fwveg:="D-1/2"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="CWH", fwveg:="M-1/2"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "CWH" & bec_subzone %in% wet, fwveg:="C-5"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "BWBS", fwveg:="C-2"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "SWB", fwveg:="M-1/2"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "SBS", fwveg:="C-3"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "SBPS", fwveg:="C-7"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "MS", fwveg:="C-3"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "IDF", fwveg:="C-7"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="IDF" & bec_subzone %in% wet, fwveg:="M-1/2"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "PP", fwveg:="C-7"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "BG", fwveg:="O-1a/b"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="MH", fwveg:="C-5"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="ESSF", fwveg:="C-3"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "CDF", fwveg:="C-7"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="CDF" & bec_subzone %in% wet, fwveg:="C-5"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "ICH", fwveg:="M-1/2"]
  unknown_pts[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "ICH" & bec_subzone %in% wet, fwveg:="C-5"]
  

  ##--------------------------##
  #### bclcs_level_1 == "N" ####
  ##--------------------------##
    
  # not logged and not recently burned  & bclcs_level_1 =="N"
  unknown_pts[bclcs_level_1=="N" & (bclcs_level_2=="L" | is.na(bclcs_level_2)) & species_pct_1 > 0, fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="N" & (bclcs_level_2=="L" | is.na(bclcs_level_2)) &  species_pct_1 > 0 & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"] 
  
  #logged less than 6 yrs before  & bclcs_level_1 =="N"
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest<= 6 & coast_interior_cd=="C", fwveg:="S-3"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest<= 6 & coast_interior_cd =="I",fwveg:="S-1"]
  
  # harvest date 7-24 & bclcs_level_1 =="N"
  unknown_pts[bclcs_level_1=="N" & (yearsSinceHarvest %between% c(7,24)), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="N" & (yearsSinceHarvest %between% c(7,24)) & bec_zone_code %in% c("CWH","MH","ICH"), fwveg:="D-1/2"]
       
  # harvest date > 25 & bclcs_level_1 =="N"
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code %in% c("CMA","IMA"), fwveg:="N"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="BAFA", fwveg:= "D-1/2"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CWH" & (bec_subzone %in% wet), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CWH" & !(bec_subzone %in% wet), fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="BWBS", fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="SWB", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="SBS", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="SBPS", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="MS", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="IDF" & (bec_subzone %in% wet), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="IDF" & !(bec_subzone %in% wet), fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code %in% c("PP","BG"), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="MH", fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="ESSF", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CDF" & (bec_subzone %in% wet), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CDF" & !(bec_subzone %in% wet), fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="ICH" & (bec_subzone %in% wet), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="ICH" & !(bec_subzone %in% wet), fwveg:="C-3"]
  
  # not vegetated, not logged, but burned fairly recently
  unknown_pts[bclcs_level_1=="N" & earliest_nonlogging_dist_type_2 == "burn" & yearsSinceDisturbance  <=3, fwveg:="N"]
  unknown_pts[bclcs_level_1=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >=4 & yearsSinceDisturbance  <= 6), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >= 7 & yearsSinceDisturbance  <=10), fwveg:="O-1a/b"]
      
  ##------------------------------------------------##
  #### bclcs_level_1 == "V" & bclcs_level_2 =="N" ####
  ##------------------------------------------------##
  
  ### non-forested bclcs_level_2==N recently burned
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & earliest_nonlogging_dist_type_2 == "burn" & yearsSinceDisturbance  < 2, fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >=2 & yearsSinceDisturbance <= 3), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >=4 & yearsSinceDisturbance <= 10), fwveg:="O-1a/b"]
  
  ### logged
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7, fwveg:="S-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7 & species_cd_1 %in% c("P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA"), fwveg:="S-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest <=7 & species_cd_1 %in% c("B","BB","BA","BG","BL","S","SB","SE","SS","SW","SX","SXW","SXL","SXS"), fwveg:="S-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7 & species_cd_1 %in% c("CW","YC","H","HM","HW","HXM"), fwveg:="S-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7 & species_cd_1 == "FD" & bec_zone_code %in% c("CWH", "ICH"), fwveg:="S-3"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest %between% c(8, 24), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest %between% c(8, 24) & bec_zone_code %in% c("CWH", "MH"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest %between% c(8, 24) & bec_zone_code == "ICH" & bec_subzone %in% wet, fwveg:="D-1/2"]
  
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest>=25 & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "BAFA", fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "CWH", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "CWH" & bec_subzone %in% wet, fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "BWBS", fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="SWB", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="SBS", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="SBPS", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & proj_age_1 >=25 & bec_zone_code %in% c("MS", "ESSF"), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code %in% c("IDF", "CDF"), fwveg:= "C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="IDF" & bec_subzone %in% wet, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code %in% c("PP", "BG"), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="MH", fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="ICH", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code %in% c("CDF", "ICH") & bec_subzone %in% wet, fwveg:="C-5"]
  
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest <=5, fwveg:="S-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest %between% c(6, 24), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest %between% c(6, 24) & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="BAFA", fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="CWH", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="CWH" & bec_subzone %in% wet, fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="BWBS", fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="SWB", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="SBS", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="SBPS", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="MS", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="IDF" & bec_subzone %in% wet, fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="IDF", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("PP", "BG"), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="MH", fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("ESSF", "CDF"), fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="ICH", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("CDF", "ICH") & bec_subzone %in% wet, fwveg:="C-5"]
 
  
  #### Unlogged

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1), fwveg:="O-1a/b"]
  #unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1), fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1) & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1) & bec_zone_code %in% c("CWH", "MH", "ICH", "BAFA"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd %in% c(11,12,13), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd %in% c(11, 12,13) & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd ==35, fwveg:="W"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd ==42, fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & (non_productive_cd == 60 |non_productive_cd == 62 | non_productive_cd == 63), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_cd) &  bec_zone_code %in% c("CMA","IMA"), fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_cd) & bec_zone_code %in% c("CWH","MH", "ICH", "BAFA"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_cd) & !bec_zone_code %in% c("CMA","IMA","CWH","MH", "ICH", "BAFA"), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(fwveg), fwveg:="N"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1 %in% c("LA", "RE","RL","OC"), fwveg:="W"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1=="HG", fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1 %in% c("BY", "BM","BL"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & (land_cover_class_cd_1 %in% c("SL", "ST","HE","HF") |is.na(land_cover_class_cd_1)) & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & (land_cover_class_cd_1 %in% c("SL", "ST","HE","HF") |is.na(land_cover_class_cd_1)) & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & (land_cover_class_cd_1 %in% c("SL", "ST","HE","HF") |is.na(land_cover_class_cd_1)) & is.na(fwveg), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1 %in% c("SI", "GL","PN","RO", "BR", "TA", "BI", "MZ", "LB", "EL", "RS", "ES", "LS", "RM", "BE", "LL", "BU", "RZ", "MU", "CB", "MN", "GP", "TZ", "RN", "UR", "AP", "MI", "OT", "LA", "RE", "RI", "OC"), fwveg:="N"]
  
  ##--------------------------------------------##
  ####bclcs_level_1=="V" & bclcs_level_2=="T" ####
  ##--------------------------------------------##
  
  ####Pure lodgepole or jack pine or undefined pine species.#### 
  
  #Also I just included unknown conifer species (XC) here because lodgepole and jack and undefined pines are the most common conifer species.
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure > 40 & earliest_nonlogging_dist_type %in% "burn" & yearsSinceDisturbance   < 4, fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure > 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance  >= 4 & yearsSinceDisturbance  <= 6), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure > 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance   >= 7 & yearsSinceDisturbance  <= 10), fwveg:= "C-5"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5=="SP" & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-7"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC") & yearsSinceHarvest<=7, fwveg:="S-1"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC") & bclcs_level_5=="SP" & bec_zone_code=="ICH" & bec_subzone %in% wet, fwveg:= "D-1/2"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC") & bclcs_level_5=="SP" & bec_zone_code %in% c("CWH", "CDF", "MH"), fwveg:="D-1/2"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & crown_closure <= 40 & earliest_nonlogging_dist_type %in% "burn" & yearsSinceDisturbance  < 2, fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure <= 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance   >= 2 & yearsSinceDisturbance  <=6), fwveg:= "D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure <= 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance  >= 7 & yearsSinceDisturbance<= 10), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total<60 &  earliest_nonlogging_dist_type %in% "burn" & yearsSinceDisturbance   < 2, fwveg:="N"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total<60 &  earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance  >=2 & yearsSinceDisturbance  <= 10), fwveg:="D-1/2"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 &  bclcs_level_5 %in% c("DE", "OP") & proj_height_1<=4 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="O-1a/b"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 %between% c(4, 12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha) > 8000 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-4"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 %between% c(4,12) & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 >12 & crown_closure <40 & bec_zone_code %in% c("BG", "PP", "IDF", "MS") & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-7"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 >12 & crown_closure <40 & bec_zone_code %in% c("CWH", "MH", "ICH") & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-5"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 >12 & crown_closure <40 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  <=5 & stand_percentage_dead >50 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="M-3"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  <=5 & stand_percentage_dead  %between% c(25, 50)  & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-2"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  <=5 & stand_percentage_dead < 25 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 & stand_percentage_dead > 50 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-2"]
  
  
  #### Pure ponderosa pine ####
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1>= 80 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & yearsSinceHarvest<=10, fwveg:="S-1"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 < 4 & is.na(fwveg), fwveg:="O-1a/b"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 %between% c(4, 12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>8000 & is.na(fwveg), fwveg:="C-4"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 %between% c(4,12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha) %between% c(3000, 8000) & is.na(fwveg), fwveg:="C-3"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 > 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 %between% c(4,12) & ((vri_live_stems_per_ha+vri_dead_stems_per_ha)<3000 | is.na(vri_live_stems_per_ha+vri_dead_stems_per_ha)) & is.na(fwveg), fwveg:="C-7"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & proj_height_1 %between% c(12, 17) & is.na(fwveg), fwveg:="C-7"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 > 79 & species_cd_1 == "PY" & bclcs_level_5 =="DE" & proj_height_1 %between% c(12, 17) & is.na(fwveg), fwveg:="C-3"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & proj_height_1 >17 & is.na(fwveg), fwveg:="C-7"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 =="SP" & is.na(fwveg), fwveg:="C-7"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 =="SP" & stand_percentage_dead >=40 & is.na(fwveg), fwveg:="O-1a/b"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 =="SP" & yearsSinceHarvest<=10 & is.na(fwveg), fwveg:="S-1"]
   
  
  # PA, PF, PW
  
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW"), fwveg:="C-5"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW") & bclcs_level_5 =="DE", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>=900, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha) %between% c(600,900), fwveg:="C-7"]
  
  
  #### Pure douglas fir ####
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & (proj_height_1>12 | is.na(proj_height_1)) & crown_closure > 55, fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI")  & yearsSinceHarvest<=6, fwveg:="S-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI")  & yearsSinceHarvest<=6 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="S-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI")  & yearsSinceHarvest<=6 & bec_zone_code=="ICH" & bec_subzone %in% wet, fwveg:="S-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4 & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & proj_height_1 < 4 & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code =="ICH" & bec_subzone %in% wet & proj_height_1 < 4 & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 > 79 & dominant_conifer %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & proj_height_1 %between% c(4, 12) & (is.na(yearHarvest) | (yearsSinceHarvest>6)) & crown_closure >= 55, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code =="ICH" & bec_subzone %in% wet & proj_height_1 %between% c(4, 12) & crown_closure > 55  & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4,12) & crown_closure > 55 & stand_percentage_dead > 34  & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="C-4"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4,12) & crown_closure > 55  & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & proj_height_1>12 & crown_closure > 55, fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code=="ICH" & bec_subzone %in% wet & crown_closure > 55 & proj_height_1>12, fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & crown_closure %between% c(26,55), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code=="ICH" & bec_subzone %in% wet & crown_closure %between% c(26, 55), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & crown_closure %between% c(26, 55), fwveg:="C-7"]
   unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & (crown_closure<26 | is.na(crown_closure)) & is.na(fwveg), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & crown_closure<26, fwveg:= "D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code =="ICH" & bec_subzone %in% wet & crown_closure<26, fwveg:="D-1/2"]
  
  
  # Pure spruce 
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE" & bclcs_level_5=="SP", fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE" & bclcs_level_5=="DE", fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE" & yearsSinceHarvest<=10, fwveg:="S-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" &  species_pct_1> 79 & species_cd_1 == "SS" & bclcs_level_5=="SP", fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SS" & bclcs_level_5 %in% c("DE","OP"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SS"  & yearsSinceHarvest<=6, fwveg:="S-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("SB", "SW"), fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1  %in% c("SB", "SW") & bclcs_level_5 %in% c("DE","OP"), fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("SB", "SW") & bec_zone_code %in% c("BWBS", "SWB"), fwveg:="C-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("SB", "SW")  & yearsSinceHarvest<=10, fwveg:="S-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS"), fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS") & bclcs_level_5 == "OP", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  bec_zone_code %in% c("BWBS", "SWB"), fwveg:="C-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  bec_zone_code %in% c("BWBS", "SWB") & bclcs_level_5 %in% c("DE", "OP"), fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  !(bec_zone_code %in% c("BWBS", "SWB")) & bclcs_level_5 =="SP", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  bec_zone_code %in% c("CWH", "CDF"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  & yearsSinceHarvest<=7, fwveg:="S-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  & proj_height_1 < 4, fwveg:="O-1a/b"]
  

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC"),fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5 %in% c("OP","DE"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_age_1 < 60, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_age_1 %between% c(60, 99), fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_height_1 < 4, fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_height_1 %between% c(4, 15), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & yearsSinceHarvest<=6, fwveg:="S-3"]
  
  # True fir
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "BG", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "BA", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total> 79 & dominant_conifer  %in% c("B", "BB", "BL"), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total> 79 & dominant_conifer %in% c("B", "BB", "BL")  & bclcs_level_5=="SP", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in%  c("T","TW"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("J","JR","JS"), fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% deciduous, fwveg:="D-1/2"]
  
  
  #### Mixed species stand ####
 
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & (conifer_pct_cover_total<=20 | is.na(conifer_pct_cover_total)) , fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total %between% c(21, 40), fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & yearsSinceHarvest<=6 & conifer_pct_cover_total %between% c(21, 80), fwveg:="S-1"]
  
  # note for below I made the assumption that  on pg 39 of Perrakis et al. (2018) there were refering to the dominant conifer species  when they listed specific species. That is why only the first occurrence of a conifer gets the specific species  
  
  ## conifer cover 41 - 65%
 unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & dominant_conifer %in% c("T","TW") & conifer_pct_cover_total %between% c(41, 65), fwveg:="C-5"]
 unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & (conifer_pct_cover_total > 40 & conifer_pct_cover_total<66) & dominant_conifer %in% c("J","JR","JS"), fwveg:="O-1a/b"]
 unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & (conifer_pct_cover_total > 40 & conifer_pct_cover_total<66) & dominant_conifer %in% c("P","PJ","PF","PL","PLI","PY","PLC","PW","PA","F","FD","FDC","FDI","SE","S","SB","SS","SW","SX","SXW","SXL","SXS","C","CW","Y","YC","H","HM","HW","HXM","B","BB","BA","BG","BL"), fwveg:="M-1/2"] # removed PXJ & PR 
  
  
  ## conifer cover 65-80% 
 unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80), fwveg:="M-1/2"] 
 unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("PL", "PLI", "PLC", "PJ", "P"), fwveg:="M-1/2"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer =="PY", fwveg:="C-7"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("PA", "PF", "PW"), fwveg:="C-5"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="C-7"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & bec_zone_code %in% c("CWH", "CDF") & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="C-5"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="C-5"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & bclcs_level_5=="DE" & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="M-1/2"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("SS"), fwveg:="C-5"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("SE","S","SB","SS","SW","SX","SXW","SXL","SXS"), fwveg:="M-1/2"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("C","CW","Y","YC","H","HM","HW","HXM","T","TW"), fwveg:="C-5"]
unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("B","BB","BA","BG","BL","J","JR","JS"), fwveg:="C-7"]

  ## conifer cover 81-100 %            

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & bclcs_level_5 == "SP" & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P"), fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & bclcs_level_5 == "SP" & bec_zone_code %in% c("CWH", "CDF", "MH"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & bclcs_level_5 == "SP" & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & bclcs_level_5 %in% c("DE", "OP") & proj_height_1<4, fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & yearsSinceHarvest<=7, fwveg:="S-1"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 %between% c(4, 12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>8000, fwveg:="C-4"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 %between% c(4, 12), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12, fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & (proj_height_1 > 12 | is.na(proj_height_1)) & crown_closure<40, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 > 12 & crown_closure<40 & bec_zone_code %in% c("BG", "PP", "IDF", "MS"), fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & (proj_height_1 > 12 | is.na(crown_closure)) & crown_closure<40 & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="C-5"]

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead < 25, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & bclcs_level_5=="DE" & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead < 25, fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead > 50, fwveg:="M-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead %between% c(25, 50), fwveg:="C-2"]
  
  # years since IBM attack > 5
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 &  stand_percentage_dead >50, fwveg:= "C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 &  stand_percentage_dead >= 25 & stand_percentage_dead <= 50  & bclcs_level_5 == "DE", fwveg:= "C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 &  stand_percentage_dead >= 25 & stand_percentage_dead <= 50, fwveg:= "C-3"]

  # no IBM
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & !(species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")), fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P")  & !(species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")) & crown_closure <40 & bec_zone_code %in% c("IDF", "PP", "BG", "SBPW", "MS"), fwveg:= "C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & !(species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")) & crown_closure <40 & bec_zone_code %in% c("CWH", "CDF", "ICH"), fwveg:= "C-5"]
  
# sp. 1 py
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY", fwveg:= "C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY" & yearsSinceHarvest<=7, fwveg:= "S-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY" & (yearsSinceHarvest>7 | is.na(yearHarvest)) & proj_height_1 < 4, fwveg:= "O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY" & bclcs_level_5=="DE" & proj_height_1>=4, fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY"  & proj_height_1>=4 & ((yearsSinceHarvest>7) | is.na(yearHarvest)) & bclcs_level_5 !="DE", fwveg:= "C-7"]
  
  # Pa, Pf, Pw
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW"), fwveg:= "C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW") & bclcs_level_5=="DE", fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>=900, fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha) %between% c(600, 900), fwveg:= "C-7"]
 

  #sp. 1 Fd or any F 
 
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & yearsSinceHarvest<=6, fwveg:= "S-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total >20 & species_cd_1 %in% c("F","FD","FDC","FDI") & yearsSinceHarvest<=6 & bec_zone_code %in% c("CWH", "MH","CDF"), fwveg:= "S-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & yearsSinceHarvest<=6 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "S-3"]

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4, fwveg:= "O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:= "D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "D-1/2"]

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "C-3"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & species_cd_2=="PY" & proj_height_1 %between% c(4, 12) & crown_closure>55, fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55 & stand_percentage_dead >34, fwveg:="C-4"]
  
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & proj_height_1 >12 & crown_closure>55, fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & proj_height_1 >12 & crown_closure>55 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & proj_height_1 >12 & crown_closure>55 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "C-5"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & (crown_closure %between% c(26, 55) | is.na(crown_closure)), fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & (crown_closure %between% c(26, 55) | is.na(crown_closure)) & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & (crown_closure %between% c(26, 55) | is.na(crown_closure)) & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="C-5"]
  
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & crown_closure < 26, fwveg:="O-1a/b"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & crown_closure < 26 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & crown_closure < 26 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="D-1/2"]
  
  
  #Sp1 S(any) 

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & bclcs_level_5=="SP" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("BL", "B", "PL", "P", "PLI") & bclcs_level_5=="DE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("BL", "B", "PL", "P", "PLI") & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-3"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("HW", "HM", "CW", "YC") & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("HW", "HM", "CW", "YC") & bclcs_level_5=="DE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-3"]
  
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SS" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-5"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SB" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SB" & bec_zone_code=="BWBS" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SB" & bclcs_level_5 %in% c("DE","OP") & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-2"]
  
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code=="BWBS", fwveg:= "C-1"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bclcs_level_5 == "OP" & bec_zone_code=="BWBS", fwveg:= "C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bclcs_level_5 == "DE" & bec_zone_code=="BWBS", fwveg:= "C-2"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code %in% c("CWH","MH","CDF"), fwveg:= "C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code %in% c("CWH","MH","CDF") & species_cd_2 %in% c("BL", "B", "P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA"), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code %in% c("CWH","MH","CDF") & species_cd_2 %in% c("BL", "B", "P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA") & bclcs_level_5=="SP", fwveg:="C-7"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")) & bclcs_level_5=="SP", fwveg:= "C-7"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bclcs_level_5=="DE" & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")) & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-2"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & stand_percentage_dead>34 & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")), fwveg:= "C-2"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & species_cd_2 %in% c("PL","PLI","P") & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")), fwveg:= "C-2"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & (stand_percentage_dead<=34 | is.na(stand_percentage_dead)) & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & !(species_cd_2 %in% c("PL","PLI","P")) & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")), fwveg:= "C-3"]
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SB","SE","SS","SW","SX","SXW","SXL","SXS") & yearsSinceHarvest<=6, fwveg:= "S-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SB","SE","SS","SW","SX","SXW","SXL","SXS") & yearsSinceHarvest<=6 & bec_zone_code %in% c("CWH", "MH","CDF"), fwveg:="S-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SB","SE","SS","SW","SX","SXW","SXL","SXS") & yearsSinceHarvest<=6 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="S-3"]
  
  
  #H(any), C(any), Y(any) 

  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_age_1<60 & proj_height_1 > 15, fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_age_1 %between% c(60,99) & proj_height_1 > 15, fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & !(bclcs_level_5 %in% c("DE", "OP")), fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_height_1<4, fwveg:="D-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_height_1 %between% c(4, 15), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & yearsSinceHarvest<=6, fwveg:="S-3"]
       
  # BG, BA, B etc also T and J 
  
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1=="BG", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1=="BA", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1=="BA" & species_cd_2 %in% c("SE", "SW", "S"), fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & coast_interior_cd=="C", fwveg:="M-1/2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & bclcs_level_5=="SP" & coast_interior_cd!="C", fwveg:="C-7"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & coast_interior_cd !="C"& bclcs_level_5=="DE" & species_cd_2 %in% c("SE", "SW", "S"), fwveg:="C-2"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & !(species_cd_2 %in% c("SE", "SW", "S")) & coast_interior_cd !="C" & bclcs_level_5 != "SP", fwveg:="C-3"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("T","TW"), fwveg:="C-5"]
  unknown_pts[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("J","JR","JS"), fwveg:="C-7"]
  
  # classify species that are not classified into a class already
  unknown_pts[is.na(fwveg) & bclcs_level_4 == "TB", fwveg:="D-1/2"]
  unknown_pts[is.na(fwveg) & bclcs_level_2 == "N", fwveg:="N"]
  
  
  unknown_pts[bclcs_level_5 %in% c("GL","LA"), fwveg := "W"]
  unknown_pts[bclcs_level_2=="W", fwveg:="W"]

table(unknown_pts$fwveg)

                             
table(is.na(unknown_pts$fwveg))

x<- unknown_pts %>% filter(is.na(fwveg)) %>% dplyr::select(inventory_standard_cd:conifer_pct_cover_total)
                             
unknown_pts2<-st_drop_geometry(unknown_pts)

unknown_pts_reduced<-unknown_pts1 %>% dplyr::select(FIRE_YEAR:FIRE_CAUSE, LATITUDE:CURRENT_SIZE, ig_mnth:dist_roads_m, dist_infrastructure_m:idno, Tmax02:RH11, CMI02:CMI11, MDC_02:MDC_11, fwveg, conifer_pct_cover_total, yearHarvest:yearsSinceDisturbance)

table(is.na(unknown_pts_reduced$fwveg))

unknown_pts_reduced<-unknown_pts_reduced %>% drop_na(fwveg)

```


```{r}
st_write(unknown_pts, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\unknown_escape_weather_veg.gpkg", overwrite=TRUE)

write.csv(unknown_pts2, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\unknown_ignition_weather_veg.csv")
```

Combine all data
```{r}
dat_lightning2<-dat_lightning %>%
  distinct(idno, .keep_all = TRUE)

dat_lightning3<-dat_lightning2 %>% dplyr::select(id, fire_yr, FIRE_CA, ig_mnth, CURRENT, frt, fire, idno, s___300, a___300, dm_h_bc, Latitude, Longitude, road_dist_m, dist_infrastructure_m, win_sum, win_spg, fwveg, Tmax02:Tmax11, Tave02:Tave11, PPT02:PPT11, CMI02:CMI11, CMD02:CMD11)

dat_human2<-dat_human %>%
  distinct(idno, .keep_all = TRUE)

dat_human3<-dat_human2 %>% dplyr::select(id, fire_yr, FIRE_CA, ig_mnth, CURRENT, frt, fire, idno, s___300, a___300, dm_h_bc, Latitude, Longitude, road_dist_m, dist_infrastructure_m, win_sum, win_spg, fwveg, Tmax02:Tmax11, Tave02:Tave11, PPT02:PPT11, CMI02:CMI11, CMD02:CMD11)

unknown_pts$fire<-1

unknown_pts2<-unknown_pts %>% 
  rename(FIRE_CA = FIRE_CAUSE,
         CURRENT = CURRENT_SIZE,
         s___300 = slope_ha_bc_3005,
         a___300 = aspect_ha_bc_3005,
         dm_h_bc = dem_ha_bc,
         road_dist_m = dist_roads_m,
         frt = Cluster) 

unknown_pts2<- unknown_pts2 %>% 
  dplyr::select(id, fire_yr, FIRE_CA, ig_mnth, CURRENT, frt, fire, idno, s___300, a___300, dm_h_bc, Latitude, Longitude, road_dist_m, dist_infrastructure_m, win_sum, win_spg, fwveg, Tmax02:Tmax11, Tave02:Tave11, PPT02:PPT11, CMI02:CMI11, CMD02:CMD11)

dat<- rbind(rbind(dat_lightning3, dat_human3), unknown_pts2)


dat<-dat %>% filter(fire==1)

write.csv(dat, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\escape_data.csv")


```


```{r}
dat$CURRENT<-as.numeric(as.character(dat$CURRENT))
hist(dat$CURRENT, breaks=50)
dat2<- dat %>% drop_na(CURRENT)

names(dat2)

unknown_ignition_weather_veg4<-dat %>%
  rename(fire_no = FIRE_NU,
    fire_yr=FIRE_YE,
       fire_cs=FIRE_CA,
       fir_typ=FIRE_TY,
       size_ha = CURRENT,
       slope = s___300,
       aspect = a___300,
       elevatn = dm_h_bc)


fire_escapes3 <- fire_escapes2  %>% dplyr::select(fire_no, fire_yr, IGNITIO, fire_cs, FIRE_LA, ZONE, FIRE_ID, fir_typ, LATITUD, LONGITU, size_ha, ig_mnth, Cluster, idno, slope, aspect, elevatn, Tmax02:MDC_11, infr_dist, road_dist_m, win_sum, win_spg, inventory_standard_cd:proj_height_2, yearHarvest:fwveg)

dim(fire_escapes3)
dim(unknown_ignition_weather_veg4)

fire_escapes_final<- rbind(fire_escapes3, unknown_ignition_weather_veg4)

st_write(fire_escapes_final, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\Fire_escape_data_all.gpkg", delete_layer=TRUE)
```


