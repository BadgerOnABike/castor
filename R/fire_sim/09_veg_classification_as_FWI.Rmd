---
title: "Fire_veg"
author: "Elizabeth Kleynhans"
date: '2022-08-19'
output: html_document
---


# FIX it appears some fires are found to be started in the FWI_veg type =N. I think part of the problem is that if earliest disturbance year is the same as the fire year it is making years since disturbance =0 and then as a result it is classifying vegetation type as N because that area was just burned. But I think this is actually the fire i want to get info for. So I think therea re two solutions. 1.) either I reclassify the vegetation in the VRI using the VRI from the year before so that the burn date does not appear or I include an if statement saying that if the year burnt = the same year as my fire year then I should ignore it. ill try the latter for starters but I might swithch. 
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

```{r}
library(sf)
library(tidyverse)
```


```{r}
fire_veg_sf<-st_read("C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\Fire_data_all3.gpkg")


```


```{r}

# looking at how many na values there are
table(is.na(fire_veg_sf$bec_zone_code))
table(is.na(fire_veg_sf$bclcs_level_1))
table(is.na(fire_veg_sf$bclcs_level_2))
table(is.na(fire_veg_sf$bclcs_level_3))
table(is.na(fire_veg_sf$bclcs_level_4))
table(is.na(fire_veg_sf$bclcs_level_5))

table((fire_veg_sf$bclcs_level_1)) # U=unreported, N = non-vegetated, V = vegetated
table((fire_veg_sf$bclcs_level_2)) # T= treed, N = Non-treed, L=Land, W=water
table((fire_veg_sf$bclcs_level_3)) # A = alpine, U = upland, W = wetland
table((fire_veg_sf$bclcs_level_4)) # 
table((fire_veg_sf$bclcs_level_5))
table(fire_veg_sf$bec_subzone)

# fire_veg_sf$stand_percentage_dead<- round(fire_veg_sf$stand_percentage_dead,2)
# fire_veg_sf$crown_closure<- round(fire_veg_sf$crown_closure,2)
# fire_veg_sf$species_pct_1<- round(fire_veg_sf$species_pct_1,0)
# fire_veg_sf$species_pct_2<- round(fire_veg_sf$species_pct_2,0)
# fire_veg_sf$species_pct_3<- round(fire_veg_sf$species_pct_3,0)
# fire_veg_sf$species_pct_4<- round(fire_veg_sf$species_pct_4,0)
# fire_veg_sf$species_pct_5<- round(fire_veg_sf$species_pct_5,0)
# fire_veg_sf$species_pct_6<- round(fire_veg_sf$species_pct_6,0)
#fire_veg_sf$proj_age_1<- round(fire_veg_sf$proj_age_1,2)
fire_veg_sf$proj_height_1<- round(fire_veg_sf$proj_height_1,1)
fire_veg_sf$bec_zone_code<- (as.character(fire_veg_sf$bec_zone_code))
fire_veg_sf$bec_subzone<- as.character(fire_veg_sf$bec_subzone)
fire_veg_sf$species_cd_1<- (as.character(fire_veg_sf$species_cd_1))
fire_veg_sf$species_cd_2<- (as.character(fire_veg_sf$species_cd_2))
fire_veg_sf$species_cd_3<- (as.character(fire_veg_sf$species_cd_3))
fire_veg_sf$species_cd_4<- (as.character(fire_veg_sf$species_cd_4))
fire_veg_sf$species_cd_5<- (as.character(fire_veg_sf$species_cd_5))
fire_veg_sf$species_cd_6<- (as.character(fire_veg_sf$species_cd_6))

str(fire_veg_sf)

```


### Now Im going to try to use the VRI vegetation data to classify vegetation as Perrakis et al. (2018) British Columbia Wildfire Fuel Typing and Fuel Type Layer Description


First I need to create some new variables i.e. time since disturbance in years and time since last harvest. 
```{r}
# note: in this code fire_yr really refers to my focal year i.e. yr that i want to create this data for.

# Returns string without leading white space
trim.leading <- function (x)  sub("^\\s+", "", x)

fire_veg_sf$line_7b_disturbance_history<-trim.leading(fire_veg_sf$line_7b_disturbance_history)

unique(fire_veg_sf$line_7b_disturbance_history)
unique(fire_veg_sf$earliest_nonlogging_dist_type)

fire_veg_sf$dist_hist<-NA

# split data table up into two with one having line_7b_disturbance_history with #'s and the other with the same column but no #'s. Then pull out the data separetly within each type and then combine them back.
fire_veg_1<-fire_veg_sf[grep("#", fire_veg_sf$line_7b_disturbance_history, invert=TRUE), ]
fire_veg_2<-fire_veg_sf[grep("#", fire_veg_sf$line_7b_disturbance_history, ignore.case = TRUE), ]

fire_veg_1$dist_hist<-ifelse(grepl("L", fire_veg_1$line_7b_disturbance_history, ignore.case = TRUE),"L",fire_veg_1$dist_hist)
fire_veg_1$dist_hist<-ifelse(grepl("B", fire_veg_1$line_7b_disturbance_history, ignore.case = TRUE),"burn",fire_veg_1$dist_hist)
fire_veg_1$dist_hist<-ifelse(grepl("I", fire_veg_1$line_7b_disturbance_history, ignore.case = TRUE),"insect",fire_veg_1$dist_hist)

fire_veg_1$dist_yr<-NA

# pull out the year that the disturbance occured.
fire_veg_1$dist_yr<-as.numeric(stringi::stri_sub(fire_veg_1$line_7b_disturbance_history,2,3))
unique(fire_veg_1$dist_yr)
# make the year into a proper date year e.g. 2004 or 1985 etc
fire_veg_1$dist_yr<-ifelse(fire_veg_1$dist_yr<=21 & as.numeric(fire_veg_1$fire_yr)>fire_veg_1$dist_yr, fire_veg_1$dist_yr+2000, fire_veg_1$dist_yr+1900)
unique(fire_veg_1$dist_yr)

# dealing with logging L% or L# where I think the % was changed to a # 
fire_veg_2$dist_hist<-ifelse(grepl("L", fire_veg_2$line_7b_disturbance_history, ignore.case = TRUE),"L",fire_veg_2$dist_hist)
fire_veg_2$dist_hist<-ifelse(grepl("B", fire_veg_2$line_7b_disturbance_history, ignore.case = TRUE),"burn",fire_veg_2$dist_hist)
fire_veg_2$dist_hist<-ifelse(grepl("I", fire_veg_2$line_7b_disturbance_history, ignore.case = TRUE),"insect",fire_veg_2$dist_hist)

fire_veg_2$dist_precent<-stringr::str_extract(fire_veg_2$line_7b_disturbance_history, "[\\d]{1,3}")
fire_veg_2$dist_yr<- str_split(fire_veg_2$line_7b_disturbance_history, '#', simplify = TRUE)[,2]
fire_veg_2$dist_yr<-as.numeric(as.character(stringi::stri_sub(fire_veg_2$dist_yr,1,2)))

# make the year into a proper date year e.g. 2004 or 1985 etc
fire_veg_2$dist_yr<-ifelse(fire_veg_2$dist_yr<=20 & as.numeric(fire_veg_2$fire_yr)>fire_veg_2$dist_yr, fire_veg_2$dist_yr+2000, fire_veg_2$dist_yr+1900)
unique(fire_veg_2$dist_yr)

fire_veg_2$dist_hist<-ifelse(fire_veg_2$dist_precent<50, NA, fire_veg_2$dist_hist)
fire_veg_2<-data.table(fire_veg_2)
fire_veg_2[,dist_precent:=NULL]

fire_veg_sf<-rbind(data.table(fire_veg_1), fire_veg_2)

fire_veg_sf$yearHarvest<-as.numeric(as.character(stringi::stri_sub(fire_veg_sf$harvest_date,1,4)))
fire_veg_sf[yearHarvest==2026, yearHarvest:=1926]
fire_veg_sf$fire_yr<-as.numeric(fire_veg_sf$fire_yr)
fire_veg_sf<- fire_veg_sf %>% dplyr::mutate(yearsSinceHarvest = fire_yr - yearHarvest)

unique(fire_veg_sf$yearsSinceHarvest)

x<-fire_veg_sf %>% dplyr::select(dist_hist,dist_yr, yearHarvest, earliest_nonlogging_dist_type, earliest_nonlogging_dist_date)

x[!is.na(dist_hist),]
x[dist_hist=="burn" & !is.na(earliest_nonlogging_dist_type),]

fire_veg_sf$yearsSinceHarvest<- ifelse(fire_veg_sf$yearsSinceHarvest<1, NA, fire_veg_sf$yearsSinceHarvest)
fire_veg_sf %>% filter(yearsSinceHarvest<1)
table(fire_veg_sf$yearsSinceHarvest)


fire_veg_sf$earliest_nonlogging_dist_type_2<-gsub('[" "]', '', fire_veg_sf$earliest_nonlogging_dist_type) # removing some weird characters
table(fire_veg_sf$earliest_nonlogging_dist_type)
table(fire_veg_sf$earliest_nonlogging_dist_type_2) # better

fire_veg_sf$earliest_nonlogging_dist_type<-fire_veg_sf$earliest_nonlogging_dist_type_2

fire_veg_sf$earliest_nonlogging_dist_type_2<- as.factor(fire_veg_sf$earliest_nonlogging_dist_type_2)
levels(fire_veg_sf$earliest_nonlogging_dist_type_2)<-list(burn="B",burn="BE", burn = "BG", burn="BR", burn="BW", burn="NB",drought="D",  disease="DF", disease="DMP", disease="DS", disease="DSG", insect="I", insect="IBB", insect="IBD", insect="IBF", insect="IBM", insect="IBS", flooding="NF", slide="NS", windthrow="NW", planting="P" ) # amalgamate some categories
table(fire_veg_sf$earliest_nonlogging_dist_type_2)
fire_veg_sf$earliest_nonlogging_dist_date
fire_veg_sf$yearDisturb<-as.numeric(as.character(stringi::stri_sub(fire_veg_sf$earliest_nonlogging_dist_date,1,4)))

fire_veg_sf[is.na(earliest_nonlogging_dist_type) & !is.na(dist_hist), earliest_nonlogging_dist_type_2:=dist_hist]

fire_veg_sf[is.na(earliest_nonlogging_dist_date) & !is.na(dist_yr) & dist_hist!="L", yearDisturb:=dist_yr]

fire_veg_sf[is.na(yearHarvest) & !is.na(dist_yr) & dist_hist=="L", yearHarvest :=dist_yr]

fire_veg_sf$yearsSinceDisturbance<- ifelse (fire_veg_sf$fire_yr > fire_veg_sf$yearDisturb, fire_veg_sf$fire_yr - fire_veg_sf$yearDisturb, NA)
unique(fire_veg_sf$yearsSinceDisturbance)

```


```{r}
veg2[non_productive_descriptor_cd==" ",non_productive_descriptor_cd:=NA]
veg2[bclcs_level_2==" ",bclcs_level_2:=NA]
veg2[bclcs_level_3==" ",bclcs_level_3:=NA]
veg2[bclcs_level_4==" ",bclcs_level_4:=NA]
veg2[bclcs_level_5==" ",bclcs_level_5:=NA]
veg2[line_7b_disturbance_history==" ",bclcs_level_5:=NA]


unique(veg2$line_7b_disturbance_history)
```

To save time and effort in coding I create a list of conifer and deciduous species and the bec_subzone codes that equate to wet areas. 
```{r}
conifer<-c("C","CW","Y","YC","F","FD","FDC","FDI","B","BB","BA","BG","BL","H","HM","HW","HXM","J","JR","JS","P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA","S","SB","SE","SS","SW","SX","SXW","SXL","SXS","T","TW","X", "XC","XH", "ZC")

deciduous<-c("L", "LA", "LT", "LW", "D", "DR", "U", "UP", "A", "AC", "ACB", "ACT", "AX", "AT", "R", "RA", "E", "EA", "EXP", "EP", "EW", "K", "KC", "V", "VB", "VV", "VP", "G", "M", "MB", "MV", "Q", "QG", "W", "WB", "WP", "WA", "WD", "WS", "WT", "XH", "ZH")

wet<-c("mc", "mcp", "mh", "mk", "mkp", "mks", "mm", "mmp", "mmw", "ms", "mv", "mvp", "mw", "mwp", "mww", "vc", "vcp", "vcw", "vh", "vk", "vks", "vm", "wc", "wcp", "wcw", "wh", "whp", "wk", "wm", "wmp", "wmu", "ws", "wv", "wvp", "ww")
```

calculating total percent cover by conifers regardless of species. Also pulling out the name of the most dominant conifer. 

```{r}

fire_veg_sf<- fire_veg_sf %>%
  mutate(pct1 = ifelse(species_cd_1 %in% conifer, species_pct_1, NA),
         pct2 = ifelse(species_cd_2 %in% conifer, species_pct_2, NA),
         pct3 = ifelse(species_cd_3 %in% conifer, species_pct_3, NA),
         pct4 = ifelse(species_cd_4 %in% conifer, species_pct_4, NA),
         pct5 = ifelse(species_cd_5 %in% conifer, species_pct_5, NA),
         pct6 = ifelse(species_cd_6 %in% conifer, species_pct_6, NA),
         dominant_conifer = ifelse(species_cd_1 %in% conifer, species_cd_1, 
                                   ifelse(species_cd_2 %in% conifer, species_cd_2,
                                          ifelse(species_cd_3 %in% conifer, species_cd_3,
                                                 ifelse(species_cd_4 %in% conifer, species_cd_4,
                                                        ifelse(species_cd_5 %in% conifer, species_cd_5,
                                                               ifelse(species_cd_6 %in% conifer, species_cd_6, NA)))))))

table(fire_veg_sf$dominant_conifer)

fire_veg_sf<-fire_veg_sf %>% mutate(conifer_pct_cover_total=rowSums(across(c(pct1:pct6)), na.rm=TRUE))

# the above calculation puts zeros in rows with NA's so Im changing them back to NA
fire_veg_sf$conifer_pct_cover_total<- ifelse(is.na(fire_veg_sf$pct1) & is.na(fire_veg_sf$pct2) & is.na(fire_veg_sf$pct3) & is.na(fire_veg_sf$pct4) & is.na(fire_veg_sf$pct5) & is.na(fire_veg_sf$pct6), NA, fire_veg_sf$conifer_pct_cover_total)

tail(fire_veg_sf) # looks like it worked

```


Now I can hopefully follow the rules outlined at the end of Perrakis et al (2018)
First Ill code the non-vegetated areas
```{r}
#fire_veg_sf$fwveg<-NA

veg2<-fire_veg_sf

#Now coding the VEGETATED areas

 # limited vegetation information  but has bec designation
veg2$crown_closure<-as.numeric(veg2$crown_closure)
 
  veg2[bclcs_level_5 %in% c("GL","LA"), bclcs_level_2 := "W"]
  
  veg2[is.na(bclcs_level_1) & is.na(bclcs_level_2) & crown_closure > 4,  bclcs_level_1 :="V"]
  veg2[is.na(bclcs_level_1) & is.na(bclcs_level_2) & (crown_closure < 5),  bclcs_level_1 :="N"]
  veg2[is.na(bclcs_level_2) & crown_closure < 10,  bclcs_level_2 :="N"]
  veg2[!bclcs_level_2 %in% c("N", "T", "W", "L") & crown_closure > 9,  bclcs_level_2 :="T"]


  veg2[bclcs_level_1=="N", fwveg:="N"]
  veg2[land_cover_class_cd_1 =="RP", fwveg:="N"]
  veg2[bclcs_level_2=="W", fwveg:="W"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "BAFA", fwveg:="D-1/2"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="CWH", fwveg:="M-1/2"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "CWH" & bec_subzone %in% wet, fwveg:="C-5"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "BWBS", fwveg:="C-2"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "SWB", fwveg:="M-1/2"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "SBS", fwveg:="C-3"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "SBPS", fwveg:="C-7"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "MS", fwveg:="C-3"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "IDF", fwveg:="C-7"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="IDF" & bec_subzone %in% wet, fwveg:="M-1/2"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "PP", fwveg:="C-7"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "BG", fwveg:="O-1a/b"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="MH", fwveg:="C-5"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="ESSF", fwveg:="C-3"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "CDF", fwveg:="C-7"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code=="CDF" & bec_subzone %in% wet, fwveg:="C-5"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "ICH", fwveg:="M-1/2"]
  veg2[(is.na(bclcs_level_1)|bclcs_level_1 == "U") & is.na(species_cd_1) & is.na(species_cd_2) & bec_zone_code == "ICH" & bec_subzone %in% wet, fwveg:="C-5"]
  

  ##--------------------------##
  #### bclcs_level_1 == "N" ####
  ##--------------------------##
    
  # not logged and not recently burned  & bclcs_level_1 =="N"
  veg2[bclcs_level_1=="N" & (bclcs_level_2=="L" | is.na(bclcs_level_2)) & species_pct_1 > 0, fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="N" & (bclcs_level_2=="L" | is.na(bclcs_level_2)) &  species_pct_1 > 0 & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"] 
  
  #logged less than 6 yrs before  & bclcs_level_1 =="N"
  veg2[bclcs_level_1=="N" & yearsSinceHarvest<= 6 & coast_interior_cd=="C", fwveg:="S-3"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest<= 6 & coast_interior_cd =="I",fwveg:="S-1"]
  
  # harvest date 7-24 & bclcs_level_1 =="N"
  veg2[bclcs_level_1=="N" & (yearsSinceHarvest %between% c(7,24)), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="N" & (yearsSinceHarvest %between% c(7,24)) & bec_zone_code %in% c("CWH","MH","ICH"), fwveg:="D-1/2"]
       
  # harvest date > 25 & bclcs_level_1 =="N"
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code %in% c("CMA","IMA"), fwveg:="N"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="BAFA", fwveg:= "D-1/2"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CWH" & (bec_subzone %in% wet), fwveg:="C-5"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CWH" & !(bec_subzone %in% wet), fwveg:="M-1/2"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="BWBS", fwveg:="C-2"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="SWB", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="SBS", fwveg:="C-3"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="SBPS", fwveg:="C-7"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="MS", fwveg:="C-7"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="IDF" & (bec_subzone %in% wet), fwveg:="C-3"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="IDF" & !(bec_subzone %in% wet), fwveg:="C-7"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code %in% c("PP","BG"), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="MH", fwveg:="D-1/2"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="ESSF", fwveg:="C-7"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CDF" & (bec_subzone %in% wet), fwveg:="C-5"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="CDF" & !(bec_subzone %in% wet), fwveg:="C-7"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="ICH" & (bec_subzone %in% wet), fwveg:="C-5"]
  veg2[bclcs_level_1=="N" & yearsSinceHarvest>=25 & bec_zone_code=="ICH" & !(bec_subzone %in% wet), fwveg:="C-3"]
  
  # not vegetated, not logged, but burned fairly recently
  veg2[bclcs_level_1=="N" & earliest_nonlogging_dist_type_2 == "burn" & yearsSinceDisturbance  <=3, fwveg:="N"]
  veg2[bclcs_level_1=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >=4 & yearsSinceDisturbance  <= 6), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >= 7 & yearsSinceDisturbance  <=10), fwveg:="O-1a/b"]
      
  ##------------------------------------------------##
  #### bclcs_level_1 == "V" & bclcs_level_2 =="N" ####
  ##------------------------------------------------##
  
  ### non-forested bclcs_level_2==N recently burned
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & earliest_nonlogging_dist_type_2 == "burn" & yearsSinceDisturbance  < 2, fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >=2 & yearsSinceDisturbance <= 3), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & earliest_nonlogging_dist_type_2 == "burn" & (yearsSinceDisturbance  >=4 & yearsSinceDisturbance <= 10), fwveg:="O-1a/b"]
  
  ### logged
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7, fwveg:="S-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7 & species_cd_1 %in% c("P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA"), fwveg:="S-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest <=7 & species_cd_1 %in% c("B","BB","BA","BG","BL","S","SB","SE","SS","SW","SX","SXW","SXL","SXS"), fwveg:="S-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7 & species_cd_1 %in% c("CW","YC","H","HM","HW","HXM"), fwveg:="S-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest<=7 & species_cd_1 == "FD" & bec_zone_code %in% c("CWH", "ICH"), fwveg:="S-3"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest %between% c(8, 24), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest %between% c(8, 24) & bec_zone_code %in% c("CWH", "MH"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest %between% c(8, 24) & bec_zone_code == "ICH" & bec_subzone %in% wet, fwveg:="D-1/2"]
  
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest>=25 & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "BAFA", fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "CWH", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "CWH" & bec_subzone %in% wet, fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code == "BWBS", fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="SWB", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="SBS", fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="SBPS", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & proj_age_1 >=25 & bec_zone_code %in% c("MS", "ESSF"), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code %in% c("IDF", "CDF"), fwveg:= "C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="IDF" & bec_subzone %in% wet, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code %in% c("PP", "BG"), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="MH", fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code=="ICH", fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & yearsSinceHarvest >=25 & bec_zone_code %in% c("CDF", "ICH") & bec_subzone %in% wet, fwveg:="C-5"]
  
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest <=5, fwveg:="S-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest %between% c(6, 24), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest %between% c(6, 24) & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="BAFA", fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="CWH", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="CWH" & bec_subzone %in% wet, fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="BWBS", fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="SWB", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="SBS", fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="SBPS", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="MS", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="IDF" & bec_subzone %in% wet, fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="IDF", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("PP", "BG"), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="MH", fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("ESSF", "CDF"), fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code=="ICH", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(species_cd_1) & yearsSinceHarvest >= 25 & bec_zone_code %in% c("CDF", "ICH") & bec_subzone %in% wet, fwveg:="C-5"]
 
  
  #### Unlogged

  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1), fwveg:="O-1a/b"]
  #veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1), fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1) & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & !is.na(species_cd_1) & bec_zone_code %in% c("CWH", "MH", "ICH", "BAFA"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd %in% c(11,12,13), fwveg:="O-1a/b"]
  #veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_descriptor_cd %in% c("NPBR","NP","NPBU"), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd %in% c(11, 12,13) & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"]
  #veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_descriptor_cd %in% c("NPBR","NP","NPBU") & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd ==35, fwveg:="W"]
  #veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_descriptor_cd =="S", fwveg:="W"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_cd ==42, fwveg:="N"]
 # veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & non_productive_descriptor_cd =="C", fwveg:="N"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & (non_productive_descriptor_cd == 60 |non_productive_descriptor_cd == 62 | non_productive_descriptor_cd == 63), fwveg:="O-1a/b"]
  #veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & (non_productive_descriptor_cd == "P" |non_productive_descriptor_cd == "M" | non_productive_descriptor_cd == "OR"), fwveg:="O-1a/b"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_cd) &  bec_zone_code %in% c("CMA","IMA"), fwveg:="N"]
 # veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_descriptor_cd) &  bec_zone_code %in% c("CMA","IMA"), fwveg:="N"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_cd) & bec_zone_code %in% c("CWH","MH", "ICH", "BAFA"), fwveg:="D-1/2"]
  #veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_descriptor_cd) & bec_zone_code %in% c("CWH","MH", "ICH", "BAFA"), fwveg:="D-1/2"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_cd) & !bec_zone_code %in% c("CMA","IMA","CWH","MH", "ICH", "BAFA"), fwveg:="O-1a/b"]
  #veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(non_productive_descriptor_cd) & !bec_zone_code %in% c("CMA","IMA","CWH","MH", "ICH", "BAFA"), fwveg:="O-1a/b"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(fwveg), fwveg:="N"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1 %in% c("LA", "RE","RL","OC"), fwveg:="W"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1=="HG", fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1 %in% c("BY", "BM","BL"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & (land_cover_class_cd_1 %in% c("SL", "ST","HE","HF") |is.na(land_cover_class_cd_1)) & bec_zone_code %in% c("CMA", "IMA"), fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & (land_cover_class_cd_1 %in% c("SL", "ST","HE","HF") |is.na(land_cover_class_cd_1)) & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & (land_cover_class_cd_1 %in% c("SL", "ST","HE","HF") |is.na(land_cover_class_cd_1)) & is.na(fwveg), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="N" & is.na(yearHarvest) & is.na(species_cd_1) & inventory_standard_cd %in% c("V", "I") & land_cover_class_cd_1 %in% c("SI", "GL","PN","RO", "BR", "TA", "BI", "MZ", "LB", "EL", "RS", "ES", "LS", "RM", "BE", "LL", "BU", "RZ", "MU", "CB", "MN", "GP", "TZ", "RN", "UR", "AP", "MI", "OT", "LA", "RE", "RI", "OC"), fwveg:="N"]
  
  ##--------------------------------------------##
  ####bclcs_level_1=="V" & bclcs_level_2=="T" ####
  ##--------------------------------------------##
  
  ####Pure lodgepole or jack pine or undefined pine species.#### 
  
  #Also I just included unknown conifer species (XC) here because lodgepole and jack and undefined pines are the most common conifer species.
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure > 40 & earliest_nonlogging_dist_type %in% "burn" & yearsSinceDisturbance   < 4, fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure > 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance  >= 4 & yearsSinceDisturbance  <= 6), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure > 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance   >= 7 & yearsSinceDisturbance  <= 10), fwveg:= "C-5"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5=="SP" & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-7"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC") & yearsSinceHarvest<=7, fwveg:="S-1"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC") & bclcs_level_5=="SP" & bec_zone_code=="ICH" & bec_subzone %in% wet, fwveg:= "D-1/2"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC") & bclcs_level_5=="SP" & bec_zone_code %in% c("CWH", "CDF", "MH"), fwveg:="D-1/2"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & crown_closure <= 40 & earliest_nonlogging_dist_type %in% "burn" & yearsSinceDisturbance  < 2, fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure <= 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance   >= 2 & yearsSinceDisturbance  <=6), fwveg:= "D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total>=60 & crown_closure <= 40 & earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance  >= 7 & yearsSinceDisturbance<= 10), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total<60 &  earliest_nonlogging_dist_type %in% "burn" & yearsSinceDisturbance   < 2, fwveg:="N"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total<60 &  earliest_nonlogging_dist_type %in% "burn" & (yearsSinceDisturbance  >=2 & yearsSinceDisturbance  <= 10), fwveg:="D-1/2"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 &  bclcs_level_5 %in% c("DE", "OP") & proj_height_1<=4 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="O-1a/b"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 %between% c(4, 12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha) > 8000 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-4"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 %between% c(4,12) & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 >12 & crown_closure <40 & bec_zone_code %in% c("BG", "PP", "IDF", "MS") & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-7"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 >12 & crown_closure <40 & bec_zone_code %in% c("CWH", "MH", "ICH") & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-5"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & bclcs_level_5 %in% c("DE", "OP") & proj_height_1 >12 & crown_closure <40 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  <=5 & stand_percentage_dead >50 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="M-3"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  <=5 & stand_percentage_dead  %between% c(25, 50)  & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-2"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  <=5 & stand_percentage_dead < 25 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-3"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 & stand_percentage_dead > 50 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P", "XC"), fwveg:="C-2"]
  
  
  #### Pure ponderosa pine ####
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1>= 80 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & yearsSinceHarvest<=10, fwveg:="S-1"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 < 4 & is.na(fwveg), fwveg:="O-1a/b"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 %between% c(4, 12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>8000 & is.na(fwveg), fwveg:="C-4"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 %between% c(4,12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha) %between% c(3000, 8000) & is.na(fwveg), fwveg:="C-3"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 > 79 & species_cd_1 == "PY" & bclcs_level_5 %in% c("DE","OP") & proj_height_1 %between% c(4,12) & ((vri_live_stems_per_ha+vri_dead_stems_per_ha)<3000 | is.na(vri_live_stems_per_ha+vri_dead_stems_per_ha)) & is.na(fwveg), fwveg:="C-7"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & proj_height_1 %between% c(12, 17) & is.na(fwveg), fwveg:="C-7"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 > 79 & species_cd_1 == "PY" & bclcs_level_5 =="DE" & proj_height_1 %between% c(12, 17) & is.na(fwveg), fwveg:="C-3"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & proj_height_1 >17 & is.na(fwveg), fwveg:="C-7"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 =="SP" & is.na(fwveg), fwveg:="C-7"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 =="SP" & stand_percentage_dead >=40 & is.na(fwveg), fwveg:="O-1a/b"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "PY" & bclcs_level_5 =="SP" & yearsSinceHarvest<=10 & is.na(fwveg), fwveg:="S-1"]
   
  
  # PA, PF, PW
  
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW"), fwveg:="C-5"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW") & bclcs_level_5 =="DE", fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>=900, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha) %between% c(600,900), fwveg:="C-7"]
  
  
  #### Pure douglas fir ####
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & (proj_height_1>=12 | is.na(proj_height_1)) & crown_closure > 55, fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI")  & yearsSinceHarvest<=6, fwveg:="S-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI")  & yearsSinceHarvest<=6 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="S-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI")  & yearsSinceHarvest<=6 & bec_zone_code=="ICH" & bec_subzone %in% wet, fwveg:="S-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4 & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & proj_height_1 < 4 & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code =="ICH" & bec_subzone %in% wet & proj_height_1 < 4 & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 > 79 & dominant_conifer %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & proj_height_1 >=4 & proj_height_1 <= 12 & (is.na(yearHarvest) | (yearsSinceHarvest>6)) & crown_closure >= 55, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code =="ICH" & bec_subzone %in% wet & proj_height_1 >=4 & proj_height_1 <= 12 & crown_closure > 55  & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 >=4 & proj_height_1 <= 12 & crown_closure > 55 & stand_percentage_dead > 34  & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="C-4"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 >=4 & proj_height_1 <= 12 & crown_closure > 55  & (is.na(yearHarvest) | (yearsSinceHarvest>6)), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & proj_height_1>12 & crown_closure > 55, fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code=="ICH" & bec_subzone %in% wet & crown_closure > 55 & proj_height_1>=12, fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & crown_closure >=26 & crown_closure <=55, fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code=="ICH" & bec_subzone %in% wet & crown_closure >=26 & crown_closure <=55, fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & crown_closure >=26 & crown_closure <=55, fwveg:="C-7"]
   veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & (crown_closure<26 | is.na(crown_closure)) & is.na(fwveg), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code %in% c("CWH", "MH", "CDF") & crown_closure<26, fwveg:= "D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("F","FD","FDC","FDI") & bec_zone_code =="ICH" & bec_subzone %in% wet & crown_closure<26, fwveg:="D-1/2"]
  
  
  # Pure spruce 
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE", fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE" & bclcs_level_5=="SP", fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE" & bclcs_level_5=="DE", fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SE" & yearsSinceHarvest<=10, fwveg:="S-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" &  species_pct_1> 79 & species_cd_1 == "SS" & bclcs_level_5=="SP", fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SS" & bclcs_level_5 %in% c("DE","OP"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "SS"  & yearsSinceHarvest<=6, fwveg:="S-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("SB", "SW"), fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1  %in% c("SB", "SW") & bclcs_level_5 %in% c("DE","OP"), fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("SB", "SW") & bec_zone_code %in% c("BWBS", "SWB"), fwveg:="C-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("SB", "SW")  & yearsSinceHarvest<=10, fwveg:="S-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS"), fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS") & bclcs_level_5 == "OP", fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  bec_zone_code %in% c("BWBS", "SWB"), fwveg:="C-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  bec_zone_code %in% c("BWBS", "SWB") & bclcs_level_5 %in% c("DE", "OP"), fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  !(bec_zone_code %in% c("BWBS", "SWB")) & bclcs_level_5 =="SP", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  &  bec_zone_code %in% c("CWH", "CDF"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  & yearsSinceHarvest<=7, fwveg:="S-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("S","SX","SXW","SXL","SXS")  & proj_height_1 < 4, fwveg:="O-1a/b"]
  

  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC"),fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5 %in% c("OP","DE"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_age_1 < 60, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_age_1 %between% c(60, 99), fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_height_1 < 4, fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & bclcs_level_5=="DE" & proj_height_1 %between% c(4, 15), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("H","HM", "HW", "C","CW", "Y", "YC")  & yearsSinceHarvest<=6, fwveg:="S-3"]
  
  # True fir
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "BG", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 == "BA", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total> 79 & dominant_conifer  %in% c("B", "BB", "BL"), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total> 79 & dominant_conifer %in% c("B", "BB", "BL")  & bclcs_level_5=="SP", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in%  c("T","TW"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% c("J","JR","JS"), fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1> 79 & species_cd_1 %in% deciduous, fwveg:="D-1/2"]
  
  
  #### Mixed species stand ####
 
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & (conifer_pct_cover_total<=20 | is.na(conifer_pct_cover_total)) , fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & conifer_pct_cover_total %between% c(21, 40), fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & yearsSinceHarvest<=6 & conifer_pct_cover_total %between% c(21, 80), fwveg:="S-1"]
  
  # note for below I made the assumption that  on pg 39 of Perrakis et al. (2018) there were refering to the dominant conifer species  when they listed specific species. That is why only the first occurrence of a conifer gets the specific species  
  
  ## conifer cover 41 - 65%
 veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & dominant_conifer %in% c("T","TW") & conifer_pct_cover_total %between% c(41, 65), fwveg:="C-5"]
 veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & (conifer_pct_cover_total > 40 & conifer_pct_cover_total<66) & dominant_conifer %in% c("J","JR","JS"), fwveg:="O-1a/b"]
 veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & (conifer_pct_cover_total > 40 & conifer_pct_cover_total<66) & dominant_conifer %in% c("P","PJ","PF","PL","PLI","PY","PLC","PW","PA","F","FD","FDC","FDI","SE","S","SB","SS","SW","SX","SXW","SXL","SXS","C","CW","Y","YC","H","HM","HW","HXM","B","BB","BA","BG","BL"), fwveg:="M-1/2"] # removed PXJ & PR 
  
  
  ## conifer cover 65-80% 
 veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80), fwveg:="M-1/2"] 
 veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("PL", "PLI", "PLC", "PJ", "P"), fwveg:="M-1/2"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer =="PY", fwveg:="C-7"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("PA", "PF", "PW"), fwveg:="C-5"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="C-7"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & bec_zone_code %in% c("CWH", "CDF") & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="C-5"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="C-5"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & bclcs_level_5=="DE" & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("F","FD","FDC"), fwveg:="M-1/2"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("SS"), fwveg:="C-5"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("SE","S","SB","SS","SW","SX","SXW","SXL","SXS"), fwveg:="M-1/2"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("C","CW","Y","YC","H","HM","HW","HXM","T","TW"), fwveg:="C-5"]
veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1<80 & conifer_pct_cover_total %between% c(66, 80) & dominant_conifer %in% c("B","BB","BA","BG","BL","J","JR","JS"), fwveg:="C-7"]

  ## conifer cover 81-100 %            

  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & bclcs_level_5 == "SP" & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P"), fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & bclcs_level_5 == "SP" & bec_zone_code %in% c("CWH", "CDF", "MH"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & bclcs_level_5 == "SP" & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & bclcs_level_5 %in% c("DE", "OP") & proj_height_1<4, fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & yearsSinceHarvest<=7, fwveg:="S-1"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 %between% c(4, 12) & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>8000, fwveg:="C-4"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 %between% c(4, 12), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12, fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & (proj_height_1 > 12 | is.na(proj_height_1)) & crown_closure<40, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 > 12 & crown_closure<40 & bec_zone_code %in% c("BG", "PP", "IDF", "MS"), fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & (proj_height_1 > 12 | is.na(crown_closure)) & crown_closure<40 & bec_zone_code %in% c("CWH", "MH", "ICH"), fwveg:="C-5"]

  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead < 25, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & bclcs_level_5=="DE" & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead < 25, fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead > 50, fwveg:="M-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS") & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance<=5 &  stand_percentage_dead %between% c(25, 50), fwveg:="C-2"]
  
  # years since IBM attack > 5
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 &  stand_percentage_dead >50, fwveg:= "C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 &  stand_percentage_dead >= 25 & stand_percentage_dead <= 50  & bclcs_level_5 == "DE", fwveg:= "C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")  & proj_height_1 > 12 & earliest_nonlogging_dist_type=="IBM" & yearsSinceDisturbance  > 5 &  stand_percentage_dead >= 25 & stand_percentage_dead <= 50, fwveg:= "C-3"]

  # no IBM
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & !(species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")), fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P")  & !(species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")) & crown_closure <40 & bec_zone_code %in% c("IDF", "PP", "BG", "SBPW", "MS"), fwveg:= "C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PL", "PLI", "PLC", "PJ", "P") & !(species_cd_2 %in% c("B","BB","BA","BG","BL","SE","S","SB","SS","SW","SX","SXW","SXL","SXS")) & crown_closure <40 & bec_zone_code %in% c("CWH", "CDF", "ICH"), fwveg:= "C-5"]
  
# sp. 1 py
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY", fwveg:= "C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY" & yearsSinceHarvest<=7, fwveg:= "S-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY" & (yearsSinceHarvest>7 | is.na(yearHarvest)) & proj_height_1 < 4, fwveg:= "O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY" & bclcs_level_5=="DE" & proj_height_1>=4, fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 =="PY"  & proj_height_1>=4 & ((yearsSinceHarvest>7) | is.na(yearHarvest)) & bclcs_level_5 !="DE", fwveg:= "C-7"]
  
  # Pa, Pf, Pw
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW"), fwveg:= "C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW") & bclcs_level_5=="DE", fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha)>=900, fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 80 & species_cd_1 %in% c("PA", "PF", "PW") & (vri_live_stems_per_ha+vri_dead_stems_per_ha) %between% c(600, 900), fwveg:= "C-7"]
 

  #sp. 1 Fd or any F 
 
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & yearsSinceHarvest<=6, fwveg:= "S-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total >20 & species_cd_1 %in% c("F","FD","FDC","FDI") & yearsSinceHarvest<=6 & bec_zone_code %in% c("CWH", "MH","CDF"), fwveg:= "S-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & yearsSinceHarvest<=6 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "S-3"]

  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4, fwveg:= "O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:= "D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 < 4 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "D-1/2"]

  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "C-3"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & species_cd_2=="PY" & proj_height_1 %between% c(4, 12) & crown_closure>55, fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI") & proj_height_1 %between% c(4, 12) & crown_closure>55 & stand_percentage_dead >34, fwveg:="C-4"]
  
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & proj_height_1 >12 & crown_closure>55, fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & proj_height_1 >12 & crown_closure>55 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & proj_height_1 >12 & crown_closure>55 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:= "C-5"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & (crown_closure %between% c(26, 55) | is.na(crown_closure)), fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & (crown_closure %between% c(26, 55) | is.na(crown_closure)) & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & (crown_closure %between% c(26, 55) | is.na(crown_closure)) & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="C-5"]
  
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & crown_closure < 26, fwveg:="O-1a/b"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & crown_closure < 26 & bec_zone_code %in% c("CWH", "MH", "CDF"), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("F","FD","FDC","FDI")  & crown_closure < 26 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="D-1/2"]
  
  
  #Sp1 S(any) 

  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & bclcs_level_5=="SP" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("BL", "B", "PL", "P", "PLI") & bclcs_level_5=="DE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("BL", "B", "PL", "P", "PLI") & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-3"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("HW", "HM", "CW", "YC") & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SE" & species_cd_2 %in% c("HW", "HM", "CW", "YC") & bclcs_level_5=="DE" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-3"]
  
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SS" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-5"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SB" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SB" & bec_zone_code=="BWBS" & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:="C-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 == "SB" & bclcs_level_5 %in% c("DE","OP") & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-2"]
  
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code=="BWBS", fwveg:= "C-1"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bclcs_level_5 == "OP" & bec_zone_code=="BWBS", fwveg:= "C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bclcs_level_5 == "DE" & bec_zone_code=="BWBS", fwveg:= "C-2"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code %in% c("CWH","MH","CDF"), fwveg:= "C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code %in% c("CWH","MH","CDF") & species_cd_2 %in% c("BL", "B", "P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA"), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bec_zone_code %in% c("CWH","MH","CDF") & species_cd_2 %in% c("BL", "B", "P","PJ","PF","PL","PR","PLI","PXJ","PY","PLC","PW","PA") & bclcs_level_5=="SP", fwveg:="C-7"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")) & bclcs_level_5=="SP", fwveg:= "C-7"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & bclcs_level_5=="DE" & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")) & (yearsSinceHarvest>6 | is.na(yearsSinceHarvest)), fwveg:= "C-2"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & stand_percentage_dead>34 & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")), fwveg:= "C-2"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & species_cd_2 %in% c("PL","PLI","P") & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")), fwveg:= "C-2"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & (stand_percentage_dead<=34 | is.na(stand_percentage_dead)) & species_cd_1 %in% c("S","SW","SX","SXW","SXL","SXS") & !(species_cd_2 %in% c("PL","PLI","P")) & !(bec_zone_code %in% c("CWH","MH","CDF", "BWBS")), fwveg:= "C-3"]
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SB","SE","SS","SW","SX","SXW","SXL","SXS") & yearsSinceHarvest<=6, fwveg:= "S-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SB","SE","SS","SW","SX","SXW","SXL","SXS") & yearsSinceHarvest<=6 & bec_zone_code %in% c("CWH", "MH","CDF"), fwveg:="S-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("S","SB","SE","SS","SW","SX","SXW","SXL","SXS") & yearsSinceHarvest<=6 & bec_zone_code %in% c("ICH") & bec_subzone %in% wet, fwveg:="S-3"]
  
  
  #H(any), C(any), Y(any) 

  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_age_1<60 & proj_height_1 > 15, fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_age_1 %between% c(60,99) & proj_height_1 > 15, fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & !(bclcs_level_5 %in% c("DE", "OP")), fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_height_1<4, fwveg:="D-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & bclcs_level_5=="DE" & proj_height_1 %between% c(4, 15), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("C","CW","Y","YC","H","HM","HW","HXM") & yearsSinceHarvest<=6, fwveg:="S-3"]
       
  # BG, BA, B etc also T and J 
  
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1=="BG", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1=="BA", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1=="BA" & species_cd_2 %in% c("SE", "SW", "S"), fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & coast_interior_cd=="C", fwveg:="M-1/2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & bclcs_level_5=="SP" & coast_interior_cd!="C", fwveg:="C-7"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & coast_interior_cd !="C"& bclcs_level_5=="DE" & species_cd_2 %in% c("SE", "SW", "S"), fwveg:="C-2"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("B","BB","BL") & !(species_cd_2 %in% c("SE", "SW", "S")) & coast_interior_cd !="C" & bclcs_level_5 != "SP", fwveg:="C-3"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("T","TW"), fwveg:="C-5"]
  veg2[bclcs_level_1=="V" & bclcs_level_2=="T" & species_pct_1 < 80 & conifer_pct_cover_total > 20 & species_cd_1 %in% c("J","JR","JS"), fwveg:="C-7"]
  
  # classify species that are not classified into a class already
  veg2[is.na(fwveg) & bclcs_level_4 == "TB", fwveg:="D-1/2"]
  veg2[is.na(fwveg) & bclcs_level_4 == "TM", fwveg:="M-1/2"]
  veg2[is.na(fwveg) & bclcs_level_2 == "N", fwveg:="N"]
  
  
  
  veg2[bclcs_level_5 %in% c("GL","LA"), fwveg := "W"]
  veg2[bclcs_level_2=="W", fwveg:="W"]
 
# note the NA values in the fire_all table were causing ifelse statements to do weird things. This seems better. Hopefully its correct.

table(veg2$fwveg)
veg2[is.na(fwveg),]

                             
table(is.na(veg2$fwveg))

x<- veg2 %>% filter(is.na(fwveg)) %>% dplyr::select(fire, inventory_standard_cd:conifer_pct_cover_total)

y<-veg2 %>% filter(pttype==1) %>% filter(fwveg %in% c("N")) # Note there are a whole bunch of ignition points that have FWI_veg categoriezed as N. This is a problem because N means no fuel. I tried to deal with this by buffering the points 50m then 150m. Buffering did not seem to help.
table(y$fire_yr)
#2002 2003 2004 2005 2006 2007 2008 2009 2010 2011 2012 2013 2014 2015 2016 2017 2018
# 117  147  131   78  143  107  117  163   81   49   56   43   58   63   32   48   57 #2019 
#39 
#2020 2021 
 # 26   36
```


```{r}
table(y$fwveg, y$frt)
tail(y)

y2<-fire_all1 %>% filter(fire==1)

st_write(y, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\tmp\\fire_veg_data_N_or_W.gpkg", delete_layer=TRUE, driver="GPKG")


st_write(veg2, "C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\Fire_data_all_veg_Dec23.gpkg", delete_layer=TRUE, driver="GPKG")

# upload to Kyle castor. Just update the relevant credentials 
key_get('dbpass', keyring = 'postgreSQL')
key_get('dbhost', keyring = 'postgreSQL')

#ogr2ogr -f PostgreSQL PG:"host= user= dbname=castor password= port=5432" C:\\Work\\caribou\\castor_data\\Fire\\Fire_sim_data\\data\\Fire_data_all_veg.gpkg -overwrite -a_srs EPSG:3005 -progress --config PG_USE_COPY YES -nlt PROMOTE_TO_MULTI

```

Quick statistical test of importance of the different vegetation types

FRT 5
```{r}
veg2$fwveg<-as.factor(veg2$fwveg)

veg2[frt==3, frt:=5]

frt5<-veg2[frt==5 & !fwveg %in% c("W", "N"),]
frt5[fwveg == "M-3", fwveg:="M-1/2"]
frt5[fwveg == "S-2", fwveg:="S-1"]
table(frt5$fwveg, frt5$pttype)

z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt5, na.action = na.exclude)
z_null<-glm(pttype ~ 1, family = binomial(link="logit"), data=frt5)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.024

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))

# from looking at Perrakkis see pg 10 I've decided to combine C7 and C3 since there are not too many C7 points and they appear to be somewhat similar in Perrakis

# retry model with C-7 moved to C3

frt5[fwveg == "C-7", fwveg:="C-3"]
table(frt5$fwveg, frt5$pttype)

z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt5, na.action = na.exclude)
z_null<-glm(pttype ~ 1, family = binomial(link="logit"), data=frt5)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.024 only slight decline

visreg(z, rug = 2, scale = "response") 
summary(z)

```

Generally C-1 is different to the rest and D-1/2 is different to the rest otherwise they are all quite similar. Technically if I really want to lump I could go with the folllowing categories:
C1
C2 + C3 + O-1a/b
M-1/2
D-1/2
But for now I will leave the categories as is for now.

For Fire spread:
C-1 is different,
C-2, C-3 and C-7 are the same,
D-1/2 is lowest
O-1/2 is next and different
M-1/2 is 3rd lowest and different.
S-1 has few observations so huge confidence intervals so overlaps all but it seems to ahve the fastest spread rate.


################################
#### FRT 7 ####
################################
```{r}
frt7<-veg2[frt==7 & !fwveg %in% c("W", "N"),]
table(frt7$fwveg, frt7$pttype)

# combine slash categories and out C-7 with C-3 and M-1/2 together with M-3
frt7[fwveg=="S-2", fwveg:="S-1"]
frt7[fwveg == "C-7", fwveg:="C-3"]
frt7[fwveg == "M-3", fwveg:="M-1/2"]


z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt7, na.action = na.exclude)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.014

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))
```
 for FRT7 it looks like M-1/2, O-1a/b is statistically different to the rest. All the C categories are very similar and that D-1/2 is kind of its own thing. S-1/2 is a mix of everything i.e. because it does not have many data point ... I think.
 
 For spread
 C-1 is different to all
 C-2 should be separate
 Could combine C-3 and C-7
 D-1/2 has lowest spread rate and should be separate
 M-1/2 intermediate but not same as any other
 O-1a/b second lowest should be separate
 S-1 is fast and again big spread due to few observations but should be separate I think. Or could combine it with C-1
 


################################
#### FRT 9 ####
################################
```{r}
frt9<-veg2[frt==9 & !fwveg %in% c("W", "N"),]
table(frt9$fwveg, frt9$pttype)


z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt9, na.action = na.exclude)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.014 vegetation only explains 1.4% of the variance.

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))
```
For FRT9 there is no difference between the vegetation categories i.e. I could basically choose to lump them all together as no veg category is different to any other.

Spread:
C-1 and C-2 could be combined if need be.
C-3 should be separate and has highest spread
C-7 should be separate but could be combined with C-3 if need be. as it also has a high spread
D-1/2 has lowest spread
M-1/2 intermediate
O-1a/b slightly higher than D but not mcuch could be combined with D-1/2. Actually possibly should be combined with D-1/2


################################
#### FRT 10 ####
################################
```{r}
frt10<-veg2[frt==10 & !fwveg %in% c("W", "N"),]
table(frt10$fwveg, frt10$pttype)

frt10[fwveg == "M-3", fwveg := "M-1/2"]
#frt10[fwveg == "C-1", fwveg := "C-3"]
frt10[fwveg == "S-2", fwveg := "S-1"]
frt10[fwveg == "S-3", fwveg := "S-1"]

# combine some vegetation types that dont have much data
z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt10, na.action = na.exclude)

#pseudo R2 = (http://127.0.0.1:22491/graphics/plot_zoom_png?width=762&height=398null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.046 vegetation only explains 1.4% of the variance.

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))
```
C1 and C2 could be lumped
Also C-3 and C-7 could be lumped

Spread
C-1 and C-3 could be lumped
rest C's should be separate
D-1/2 lowest, then O-1a/b,
M-1/2 is similar to the C's
S-1 has highest spread with large confidence intervals

################################
#### FRT 11 ####
################################
```{r}
frt11<-veg2[frt==11 & !fwveg %in% c("W", "N", "S-1"),]
table(frt11$fwveg, frt11$pttype)

# combine some vegetation types that dont have much data
z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt11, na.action = na.exclude)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.008 vegetation only explains 0.8% of the variance.

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))
```


```{r}
?sample

dim(frt11)
frt11_1<-frt11[pttype==1,]
frt11_0<-frt11[pttype==0,]

frt11_1_samp_no<-sample(frt11_1$idno, 5000, replace=FALSE)

dat<-rbind(frt11_1[idno %in% frt11_1_samp_no,], frt11_0)


z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = dat, na.action = na.exclude)
visreg(z, rug = 2, scale = "response") 
```

################################
#### FRT 12 ####
################################
```{r}
frt12<-veg2[frt==12 & !fwveg %in% c("W", "N"),]
table(frt12$fwveg, frt12$pttype)

# combine some vegetation types that dont have much data
frt12[fwveg=="S-3", fwveg:="S-1"]
frt12[fwveg=="S-2", fwveg:="S-1"]
frt12[fwveg=="M-3", fwveg:="M-1/2"]

z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt12, na.action = na.exclude)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.0058 vegetation only explains 0.5% of the variance.

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))

```
for frt12 I can definitely combine open and slash, C-7 and D-1/2, and C-2 and C-3 but I think Ill leave all the categories in for now.

################################
#### FRT 13 ####
################################
```{r}
frt13<-veg2[frt==13 & !fwveg %in% c("W", "N"),]
table(frt13$fwveg, frt13$pttype)

# combine some vegetation types that dont have much data
frt13[fwveg=="S-3", fwveg:="S-1"]
frt13[fwveg=="S-2", fwveg:="S-1"]
frt13[fwveg=="M-3", fwveg:="M-1/2"]
# combine C-1 and C-3 because there is not much data for C-1 and they have similar qualities
frt13[fwveg=="C-1", fwveg:="C-3"]

z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt13, na.action = na.exclude)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.019 vegetation only explains 1.9% of the variance.

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))

```

################################
#### FRT 14 ####
################################
```{r}
frt14<-veg2[frt==14 & !fwveg %in% c("W", "N", "C-4"),]
table(frt14$fwveg, frt14$pttype)

# combine some vegetation types that dont have much data
frt14[fwveg=="S-3", fwveg:="S-1"]
frt14[fwveg=="S-2", fwveg:="S-1"]
frt14[fwveg=="M-3", fwveg:="M-1/2"]

z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt14, na.action = na.exclude)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.0061 vegetation only explains 1.9% of the variance.

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))
# it looks like I can combine C-2 and C-3 and C-5 and C-7

frt14[fwveg=="C-2", fwveg:="C-3"]
frt14[fwveg=="C-7", fwveg:="C-5"] 
#this does not change the R2 at all still 0.0061
# Maybe I should go with this lumping

```

################################
#### FRT 15 ####
################################
```{r}
frt15<-veg2[frt==15 & !fwveg %in% c("W", "N"),]
table(frt15$fwveg, frt15$pttype)

# combine some vegetation types that dont have much data
frt15[fwveg=="S-3", fwveg:="S-1"]
frt15[fwveg=="S-2", fwveg:="S-1"]

z <- glm(pttype ~ fwveg, family = binomial(link="logit"), data = frt15, na.action = na.exclude)

#pseudo R2 = (null deviance- residual deviance)/ null deviance
# pseudo R2 = 0.025 vegetation only explains 2.5% of the variance.

visreg(z, rug = 2, scale = "response") 
summary(z)
library(multcomp)
mod<-glht(z, linfct = mcp(fwveg = "Tukey"))
confint(mod)
old.par <- par(mai=c(1,1.25,1,1), no.readonly = TRUE)
plot(print(confint(mod)))

```

